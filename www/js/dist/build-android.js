var EC=window.EC||{};EC.Boot=EC.Boot||{},EC.Boot.getProjects=function(){"use strict";window.setTimeout(function(){navigator.splashscreen.hide()},1e3),window.localStorage.is_db_set===EC.Const.SET?(console.log("getting list"),EC.Project.getList()):$.when(EC.DBAdapter.init()).then(function(){window.localStorage.is_db_set=EC.Const.SET,EC.Project.getList()})};var EC=window.EC||{};EC.Boot=EC.Boot||{},EC.Boot.handleDeviceEvents=function(){"use strict";window.onBackButton=function(){var e=$.mobile.activePage.attr("id");e===EC.Const.INDEX?navigator.app.exitApp():e!==EC.Const.BARCODE&&e!==EC.Const.BRANCH_PREFIX+EC.Const.BARCODE||!window.localStorage.is_dismissing_barcode?e!==EC.Const.PHOTO&&e!==EC.Const.BRANCH_PREFIX+EC.Const.PHOTO||!$.swipebox.isOpen?EC.Routing.goBack(e):$("a#swipebox-close").click():window.localStorage.removeItem("is_dismissing_barcode")},window.onResume=function(){console.log("App resumed")},document.addEventListener("resume",window.onResume,!1)};var EC=window.EC||{};EC.Boot=EC.Boot||{},EC.Boot.init=function(){"use strict";var e=$.Deferred(),t=$.Deferred();EC.Boot.handleDeviceEvents(),EC.Utils.isChrome()&&(console.log("deviceready Chrome"),t.resolve()),JSON.originalParse=JSON.parse,JSON.parse=function(e){return e?JSON.originalParse(e):[]},0===EC.Const.DEBUG&&(console.log=function(){}),window.sessionStorage.app_loaded||EC.Utils.isChrome()||window.localStorage.clear(),void 0===window.localStorage.project_server_url&&(console.log("EC.Const.EPICOLLECT_SERVER_URL - "+EC.Const.EPICOLLECT_SERVER_URL),window.localStorage.project_server_url=EC.Const.EPICOLLECT_SERVER_URL),$(document).bind("pageinit",e.resolve),document.addEventListener("deviceready",t.resolve,!1),window.localStorage.autoload_project_url="",window.handleOpenURL=function(e){console.log("handleOpenURL called with "+e);var t,n;e&&(t=e.split("://project?"),n=t[1],n="http://"+n,window.localStorage.autoload_project_url=n,EC.Boot.getProjects())},$.when(e,t).then(function(){console.log("both JQM and Cordova triggered init event"),EC.Boot.onDeviceReady()})};var EC=window.EC||{};EC.Boot=EC.Boot||{},EC.Boot.onDeviceReady=function(){"use strict";if(EC.Utils.isChrome()?(window.localStorage.DEVICE_LANGUAGE="en",EC.Localise.setLanguage(window.localStorage.DEVICE_LANGUAGE),window.localStorage.BASE_URI=window.location.href.replace("index.html","")):(console.log("OS version: "+window.device.version),EC.Utils.setMediaDirPaths(),window.device.platform===EC.Const.IOS&&$.when(EC.File.createMediaDirs()).then(function(){EC.Utils.setIOSRootPath(),EC.Utils.setIOSPersistentStoragePath()}),window.device.platform===EC.Const.ANDROID&&($.when(EC.File.createMediaDirs()).then(function(){console.log("Android media folders created")}),navigator.globalization.getLocaleName(function(e){var t=e.value.substring(0,2);console.log("ANDROID language: "+JSON.stringify(e)+"\n"),console.log(JSON.stringify(Object.keys(EC.Dictionary))),window.localStorage.DEVICE_LANGUAGE=-1!==Object.keys(EC.Dictionary).indexOf(t)?t:"en",EC.Localise.setLanguage(window.localStorage.DEVICE_LANGUAGE)},function(){console.log("Error getting locale\n"),window.localStorage.DEVICE_LANGUAGE="en",EC.Localise.setLanguage(window.localStorage.DEVICE_LANGUAGE)})),window.device.platform===EC.Const.IOS&&navigator.globalization.getPreferredLanguage(function(e){var t=e.value.substring(0,2);window.localStorage.DEVICE_LANGUAGE=-1!==Object.keys(EC.Dictionary).indexOf(t)?t:"en",EC.Localise.setLanguage(window.localStorage.DEVICE_LANGUAGE),console.log("IOS language: "+e.value+"\n")},function(){console.log("Error getting language\n"),window.localStorage.DEVICE_LANGUAGE="en",EC.Localise.setLanguage(window.localStorage.DEVICE_LANGUAGE)})),EC.db=EC.Utils.openDatabase(),EC.Routing.indexPageEvents(),EC.Routing.inputsPageEvents(),EC.Routing.branchInputsPageEvents(),EC.Ui.bindBtnStates(),window.localStorage.QUERY_LIMIT||(window.localStorage.QUERY_LIMIT=EC.Const.ITEMS_PER_PAGE),window.localStorage.QUERY_ENTRIES_OFFSET=0,window.localStorage.QUERY_CHILD_ENTRIES_OFFSET=0,window.localStorage.QUERY_PARENT_ENTRIES_OFFSET=0,window.sessionStorage.app_loaded=0,$(function(){FastClick.attach(document.body)}),EC.Utils.isChrome())EC.Utils.setPhoneUUID("Chrome_Beta");else switch(document.addEventListener("backbutton",window.onBackButton,!1),window.device.platform){case EC.Const.ANDROID:EC.Utils.setPhoneUUID(device.uuid);break;case EC.Const.IOS:window.IDFVPlugin.getIdentifier(function(e){console.log("Vendor ID:"+e),EC.Utils.setPhoneUUID(e)},function(e){console.log(e),EC.Utils.setPhoneUUID("no_ios_id_available")})}window.localStorage.project_names||(window.localStorage.project_names=JSON.stringify([])),window.device&&window.device.platform===EC.Const.ANDROID&&window.plugins.appPreferences.fetch(function(e){console.log("Referrer value is ****************************"+e)},function(e){console.log("Referrer value error! ************************"+JSON.stringify(e))},"referrer"),EC.Boot.getProjects()};var EC=EC||{};EC.DevicePosition=EC.DevicePosition||{},EC.DevicePosition=function(e){"use strict";return e.initGoogleMap=function(){var e=this,t=new $.Deferred;return e.current_position=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),e.map_options={center:{lat:e.coords.latitude,lng:e.coords.longitude},zoom:16,disableDefaultUI:!0},e.map=new google.maps.Map(document.getElementById("map-canvas"),e.map_options),e.marker=new google.maps.Marker({position:e.current_position,map:e.map,draggable:!0}),e.circle=new google.maps.Circle({center:e.current_position,radius:e.coords.accuracy,map:e.map,fillColor:"#0000FF",fillOpacity:.2,strokeColor:"0",strokeOpacity:0}),e.marker.bindTo("position",e.circle,"center"),e.map.fitBounds(e.circle.getBounds()),window.google.maps.event.addListenerOnce(e.map,"idle",function(){window.setTimeout(function(){t.resolve()},2e3)}),window.google.maps.event.addListener(e.marker,"dragend",function(t){console.debug("final position is "+t.latLng.lat()+" / "+t.latLng.lng()),e.coords.latitude=t.latLng.lat(),e.coords.latitude=t.latLng.lng(),EC.Notification.showToast("Marker dragged by user","short")}),t.promise()},e}(EC.DevicePosition);var EC=EC||{};EC.DevicePosition=EC.DevicePosition||{},EC.DevicePosition=function(e){"use strict";return e.map={},e.marker={},e.circle={},e.coords={},e.current_position={},e.map_options={},e.timeout=3e4,e.is_first_attempt=!0,e.is_api_loaded=!1,e.is_enhanced_map_on=function(){return 1===parseInt(window.localStorage.is_enhanced_map_on,10)},e.watchTimeout=function(){return window.device.platform===EC.Const.IOS?1/0:3e4},e.getCurrentPosition=function(){function e(e){o.setCoords(e),n.resolve()}function t(e){console.log(e),n.reject()}var n=new $.Deferred,o=this;return navigator.geolocation.getCurrentPosition(e,t,{maximumAge:0,timeout:o.timeout,enableHighAccuracy:!0}),n.promise()},e.watchPosition=function(){function e(e){console.log("onWatchSuccess called, accuracy: "+e.coords.accuracy),a.setCoords(e),window.navigator.geolocation.clearWatch(n),o.resolve(!0)}function t(e){switch(console.log(e),window.navigator.geolocation.clearWatch(n),e.code){case 1:window.device.platform===EC.Const.IOS&&EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("location_service_fail"));break;case 3:EC.Notification.showAlert(EC.Localise.getTranslation("error"),e.message+EC.Localise.getTranslation("location_fail"));break;default:EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("unknow_error"))}o.resolve(!1)}var n,o=new $.Deferred,r=EC.DevicePosition.watchTimeout(),a=this;return a.is_first_attempt?(n=navigator.geolocation.watchPosition(e,t,{maximumAge:0,timeout:r,enableHighAccuracy:!0}),a.is_first_attempt=!1):(window.setTimeout(function(){window.navigator.geolocation.clearWatch(n),o.resolve(!0),console.log("setTimeout called without location")},3e4),n=navigator.geolocation.watchPosition(e,t,{maximumAge:0,timeout:r,enableHighAccuracy:!0})),o.promise()},e.setCoords=function(e){var t=this;t.coords={latitude:null===e.coords.latitude?"":e.coords.latitude,longitude:null===e.coords.longitude?"":e.coords.longitude,altitude:null===e.coords.altitude?"":e.coords.altitude,accuracy:null===e.coords.accuracy?"":e.coords.accuracy,altitude_accuracy:null===e.coords.altitudeAccuracy?"":e.coords.altitudeAccuracy,heading:null===e.coords.heading?"":e.coords.heading}},e.getCoordsFormattedText=function(){return"Latitude: "+this.coords.latitude+",\nLongitude: "+this.coords.longitude+",\nAltitude: "+this.coords.altitude+",\nAccuracy: "+this.coords.accuracy+",\nAltitude Accuracy: "+this.coords.altitude_accuracy+",\nHeading: "+this.coords.heading+"\n"},e.getCoordsEmptyText=function(){return"Latitude: ,\nLongitude: ,\nAltitude: ,\nAccuracy: ,\nAltitude Accuracy: ,\nHeading: \n"},e}(EC.DevicePosition);var EC=EC||{};EC.DevicePosition=EC.DevicePosition||{},EC.DevicePosition.loadGoogleMapsApi=function(){"use strict";var e=new $.Deferred;return window.mapIsLoaded=function(){e.resolve()},void 0!==window.google&&window.google.maps?(console.log("Maps API cached already"),EC.Utils.hasGoodConnection()?e.resolve():e.reject()):EC.Utils.hasGoodConnection()?$.getScript("https://maps.googleapis.com/maps/api/js?sensor=true&callback=mapIsLoaded").done(function(e,t){console.log(t)}).fail(function(t,n,o){console.log(t+o),e.reject()}):e.reject(),e.promise()};var EC=EC||{};EC.DevicePosition=EC.DevicePosition||{},EC.DevicePosition=function(e){"use strict";return e.updateGoogleMap=function(){var e=this,t=new $.Deferred;return e.current_position=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),e.map_options={center:{lat:e.coords.latitude,lng:e.coords.longitude},zoom:16,disableDefaultUI:!0},e.map=new google.maps.Map(document.getElementById("map-canvas"),e.map_options),e.marker=new google.maps.Marker({position:e.current_position,map:e.map,draggable:!0}),e.circle=new google.maps.Circle({center:e.current_position,radius:e.coords.accuracy,map:e.map,fillColor:"#0000FF",fillOpacity:.2,strokeColor:"0",strokeOpacity:0}),e.marker.bindTo("position",e.circle,"center"),e.map.fitBounds(e.circle.getBounds()),window.google.maps.event.addListenerOnce(e.map,"idle",function(){window.setTimeout(function(){t.resolve()},2e3)}),window.google.maps.event.addListener(e.marker,"dragend",function(t){console.debug("final position is "+t.latLng.lat()+" / "+t.latLng.lng()),e.coords.latitude=t.latLng.lat(),e.coords.latitude=t.latLng.lng(),EC.Notification.showToast("Marker dragged by user","short")}),t.promise()},e}(EC.DevicePosition);var EC=EC||{};EC.Notification=EC.Notification||{},EC.Notification=function(){"use strict";var e=function(e,t){navigator.notification&&!EC.Utils.isChrome()?navigator.notification.alert(t,null,e,"ok"):alert(e?e+": "+t:t)},t=function(e,t,n,o,r,a){var i,s=r;if(navigator.notification&&!EC.Utils.isChrome()){var l=function(e){console.log("btn_index: "+e),1===e&&EC.Utils.executeFunctionByName(n,window)},c=function(e){switch(e){case 1:EC.Utils.executeFunctionByName(n,window);break;case 2:EC.Notification.showProgressDialog(),a?EC.BranchInputs.saveValuesOnExit(s):EC.Inputs.saveValuesOnExit(s);break;default:return}};o?navigator.notification.confirm(t,c,e,[EC.Localise.getTranslation("no"),EC.Localise.getTranslation("save"),EC.Localise.getTranslation("dismiss")]):(window.device.platform===EC.Const.IOS&&navigator.notification.confirm(t,l,e,[EC.Localise.getTranslation("confirm"),EC.Localise.getTranslation("dismiss")]),window.device.platform===EC.Const.ANDROID&&navigator.notification.confirm(t,l,e,[EC.Localise.getTranslation("confirm"),EC.Localise.getTranslation("dismiss")]))}else{if(i=confirm(e?e+": "+t:t),!i)return;EC.Utils.executeFunctionByName(n,window)}},n=function(e,t){return EC.Utils.isChrome()?void alert(e):void window.plugins.toast.show(e,t,"bottom",function(e){},function(e){alert("toast error: "+e)})},o=function(e,t){var n=e,o=t;if(EC.Utils.isChrome())$.mobile.loading("show",{text:t,textVisible:!0,theme:"a",html:""});else switch(window.device.platform){case EC.Const.ANDROID:navigator.notification.activityStart(n||"",o||"Loading...");break;case EC.Const.IOS:window.ActivityIndicator.show(o)}},r=function(){if(EC.Utils.isChrome())return void $.mobile.loading("hide");switch(console.log("Platform: "+device.platform),window.device.platform){case EC.Const.ANDROID:window.setTimeout(function(){navigator.notification.activityStop()},500);break;case EC.Const.IOS:window.ActivityIndicator&&(window.localStorage.edit_mode?window.ActivityIndicator.hide():window.setTimeout(function(){window.ActivityIndicator.hide()},500))}};return{showAlert:e,askConfirm:t,showToast:n,showProgressDialog:o,hideProgressDialog:r}}();var EC=EC||{};EC.Ui=EC.Ui||{},EC.Ui={colors:{tap_action_overlay:"#2a6fc3",default_button_background:"#EEEEEE",list_item_background:"#DDDDDD",fa_entry_value_embedded_btn_default:"#000000"},bindBtnStates:function(){"use strict";var e=this;$(document).on("vmousedown","div.ui-btn-right",function(t){t.preventDefault(),t.stopPropagation(),$(this).css("background-color",e.colors.tap_action_overlay)}),$(document).on("vmouseup","div.ui-btn-right",function(e){e.preventDefault(),e.stopPropagation(),$(this).css("background","none")}),$(document).on("vmousedown","div.h-nav-item",function(t){t.preventDefault(),t.stopPropagation(),$(this).css("background-color",e.colors.tap_action_overlay)}),$(document).on("vmouseup","div.h-nav-item",function(e){e.preventDefault(),e.stopPropagation(),$(this).css("background","none")}),$(document).on("vmousedown","li.v-nav-item",function(t){t.preventDefault(),t.stopPropagation(),$(this).css("background-color",e.colors.tap_action_overlay)}),$(document).on("vmouseup","li.v-nav-item",function(t){t.preventDefault(),t.stopPropagation(),$(this).css("background-color",e.colors.list_item_background)}),$(document).on("vmousedown","li.h-nav-item",function(t){t.preventDefault(),t.stopPropagation(),$(this).css("background-color",e.colors.tap_action_overlay)}),$(document).on("vmouseup","li.h-nav-item",function(t){t.preventDefault(),t.stopPropagation(),$(this).css("background-color",e.colors.list_item_background)}),$(document).on("vmousedown","li.inactive-tab",function(t){t.preventDefault(),t.stopPropagation(),$(this).css("background-color",e.colors.tap_action_overlay)}),$(document).on("vmouseup","li.inactive-tab",function(t){t.preventDefault(),t.stopPropagation(),$(this).css("background-color",e.colors.default_button_background)}),$(document).on("vmousedown",".input-prev-btn",function(t){t.preventDefault(),t.stopPropagation(),$(this).css("background-color",e.colors.tap_action_overlay)}),$(document).on("vmouseup",".input-prev-btn",function(t){t.preventDefault(),t.stopPropagation(),$(this).css("background-color",e.colors.default_button_background)}),$(document).on("vmousedown",".input-next-btn",function(t){t.preventDefault(),t.stopPropagation(),$(this).css("background-color",e.colors.tap_action_overlay)}),$(document).on("vmouseup",".input-next-btn",function(t){t.preventDefault(),t.stopPropagation(),$(this).css("background-color",e.colors.default_button_background)}),$(document).on("vmousedown","div.embedded-btn",function(t){t.preventDefault(),t.stopPropagation(),$(this).css("background-color",e.colors.tap_action_overlay)}),$(document).on("vmouseup","div.embedded-btn",function(t){t.preventDefault(),t.stopPropagation(),$(this).css("background-color",e.colors.default_button_background)}),$(document).on("vmousedown","i.fa-ep-entry-value-embedded-btn",function(t){t.preventDefault(),t.stopPropagation(),$(this).css("color",e.colors.tap_action_overlay)}),$(document).on("vmouseup","i.fa-ep-entry-value-embedded-btn",function(t){t.preventDefault(),t.stopPropagation(),$(this).css("color",e.colors.fa_entry_value_embedded_btn_default)}),$(document).on("vmousedown",".more-items-btn",function(t){t.preventDefault(),t.stopPropagation(),$(this).css("background-color",e.colors.tap_action_overlay)}),$(document).on("vmouseup",".more-items-btn",function(t){t.preventDefault(),t.stopPropagation(),$(this).css("background-color",e.colors.default_button_background)})}};var EC=EC||{};EC.Utils=EC.Utils||{},EC.Utils=function(){"use strict";function e(e){return!isNaN(parseFloat(e))&&isFinite(e)}function t(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}function n(e,t){var n=t,o=e,r=n.split("/");return r.pop(),n=r.join("/"),n+="/",console.log("cache_path "+o),console.log("file_path"+n),n===o?!1:!0}function o(){var e;switch(window.device.platform){case EC.Const.ANDROID:e=EC.Utils.getTimestamp()+".mp4";break;case EC.Const.IOS:e=EC.Utils.getTimestamp()+".wav"}return e}function r(){var e=!0;switch(navigator.connection.type){case Connection.NONE:console.log("no internet connection"),e=!1;break;case Connection.UNKNOWN:console.log("unknown internet connection"),e=!1}return e}var a=function(e){this.UUID=e,console.log("device UUID: "+this.UUID)},i=function(){return this.UUID},s=function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:7&n|8).toString(16)});return t},l=function(){return s()},c=function(){return Math.floor((new Date).getTime()/1e3)},d=function(){return EC.Utils.isChrome()?(console.log("chrome websql db init"),window.openDatabase("epicollect","1.0","Epicollect",5242880)):(console.log("native SQLite db init"),window.sqlitePlugin.openDatabase({name:"epicollect"}))},u=function(){var e=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;return!!window.chrome&&!e},E=function(e){var t,n=(new Date).getTime();for(t=0;1e7>t&&!((new Date).getTime()-n>e);t++);},p=function(e,t){var n,o,r,a=e,i=t,s=[];for(n=a.split("date"===i?"/":":"),r=n.length,o=0;r>o;o++)switch(n[o]){case"dd":s.push("%d");break;case"MM":s.push("%m");break;case"yyyy":s.push("%Y");break;case"YYYY":s.push("%Y");break;case"HH":s.push("%H");break;case"hh":s.push("%I");break;case"mm":s.push("%M");break;case"ss":s.push("%S")}return s.join("date"===i?"/":":")},C=function(e,t){var n,o=e,r=t,a=o.getDate(),i=o.getMonth()+1,s=o.getFullYear(),l=r.split("/"),c=[],d=l.length;for(n=0;d>n;n++)switch(l[n]){case"dd":c.push(a);break;case"MM":c.push(i);break;case"yyyy":c.push(s)}return c.join("/")},_=function(e,t){var n,o=e,r=o.split("-"),a=t,i=r[2],s=r[1],l=r[0],c=a.split("/"),d=[],u=c.length;for(n=0;u>n;n++)switch(c[n]){case"dd":d.push(i);break;case"MM":d.push(s);break;case"yyyy":d.push(l)}return d.join("/")},h=function(e,t){var n,o=e,r=t,a=o.getHours(),i=(a+11)%12+1,s=o.getMinutes(),l=o.getSeconds(),c=r.split(":"),d=[],u=c.length,E=function(e){return e>=0&&10>e?"0"+e:e};for(n=0;u>n;n++)switch(c[n]){case"hh":d.push(i);break;case"HH":d.push(E(a));break;case"mm":d.push(E(s));break;case"ss":d.push(E(l))}return d.join(":")},f=function(e,t){var n,o=e,r=t,a=o.split(":"),i=parseInt(a[0],10),s=(i+11)%12+1,l=parseInt(a[1],10),c=parseInt(a[2],10),d=r.split(":"),u=[],E=d.length,p=function(e){return e>=0&&10>e?"0"+e:e};for(n=0;E>n;n++)switch(d[n]){case"hh":u.push(s);break;case"HH":u.push(p(i));break;case"mm":u.push(p(l));break;case"ss":u.push(p(c))}return u.join(":")},v=function(e){this.forms=e,window.localStorage.forms=JSON.stringify(this.forms)},m=function(e){this.forms=this.forms||JSON.parse(window.localStorage.forms);var t,n,o,r,a,i=parseInt(e,10),s=this.forms.length;for(t=0;s>t;t++)if(parseInt(this.forms[t]._id,10)===i)return t-1===-1?(n=0,o=""):(n=this.forms[t-1]._id,o=this.forms[t-1].name),t+1===s?(r=0,a=""):(r=this.forms[t+1]._id,a=this.forms[t+1].name),{parent:n,pname:o,child:r,cname:a}},g=function(e){var t=e,n={},o=t.split(",");return o[0]===EC.Const.SKIPPED?(n.latitude="",n.longitude="",n.altitude="",n.accuracy="",n.heading=""):(n.latitude=parseFloat(o[0].replace("Latitude: ","").replace(/(\r\n|\n|\r)/gm,"")),n.longitude=parseFloat(o[1].replace("Longitude: ","").replace(/(\r\n|\n|\r)/gm,"")),n.altitude=parseFloat(o[2].replace("Altitude: ","").replace(/(\r\n|\n|\r)/gm,"")),n.accuracy=parseFloat(o[3].replace("Accuracy: ","").replace(/(\r\n|\n|\r)/gm,"")),n.heading=parseFloat(o[5].replace("Heading: ","").replace(/(\r\n|\n|\r)/gm,"")),n.latitude=isNaN(n.latitude)?"":n.latitude,n.longitude=isNaN(n.longitude)?"":n.longitude,n.altitude=isNaN(n.altitude)?"":n.altitude,n.accuracy=isNaN(n.accuracy)?"":n.accuracy,n.heading=isNaN(n.heading)?"":n.heading),n},w=function(e){var t=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return t.test(e)},y=function(e){var t=/^[\w-]+(\.[\w-]+)*@([a-z0-9-]+(\.[a-z0-9-]+)*?\.[a-z]{2,6}|(\d{1,3}\.){3}\d{1,3})(:\d{4})?$/;return t.test(e)},S=function(){return this.forms},I=function(){function e(e){console.log("gps is "+e),e?t.resolve():t.reject()}var t=new $.Deferred;if(!EC.Utils.isChrome())switch(window.device.platform){case EC.Const.ANDROID:cordova.plugins.diagnostic.isLocationEnabled(e);break;case EC.Const.IOS:t.resolve()}return t.promise()},b=function(e,t){var n,o=Array.prototype.slice.call(arguments).splice(2),r=e.split("."),a=r.pop();for(n=0;n<r.length;n++)t=t[r[n]];return t[a].apply(this,o)},T=function(e){var t,n,o,r,a=[];for(t=e.split(","),o=t.length,n=0;o>n;n+=2){if(r={},r.jump_to=t[n],"!"===t[n+1].charAt(0))r.jump_when=EC.Const.JUMP_VALUE_IS_NOT,r.jump_value=t[n+1].substr(1);else switch(t[n+1]){case EC.Const.JUMP_ALWAYS:r.jump_when=EC.Const.JUMP_ALWAYS,r.jump_value="";break;case EC.Const.JUMP_FIELD_IS_BLANK:r.jump_when=EC.Const.JUMP_FIELD_IS_BLANK,r.jump_value="";break;default:r.jump_when=r.jump_when=EC.Const.JUMP_VALUE_IS,r.jump_value=t[n+1]}a.push(r)}return a},O=function(e){var t,n=JSON.parse(window.localStorage.forms),o=n.length,r=e;for(t=0;o>t;t++)if(n[t].name===r)return n[t]._id},N=function(){var e,t=JSON.parse(window.localStorage.forms),n=parseInt(window.localStorage.form_id,10),o=t.length;for(e=0;o>e;e++)if(parseInt(t[e]._id,10)===n)return parseInt(t[e].is_genkey_hidden,10)},A=function(){var e=JSON.parse(window.localStorage.branch_form);return e.is_genkey_hidden},D=function(e){var t,n=JSON.parse(window.localStorage.local_input_ids),o=n.length,r=e;for(t=0;o>t;t++)if(n[t].ref===r)return n[t]._id},R=function(e){var t,n=parseInt(e,10),o=JSON.parse(window.localStorage.forms),r=o.length;for(t=0;r>t;t++)if(o[t]._id===n)return o[t].key},k=function(){var e,t=JSON.parse(window.localStorage.forms),n=t.length,o=!1;for(e=0;n>e;e++)1===parseInt(t[e].has_branches,10)&&(o=!0);return o},L=function(e){var t,n=parseInt(e,10),o=JSON.parse(window.localStorage.forms),r=o.length;for(t=0;r>t;t++)if(o[t]._id===n)return o[t-1].key},U=function(e){var t,n=parseInt(e,10),o=JSON.parse(window.localStorage.forms),r=o.length;for(t=0;r>t;t++)if(parseInt(o[t]._id,10)===n)return o[t]},P=function(){var e,t,n=JSON.parse(window.localStorage.forms),o=0;for(e=0;t>e;e++)o+=parseInt(n[e].entries,10);return o},B=function(e){var t,n=parseInt(e,10),o=JSON.parse(window.localStorage.forms),r=o.length;for(t=0;r>t;t++)if(o[t]._id===n)return o[t-1]},F=function(e){var t,n=JSON.parse(window.localStorage.forms),o=parseInt(e,10),r=n.length;for(t=0;r>t;t++)if(n[t]._id===o){n[t].entries=n[t].entries+1;break}window.localStorage.forms=JSON.stringify(n)},j=function(e){var t,n=JSON.parse(window.localStorage.forms),o=parseInt(e,10),r=n.length;for(t=0;r>t;t++)if(n[t]._id===o)return n.slice(t+1,r+1)},x=function(e,t){var n=e.split("&"),o=n[n.length-1].split("=");return o[o.length-1]=t,n[n.length-1]=o[0]+"="+o[1],console.log(n),n.join("&")},H=function(e,t,n){function o(e,t){return-1<e.map(function(e){return e.toLowerCase()}).indexOf(t.toLowerCase())}return e?n?-1!==e.indexOf(t):o(e,t):!1},V=function(){var e,t=new $.Deferred;return cordova.getAppVersion(function(n){console.log("App version "+n),e=n,t.resolve(e)}),t.promise()},M=function(){var e,t=new $.Deferred;return cordova.getAppVersion.getAppName(function(n){console.log("App name "+n),e=n,t.resolve(e)}),t.promise()},G=function(){var e,t=new $.Deferred;return cordova.getAppVersion.getAppName(function(n){e=n.replace(/[^\w\s]/gi,"-"),e+="-export",t.resolve(e)}),t.promise()},J=function(){var e;if(EC.Utils.isChrome())e=window.localStorage.BASE_URI;else switch(window.device.platform){case"Android":console.log("kitkat regex: "+EC.Const.KITKAT_REGEX.test(window.device.version)),e=1!==EC.Const.DEBUG||EC.Const.KITKAT_REGEX.test(window.device.version)||EC.Const.LOLLIPOP_REGEX.test(window.device.version)?EC.Const.ANDROID_ASSETS_ABS_PATH:EC.Const.ANDROID_ASSETS_ABS_PATH;break;case"iOS":e=EC.Const.IOS_ASSETS_ABS_PATH}return e},W=function(e,t,n){var o=this,r={is_valid:!0,message:""},a=e,i=t,s=n;if(a.type===EC.Const.BRANCH)return r;if(a.type===EC.Const.INTEGER&&parseFloat(i)!==parseInt(i,10)&&""!==i)return r.is_valid=!1,r.message=EC.Localise.getTranslation("invalid_integer"),r;if(a.type===EC.Const.DECIMAL&&!o.isNumber(i)&&""!==i)return r.is_valid=!1,r.message=EC.Localise.getTranslation("invalid_decimal"),r;if(1===a.is_primary_key&&-1!==i.indexOf(EC.Const.ENTRY_ROOT_PATH_SEPARATOR))return r.is_valid=!1,r.message=EC.Localise.getTranslation("pk_reserved_char")+EC.Const.ENTRY_ROOT_PATH_SEPARATOR,r;if(""!==a.regex&&!i.match(a.regex))return r.is_valid=!1,r.message=EC.Localise.getTranslation("invalid_regex")+a.regex,r;if(1===parseInt(a.has_double_check,10)&&i!==s)return r.is_valid=!1,r.message=EC.Localise.getTranslation("values_unmatched"),r;if(""!==a.max_range&&parseFloat(i)>parseFloat(a.max_range))return r.is_valid=!1,r.message=EC.Localise.getTranslation("out_of_range"),r;if(""!==a.min_range&&parseFloat(i)<parseFloat(a.min_range))return r.is_valid=!1,r.message=EC.Localise.getTranslation("out_of_range"),r;if(a.value===EC.Const.SKIPPED)return r.is_valid=!1,r.message=EC.Localise.getTranslation("reserved_keyword"),r;if(1===parseInt(a.is_required,10))if(a.type===EC.Const.DROPDOWN||a.type===EC.Const.RADIO||a.type===EC.Const.CHECKBOX){if(i===EC.Const.NO_OPTION_SELECTED)return r.is_valid=!1,r.message=EC.Localise.getTranslation("field_required"),r}else if(""===i)return r.is_valid=!1,r.message=EC.Localise.getTranslation("field_required"),r;return r},q=function(){function e(e){var t;window.device.platform===EC.Const.IOS&&parseFloat(window.device.version)>=8?(t=e.toURL(),EC.Const.IOS_ASSETS_ABS_PATH=t.replace("file:////","file:///private/"),EC.Const.IOS_ASSETS_ABS_PATH+="www/",console.log("iOS 8+ root www - "+EC.Const.IOS_ASSETS_ABS_PATH)):(console.log(e),t=e.root.nativeURL,t=t.replace("Documents/",""),EC.Const.IOS_ASSETS_ABS_PATH=t+EC.Const.IOS_ASSETS_ABS_PATH,console.log("iOS root www - "+EC.Const.IOS_ASSETS_ABS_PATH))}function t(e){console.log(JSON.stringify(e))}window.device.platform===EC.Const.IOS&&parseFloat(window.device.version)>=8?window.resolveLocalFileSystemURL(cordova.file.applicationDirectory,e,t):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,e,t)},X=function(){function e(e){EC.Const.IOS_APP_PRIVATE_URI=e.root.nativeURL,EC.Const.IOS_APP_PRIVATE_URI=EC.Const.IOS_APP_PRIVATE_URI.slice(7),console.log("iOS Documents path - "+EC.Const.IOS_APP_PRIVATE_URI)}function t(e){console.log(JSON.stringify(e))}window.requestFileSystem(LocalFileSystem.PERSISTENT,0,e,t)},Y=function(){switch(window.device.platform){case EC.Const.ANDROID:EC.Const.PHOTO_DIR="/files/images/",EC.Const.AUDIO_DIR="/files/audios/",EC.Const.VIDEO_DIR="/files/videos/";break;case EC.Const.IOS:EC.Const.PHOTO_DIR="images/",EC.Const.AUDIO_DIR="audios/",EC.Const.VIDEO_DIR="videos/"}},K=function(e,t){var n,o=e,r=t,a=o.length;for(n=0;a>n;n++)if(o[n].filename===r)return o[n].timestamp},Q=function(e,t){function n(e,t){var n,o=t,r=o.length;for(n=0;r>n;n++)if(o[n].ref===e)return o[n]}function o(e,t){var n,o,r=e.value.split(","),a=t,i=r.length,s=a.options.length,l=[];for(n=0;i>n;n++)for(o=0;s>o;o++)a.options[o].value===r[n].trim()&&l.push(a.options[o].label);return l}function r(e,t){var n,o=t,r=e,a=o.options.length;for(n=0;a>n;n++)if(o.options[n].value===r.value.trim())return o.options[n].label}var a,i=e,s=i.ref,l=t,c=n(s,l);switch(i.type){case EC.Const.CHECKBOX:a=o(i,c);break;case EC.Const.DROPDOWN:a=r(i,c);break;case EC.Const.RADIO:a=r(i,c)}return a},z=function(){return EC.Utils.isChrome()?!0:navigator.network?!(navigator.network.connection.type===Connection.NONE||navigator.network.connection.type===Connection.UNKNOWN):void 0};return{setForms:v,getForms:S,getPhoneUUID:i,setPhoneUUID:a,getGenKey:l,getParentAndChildForms:m,getTimestamp:c,hasConnection:z,openDatabase:d,isChrome:u,projectHasBranches:k,parseTimestampDate2Posix:p,parseDate:C,parseIOSDate:_,parseTime:h,parseIOSTime:f,parseLocationString:g,parseJumpString:T,isURL:w,isNumber:e,sleep:E,isGPSEnabled:I,executeFunctionByName:b,getLocalInputID:D,getLocalFormID:O,isValidEmail:y,getFormPrimaryKeyRef:R,getFormParentPrimaryKeyRef:L,getFormByID:U,getEntriesCount:P,isFormGenKeyHidden:N,isBranchFormGenKeyHidden:A,getParentFormByChildID:B,updateFormsObj:F,getChildrenForms:j,changeHashNavigationDirection:x,inArray:H,getVersionName:V,getAppName:M,getExportDirName:G,getPageBaseURI:J,isValidValue:W,setIOSRootPath:q,setMediaDirPaths:Y,setIOSPersistentStoragePath:X,getIOSFilename:K,getParameterByName:t,mapLabelToValue:Q,isAudioFileStored:n,generateAudioFileName:o,hasGoodConnection:r}}();var EC=window.EC||{};EC.Config=function(){"use strict";Array.prototype.unique=function(){var e,t,n=this.concat();for(e=0;e<n.length;++e)for(t=e+1;t<n.length;++t)n[e]===n[t]&&n.splice(t--,1);return n},Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n,o,r=t||0;if(!this)throw new TypeError;if(o=this.length,0===o||r>=o)return-1;for(0>r&&(r=o-Math.abs(r)),n=r;o>n;n++)if(this[n]===e)return n;return-1}),Array.prototype.equals=function(e,t){var n;if(!e)return!1;if(1===arguments.length&&(t=!0),this.length!==e.length)return!1;for(n=0;n<this.length;n++){if(this[n]instanceof Array&&e[n]instanceof Array&&!this[n].equals(e[n],t))return!1;if(t&&this[n]!==e[n])return!1;if(!t)return this.sort().equals(e.sort(),!0)}return!0},String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(e,t){return t=t||0,this.indexOf(e,t)===t}}),String.prototype.trunc=function(e){return this.substr(0,e-1)+(this.length>e?"...":"")},Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],o=n.length;return function(r){if("object"!=typeof r&&("function"!=typeof r||null===r))throw new TypeError("Object.keys called on non-object");var a,i,s=[];for(a in r)e.call(r,a)&&s.push(a);if(t)for(i=0;o>i;i++)e.call(r,n[i])&&s.push(n[i]);return s}}())}();var EC=EC||{};EC.Const=EC.Const||{},EC.Const=function(){"use strict";return{DEBUG:1,ANDROID:"Android",IOS:"iOS",ANDROID_ASSETS_ABS_PATH:"file:///android_asset/www/",IOS_ASSETS_ABS_PATH:"Epicollect+.app/www/",ANDROID_APP_PRIVATE_URI:"file:///data/data/uk.ac.imperial.epicollectplus.html5",IOS_APP_PRIVATE_URI:"",TEXT:"text",TEXTAREA:"textarea",INTEGER:"integer",DECIMAL:"decimal",DATE:"date",TIME:"time",RADIO:"radio",CHECKBOX:"checkbox",DROPDOWN:"select",BARCODE:"barcode",LOCATION:"location",AUDIO:"audio",VIDEO:"video",PHOTO:"photo",BRANCH:"branch",BRANCH_PREFIX:"branch-",PHOTO_DIR:"",AUDIO_DIR:"",VIDEO_DIR:"",BRANCH_VIEWS_DIR:"branch_inputs/",INPUT_VIEWS_DIR:"inputs/",VIEWS_DIR:"views/",HTML_FILE_EXT:".html",PHOTO_FILE_EXTENSION:"jpg",TRANSACTION_SUCCESS:"TRANSACTION SUCCESS ",TRANSACTION_ERROR:"TRANSACTION ERROR ----------------------------------------------------------------**",DELETE:"delete",DELETE_SINGLE_ENTRY:"delete_single_entry",RESTORE:"restore",INSERT:"insert",DOWNLOAD:"download",START_HIERARCHY_UPLOAD:"start_hierarchy_upload",STOP_HIERARCHY_UPLOAD:"stop_hierarchy_upload",HIERARCHY_RECURSION:"hierarchy_recursion",START_BRANCH_UPLOAD:"start_branch_upload",STOP_BRANCH_UPLOAD:"stop_branch_upload",BRANCH_RECURSION:"branch_recursion",ADDING:"adding",FORWARD:"forward",BACKWARD:"backward",EDITING:"editing",PREVIOUS:"previous",NEXT:"next",VIEW:"view",
INDEX_VIEW:"index.html",UPLOAD_VIEW:"upload.html",DOWNLOAD_VIEW:"download.html",EMAIL_BACKUP_VIEW:"email-backup.html",ENTRIES_LIST_VIEW:"entries-list.html",SETTINGS_VIEW:"settings.html",ADD_PROJECT_VIEW:"add-project.html",FORMS_VIEW:"forms.html",SAVE_CONFIRM_VIEW:"save-confirm.html",BRANCH_ENTRIES_LIST_VIEW:"branch-entries-list.html",BRANCH_SAVE_CONFIRM_VIEW:"branch-save-confirm.html",BRANCH_FEEDBACK_VIEW:"branch-feedback.html",PROJECT_NAME_MAX_LENGTH:22,FORM_NAME_MAX_LENGTH:12,ITEMS_PER_PAGE:20,SET:1,INDEX:"index",INPUTS:"inputs",PROJECT_LIST:"Project List",FORMS:"Forms",FILLER:"_fill3r_",NO_OPTION_SELECTED:"select_one_option",PHOTO_AVAILABLE_LABEL:"photo_available",PHOTO_NOT_AVAILABLE_LABEL:"no_photo",AUDIO_AVAILABLE_LABEL:"audio_available",AUDIO_NOT_AVAILABLE_LABEL:"no_audio",VIDEO_AVAILABLE_LABEL:"video_available",VIDEO_NOT_AVAILABLE_LABEL:"no_video",JUMP_VALUE_IS:"IS",JUMP_VALUE_IS_NOT:"IS NOT",JUMP_ALWAYS:"ALL",JUMP_FIELD_IS_BLANK:"NULL",SKIPPED:"_skipp3d_",END_OF_FORM:"END",EPICOLLECT_SERVER_URL:"http://plus.epicollect.net/",PROXY:"http://www.corsproxy.com/plus.epicollect.net/",CACHED_FILENAME_LENGTH:17,ENTRY_ROOT_PATH_SEPARATOR:"|",ENGLISH:"en",ITALIAN:"it",KITKAT_REGEX:/^4.4.\d{1}$/,LOLLIPOP_REGEX:/^5.\d{1}$/}}();var EC=EC||{};EC.Parse=EC.Parse||{},EC.Parse=function(e){"use strict";return e.is_form_genkey_hidden="",e.form_key="",e.project={},e.parsed_forms=[],e.inputs=[],e.branch_inputs=[],e.form_inputs_positions=[],e.input_list=[],e.options=[],e.branch_options=[],e.getHierarchyForms=function(){var e,t=this,n=t.parsed_forms.length,o=[];for(e=0;n>e;e++)"main"===t.parsed_forms[e].type&&o.push(t.parsed_forms[e]);return o},e.getBranchForms=function(){var e,t=this,n=t.parsed_forms.length,o=[];for(e=0;n>e;e++)"branch"===t.parsed_forms[e].type&&o.push(t.parsed_forms[e]);return o},e}(EC.Parse);var EC=EC||{};EC.Parse=function(e){"use strict";return e.mapPositionToInput=function(e){var t,n,o,r,a,i,s,l,c=e,d=[],u=1,E=[];return $(c).find("form").each(function(e){t=$(this).children(),r=[],o=1,a=$(this).attr("key"),i=$(this).attr("main"),n=parseInt($(this).attr("num"),10),s=$(this).attr("name"),$(t).each(function(e){var t=$(this).attr("ref");1===n?(l||(l=a,E.push(a)),r.push({form_num:n,form_name:s,form_position:u,position:o,ref:t}),o++):t===l?r.push({form_num:n,form_name:s,form_position:u,position:"skip",ref:t}):(r.push("false"===i&&EC.Utils.inArray(E,t)?{form_num:n,form_name:s,form_position:u,position:"skip",ref:t}:{form_num:n,form_name:s,form_position:u,position:o,ref:t}),o++)}),"true"===i&&(l=a,E.push(a)),d.push(r),n++,u++}),console.log("input_positions"),console.log(d,!0),d},e}(EC.Parse);var EC=EC||{};EC.Parse=function(e){"use strict";var t,n=function(e,n){var o,r,a,i,s=e,l=n,c=t.form_inputs_positions.length;for(o=0;c>o;o++)for(i=t.form_inputs_positions[o],a=i.length,r=0;a>r;r++)if(i[r].form_name===l&&i[r].ref===s)return i[r].position};return e.parseInputArray=function(e,t,n,o,r){var a=this;$.each(e,function(e,i){a.parseInputObject(i,t,n,o,r)})},e.parseInputObject=function(e,o,r,a,i){var s,l,c,d,u,E;if(t=this,l=e["@ref"],c=r,d=a,u=i,s=n(l,u),"skip"!==s){var p={position:s,label:e.label,type:o,ref:l,datetime_format:"",has_jump:"",jumps:"",has_advanced_jump:""};p.is_genkey=void 0===e["@genkey"]?"":1,E=void 0===e["@display"]?0:1,1===p.is_genkey&&1===E&&(t.is_form_genkey_hidden=1),p.is_primary_key=p.ref===t.form_key?1:0,1===p.is_primary_key&&1===E&&(t.is_form_genkey_hidden=1),p.default_value=void 0===e["@default"]?"":p.default_value=e["@default"],void 0!==e["@integer"]&&(p.type="integer"),void 0!==e["@decimal"]&&(p.type="decimal"),(void 0!==e["@setdate"]||void 0!==e["@date"])&&(p.type="date",p.datetime_format=e["@setdate"]||e["@date"],p.default_value=e["@setdate"]||""),(void 0!==e["@settime"]||void 0!==e["@time"])&&(p.type="time",p.datetime_format=e["@settime"]||e["@time"],p.default_value=e["@settime"]||""),p.regex=void 0===e["@regex"]?"":e["@regex"],p.max_range=void 0===e["@max"]?"":e["@max"],p.min_range=void 0===e["@min"]?"":e["@min"],p.is_required=void 0===e["@required"]?0:1,p.is_searchable=void 0===e["@search"]?0:1,p.is_title=void 0===e["@title"]?0:1,p.has_double_check=void 0===e["@verify"]?0:1,void 0!==e["@jump"]&&(p.has_jump=1,p.jumps=e["@jump"]),(o===EC.Const.RADIO||o===EC.Const.CHECKBOX||o===EC.Const.DROPDOWN)&&("main"===d?t.options.push({num:r,ref:e["@ref"],options:e.item}):t.branch_options.push({num:r,ref:e["@ref"],options:e.item})),p.branch_form_name=void 0===e["@branch_form"]?"":e["@branch_form"],t.input_list.push(p)}},e}(EC.Parse);var EC=EC||{};EC.Parse=function(e){"use strict";return e.parseXML=function(e){var t,n,o,r,a,i=this,s=e,l="",c="",d=[];i.form_key="",i.parsed_forms=[],i.form_inputs_positions=[],i.form_inputs_positions=i.mapPositionToInput(s),console.log(i.form_inputs_positions,!0),l=xml2json(s),c=l.replace("undefined",""),console.log("json"),console.log(c);try{o=JSON.parse(c)}catch(u){c=c.replace(/\\/g,"\\\\"),o=JSON.parse(c)}if(i.project={name:o.ecml.model.submission["@projectName"],allowDownloadEdits:o.ecml.model.submission["@allowDownloadEdits"],version:o.ecml.model.submission["@versionNumber"],downloadFromServer:o.ecml.model.downloadFromServer,uploadToServer:o.ecml.model.uploadToServer},d=o.ecml.form,void 0===d)return!1;for(n=d.length||1,1===n&&(d=[d]),console.log(i.project),i.project.total_hierarchy_forms=0,i.project.total_branch_forms=0,t=0;n>t;t++){var E=d[t],p="",C=E["@num"],_="false"===E["@main"]?"branch":"main",h=E["@name"];i.input_list.length=0,i.is_form_genkey_hidden=0,r=0,a=0,i.form_key=E["@key"],i.parsed_forms.push({num:C,name:h,key:i.form_key}),i.parsed_forms[t].type=_,void 0!==E.input&&(p="text",Array.isArray(E.input)?i.parseInputArray(E.input,p,C,_,h):i.parseInputObject(E.input,p,C,_,h)),void 0!==E.barcode&&(p="barcode",Array.isArray(E.barcode)?i.parseInputArray(E.barcode,p,C,_,h):i.parseInputObject(E.barcode,p,C,_,h)),void 0!==E.location&&(p="location",Array.isArray(E.location)?i.parseInputArray(E.location,p,C,_,h):i.parseInputObject(E.location,p,C,_,h)),void 0!==E.audio&&(p="audio",r=1,Array.isArray(E.audio)?i.parseInputArray(E.audio,p,C,_,h):i.parseInputObject(E.audio,p,C,_,h)),void 0!==E.video&&(p="video",r=1,Array.isArray(E.video)?i.parseInputArray(E.video,p,C,_,h):i.parseInputObject(E.video,p,C,_,h)),void 0!==E.photo&&(p="photo",r=1,Array.isArray(E.photo)?i.parseInputArray(E.photo,p,C,_,h):i.parseInputObject(E.photo,p,C,_,h)),void 0!==E.textarea&&(p="textarea",Array.isArray(E.textarea)?i.parseInputArray(E.textarea,p,C,_,h):i.parseInputObject(E.textarea,p,C,_,h)),void 0!==E.radio&&(p="radio",Array.isArray(E.radio)?i.parseInputArray(E.radio,p,C,_,h):i.parseInputObject(E.radio,p,C,_,h)),void 0!==E.select1&&(p="select",Array.isArray(E.select1)?i.parseInputArray(E.select1,p,C,_,h):i.parseInputObject(E.select1,p,C,_,h)),void 0!==E.select&&(p="checkbox",Array.isArray(E.select)?i.parseInputArray(E.select,p,C,_,h):i.parseInputObject(E.select,p,C,_,h)),void 0!==E.branch&&(p="branch",a=1,Array.isArray(E.branch)?i.parseInputArray(E.branch,p,C,_,h):i.parseInputObject(E.branch,p,C,_,h)),"true"===E["@main"]?(i.inputs.push({num:E["@num"],input_list:i.input_list.slice(0)}),i.project.total_hierarchy_forms++):(i.branch_inputs.push({num:E["@num"],input_list:i.input_list.slice(0)}),i.project.total_branch_forms++),i.parsed_forms[t].total_inputs=i.input_list.length,i.parsed_forms[t].is_form_genkey_hidden=i.is_form_genkey_hidden,i.parsed_forms[t].has_media=r,i.parsed_forms[t].has_branches=a}console.log("Parsed forms"),console.log(i.parsed_forms,!0)},e}(EC.Parse);var EC=EC||{};EC.Routing=EC.Routing||{},EC.Routing.branchInputsPageEvents=function(){"use strict";$(document).on("pageinit","#branch-feedback",function(){console.log("feedback init called")}),$(document).on("pagebeforeshow","#branch-text",function(e){EC.BranchInputs.renderInput(EC.BranchInputs.getInputAt(window.localStorage.branch_current_position))}),$(document).on("pagebeforeshow","#branch-integer",function(e){EC.BranchInputs.renderInput(EC.BranchInputs.getInputAt(window.localStorage.branch_current_position))}),$(document).on("pagebeforeshow","#branch-decimal",function(e){EC.BranchInputs.renderInput(EC.BranchInputs.getInputAt(window.localStorage.branch_current_position))}),$(document).on("pagebeforeshow","#branch-date",function(e){EC.BranchInputs.renderInput(EC.BranchInputs.getInputAt(window.localStorage.branch_current_position))}),$(document).on("pagebeforeshow","#branch-time",function(e){EC.BranchInputs.renderInput(EC.BranchInputs.getInputAt(window.localStorage.branch_current_position))}),$(document).on("pagebeforeshow","#branch-select",function(e){EC.BranchInputs.renderInput(EC.BranchInputs.getInputAt(window.localStorage.branch_current_position))}),$(document).on("pagebeforeshow","#branch-radio",function(e){EC.BranchInputs.renderInput(EC.BranchInputs.getInputAt(window.localStorage.branch_current_position)),$("div#input-radio input:radio").each(function(e){$(this).attr("checked")&&$(this).next().trigger("vclick")})}),$(document).on("pagebeforeshow","#branch-checkbox",function(e){EC.BranchInputs.renderInput(EC.BranchInputs.getInputAt(window.localStorage.branch_current_position))}),$(document).on("pagebeforeshow","#branch-textarea",function(e){EC.BranchInputs.renderInput(EC.BranchInputs.getInputAt(window.localStorage.branch_current_position))}),$(document).on("pagebeforeshow","#branch-location",function(e){EC.BranchInputs.renderInput(EC.BranchInputs.getInputAt(window.localStorage.branch_current_position))}),$(document).on("pagebeforeshow","#branch-photo",function(e){EC.BranchInputs.renderInput(EC.BranchInputs.getInputAt(window.localStorage.branch_current_position))}),$(document).on("pagebeforeshow","#branch-video",function(e){EC.BranchInputs.renderInput(EC.BranchInputs.getInputAt(window.localStorage.branch_current_position))}),$(document).on("pagebeforeshow","#branch-audio",function(e){EC.BranchInputs.renderInput(EC.BranchInputs.getInputAt(window.localStorage.branch_current_position))}),$(document).on("pagebeforeshow","#branch-barcode",function(e){EC.BranchInputs.renderInput(EC.BranchInputs.getInputAt(window.localStorage.branch_current_position))}),$(document).on("pagebeforeshow","#branch-save-confirm",function(e){EC.BranchInputs.renderSaveConfirmView()}),$(document).on("pagebeforeshow","#branch-feedback",function(e){EC.BranchInputs.renderFeedbackView()})};var EC=EC||{};EC.Routing=EC.Routing||{},EC.Routing.changePage=function(e,t){"use strict";var n,o,r=e;n=EC.Utils.getPageBaseURI(),o=r===EC.Const.INDEX_VIEW?n+r:n+EC.Const.VIEWS_DIR+r,console.log("Routing to ---------------------------------> "+o),$.mobile.changePage(o,{transition:"fade",reverse:!1,changeHash:!0,allowSamePageTransition:!0})};var EC=EC||{};EC.Routing=EC.Routing||{},EC.Routing.goBack=function(e){"use strict";var t=e,n=null,o=null,r=["audio","barcode","branch","checkbox","date","decimal","integer","location","photo","radio","save-confirm","save-feedback","select","text","textarea","time","video"],a=["branch-audio","branch-barcode","branch-branch","branch-checkbox","branch-date","branch-decimal","branch-integer","branch-location","branch-photo","branch-radio","branch-save-confirm","branch-save-feedback","branch-select","branch-text","branch-textarea","branch-time","branch-video"],i=["forms","entries","entry-values"],s=["branch-entries","branch-entry-values"],l=["settings","add-project","email-backup","upload","download"];EC.Utils.inArray(r,t)&&(n=$("div#"+t+' div[data-role="header"] div[data-href="back-btn"]'),n.trigger("vclick")),EC.Utils.inArray(a,t)&&(n=$("div#"+t+' div[data-role="header"] div[data-href="back-btn"]'),n.trigger("vclick")),EC.Utils.inArray(i,t)&&(o=$("div#"+t+' div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab'),o.trigger("vclick")),EC.Utils.inArray(s,t)&&(o=$("div#"+t+' div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab'),o.trigger("vclick")),EC.Utils.inArray(l,t)&&(n=$("div#"+t+' div[data-role="header"] div[data-href="back-btn"]'),n.trigger("vclick"))};var EC=EC||{};EC.Routing=EC.Routing||{},EC.Routing.indexPageEvents=function(){"use strict";$(document).on("pagebeforeshow","#index",function(e){var t=window.localStorage.back_nav_url;return"1"===window.localStorage.is_project_deleted?(EC.Project.getList(),void window.localStorage.removeItem("is_project_deleted")):void("#refresh"===t&&(EC.Project.getList(),window.localStorage.removeItem("back_nav_hash")))}),$(document).on("pagebeforeshow","#forms",function(e){var t=e.delegateTarget.baseURI;EC.Notification.showProgressDialog(),console.log("#forms pagebeforeshow"),window.localStorage.removeItem("breadcrumbs"),window.localStorage.removeItem("entries_totals"),window.localStorage.removeItem("edit_mode"),EC.Forms.getList(decodeURI(t))}),$(document).on("pagebeforeshow","#entries",function(e){var t=e.delegateTarget.baseURI;EC.Notification.showProgressDialog(),window.localStorage.removeItem("edit_mode"),EC.Entries.getList(decodeURI(t))}),$(document).on("pagebeforeshow","#entry-values",function(e){var t=e.delegateTarget.baseURI;EC.Notification.showProgressDialog(),EC.Entries.getEntryValues(decodeURI(t))}),$(document).on("pagebeforeshow","#settings",function(e){EC.Settings.renderView()}),$(document).on("pagebeforeshow","#add-project",function(e){EC.Project.renderAddProjectView()}),$(document).on("pagebeforeshow","#email-backup",function(e){EC.EmailBackup.renderSendEmailView()}),$(document).on("pagebeforeshow","#upload",function(e){EC.Upload.renderUploadView(!1)}),$(document).on("pagebeforeshow","#download",function(e){EC.Download.renderDownloadView()}),$(document).on("pageshow","#index",function(e){EC.Notification.hideProgressDialog(),window.device&&window.device.platform===EC.Const.IOS&&$.mobile.silentScroll(0)}),$(document).on("pageshow","#forms",function(e){window.device&&window.device.platform===EC.Const.IOS&&$.mobile.silentScroll(0),EC.Notification.hideProgressDialog()}),$(document).on("pageshow","#entries",function(e){window.localStorage.previous_tapped_entry_Y?$.mobile.silentScroll(parseInt(window.localStorage.previous_tapped_entry_Y,10)):window.device&&window.device.platform===EC.Const.IOS&&$.mobile.silentScroll(0),EC.Notification.hideProgressDialog()}),$(document).on("pageshow","#entry-values",function(e){window.device&&window.device.platform===EC.Const.IOS&&$.mobile.silentScroll(0),EC.Notification.hideProgressDialog()}),$(document).on("pageshow","#add-project",function(e){window.device&&window.device.platform===EC.Const.IOS&&$.mobile.silentScroll(0),-1!==Object.keys(EC.Dictionary).indexOf(window.localStorage.DEVICE_LANGUAGE)&&EC.Localise.applyToPlaceholders(window.localStorage.DEVICE_LANGUAGE)})};var EC=window.EC||{};EC.Routing=EC.Routing||{},EC.Routing.inputsPageEvents=function(){"use strict";$(document).on("pageinit","#feedback",function(){console.log("feedback init called")}),$(document).on("pagebeforeshow","#text",function(){EC.Inputs.renderInput(EC.Inputs.getInputAt(window.localStorage.current_position))}),$(document).on("pagebeforeshow","#integer",function(){EC.Inputs.renderInput(EC.Inputs.getInputAt(window.localStorage.current_position))}),$(document).on("pagebeforeshow","#decimal",function(){EC.Inputs.renderInput(EC.Inputs.getInputAt(window.localStorage.current_position))}),$(document).on("pagebeforeshow","#date",function(){EC.Inputs.renderInput(EC.Inputs.getInputAt(window.localStorage.current_position))}),$(document).on("pagebeforeshow","#time",function(){EC.Inputs.renderInput(EC.Inputs.getInputAt(window.localStorage.current_position))}),$(document).on("pagebeforeshow","#select",function(){EC.Inputs.renderInput(EC.Inputs.getInputAt(window.localStorage.current_position))}),$(document).on("pagebeforeshow","#radio",function(){EC.Inputs.renderInput(EC.Inputs.getInputAt(window.localStorage.current_position)),$("div#input-radio input:radio").each(function(){$(this).attr("checked")&&$(this).next().trigger("vclick")})}),$(document).on("pagebeforeshow","#checkbox",function(){EC.Inputs.renderInput(EC.Inputs.getInputAt(window.localStorage.current_position))}),$(document).on("pagebeforeshow","#textarea",function(){EC.Inputs.renderInput(EC.Inputs.getInputAt(window.localStorage.current_position))}),$(document).on("pagecreate","#textarea",function(){}),$(document).on("pagebeforeshow","#location",function(){EC.Inputs.renderInput(EC.Inputs.getInputAt(window.localStorage.current_position))}),$(document).on("pagebeforeshow","#photo",function(){EC.Inputs.renderInput(EC.Inputs.getInputAt(window.localStorage.current_position))}),$(document).on("pagebeforeshow","#video",function(){EC.Inputs.renderInput(EC.Inputs.getInputAt(window.localStorage.current_position))}),$(document).on("pagebeforeshow","#audio",function(){EC.Inputs.renderInput(EC.Inputs.getInputAt(window.localStorage.current_position))}),$(document).on("pagebeforeshow","#barcode",function(){EC.Inputs.renderInput(EC.Inputs.getInputAt(window.localStorage.current_position))}),$(document).on("pagebeforeshow","#branch",function(){window.localStorage.removeItem("branch_current_position"),window.localStorage.removeItem("branch_entries"),window.localStorage.removeItem("branch_form_has_jumps"),window.localStorage.removeItem("branch_form_id"),window.localStorage.removeItem("branch_form_name"),window.localStorage.removeItem("branch_inputs_total"),window.localStorage.removeItem("branch_inputs_trail"),window.localStorage.removeItem("branch_inputs_values"),EC.Inputs.renderInput(EC.Inputs.getInputAt(window.localStorage.current_position))}),$(document).on("pagebeforeshow","#branch-entries",function(){EC.Entries.getBranchEntriesList()}),$(document).on("pagebeforeshow","#branch-entry-values",function(e){var t=e.delegateTarget.baseURI;EC.Entries.getBranchEntryValues(decodeURI(t))}),$(document).on("pageshow","#branch-entry-values",function(){EC.Notification.hideProgressDialog()}),$(document).on("pagebeforeshow","#save-confirm",function(){EC.Inputs.renderSaveConfirmView()}),$(document).on("pagebeforeshow","#feedback",function(){EC.Inputs.renderFeedbackView()}),$(document).on("pageshow","#branch-entries",function(){EC.Notification.hideProgressDialog()}),$(document).on("pageshow","#branch-entry-values",function(){EC.Notification.hideProgressDialog()})};var EC=EC||{};EC.Dictionary=EC.Dictionary||{},EC.Dictionary={en:{home:"Home",settings:"Settings",help:"Help",rate_us:"Rate Us",add_project:"Add project",loading_project:"Loading project",search_project:"Search a project using the box above",projects:"Projects",filter_project:"Filter projects...",no_projects_found:"No projects found!",project_list:"Project List",type_project_name_here:"Type a project name here...",tap_the:"Tap the ",button:"button ",add:"Add ",to:" to ",to_add:"to add ",to_add_one:"to add one.",upload_to:"Upload to ",upload_data:"Upload Data",upload_images:"Upload Images",upload_audios:"Upload Audios",upload_videos:"Upload Videos",remote_server_url:"Remote Server URL",pagination:"Pagination: entries listed per page",app_version:"App Version: ",forms:"Forms",backup_data:"Backup Project Data",restore_data:"Restore Data from Backup",email_backup:"Email Backup",download_remote_data:"Download remote data",unsync_entries:"Unsync All Entries Data",delete_entries:"Delete All Entries",export_all_entries_to_csv:"Export Data to CSV",export_all_entries_to_csv_confirm:"Are you sure you want to export data to CSV?",delete_synced:"Delete Synced Entries",delete_media:"Delete Media Files",delete_project:"Delete Project",show_more:"Show more",no_entries_found:"No entries found!",enter_email:"Enter email address",email_backup_to:"Email Backup for",select_form_download:"Select form to download data from",delete_entry:"Delete Entry",unsync_entry:"Unsync Entry",prev:"Previous",next:"Next",record:"Record",stop:"Stop",play:"Play",recording:"Recording",no_audio_available:"No audio available yet",scan:"Scan",type_confirm:"Type again to confirm",pk_not_editable:"This value is the primary key for this entry, it cannot be edited. ",add_branch_form:"Add branch form",list_branch_entries:"List branch entries",set_location:"Set Location",take_photo:"Take Photo",tap_to_store:"Tap button to store values",store:"Store",store_edit:"Store Edit",data_saved_success:"Data saved successfully",branch_data_saved_success:"Branch data saved successfully",add_another:"Add another ",list:"List ",entries:" entries ",add_video:"Add video",play_video:"Play video",back_to:"Back to ",error:"Error",project_already_loaded:"Project already loaded on device!",exit:"Exit",exit_confirm:"Are you sure? \nData will NOT be saved",value_exist:"Value already exists!",invalid_integer:"The number entered is not an integer value!",invalid_decimal:'The value entered is not a decimal value! Only numbers and the dot "." are allowed',pk_reserved_char:"This field is a primary key: it cannot cointain the reserved char: ",invalid_regex:"This field does not match the regex: ",values_unmatched:"This fields do not match each other",out_of_range:"Value entered is out of range",reserved_keyword:"Value entered is an Epicollect+ reserved keyword",field_required:"This field is required",invalid_xml:"Project XML is no valid, maybe no forms yet?",connection_timeout:"Server connection time out",connection_lost:"Connection lost, please retry",project_not_found_on_server:"Project not found on server ",project_not_found:"Project not found!",unknow_error:"Unknown Error!",leaving_current_form:"Leaving current form",save_before_leave:"Save data before leaving?",edit_saved:"Edit saved!",missing_pk:"Primary key value for this form is missing.You probably jumped a required field, please go back and try again",gps_disabled:"Please enable GPS",locating:"Locating",wait:"Wait...",location_acquired:"Location acquired",location_fail:", not able to locate!",location_service_fail:"Something went wrong...are Location Services enabled for Epicollect5?",failed_because:"Failed because: ",download_success:"All data downloaded",parent_key_for_1:"Parent keys for ",parent_key_for_2:" are missing on device database, please download ",parent_key_for_3:" entries first",no_internet:"No Internet Connection!!",invalid_email:"Not a valid email address!!",invalid_email_client:"Please set up a mail client app first",generic_error:"An error occurred, please retry",entry_unsynced:"Entry unsynced",entry_deleted:"Entry deleted",all_data_synced:"All data unsynced",all_entries_deleted:"All entries deleted",data_exported_to_csv:"Data exported to csv",all_media_deleted:"All media deleted",all_synced_deleted:"All synced entries deleted",branch_entry_deleted:"Branch entry deleted",delete_branch_entry:"Delete Branch Entry",delete_entry_confirm:"Are you sure you want to delete this entry?",unsync_entry_confirm:"Are you sure you want to unsync this entry?",delete_entry_with_children_confirm:"Are you sure you want to delete this entry?  \n This entry and all its children will be deleted!",unsync_all_data:"Unsync all data",unsync_all_data_confirm:"Are you sure you want to unsync all the data?",delete_project_confirm:"Are you sure you want to delete this project?",delete_all_entries:"Delete all entries",delete_all_entries_confirm:"Are you sure you want to delete all entries?",delete_all_media:"Delete all media files",delete_all_media_confirm:"Are you sure you want to delete all media files?",delete_all_synced:"Delete all synced entries",delete_all_synced_confirm:"Are you sure you want to delete all synced entries?",backup_data_confirm:"Are you sure you want to backup all project entries?",restore_data_confirm:"Are you sure you want to restore from a backup? Existing data will be overriden!",warning:"Warning",edited_jump:"You modified a value linked to a jump so it is not possible to save the edit yet \nTap NEXT to proceed or revert your changes before saving",success:"Success",project_backup_success:"Project backed up!",project_deleted:"Project deleted",project_no_spaces_allowed:"Project name cannot have empty spaces",project_empty_not_allowed:"Project name cannot be empty",project_restored:"Project restored!",upload_error:" An error occurred while uploading, please retry. ",no_backup_saved:"No backup file found!!",all_images_uploaded:"All image files uploaded! ",all_audios_uploaded:"All audio files uploaded! ",all_videos_uploaded:"All video files uploaded! ",uploading:"Uploading...",data_upload_success:" Data uploaded! ",check_your_internet:", check you internet connection.",settings_saved_success:"Settings saved",questions:" Questions",hierarchy_forms:" Hierarchy form(s)",branch_forms:" Branch(es)",sending_message:"Sending message...",backup_for:"Backup for ",backup_for_project:"Backup for project ",is_attached:" is attached",select_one_option:"Select one option",photo_available:"Photo available",no_photo:"No photo saved",audio_available:"Audio available",no_audio:"No audio saved",video_available:"Video available",no_video:"No video saved",no:"No",save:"Save",dismiss:"Dismiss",confirm:"Confirm"},it:{home:"Home",settings:"Impostazioni",help:"Aiuto",rate_us:"Votaci",add_project:"Aggiungi progetto",loading_project:"Caricando progetto",search_project:"Cerca progetto usando l'input di testo sopra",projects:"Progetti",filter_project:"Filtra progetti",no_projects_found:"Nessun progetto trovato!",project_list:"Lista progetti",type_project_name_here:"Digita il nome del progetto...",tap_the:"Premi il ",button:"",add:"Add ",to:" a ",to_add:"per aggiungere ",to_add_one:"per aggiungerne uno ",upload_to:"Carica dati a ",upload_data:"Carica dati",upload_images:"Carica foto",upload_audios:"Carica tracce audio",upload_videos:"Carica video",remote_server_url:"URL del server remoto",pagination:"Paginazione: quanti elementi per pagina",app_version:"Versione della app: ",forms:"Schede",backup_data:"Backup dati",restore_data:"Ripristina da Backup",email_backup:"Posta Backup",download_remote_data:"Scarica dati remoti",unsync_entries:"De-sincronizza dati",delete_entries:"Cancella dati",delete_synced:"Cancella elementi sincronizzati",delete_media:"Cancella files multimedia",delete_project:"Cancella progetto",show_more:"Mostra altri elementi",no_entries_found:"Nessun elemento trovato!",enter_email:"Inserisci indirizzo email",email_backup_to:"Manda backup tramite email per ",select_form_download:"Seleziona la scheda da cui scaricare dati",delete_entry:"Cancella elemento",unsync_entry:"De-sincronizza elemento",prev:"Prec",next:"Succ",record:"Record",stop:"Stop",play:"Play",recording:"Registrazione",no_audio_available:"Nessuna registrazione trovata",scan:"Scan",type_confirm:"Digita di nuovo pre confermare",pk_not_editable:"Questo dato &egrave; una chiave primaria, non si &ograve; modificare",add_branch_form:"Aggiungi scheda diramazione",list_branch_entries:"Lista schede diramate",set_location:"Imposta posizione",take_photo:"Scatta foto",data_saved_success:"Dati salvati con successo",branch_data_saved_success:"Dati ramificazione salvati con successo",add_another:"Aggiungi un altro ",list:"Lista ",entries:" elementi ",add_video:"Aggiungi video",play_video:"Play video",back_to:"Torna a ",error:"Error",project_already_loaded:"Questo progetto esiste gi&agrave;",exit:"Exit",exit_confirm:"Sei sicuro? \nDati NON verranno salvati",value_exist:"Questo valore esiste gi&agrave;",invalid_integer:"Valore inserito non &egrave; un numero intero",invalid_decimal:"Valore inserito non &egrave; un  numero decimale, solo numeri e punto (.) sono permessi",pk_reserved_char:"Questo campo &egrave; una chiave primaria, non pu&ograve; contenere il carattere riservato: ",invalid_regex:"Valore non soddisfa la epressione regolare: ",values_unmatched:"I valori non corrispondono",out_of_range:"Valore inserito &egrave; fuori dai limiti",reserved_keyword:"Valore inserito &egrave; un valore riservato a Epicollect+",field_required:"Un valore &egrave; richiesto",invalid_xml:"Progetto XML non valiso, forse non ha schede ancora?",connection_timeout:"Connessione al server scaduta",connection_lost:"Connessione persa, riprova",project_not_found_on_server:"Progetto non trovato nel server ",project_not_found:"Progetto non trovato!",unknow_error:"Errore sconosciuto!",leaving_current_form:"Uscire da scheda corrente",save_before_leave:"Salvare dati prima di uscire?",edit_saved:"Modifiche salvate",missing_pk:"Manca chive primaria.Probabilmente un campo obbligatorio &egrave; stato saltato, torna indietro e riprova",gps_disabled:"Per favore, attivare GPS",locating:"Localizzazione",wait:"Aspetta...",location_acquired:"Posizione acquisita",location_fail:", incapace di trovare posizione",location_service_fail:"Qualcosa &egrave; andato storto...sono i Servizi Locazione abilitati per Epicollect5 app?",failed_because:"Fallito perch&egrave;: ",download_success:"Tutti i dati scaricati",parent_key_for_1:"Chiavi padre per ",parent_key_for_2:" mancano nel database del dispositivo, scarica ",parent_key_for_3:" elementi prima",no_internet:"Nessuna connessione internet!!",invalid_email:"Indirizzo Email non valido!!",invalid_email_client:"Una app per mandare emails non &egrave; stata ancora impostata",generic_error:"Errore, riprova",entry_unsynced:"Elemento de-sincronizzato",entry_deleted:"Elemento cancellato",all_data_synced:"Tutti i dati sincronizzati",all_entries_deleted:"Tutti gli elementi cancellati",all_media_deleted:"Tutti i media cancellati",all_synced_deleted:"Tutti gli elementi sincronizzati cancellati",branch_entry_deleted:"Elemento ramificato cancellato",delete_branch_entry:"Cancella elemento ramificato",delete_entry_confirm:"Sei sicuro che vuoi cancellare questo elemento?",unsync_entry_confirm:"Sei sicuro che vuoi de-sincronizzare questo elemento?",delete_entry_with_children_confirm:'Sei sicuro che vuoi cancellare questo elemento?  \n Questo elemento e tutti i "figli" verranno cancellati',unsync_all_data:"Unsync all data",unsync_all_data_confirm:"Sei sicuro che vuoi de-sincronizzare tutti i dati?",delete_project_confirm:"Sei sicuro che vuoi cancellare questo progetto?",delete_all_entries:"Cancella tutti gli elementi",data_exported_to_csv:"Dati esportati in formato csv",delete_all_entries_confirm:"Sei sicuro che vuoi cancellare tutti gli elementi",export_all_entries_to_csv:"Esportare dati formato csv",export_all_entries_to_csv_confirm:"Sicuro di esportare tutti dati in formato csv?",delete_all_media:"Cancellare tutti i file media",delete_all_media_confirm:"Sei sicuro che vuoi cancellare tutti i file media?",delete_all_synced:"Cancella tutti elementi sincronizzati",delete_all_synced_confirm:"Sei sicuro che vuoi cancellare tutti gli elementi sincronizzati?",backup_data_confirm:"Sicuro che vuoi fare un backup",restore_data_confirm:"Sicuro che vuoi ripristinare da backup? Dati esistenti verranno persi!",warning:"Attenzione",edited_jump:'Hai modificato un valore collegato a un salto quindi non &egrave; possibile salvare le modifiche \nPremi "Successivo" per procedere o annulla le modifiche per salvare',success:"Successo",project_backup_success:"Backup del progetto eseguito!",project_deleted:"Progetto cancellato",project_no_spaces_allowed:"Il nome del progetto non pu&ograve; aver spazi",project_empty_not_allowed:"Il nome del progetto non pu&ograve; essere vuoto",project_restored_:"Progetto ripristinato!",upload_error:" Errore durante caricamento dati, riprovare. ",no_backup_saved:"Nessun file di backup trovato!!",all_images_uploaded:"Tutte i file immagini caricati! ",all_audios_uploaded:"Tutti i file audio caricati! ",all_videos_uploaded:"Tutti i file video caricati! ",uploading:"Caricando...",data_upload_success:" Dati caricati! ",check_your_internet:", controlla la tua connessione internet.",settings_saved_success:"Impostazioni salvate",questions:" Domande",hierarchy_forms:" Schede gerarchia",branch_forms:" Schede ramificate",sending_message:"Mandando email...",backup_for:"Backup per ",backup_for_project:"Il backup per il progetto ",is_attached:" &egrave; attaccato",select_one_option:"Scegli opzione",photo_available:"Foto presente",no_photo:"Nessuna foto salvata",audio_available:"Traccia audio presente",no_audio:"Nessuna traccia audio presente",video_available:"Video presente",
no_video:"Nessun video presente",no:"No",save:"Salva",dismiss:"Annulla",confirm:"Conferma"}};var EC=EC||{};EC.Localise=EC.Localise||{},EC.Localise=function(){"use strict";function e(){r=window.localStorage.DEVICE_LANGUAGE}function t(e){var t=e,n="";try{n=EC.Dictionary[r][t]}catch(o){n="Translation not found"}return n}function n(e){var t,n=$.mobile.activePage.attr("id"),o=$("div#"+n+" [data-i10n]"),r=this;console.log(o),o.each(function(e){console.log($(this).data("i10n")),t=r.getTranslation($(this).data("i10n")),$(this).text(t)})}function o(e){var t,n=$.mobile.activePage.attr("id"),o=$("div#"+n+" [placeholder]"),r=this;o.each(function(e){console.log($(this).attr("placeholder")),t=r.getTranslation($(this).attr("placeholder")),$(this).attr("placeholder",t)})}var r;return{setLanguage:e,getTranslation:t,applyToHTML:n,applyToPlaceholders:o}}();var EC=EC||{};EC.Branch=EC.Branch||{},EC.Branch=function(e){"use strict";var t,n,o,r,a=[],i=0,s=function(e,t){console.log(t)},l=function(e){var t,n,i=r.length;for(t=0;i>t;t++)n="",n+="INSERT INTO ec_branch_forms (project_id, num, name, key, has_media, is_genkey_hidden, total_inputs) ",n+='VALUES ("',n+=o+'", "',n+=r[t].num+'", "',n+=r[t].name+'", "',n+=r[t].key+'", "',n+=r[t].has_media+'", "',n+=r[t].is_form_genkey_hidden+'", "',n+=r[t].total_inputs+'");',a.push({num:r[t].num,id:0}),e.executeSql(n,[],c,s)},c=function(e,t){a[i].id=t.insertId,i++},d=function(){r.length=0,n.resolve(a)};return e.commitBranchForms=function(e,c){return t=this,n=new $.Deferred,r=e,o=c,a.length=0,i=0,EC.db.transaction(l,s,d),n.promise()},e}(EC.Branch);var EC=EC||{};EC.Branch=EC.Branch||{},EC.Branch=function(e){"use strict";var t,n,o,r,a,i=[],s=0,l=function(e,t){console.log(t)},c=function(e){var t,n,o=a.length;for(t=0;o>t;t++)n="",n+="INSERT INTO ec_branch_forms (project_id, num, name, key, has_media, is_genkey_hidden, total_inputs) ",n+='VALUES ("',n+=r+'", "',n+=a[t].num+'", "',n+=a[t].name+'", "',n+=a[t].key+'", "',n+=a[t].has_media+'", "',n+=a[t].is_form_genkey_hidden+'", "',n+=a[t].total_inputs+'");',i.push({num:a[t].num,id:0}),e.executeSql(n,[],d,l)},d=function(e,t){i[s].id=++o,s++},u=function(){a.length=0,n.resolve(i)},E=function(e){var n="SELECT MAX(_id) AS _id from ec_branch_forms",o='UPDATE sqlite_sequence SET seq = (SELECT MAX(_id) FROM ec_branch_forms) WHERE name="ec_branch_forms"';e.executeSql(n,[],p,t.errorCB),e.executeSql(o,[],_,null)},p=function(e,t){o=t.rows.item(0)._id},C=function(){EC.db.transaction(c,t.errorCB,u)},_=function(e,t){};return e.commitBranchForms=function(e,l){return t=this,n=new $.Deferred,a=e,r=l,i.length=0,s=0,o=0,EC.db.transaction(E,t.errorCB,C),n.promise()},e}(EC.Branch);var EC=EC||{};EC.Branch=EC.Branch||{},EC.Branch=function(e){"use strict";var t,n,o=[],r=function(e){var r,i,s,l,c,d,u,E,p,C,_,h;for(r=0,l=n.length;l>r;r++){for(u=n[r].ref,_=n[r].num,i=0,c=o.length;c>i;i++)if(o[i].ref===u&&o[i].form_num===_){E=o[i].id;break}for(d=void 0===n[r].options?0:n[r].options.length,s=0;d>s;s++)p=n[r].options[s].label,C=n[r].options[s].value,h="INSERT INTO ec_branch_input_options (",h+="input_id, ",h+="ref, ",h+="label, ",h+="value)",h+='VALUES ("',h+=E+'", "',h+=u+'", "',h+=p+'", "',h+=C+'");',e.executeSql(h,[],a,t.errorCB)}},a=function(e,t){console.log("executeSql SUCCESS BRANCH INPUT OPTIONS")},i=function(){n.length=0,$(document).trigger("BranchModelReady"),console.log("BranchModelReady")};return e.commitBranchInputOptions=function(e,a){t=this,n=e,o=a,EC.db.transaction(r,t.errorCB,i)},e}(EC.Branch);var EC=EC||{};EC.Branch=function(e){"use strict";var t,n,o,r=[],a=0,i=[],s=[],l=function(e){var n,a,i,l,d,u,E,p,C,_,h;for(n=0,l=o.length;l>n;n++){for(E=o[n].num,a=0,d=s.length;d>a;a++)if(s[a].num===E){p=s[a].id;break}for(i=0,u=o[n].input_list.length;u>i;i++)C=o[n].input_list[i].type,_=o[n].input_list[i].ref,h="",h+="INSERT INTO ec_branch_inputs (",h+="form_id, ",h+="label, ",h+="default_value, ",h+="type, ",h+="ref, ",h+="position, ",h+="is_primary_key, ",h+="is_genkey, ",h+="regex, ",h+="max_range, ",h+="min_range, ",h+="is_required, ",h+="is_title, ",h+="has_jump, ",h+="jumps, ",h+="has_advanced_jump, ",h+="datetime_format, ",h+="has_double_check) ",h+='VALUES ("',h+=p+'", "',h+=o[n].input_list[i].label+'", "',h+=o[n].input_list[i].default_value+'", "',h+=C+'", "',h+=_+'", "',h+=o[n].input_list[i].position+'", "',h+=o[n].input_list[i].is_primary_key+'", "',h+=o[n].input_list[i].is_genkey+'", "',h+=o[n].input_list[i].regex+'", "',h+=o[n].input_list[i].max_range+'", "',h+=o[n].input_list[i].min_range+'", "',h+=o[n].input_list[i].is_required+'", "',h+=o[n].input_list[i].is_title+'", "',h+=o[n].input_list[i].has_jump+'", "',h+=o[n].input_list[i].jumps+'", "',h+=o[n].input_list[i].has_advanced_jump+'", "',h+=o[n].input_list[i].datetime_format+'", "',h+=o[n].input_list[i].has_double_check+'");',r.push({ref:_,form_id:p,form_num:E}),e.executeSql(h,[],c,t.errorCB)}},c=function(e,t){r[a].id=t.insertId,a++,console.log("executeSql SUCCESS INPUTS")},d=function(){s.length=0,o.length=0,i.length=0,n.resolve(r)};return e.commitBranchInputs=function(e,r){return t=this,n=new $.Deferred,o=e,s=r,EC.db.transaction(l,t.errorCB,d),n.promise()},e}(EC.Branch);var EC=EC||{};EC.Branch=EC.Branch||{},EC.Branch=function(e){"use strict";return e.errorCB=function(e){console.log("Error INSERT STRUCTURE BRANCH"),console.log(e),console.log(EC.Utils.TRANSACTION_ERROR)},e}(EC.Branch);var EC=EC||{};EC.DBAdapter=EC.DBAdapter||{},EC.DBAdapter=function(){"use strict";var e,t=["",'CREATE TABLE IF NOT EXISTS "ec_projects" (',' "_id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE,','"name" TEXT, ','"total_hierarchy_forms" INTEGER DEFAULT 0, ','"total_branch_forms" INTEGER DEFAULT 0, ','"is_active" INTEGER DEFAULT 0,','"uploadToServer" TEXT,','"downloadFromServer" TEXT,','"allowDownloadEdits" INTEGER DEFAULT 0,','"version" TEXT,','"description" TEXT,','"radiobutton_image_url" TEXT,','"reg_mail" TEXT);'].join(""),n=["",'CREATE TABLE IF NOT EXISTS "ec_forms" (',' "_id" INTEGER PRIMARY KEY  AUTOINCREMENT  NOT NULL  UNIQUE,','"project_id" INTEGER NOT NULL, ','"name" TEXT, ','"num" INTEGER, ','"key" TEXT, ','"total_inputs" INTEGER, ','"has_media" INTEGER DEFAULT 0, ','"has_branches" INTEGER DEFAULT 0, ','"is_genkey_hidden" INTEGER DEFAULT 0, ','"entries" INTEGER DEFAULT 0, ','FOREIGN KEY ("project_id") REFERENCES ec_projects ("_id") ON DELETE CASCADE ON ',"UPDATE CASCADE);"].join(""),o=["",'CREATE TABLE IF NOT EXISTS "ec_branch_forms" (',' "_id" INTEGER PRIMARY KEY  AUTOINCREMENT  NOT NULL  UNIQUE,','"project_id" INTEGER NOT NULL, ','"name" TEXT, ','"num" INTEGER, ','"key" TEXT, ','"total_inputs" INTEGER, ','"has_media" INTEGER DEFAULT 0, ','"is_genkey_hidden" INTEGER DEFAULT 0, ','"entries" INTEGER DEFAULT 0, ','FOREIGN KEY ("project_id") REFERENCES ec_projects ("_id") ON DELETE CASCADE ON ',"UPDATE CASCADE);"].join(""),r=["",'CREATE  TABLE IF NOT EXISTS "ec_inputs" (','"_id" INTEGER PRIMARY KEY  AUTOINCREMENT  NOT NULL  UNIQUE , ','"form_id" INTEGER NOT NULL , ','"ref" TEXT,','"position" INTEGER,','"label" TEXT,','"default_value" TEXT,','"type" TEXT, ','"is_primary_key" INTEGER,','"is_genkey" INTEGER,','"has_double_check" INTEGER,','"max_range" TEXT,','"min_range" TEXT , ','"is_required" INTEGER, ','"is_title" INTEGER,','"is_server_local" INTEGER,','"is_searchable" TEXT, ','"regex" TEXT, ','"has_jump" INTEGER,','"jumps" TEXT,','"has_advanced_jump" INTEGER, ','"datetime_format" TEXT,','"branch_form_name" TEXT,','FOREIGN KEY ("form_id") REFERENCES ec_forms(_id) ON DELETE CASCADE ON ',"UPDATE CASCADE",");"].join(""),a=["",'CREATE  TABLE IF NOT EXISTS "ec_branch_inputs" (','"_id" INTEGER PRIMARY KEY  AUTOINCREMENT  NOT NULL  UNIQUE , ','"form_id" INTEGER NOT NULL , ','"ref" TEXT,','"position" INTEGER,','"label" TEXT,','"default_value" TEXT,','"type" TEXT, ','"is_primary_key" INTEGER,','"is_genkey" INTEGER,','"has_double_check" INTEGER,','"max_range" TEXT,','"min_range" TEXT , ','"is_required" INTEGER, ','"is_title" INTEGER,','"is_server_local" INTEGER,','"is_searchable" TEXT, ','"regex" TEXT, ','"has_jump" INTEGER,','"jumps" TEXT,','"has_advanced_jump" INTEGER, ','"datetime_format" TEXT,','FOREIGN KEY ("form_id") REFERENCES ec_branch_forms(_id) ON DELETE CASCADE ON ',"UPDATE CASCADE",");"].join(""),i=["",'CREATE TABLE IF NOT EXISTS "ec_input_options" (','"_id" INTEGER PRIMARY KEY  AUTOINCREMENT  NOT NULL  UNIQUE ,','"input_id" INTEGER NOT NULL , ','"ref" TEXT NOT NULL ,','"label" TEXT NOT NULL ,','"value" TEXT NOT NULL , ','FOREIGN KEY ("input_id") REFERENCES ec_inputs("_id") ON DELETE CASCADE ON ',"UPDATE CASCADE",");"].join(""),s=["",'CREATE TABLE IF NOT EXISTS "ec_branch_input_options" (','"_id" INTEGER PRIMARY KEY  AUTOINCREMENT  NOT NULL  UNIQUE ,','"input_id" INTEGER NOT NULL , ','"ref" TEXT NOT NULL ,','"label" TEXT NOT NULL ,','"value" TEXT NOT NULL , ','FOREIGN KEY ("input_id") REFERENCES ec_branch_inputs("_id") ON DELETE CASCADE ON ',"UPDATE CASCADE",");"].join(""),l=["",'CREATE TABLE IF NOT EXISTS "ec_data" (','"_id" INTEGER PRIMARY KEY  AUTOINCREMENT  NOT NULL  UNIQUE ,','"input_id" INTEGER NOT NULL, ','"form_id" INTEGER NOT NULL, ','"position" INTEGER NOT NULL, ','"parent" TEXT NOT NULL DEFAULT "", ','"label" TEXT NOT NULL DEFAULT "", ','"value" TEXT, ','"ref" TEXT, ','"is_title" INTEGER DEFAULT 0, ','"entry_key" TEXT NOT NULL,','"type" TEXT, ','"is_data_synced" INTEGER DEFAULT 0, ','"is_media_synced" INTEGER DEFAULT 0, ','"is_remote" INTEGER DEFAULT 0, ','"created_on" INTEGER, ','FOREIGN KEY ("input_id") REFERENCES ec_inputs("_id") ON DELETE CASCADE ON ',"UPDATE CASCADE",");"].join(""),c=["",'CREATE TABLE IF NOT EXISTS "ec_branch_data" (','"_id" INTEGER PRIMARY KEY  AUTOINCREMENT  NOT NULL  UNIQUE ,','"input_id" INTEGER NOT NULL, ','"form_id" INTEGER NOT NULL, ','"hierarchy_entry_key_value" TEXT, ','"hierarchy_entry_key_ref" TEXT, ','"position" INTEGER NOT NULL, ','"label" TEXT NOT NULL DEFAULT "", ','"value" TEXT, ','"ref" TEXT, ','"is_title" INTEGER DEFAULT 0, ','"entry_key" TEXT NOT NULL,','"type" TEXT, ','"is_data_synced" INTEGER DEFAULT 0, ','"is_media_synced" INTEGER DEFAULT 0, ','"is_remote" INTEGER DEFAULT 0, ','"is_cached" INTEGER DEFAULT 0, ','"is_stored" INTEGER DEFAULT 0, ','"created_on" INTEGER, ','FOREIGN KEY ("input_id") REFERENCES ec_branch_inputs("_id") ON DELETE CASCADE ON ',"UPDATE CASCADE",");"].join(""),d=["CREATE TRIGGER delete_forms ","BEFORE DELETE ","ON ec_projects ","FOR EACH ROW ","BEGIN ","DELETE FROM ec_forms WHERE ec_forms.project_id = old._id; ","END"].join(""),u=["CREATE TRIGGER delete_branch_forms ","BEFORE DELETE ","ON ec_projects ","FOR EACH ROW ","BEGIN ","DELETE FROM ec_branch_forms WHERE ec_branch_forms.project_id = old._id; ","END"].join(""),E=["CREATE TRIGGER delete_inputs ","BEFORE DELETE ","ON ec_forms ","FOR EACH ROW ","BEGIN ","DELETE FROM ec_inputs WHERE ec_inputs.form_id = old._id; ","END"].join(""),p=["CREATE TRIGGER delete_branch_inputs ","BEFORE DELETE ","ON ec_branch_forms ","FOR EACH ROW ","BEGIN ","DELETE FROM ec_branch_inputs WHERE ec_branch_inputs.form_id = old._id; ","END"].join(""),C=["CREATE TRIGGER delete_input_options ","BEFORE DELETE ","ON ec_inputs ","FOR EACH ROW ","BEGIN ","DELETE FROM ec_input_options WHERE ec_input_options.input_id = old._id; ","END"].join(""),_=["CREATE TRIGGER delete_branch_input_options ","BEFORE DELETE ","ON ec_branch_inputs ","FOR EACH ROW ","BEGIN ","DELETE FROM ec_branch_input_options WHERE ec_branch_input_options.input_id = old._id; ","END"].join(""),h=["CREATE TRIGGER delete_ec_data ","BEFORE DELETE ","ON ec_inputs ","FOR EACH ROW ","BEGIN ","DELETE FROM ec_data WHERE ec_data.input_id = old._id; ","END"].join(""),f=["CREATE TRIGGER delete_ec_branch_data ","BEFORE DELETE ","ON ec_branch_inputs ","FOR EACH ROW ","BEGIN ","DELETE FROM ec_branch_data WHERE ec_branch_data.input_id = old._id; ","END"].join(""),v="DROP TRIGGER IF EXISTS delete_forms ",m="DROP TRIGGER IF EXISTS delete_branch_forms ",g="DROP TRIGGER IF EXISTS delete_inputs ",w="DROP TRIGGER IF EXISTS delete_branch_inputs ",y="DROP TRIGGER IF EXISTS delete_input_options ",S="DROP TRIGGER IF EXISTS delete_branch_input_options ",I="DROP TRIGGER IF EXISTS delete_ec_data ",b="DROP TRIGGER IF EXISTS delete_ec_branch_data ",T=function(e){e.executeSql(t),e.executeSql(n),e.executeSql(o),e.executeSql(r),e.executeSql(a),e.executeSql(i),e.executeSql(s),e.executeSql(l),e.executeSql(c),e.executeSql(v),e.executeSql(m),e.executeSql(g),e.executeSql(w),e.executeSql(y),e.executeSql(S),e.executeSql(I),e.executeSql(b),e.executeSql(d),e.executeSql(u),e.executeSql(E),e.executeSql(p),e.executeSql(C),e.executeSql(_),e.executeSql(h),e.executeSql(f)},O=function(e){console.log(EC.Const.TRANSACTION_ERROR),console.log("%c"+e.message,"color: red")},N=function(){console.log("TRANSACTION INIT SUCCESS"),e.resolve()},A=function(){return e=new $.Deferred,EC.db.transaction(T,O,N),e.promise()};return{init:A,errorCB:O}}();var EC=EC||{};EC.Hierarchy=EC.Hierarchy||{},EC.Hierarchy=function(e){"use strict";var t,n,o,r=[],a=[],i=0,s=function(e,t){if(t.insertId)r[i].id=t.insertId;else{var n=parseInt(window.localStorage.project_id,10),o=window.localStorage.project_name;$.when(EC.Delete.deleteProject(n,o)).then(function(){EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("unknown_error")),window.localStorage.is_project_deleted=1,window.localStorage.back_nav_url="#refresh",EC.Routing.changePage(EC.Const.INDEX_VIEW)},function(){EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("unknown_error"))})}i++,console.log("executeSql SUCCESS FORMS")},l=function(e,t){console.log(e),console.log(t),a.length=0,n.resolve(r)},c=function(e){var n,i,l=a.length;for(n=0;l>n;n++)i="INSERT INTO ec_forms (project_id, num, name, key, has_media, has_branches, is_genkey_hidden, total_inputs) ",i+='VALUES ("',i+=o+'", "',i+=a[n].num+'", "',i+=a[n].name+'", "',i+=a[n].key+'", "',i+=a[n].has_media+'", "',i+=a[n].has_branches+'", "',i+=a[n].is_form_genkey_hidden+'", "',i+=a[n].total_inputs+'");',r.push({num:a[n].num,id:0}),e.executeSql(i,[],s,t.errorCB)};return e.commitForms=function(e,s){return t=this,n=new $.Deferred,a=e,o=s,r.length=0,i=0,EC.db.transaction(c,t.errorCB,l),n.promise()},e}(EC.Hierarchy);var EC=EC||{};EC.Hierarchy=EC.Hierarchy||{},EC.Hierarchy=function(e){"use strict";var t,n,o,r,a,i=[],s=0,l=function(e,t){i[s].id=++o,s++,console.log("executeSql SUCCESS FORMS")},c=function(e,t){console.log(e),console.log(t),a.length=0,n.resolve(i)},d=function(e){var n,o,s=a.length;for(n=0;s>n;n++)o="INSERT INTO ec_forms (project_id, num, name, key, has_media, has_branches, is_genkey_hidden, total_inputs) ",o+='VALUES ("',o+=r+'", "',o+=a[n].num+'", "',o+=a[n].name+'", "',o+=a[n].key+'", "',o+=a[n].has_media+'", "',o+=a[n].has_branches+'", "',o+=a[n].is_form_genkey_hidden+'", "',o+=a[n].total_inputs+'");',i.push({num:a[n].num,id:0}),e.executeSql(o,[],l,t.errorCB)},u=function(e){var n="SELECT MAX(_id) AS _id from ec_forms",o='UPDATE sqlite_sequence SET seq = (SELECT MAX(_id) FROM ec_forms) WHERE name="ec_forms"';e.executeSql(n,[],E,t.errorCB),e.executeSql(o,[],C,null)},E=function(e,t){o=t.rows.item(0)._id},p=function(){EC.db.transaction(d,t.errorCB,c)},C=function(e,t){};return e.commitForms=function(e,l){return t=this,n=new $.Deferred,a=e,r=l,i.length=0,s=0,o=0,EC.db.transaction(u,t.errorCB,p),n.promise()},e}(EC.Hierarchy);var EC=EC||{};EC.Hierarchy=EC.Hierarchy||{},EC.Hierarchy=function(e){"use strict";var t,n,o,r=[],a=function(e,t){console.log(EC.Utils.TRANSACTION_ERROR),console.log(e),console.log(t)},i=function(e,t,n,o,r){var i="",s=e,c=t,d=n,u=o,E=r;i="INSERT INTO ec_input_options (",i+="input_id, ",i+="ref, ",i+="label, ",i+="value)",i+='VALUES ("',i+=s+'", "',i+=c+'", "',i+=d+'", "',i+=u+'");',E.executeSql(i,[],l,a)},s=function(e){var t,n,a,s,l,c,d,u,E,p,C;for(t=0,s=o.length;s>t;t++){for(d=o[t].ref,C=o[t].num,n=0,l=r.length;l>n;n++)if(r[n].ref===d&&r[n].form_num===C){u=r[n].id;break}for(void 0===o[t].options?c=0:"[object Array]"===Object.prototype.toString.call(o[t].options)?c=o[t].options.length:(c=0,E=o[t].options.label,p=o[t].options.value,i(u,d,E,p,e)),a=0;c>a;a++)E=o[t].options[a].label,p=o[t].options[a].value,i(u,d,E,p,e)}},l=function(e,t){console.log("executeSql SUCCESS INPUT OPTIONS")},c=function(){o.length=0,n.resolve()};return e.commitInputOptions=function(e,i){return t=this,n=new $.Deferred,o=e,r=i,EC.db.transaction(s,a,c),n.promise()},e}(EC.Hierarchy);var EC=EC||{};EC.Hierarchy=EC.Hierarchy||{},EC.Hierarchy=function(e){"use strict";var t,n,o,r,a=[],i=[],s=[],l=function(e){var t,n,o,i,l,d,E,p,C,_,h;for(t=0,i=r.length;i>t;t++){for(E=r[t].num,n=0,l=s.length;l>n;n++)if(s[n].num===E){p=s[n].id;break}for(d=r[t].input_list.length,o=0;d>o;o++)C=r[t].input_list[o].type,_=r[t].input_list[o].ref,h="INSERT INTO ec_inputs (",h+="form_id, ",h+="label, ",h+="default_value, ",h+="type, ",h+="ref, ",h+="position, ",h+="is_primary_key, ",h+="is_genkey, ",h+="regex, ",h+="max_range, ",h+="min_range, ",h+="is_required, ",h+="is_title, ",h+="has_jump, ",h+="jumps, ",h+="has_advanced_jump, ",h+="datetime_format, ",h+="branch_form_name, ",h+="has_double_check) ",h+="VALUES (",h+="?,",h+="?,",h+="?,",h+="?,",h+="?,",h+="?,",h+="?,",h+="?,",h+="?,",h+="?,",h+="?,",h+="?,",h+="?,",h+="?,",h+="?,",h+="?,",h+="?,",h+="?,",h+="?);",a.push({ref:_,form_id:p,form_num:E,id:""}),e.executeSql(h,[p,r[t].input_list[o].label,r[t].input_list[o].default_value,C,_,r[t].input_list[o].position,r[t].input_list[o].is_primary_key,r[t].input_list[o].is_genkey,r[t].input_list[o].regex,r[t].input_list[o].max_range,r[t].input_list[o].min_range,r[t].input_list[o].is_required,r[t].input_list[o].is_title,r[t].input_list[o].has_jump,r[t].input_list[o].jumps,r[t].input_list[o].has_advanced_jump,r[t].input_list[o].datetime_format,r[t].input_list[o].branch_form_name,r[t].input_list[o].has_double_check],c,u)}},c=function(e,t){a[o].id=t.insertId,o++,console.log("executeSql SUCCESS HIERARCHY INPUTS")},d=function(){n.resolve(a),i.length=0,r.length=0},u=function(e,t){console.log(EC.Utils.TRANSACTION_ERROR),console.log(e),console.log(t)};return e.commitInputs=function(e,c){return t=this,n=new $.Deferred,r=e,s=c,a=[],i=[],o=0,EC.db.transaction(l,u,d),n.promise()},e}(EC.Hierarchy);var EC=EC||{};EC.Hierarchy=EC.Hierarchy||{},EC.Hierarchy=function(e){"use strict";var t,n,o,r=function(e){var o="";o+="INSERT INTO ec_projects ( ",o+="name, ",o+="allowDownloadEdits, ",o+="version, ",o+="total_hierarchy_forms, ",o+="total_branch_forms, ",o+="downloadFromServer, ",o+="uploadToServer) ",o+='VALUES ("',o+=n.name+'", "',o+=n.allowDownloadEdits+'", "',o+=n.version+'", "',o+=n.total_hierarchy_forms+'", "',o+=n.total_branch_forms+'", "',o+=n.downloadFromServer+'", "',o+=n.uploadToServer+'");',e.executeSql(o,[],a,t.errorCB)},a=function(e,t){n.insertId=t.insertId},i=function(){n.insertId?o.resolve(n):(alert("ios"),$.when(EC.Select.getProjectRowId(n.name)).then(function(e){n.insertId=e,o.resolve(n)}))};return e.commitProject=function(e){return t=this,n=e,o=new $.Deferred,EC.db.transaction(r,t.errorCB,i),o.promise()},e}(EC.Hierarchy);var EC=EC||{};EC.Hierarchy=function(e){"use strict";return e.errorCB=function(e,t){console.log(EC.Utils.TRANSACTION_ERROR),console.log(e),console.log(t)},e}(EC.Hierarchy);var EC=EC||{};EC.Structure=EC.Structure||{},EC.Structure=function(e){"use strict";var t,n;return e.commitAll=function(){return t=new $.Deferred,$.when(EC.Hierarchy.commitProject(EC.Parse.project)).then(function(e){n=e;var o=EC.Parse.getBranchForms(),r=EC.Parse.getHierarchyForms();o.length>0?$.when(EC.Hierarchy.commitForms(r,n.insertId),EC.Branch.commitBranchForms(o,n.insertId)).then(function(e,n){var o=EC.Parse.inputs,r=EC.Parse.branch_inputs;$.when(EC.Hierarchy.commitInputs(o,e),EC.Branch.commitBranchInputs(r,n)).then(function(e,n){var o=EC.Parse.branch_options,r=EC.Parse.options;r.length>0?$.when(EC.Hierarchy.commitInputOptions(r,e)).then(function(){o.length>0?$.when(EC.Branch.commitBranchInputOptions(o,n)).then(function(){console.log("models ready"),t.resolve()}):(console.log("models ready"),t.resolve())}):o.length>0?$.when(EC.Branch.commitBranchInputOptions(o,n)).then(function(){console.log("models ready"),t.resolve()}):(console.log("models ready"),t.resolve())})}):$.when(EC.Hierarchy.commitForms(r,n.insertId)).then(function(e){var n=EC.Parse.inputs;$.when(EC.Hierarchy.commitInputs(n,e)).then(function(e){var n=EC.Parse.options;n.length>0?$.when(EC.Hierarchy.commitInputOptions(n,e)).then(function(){console.log("models ready"),t.resolve()}):(console.log("models ready"),t.resolve())})})}),t.promise()},e}(EC.Structure);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a,i,s,l,c,d=function(e){var o,c,d=t.length,u="SELECT * FROM ec_data WHERE form_id=?";for(i=0,s=0,o=0;d>o;o++)e.executeSql(u,[t[o]._id],E,EC.Select.errorCB);l&&(r=[],a=[],c="SELECT * FROM ec_branch_data JOIN ec_branch_forms ON ec_branch_data.form_id=ec_branch_forms._id WHERE ec_branch_forms.project_id=?",e.executeSql(c,[n],p,EC.Select.errorCB))},u=function(){r.length>0&&o.push({has_branches:!0,branch_data_rows:r,branch_form_names:a}),c.resolve(o.slice(0)),o.length=0,r.length=0,t.length=0},E=function(e,n){var r,a,s=n.rows.length;for(o[i]={form_id:t[i]._id,form_name:t[i].name,total_entries:t[i].entries,total_inputs:t[i].total_inputs,data_rows:[]},r=0;s>r;r++)a=o[i].data_rows,a.push(n.rows.item(r)),(a[a.length-1].type===EC.Const.PHOTO||a[a.length-1].type===EC.Const.AUDIO||a[a.length-1].type===EC.Const.VIDEO)&&(a[a.length-1].value="");i++},p=function(e,t){var n,o,i=t.rows.length;for(n=0;i>n;n++)r.push(t.rows.item(n)),o=t.rows.item(n).name,EC.Utils.inArray(a,o)||a.push(o)};return e.getAllProjectEntries=function(e,a){return t=e,n=a,l=EC.Utils.projectHasBranches(),o=[],r=[],c=new $.Deferred,EC.db.transaction(d,EC.Select.errorCB,u),c.promise()},e}(EC.Select);var EC=EC||{};EC.Select=function(e){var t,n,o,r=function(e){var n="SELECT allowDownloadEdits FROM ec_projects WHERE _id=?";e.executeSql(n,[t],a,EC.Select.errorCB)},a=function(e,t){n=t.rows.item(0).allowDownloadEdits},i=function(){"false"===n?o.reject():o.resolve()};return e.getAllowDownloadEdits=function(e){return t=e,o=new $.Deferred,EC.db.transaction(r,EC.Select.errorCB,i),o.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a=function(e,t){var n,o=t.rows.length;for(n=0;o>n;n++)r.push(t.rows.item(n))},i=function(e){var n,r=o.length,i="SELECT value, type from ec_branch_data WHERE hierarchy_entry_key_value=? AND (type=? OR type=? OR type=?) AND value <>?";for(n=0;r>n;n++)e.executeSql(i,[o[n].entry_key,EC.Const.PHOTO,EC.Const.AUDIO,EC.Const.VIDEO,""],a,t.errorCB)},s=function(){n.resolve(r)};return e.getBranchChildrenFiles=function(){return t=this,n=new $.Deferred,o=EC.Delete.deletion_entries,r=[],EC.db.transaction(i,t.errorCB,s),n.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a,i,s=[],l=[],c=[],d=[],u=function(){var e,t=s.length;for(e=0;t>e;e++)d.push(s[e].entry_key);EC.BranchInputs.setCachedBranchEntryKeys(o,d),d.length=0,EC.db.transaction(E,EC.Select.errorCB,C),console.log(EC.Const.TRANSACTION_SUCCESS)},E=function(e){var t,r,a=s.length;for(t=0;a>t;t++)r="SELECT _id, value, entry_key FROM ec_branch_data WHERE form_id IN (SELECT _id FROM ec_branch_forms WHERE name=? AND project_id=?) AND is_title=? AND entry_key=? AND hierarchy_entry_key_value=?",e.executeSql(r,[o,n,1,s[t].entry_key,s[t].hierarchy_entry_key_value],p,EC.Select.errorCB)},p=function(e,t){var n,o=t.rows.length;for(n=0;o>n;n++)l.push(t.rows.item(n))},C=function(){var e,t,n,o=s.length,r=l.length;for(e=0;o>e;e++){for(n="",t=0;r>t;t++)s[e].entry_key===l[t].entry_key&&(n+=""===n?l[t].value:", "+l[t].value);c.push({full_title:n,entry_key:s[e].entry_key})}console.log("branch entries full_titles"),console.log(c),i.resolve(c.slice(0)),c.length=0,l.length=0,s.length=0},_=function(e){var i="";i="SELECT _id, entry_key, hierarchy_entry_key_value FROM ec_branch_data ",i+="WHERE form_id IN (SELECT _id FROM ec_branch_forms WHERE name=? AND project_id=?) ",i+="AND hierarchy_entry_key_value=? ",i+="GROUP BY entry_key ",i+="ORDER BY entry_key ",i+="LIMIT "+window.localStorage.QUERY_LIMIT+" OFFSET "+a,e.executeSql(i,[o,n,r],h,EC.Select.errorCB),t.query_error_message="EC.Select.getBranchEntries _getBranchEntriesTX"},h=function(e,t){var n,o=t.rows.length;for(n=0;o>n;n++)s.push(t.rows.item(n));console.log(s,!0)};return e.getBranchEntries=function(e,s,l,c){return t=this,o=s,r=l,n=e,a=c,i=new $.Deferred,EC.db.transaction(_,EC.Select.errorCB,u),i.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r=[],a=function(e){var o="SELECT DISTINCT entry_key FROM ec_data WHERE form_id IN (SELECT _id FROM ec_branch_forms WHERE name=? AND project_id=?)";e.executeSql(o,[t,n],i,EC.Select.errorCB)},i=function(e,t){var n,o=t.rows.length;for(n=0;o>n;n++)r.push(t.rows.item(n).entry_key)},s=function(){o.resolve(r)};return e.getBranchEntryKeys=function(e,i){return o=new $.Deferred,t=e,n=i,r.length=0,EC.db.transaction(a,EC.Select.errorCB,s),o.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a,i=[],s=function(e){var a="SELECT * FROM ec_branch_data WHERE form_id IN (SELECT _id FROM ec_branch_forms WHERE name=? AND project_id=?) AND entry_key=? AND hierarchy_entry_key_value =? ORDER BY position";e.executeSql(a,[t,r,o,n],l,EC.Select.errorCB)},l=function(e,t){var n,o,r=t.rows.length;for(n=0;r>n;n++)o=t.rows.item(n).input_id,i.push(t.rows.item(n));console.log(e),console.log("TRANSACTION SELECT BRANCH ENTRY VALUES SUCCESS")},c=function(e){a.resolve(i.slice(0)),i.length=0};return e.getBranchEntryValues=function(e,l,d,u){return t=l,o=d,r=e,n=u,a=new $.Deferred,i.length=0,EC.db.transaction(s,EC.Select.errorCB,c),a.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r=function(e,t){console.log(EC.Const.TRANSACTION_ERROR),console.log(e),console.log(t)},a=function(e,t){var n,r=t.rows.length;for(n=0;r>n;n++)o.push(t.rows.item(n))},i=function(e){var n="SELECT value, type from ec_branch_data WHERE hierarchy_entry_key_value=? AND (type=? OR type=? OR type=?) AND value <>?";e.executeSql(n,[t,EC.Const.PHOTO,EC.Const.AUDIO,EC.Const.VIDEO,""],a,r)},s=function(){console.log("Branch files: ****************************************"),console.log("Branch files:"+JSON.stringify(o)),n.resolve(o)};return e.getBranchFiles=function(e){return n=new $.Deferred,t=e,o=[],EC.db.transaction(i,r,s),n.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a,i,s=function(e){var n="SELECT _id, project_id, name,num, key, total_inputs, has_media, is_genkey_hidden, entries FROM ec_branch_forms WHERE name=? AND project_id=?";e.executeSql(n,[t,r],l,EC.Select.errorCB)},l=function(e,t){a=t.rows.item(0)},c=function(){i.resolve(a)};return e.getBranchFormDetails=function(e,a,l){return o=e,n=a,t=o.branch_form_name,r=l,i=new $.Deferred,EC.db.transaction(s,EC.Select.errorCB,c),i.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a=function(e){var o,r=n.length,a="SELECT _id, name FROM ec_branch_forms WHERE name=? AND project_id=?";for(o=0;r>o;o++)e.executeSql(a,[n[o],t],i,EC.Select.errorCB)},i=function(e,t){o.push({_id:t.rows.item(0)._id,name:t.rows.item(0).name})},s=function(){r.resolve(o)};return e.getBranchFormLocalIDs=function(e,i){return t=e,n=i,r=new $.Deferred,o=[],EC.db.transaction(a,EC.Select.errorCB,s),r.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r=function(){o.resolve(t)},a=function(e,n){var o,r=n.rows.length;for(o=0;r>o;o++)t.push(n.rows.item(o))},i=function(e){var t="SELECT _id, name, key, num, has_media, is_genkey_hidden, total_inputs, entries FROM ec_branch_forms WHERE project_id=?";e.executeSql(t,[n],a,EC.Select.errorCB)};return e.getBranchForms=function(e){return n=e,t=[],o=new $.Deferred,EC.db.transaction(i,EC.Select.errorCB,r),o.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a=[],i=[],s=[],l=function(e){console.log("TRANSACTION SELECT INPUTS SUCCESS"),t=!1,i.length=0;var n,o=a.length;for(n=0;o>n;n++)("radio"===a[n].type||"select"===a[n].type||"checkbox"===a[n].type)&&i.push({id:a[n]._id}),1!==a[n].has_jump||t||(t=!0);i.length>0?EC.db.transaction(u,EC.Select.errorCB,d):r.resolve(a,t)},c=function(e,t){var n,o=t.rows.length;for(n=0;o>n;n++)a.push(t.rows.item(n));console.log(a,!0)},d=function(e){var n,o,i=a.length,l=s.length;for(n=0;i>n;n++)for(a[n].options=[],o=0;l>o;o++)a[n]._id===s[o].input_id&&a[n].options.push({jump_to:s[o].jump_to,jump_when:s[o].jump_when,label:s[o].label,ref:s[o].ref,value:s[o].value});r.resolve(a,t)},u=function(e){var t,n,o=i.length;for(t=0;o>t;t++)n="SELECT * FROM ec_branch_input_options WHERE input_id=?",e.executeSql(n,[i[t].id],E,EC.Select.errorCB)},E=function(e,t){var n,o=t.rows.length;for(n=0;o>n;n++)s.push(t.rows.item(n))},p=function(e){var t="SELECT * FROM ec_branch_inputs WHERE form_id IN (SELECT _id FROM ec_branch_forms WHERE name=? AND project_id=?) ORDER BY position";e.executeSql(t,[n,o],c,EC.Select.errorCB)};return e.getBranchInputs=function(e,t){return r=new $.Deferred,o=t,n=e,a.length=0,i.length=0,s.length=0,$.when(EC.Select.getBranchEntryKeys(n,o)).then(function(e){var t,n;try{t=JSON.parse(window.localStorage.branch_primary_keys)}catch(o){t=[]}n=t.concat(e).unique(),window.localStorage.branch_primary_keys=JSON.stringify(n),EC.db.transaction(p,EC.Select.errorCB,l)}),r.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r=function(e){var n="SELECT ec_branch_inputs._id, ec_branch_inputs.ref FROM ec_branch_inputs JOIN ec_branch_forms ON ec_branch_forms._id=ec_branch_inputs.form_id WHERE ec_branch_forms.project_id=?";e.executeSql(n,[t],a,EC.Select.errorCB)},a=function(e,t){var o,r=t.rows.length;for(o=0;r>o;o++)n.push({_id:t.rows.item(o)._id,ref:t.rows.item(o).ref})},i=function(){o.resolve(n)};return e.getBranchInputsLocalIDs=function(e){return t=e,o=new $.Deferred,n=[],EC.db.transaction(r,EC.Select.errorCB,i),o.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a=function(){o.resolve(r)},i=function(e,t){var n,o=t.rows.length;for(n=0;o>n;n++)r.push(t.rows.item(n))},s=function(e){var o,r=n.length,a="SELECT value, type from ec_branch_data WHERE hierarchy_entry_key_value=? AND is_data_synced=? AND is_media_synced=? AND (type=? OR type=? OR type=?) AND value <>?";for(o=0;r>o;o++)e.executeSql(a,[n[o],1,1,EC.Const.PHOTO,EC.Const.AUDIO,EC.Const.VIDEO,""],i,t.errorCB)};return e.getBranchSyncedFiles=function(e){return t=this,o=new $.Deferred,n=e,r=[],EC.db.transaction(s,t.errorCB,a),o.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a,i,s,l,c,d,u,E=[],p=0,C=0,_=0,h=function(e){var n="";n+="SELECT DISTINCT parent FROM ec_data WHERE form_id=? ORDER BY parent ",n+="LIMIT 1 ",n+="OFFSET "+r,e.executeSql(n,[t],v,EC.Select.errorCB)},f=function(e){},v=function(e,t){var n,o=t.rows.length;o>0?(n=t.rows.item(0).parent,E.push(t.rows.item(0)),EC.db.transaction(m,EC.Select.errorCB,w)):u?EC.Entries.appendMoreChildEntries(E):l?EC.Entries.appendMoreChildEntries(E):EC.Entries.renderChildEntriesList(E)},m=function(e){var t=E[p].parent,r="SELECT form_id, parent, label, value,  entry_key, is_title, type FROM ec_data WHERE parent=? AND value<>?";u?(r+="LIMIT "+window.localStorage.QUERY_LIMIT*a+" ",u=!1):r+="LIMIT "+(window.localStorage.QUERY_LIMIT-o)*a+" ",0===n?r+="OFFSET 0":0===o?r+="OFFSET "+n*a:(r+="OFFSET "+o*a,o=0),e.executeSql(r,[t,EC.Const.SKIPPED],g,EC.Select.errorCB)},g=function(e,t){var n,o=t.rows.length,r="";if(o>0){var a=t.rows.item(0),i=a.entry_key;for(1===a.is_title&&""!==a.value&&(r+=""===r?a.value:", "+a.value),
E[p].children=[],C=0,n=1;o>n;n++)a=t.rows.item(n),a.entry_key===i?1===a.is_title&&""!==a.value&&(r+=""===r?a.value:", "+a.value):(""===r&&(r=i),E[p].children[C]={full_title:r,entry_key:i},i=a.entry_key,C++,r="",1===a.is_title&&""!==a.value&&(r+=""===r?a.value:", "+a.value));""===r&&(r=i),E[p].children[C]={full_title:r,entry_key:i},r=""}},w=function(){E.length;EC.db.transaction(S,EC.Select.errorCB,y)},y=function(){var e=window.localStorage.QUERY_LIMIT;if(_=0,C=0,l)E[p].children.length<e-o?(o=E[p].children.length,p++,r++,n=0,EC.db.transaction(h,EC.Select.errorCB,f)):(o=E[p].children.length,EC.Entries.appendMoreChildEntries(E));else{var t,a=E.length,i=0;for(t=0;a>t;t++)i+=E[t].children.length;e>i?d.getNextParentChildEntries(i):(o=E[p].children.length,EC.Entries.renderChildEntriesList(E))}},S=function(e){var n,o,r,a=E[p].children.length,i=EC.Utils.getParentAndChildForms(t),s=i.child;for(n=0;a>n;n++)r=E[p].parent+EC.Const.ENTRY_ROOT_PATH_SEPARATOR+E[p].children[n].entry_key,o="SELECT entry_key FROM ec_data WHERE parent=? AND form_id=? GROUP BY entry_key",e.executeSql(o,[r,s],I,EC.Select.errorCB)},I=function(e,t){E[p].children[_].nested_children_count=t.rows.length,_++};return e.getChildEntries=function(e,c,u){t=e,r=c,n=u,s=EC.Utils.getFormByID(t).entries,a=EC.Utils.getFormByID(t).total_inputs,i=0,l=!1,o=0,E.length=0,p=0,d=this,EC.db.transaction(h,EC.Select.errorCB,f)},e.getNextParentChildEntries=function(e){o=e,r++,p++,EC.db.transaction(h,EC.Select.errorCB,f)},e.getMoreChildEntries=function(e,o){t=e,n=o,l=!0,c=window.localStorage.QUERY_LIMIT,u=!0;var r=E[E.length-1];E.length=0,E.push(r),E[0].children.length=0,p=0,console.log(E),EC.db.transaction(m,EC.Select.errorCB,w)},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a,i,s=function(e,t){var n,o=t.rows.length;for(n=0;o>n;n++)r.push(t.rows.item(n));o>0&&(a={form_id:r[0].form_id,amount:r.length})},l=function(e){var n,r=i.length,a="SELECT form_id, parent, entry_key, COUNT(*) as count FROM ec_data WHERE parent=? GROUP BY entry_key";for(n=0;r>n;n++)o=""===i[n].parent?i[n].entry_key:i[n].parent+EC.Const.ENTRY_ROOT_PATH_SEPARATOR+i[n].entry_key,e.executeSql(a,[o],s,t.errorCB)},c=function(){n.resolve(r,a)};return e.getChildEntriesForDeletion=function(){return t=this,n=new $.Deferred,i=EC.Delete.deletion_entries,r=[],a={},EC.db.transaction(l,t.errorCB,c),n.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a,i,s=function(e){var t;t="SELECT COUNT(DISTINCT entry_key) as count FROM ec_branch_data WHERE form_id IN (SELECT _id FROM ec_branch_forms WHERE name=? AND project_id=?) AND hierarchy_entry_key_value=?",e.executeSql(t,[n,i,a],l,EC.Select.errorCB)},l=function(e,t){o=t.rows.length>0?t.rows.item(0).count:0},c=function(){r.resolve(o,t)};return e.getCountBranchEntries=function(e,o,l){return t=e,n=e.branch_form_name,a=o,i=l,r=new $.Deferred,EC.db.transaction(s,EC.Select.errorCB,c),r.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";function t(e){var t,n,r,a,i,s=l.length;for(a=JSON.parse(window.localStorage.breadcrumbs),r=""===a[0]?a.join(EC.Const.ENTRY_ROOT_PATH_SEPARATOR).substring(1):a.join(EC.Const.ENTRY_ROOT_PATH_SEPARATOR),t=0;s>t;t++)n=""===r?l[t].entry_key:r+EC.Const.ENTRY_ROOT_PATH_SEPARATOR+l[t].entry_key,i="SELECT parent FROM ec_data WHERE parent=? GROUP BY entry_key",e.executeSql(i,[n],o,EC.Select.errorCB)}function n(){0===i?s.resolve(d.slice(0)):EC.Entries.appendMoreEntries(d.slice(0)),d.length=0,c.length=0,l.length=0,E=0,console.log(EC.Const.TRANSACTION_SUCCESS)}function o(e,t){d[E].children=t.rows.length,E++}var r,a,i,s,l=[],c=[],d=[],u=[],E=0,p=function(){var e,t=l.length;for(e=0;t>e;e++)u.push(l[e].entry_key);window.localStorage.primary_keys=JSON.stringify(u),u.length=0,EC.db.transaction(f,EC.Select.errorCB,C),console.log(EC.Const.TRANSACTION_SUCCESS)},C=function(){var e,t,n,o=l.length,r=c.length;for(e=0;o>e;e++){for(n="",t=0;r>t;t++)l[e].entry_key===c[t].entry_key&&(n+=""===n?c[t].value:", "+c[t].value);d.push({full_title:n,entry_key:l[e].entry_key})}m()},_=function(e){var t="SELECT _id, entry_key, parent FROM ec_data WHERE form_id=? AND parent=? GROUP BY entry_key ORDER BY _id LIMIT "+window.localStorage.QUERY_LIMIT+" OFFSET "+i;e.executeSql(t,[r,a],h,EC.Select.errorCB)},h=function(e,t){var n,o=t.rows.length;for(n=0;o>n;n++)l.push(t.rows.item(n));console.log(l,!0)},f=function(e){var t,n,o=l.length;for(t=0;o>t;t++)n="SELECT _id, value, entry_key FROM ec_data WHERE form_id=? AND is_title=? AND entry_key=? AND parent=? AND value<>?",e.executeSql(n,[r,1,l[t].entry_key,l[t].parent,EC.Const.SKIPPED],v,EC.Select.errorCB)},v=function(e,t){var n,o=t.rows.length;for(n=0;o>n;n++)c.push(t.rows.item(n))},m=function(){l.length>0?EC.db.transaction(t,EC.Select.errorCB,n):(0===i?EC.Entries.renderList(d.slice(0)):EC.Entries.appendMoreEntries(d.slice(0)),d.length=0,c.length=0,l.length=0,E=0,console.log(EC.Const.TRANSACTION_SUCCESS))};return e.getEntries=function(e,t,n){return r=e,a=t,i=n,s=new $.Deferred,EC.db.transaction(_,EC.Select.errorCB,p),s.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a=function(e){var o="SELECT DISTINCT entry_key FROM ec_data WHERE form_id=?";e.executeSql(o,[n],i,t.errorCB)},i=function(e,t){var n,r=t.rows.length;for(n=0;r>n;n++)o.push(t.rows.item(n).entry_key)},s=function(){r.resolve(o)};return e.getEntryKeys=function(e){return t=this,r=new $.Deferred,n=e,o=[],EC.db.transaction(a,t.errorCB,s),r.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a=[],i=[],s=function(e){var r="SELECT * FROM ec_data WHERE form_id=? AND entry_key=? AND parent=? ORDER BY position";e.executeSql(r,[t,n,o],l,EC.Select.errorCB)},l=function(e,t){var n,o,r=t.rows.length;for(n=0;r>n;n++)o=t.rows.item(n).input_id,a.push(t.rows.item(n)),t.rows.item(n).type===EC.Const.BRANCH&&i.push(t.rows.item(n));console.log(e),console.log("TRANSACTION SELECT ENTRY VALUES SUCCESS")},c=function(e){r.resolve(a.slice(0)),a.length=0,console.log(EC.Const.TRANSACTION_SUCCESS)};return e.getEntryValues=function(e,a,i){return t=e,n=a,o=i,r=new $.Deferred,EC.db.transaction(s,EC.Select.errorCB,c),r.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a,i,s,l,c,d={},u=function(){r=0,a=0,i=0,l=0,s=0,o=EC.Utils.projectHasBranches(),EC.db.transaction(E,EC.Select.errorCB,f)},E=function(e){var n,o=t.length,r="SELECT COUNT(*) AS total_synced_rows FROM ec_data WHERE form_id=? AND is_data_synced=?",a="SELECT COUNT(*) AS total_entries_rows FROM ec_data WHERE form_id=?",i="SELECT COUNT(*) AS total_media_files FROM ec_data WHERE form_id=? AND (type=? OR type=? OR type=?) AND value<>?",s="SELECT COUNT(*) AS total_all_synced_rows FROM ec_data WHERE form_id=? AND is_data_synced=?";for(n=0;o>n;n++)e.executeSql(r,[t[n]._id,1],p,EC.Select.errorCB),e.executeSql(a,[t[n]._id],C,EC.Select.errorCB),e.executeSql(i,[t[n]._id,EC.Const.PHOTO,EC.Const.AUDIO,EC.Const.VIDEO,""],_,EC.Select.errorCB),e.executeSql(s,[t[n]._id,1],h,EC.Select.errorCB)},p=function(e,t){r+=parseInt(t.rows.item(0).total_synced_rows,10)},C=function(e,t){a+=parseInt(t.rows.item(0).total_entries_rows,10)},_=function(e,t){i+=parseInt(t.rows.item(0).total_media_files,10)},h=function(e,t){l+=parseInt(t.rows.item(0).total_all_synced_rows,10)},f=function(){var e,s,u=[];console.log("Data info collected"),d.unsync_all_data=r>0?1:0,d.delete_all_entries=a>0?1:0,d.delete_media_files=i>0?1:0,d.delete_synced_entries=l>0?1:0,o?$.when(EC.Select.getBranchForms(n)).then(function(n){for(s=n.length,e=0;s>e;e++)1===parseInt(n[e].has_media,10)&&u.push(n[e]._id);u.length>0?$.when(EC.Select.hasBranchMediaFiles(u)).then(function(e){d.delete_media_files=e?1:0,c.resolve(t.slice(0),d)}):c.resolve(t.slice(0),d)}):c.resolve(t.slice(0),d)},v=function(e){var t="SELECT _id, name, key, num, has_media, has_branches, is_genkey_hidden, total_inputs, entries FROM ec_forms WHERE project_id=?";e.executeSql(t,[n],m,EC.Select.errorCB)},m=function(e,n){var o,r=n.rows.length;for(o=0;r>o;o++)t.push(n.rows.item(o));console.log(e),console.log("TRANSACTION SELECT FORMS SUCCESS")};return e.getForms=function(e){return n=e,t=[],c=new $.Deferred,EC.db.transaction(v,EC.Select.errorCB,u),c.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a=function(e,t){console.log(e),console.log(t)},i=function(e,t){t.rows.item(0)&&(n=t.rows.item(0).parent)},s=function(){null!==n?r.resolve(n):r.reject()},l=function(e){var n="SELECT parent FROM ec_data WHERE form_id=? AND entry_key=? LIMIT 1";e.executeSql(n,[o,t],i,a)};return e.getFullParentPath=function(e,i){return o=e,t=i,r=new $.Deferred,n=null,EC.db.transaction(l,a,s),r.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a,i=function(e,t){var n,o=t.rows.length;for(n=0;o>n;n++)r.push(t.rows.item(n))},s=function(e){var o,r=a.length,s="SELECT value, type from ec_data WHERE form_id=? AND entry_key=? AND (type=? OR type=? OR type=?) AND value <>?";for(o=0;r>o;o++)e.executeSql(s,[n._id,a[o].entry_key,EC.Const.PHOTO,EC.Const.AUDIO,EC.Const.VIDEO,""],i,t.errorCB)},l=function(){console.log("Hierarchy files: ****************************************"),console.log("files:"+JSON.stringify(r)),o.resolve(r)};return e.getHierarchyChildrenFiles=function(e){return t=this,o=new $.Deferred,n=e,r=[],a=EC.Delete.deletion_entries,EC.db.transaction(s,t.errorCB,l),o.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a,i=function(e,t){var n,o=t.rows.length;for(n=0;o>n;n++)r.push(t.rows.item(n));a.push({form_id:r[0].form_id,amount:r.length})},s=function(e){var t="SELECT form_id, parent, entry_key, COUNT(*) as count FROM ec_data WHERE entry_key=? GROUP BY form_id";e.executeSql(t,[o],i,EC.Delete.errorCB)},l=function(){n.resolve(r,a)};return e.getHierarchyEntriesForDeletion=function(e){return t=this,n=new $.Deferred,o=e,r=[],a=[],EC.db.transaction(s,EC.Delete.errorCB,l),n.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a,i=function(e,t){var n,o=t.rows.length;for(n=0;o>n;n++)r.push(t.rows.item(n))},s=function(e){var o="SELECT value, type from ec_data WHERE form_id=? AND entry_key=? AND (type=? OR type=? OR type=?) AND value <>?";e.executeSql(o,[n._id,a,EC.Const.PHOTO,EC.Const.AUDIO,EC.Const.VIDEO,""],i,t.errorCB)},l=function(){o.resolve(r)};return e.getHierarchyFiles=function(e,i){return t=this,o=new $.Deferred,n=e,a=i,r=[],EC.db.transaction(s,t.errorCB,l),o.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a=function(){o.resolve(r)},i=function(e,t){var n,o=t.rows.length;for(n=0;o>n;n++)r.push(t.rows.item(n))},s=function(e){var o="SELECT value, type from ec_data WHERE form_id=? AND is_data_synced=? AND is_media_synced=? AND (type=? OR type=? OR type=?) AND value<>?";e.executeSql(o,[n,1,1,EC.Const.PHOTO,EC.Const.AUDIO,EC.Const.VIDEO,""],i,t.errorCB)};return e.getHierarchySyncedFiles=function(e){return t=this,o=new $.Deferred,n=e,r=[],EC.db.transaction(s,t.errorCB,a),o.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a=[],i=[],s=[],l=function(e){console.log("TRANSACTION SELECT INPUTS SUCCESS"),n=o=!1,i.length=0;var t,s=a.length;for(t=0;s>t;t++)(a[t].type===EC.Const.RADIO||a[t].type===EC.Const.DROPDOWN||a[t].type===EC.Const.CHECKBOX)&&i.push({id:a[t]._id}),a[t].type===EC.Const.LOCATION&&(o=!0),1!==a[t].has_jump||n||(n=!0);i.length>0?EC.db.transaction(u,EC.Select.errorCB,d):r.resolve(a,n,o)},c=function(e,t){var n,o=t.rows.length;for(n=0;o>n;n++)a.push(t.rows.item(n))},d=function(e){var t,i,l=a.length,c=s.length;for(t=0;l>t;t++)for(a[t].options=[],i=0;c>i;i++)a[t]._id===s[i].input_id&&a[t].options.push({label:s[i].label,ref:s[i].ref,value:s[i].value});r.resolve(a,n,o)},u=function(e){var t,n,o=i.length;for(t=0;o>t;t++)n="SELECT * FROM ec_input_options WHERE input_id=?",e.executeSql(n,[i[t].id],E,EC.Select.errorCB)},E=function(e,t){var n,o=t.rows.length;for(n=0;o>n;n++)s.push(t.rows.item(n))},p=function(e){var n="SELECT * FROM ec_inputs WHERE form_id=? ORDER BY position";e.executeSql(n,[t],c,EC.Select.errorCB)};return e.getInputs=function(e){return r=new $.Deferred,t=e,a.length=0,i.length=0,s.length=0,$.when(EC.Select.getEntryKeys(t)).then(function(e){var t,n;try{t=JSON.parse(window.localStorage.primary_keys)}catch(o){t=[]}n=t.concat(e).unique(),window.localStorage.primary_keys=JSON.stringify(n),EC.db.transaction(p,EC.Select.errorCB,l)}),r.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o=[];e.getLocalInputIDs=function(e){return t=e,n=new $.Deferred,EC.db.transaction(r,EC.Select.errorCB,i),n.promise()};var r=function(e){var n,o=t.length,r="SELECT _id, ref FROM ec_inputs WHERE form_id=?";for(n=0;o>n;n++)e.executeSql(r,[t[n]._id],a,EC.Select.errorCB)},a=function(e,t){var n,r=t.rows.length;for(n=0;r>n;n++)o.push(t.rows.item(n))},i=function(){n.resolve(o)};return e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r=function(){o.resolve(n)},a=function(e,t){n=t.rows.item(0)._id},i=function(e){var n="SELECT _id FROM ec_projects WHERE name=?";e.executeSql(n,[t],a,EC.Select.errorCB)};return e.getProjectRowId=function(e){return o=new $.Deferred,t=e,EC.db.transaction(i,EC.Select.errorCB,r),o.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n=[],o=function(){console.log(EC.Const.TRANSACTION_SUCCESS)},r=function(e){var t="SELECT _id, name, total_hierarchy_forms, total_branch_forms FROM ec_projects ORDER BY name";e.executeSql(t,[],a,EC.Select.errorCB)},a=function(e,o){var r,a=o.rows.length;for(r=0;a>r;r++)n.push(o.rows.item(r));t.resolve(n)};return e.getProjects=function(){return t=new $.Deferred,n.length=0,EC.db.transaction(r,EC.Select.errorCB,o),t.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a=function(e,t){console.log(e),console.log(t)},i=function(e){var t="SELECT DISTINCT entry_key FROM ec_data WHERE form_id=?";t+=' AND ((is_data_synced=? AND type NOT IN ("audio", "photo", "video"))',t+=' OR (is_data_synced=? AND is_media_synced=? AND type IN ("audio", "photo", "video"))',t+=' OR (is_data_synced=? AND is_media_synced=? AND type IN ("audio", "photo", "video") AND value=?))',e.executeSql(t,[n,1,1,1,1,0,""],s,a)},s=function(e,t){var n,r=t.rows.length;for(n=0;r>n;n++)o.push(t.rows.item(n).entry_key)},l=function(){r.resolve(o)};return e.getSyncedEntryKeys=function(e){return t=this,r=new $.Deferred,n=e,o=[],EC.db.transaction(i,t.errorCB,l),r.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r=function(){o.resolve(n>0?!0:!1)},a=function(e,t){n+=parseInt(t.rows.item(0).total_branch_media_files,10)},i=function(e){var n,o=t.length,r="SELECT COUNT(*) AS total_branch_media_files FROM ec_branch_data WHERE form_id=? AND (type=? OR type=? OR type=?) AND value<>?";for(n=0;o>n;n++)e.executeSql(r,[t[n],EC.Const.PHOTO,EC.Const.AUDIO,EC.Const.VIDEO,""],a,EC.Select.errorCB)};return e.hasBranchMediaFiles=function(e){return t=e,n=0,o=new $.Deferred,EC.db.transaction(i,EC.Select.errorCB,r),o.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";return e.errorCB=function(e,t){console.log(EC.Const.TRANSACTION_ERROR),console.log("%c"+t.message,"color: red"),console.log("%c"+e,"color: red")},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r=function(e){var n="SELECT _id, name, num, key, total_inputs, has_media, is_genkey_hidden, entries FROM ec_branch_forms WHERE project_id=?";e.executeSql(n,[t],a,EC.Select.errorCB)},a=function(e,t){var o,r=t.rows.length;for(o=0;r>o;o++)n.push(t.rows.item(o))},i=function(){o.resolve(n)};return e.getBranchForms=function(e){return t=e,n=[],o=new $.Deferred,EC.db.transaction(r,EC.Select.errorCB,i),o.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r=function(e){var n="SELECT _id, value, type FROM ec_branch_data WHERE form_id IN (SELECT _id FROM ec_branch_forms WHERE project_id=? AND has_media=?) AND type=? AND is_data_synced=? AND is_media_synced=? AND value<>? LIMIT 1";e.executeSql(n,[t,1,EC.Const.AUDIO,1,0,""],a,EC.Select.errorCB)},a=function(e,t){t.rows.length>0&&(o=t.rows.item(0))},i=function(){o?n.resolve(o):n.reject()};return e.getOneBranchAudioFile=function(e){return t=e,n=new $.Deferred,o=null,EC.db.transaction(r,EC.Select.errorCB,i),n.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a,i,s,l,c=function(e){var r="";r+="SELECT DISTINCT entry_key FROM ec_branch_data WHERE hierarchy_entry_key_value=? AND is_data_synced=? AND form_id IN (SELECT _id from ec_branch_forms WHERE name=? AND project_id=?) LIMIT 1",e.executeSql(r,[o,0,t,n],d,EC.Select.errorCB)},d=function(e,t){var o=t.rows.length;o>0?(a=t.rows.item(0).entry_key,r=[],EC.db.transaction(u,EC.Select.errorCB,p)):EC.Upload.branch_forms.length>0?(EC.Upload.current_branch_form=EC.Upload.branch_forms.shift(),l.getOneBranchEntry(n,EC.Upload.current_branch_form.name,!1)):(EC.Upload.action=EC.Upload.action===EC.Const.BRANCH_RECURSION?EC.Upload.action=EC.Const.STOP_BRANCH_UPLOAD:EC.Const.START_BRANCH_UPLOAD,EC.Upload.renderUploadViewFeedback(!0))},u=function(e){var r="";r+="SELECT _id, hierarchy_entry_key_ref, hierarchy_entry_key_value, ref, value, entry_key, type, created_on FROM ec_branch_data WHERE form_id IN ",r+="(SELECT _id from ec_branch_forms WHERE name=? AND project_id=?) ",r+="AND is_data_synced=? AND hierarchy_entry_key_value=? AND entry_key=?",e.executeSql(r,[t,n,0,o,a],E,EC.Select.errorCB)},E=function(e,t){var n,o,r=t,a=r.rows.length,s={},l=0;for(i={created_on:r.rows.item(0).created_on,entry_key:r.rows.item(0).entry_key,hierarchy_entry_key_ref:r.rows.item(0).hierarchy_entry_key_ref,hierarchy_entry_key_value:r.rows.item(0).hierarchy_entry_key_value,values:[{}]},console.log(r.rows.item(0)),n=0,l=0;a>n;){switch(i.values[l]={},r.rows.item(n).type){case EC.Const.LOCATION:o=r.rows.item(n).value.replace("\n","").replace("\r",""),""===o?(i.values[l].ref=r.rows.item(n).ref+"_lat",i.values[l].value="",i.values[l]._id=r.rows.item(n)._id,i.values[l].type=r.rows.item(n).type,i.values[l+1]={},i.values[l+1].ref=r.rows.item(n).ref+"_lon",i.values[l+1].value="",i.values[l+1]._id="",i.values[l+1].type=r.rows.item(n).type,i.values[l+2]={},i.values[l+2].ref=r.rows.item(n).ref+"_acc",i.values[l+2].value="",i.values[l+2]._id="",i.values[l+2].type=r.rows.item(n).type,i.values[l+3]={},i.values[l+3].ref=r.rows.item(n).ref+"_alt",i.values[l+3].value="",i.values[l+3]._id="",i.values[l+3].type=r.rows.item(n).type,i.values[l+4]={},i.values[l+4].ref=r.rows.item(n).ref+"_bearing",i.values[l+4].value="",i.values[l+4]._id="",i.values[l+4].type=r.rows.item(n).type):(s=EC.Utils.parseLocationString(o),i.values[l].ref=r.rows.item(n).ref+"_lat",i.values[l].value=s.latitude,i.values[l]._id=r.rows.item(n)._id,i.values[l].type=r.rows.item(n).type,i.values[l+1]={},i.values[l+1].ref=r.rows.item(n).ref+"_lon",i.values[l+1].value=s.longitude,i.values[l+1]._id="",i.values[l+1].type=r.rows.item(n).type,i.values[l+2]={},i.values[l+2].ref=r.rows.item(n).ref+"_acc",i.values[l+2].value=s.accuracy,i.values[l+2]._id="",i.values[l+2].type=r.rows.item(n).type,i.values[l+3]={},i.values[l+3].ref=r.rows.item(n).ref+"_alt",i.values[l+3].value=s.altitude,i.values[l+3]._id="",i.values[l+3].type=r.rows.item(n).type,i.values[l+4]={},i.values[l+4].ref=r.rows.item(n).ref+"_bearing",i.values[l+4].value=s.heading,i.values[l+4]._id="",i.values[l+4].type=r.rows.item(n).type),l+=4;break;default:i.values[l].ref=r.rows.item(n).ref,i.values[l].value=r.rows.item(n).value,i.values[l]._id=r.rows.item(n)._id,i.values[l].type=r.rows.item(n).type}l++,n++}},p=function(){switch(console.log("One branch entry"),console.log(i),EC.Upload.action){case EC.Const.START_BRANCH_UPLOAD:i?s.resolve(i):s.reject();break;case EC.Const.BRANCH_RECURSION:i?(EC.Upload.current_branch_entry=i,EC.Upload.prepareOneBranchEntry(EC.Upload.current_branch_form.name,EC.Upload.current_branch_entry)):(EC.Upload.action=EC.Upload.action===EC.Const.BRANCH_RECURSION?EC.Upload.action=EC.Const.STOP_BRANCH_UPLOAD:EC.Const.START_BRANCH_UPLOAD,EC.Upload.renderUploadViewFeedback(!0))}},C=function(){console.log(JSON.stringify(a))},_=function(e){var o="SELECT DISTINCT hierarchy_entry_key_value FROM ec_branch_data WHERE is_data_synced=? AND form_id IN (SELECT _id from ec_branch_forms WHERE name=? AND project_id=?) LIMIT 1";e.executeSql(o,[0,t,n],h,EC.Select.errorCB)},h=function(e,t){t.rows.length>0&&(o=t.rows.item(0).hierarchy_entry_key_value)},f=function(){o?EC.db.transaction(c,EC.Select.errorCB,C):EC.Upload.branch_forms.length>0?(EC.Upload.current_branch_form=EC.Upload.branch_forms.shift(),l.getOneBranchEntry(n,EC.Upload.current_branch_form.name)):(EC.Upload.action===EC.Const.BRANCH_RECURSION&&(EC.Upload.action=EC.Const.STOP_BRANCH_UPLOAD,EC.Upload.renderUploadViewFeedback(!0)),EC.Upload.action===EC.Const.START_BRANCH_UPLOAD&&s.reject())};return e.getOneBranchEntry=function(e,o,r){return l=this,n=e,t=o,i={},r&&(s=new $.Deferred),EC.db.transaction(_,EC.Select.errorCB,f),r?s.promise():void 0},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a=function(e){var n="SELECT _id, value, type FROM ec_branch_data WHERE form_id IN (SELECT _id FROM ec_branch_forms WHERE project_id=? AND has_media=?) AND type=? AND is_data_synced=? AND is_media_synced=? AND value<>? LIMIT 1";e.executeSql(n,[t,1,o,1,0,""],i,EC.Select.errorCB)},i=function(e,t){r=t.rows.item(0)},s=function(){r?n.resolve(r):n.reject()};return e.getOneBranchMediaFile=function(e,r){return t=e,o=r,n=new $.Deferred,EC.db.transaction(a,EC.Select.errorCB,s),n.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a,i=[],s=function(e){var n=(i.length,EC.Const.PHOTO),o=EC.Const.AUDIO,r=EC.Const.VIDEO,a="SELECT _id, value, type FROM ec_data WHERE form_id IN (SELECT _id FROM ec_forms WHERE project_id=? AND has_media=?) AND type=? AND is_data_synced=? AND is_media_synced=? AND value<>? LIMIT 1";e.executeSql(a,[t,1,n,1,0,""],l,EC.Select.errorCB),e.executeSql(a,[t,1,o,1,0,""],c,EC.Select.errorCB),e.executeSql(a,[t,1,r,1,0,""],d,EC.Select.errorCB),EC.Select.query_error_message="EC.SelectgetOneHierarchyMediaPerType() _getOneHierarchyMediaPerTypeTX"},l=function(e,t){t.rows.length>0&&(n=t.rows.item(0))},c=function(e,t){t.rows.length>0&&(o=t.rows.item(0))},d=function(e,t){t.rows.length>0&&(r=t.rows.item(0))},u=function(){a.resolve(n,o,r)};return e.getOneHierarchyMediaPerType=function(e){return t=e,a=new $.Deferred,EC.db.transaction(s,EC.Select.errorCB,u),a.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r=function(e){var n="SELECT * FROM ec_branch_data WHERE form_id IN (SELECT _id FROM ec_branch_forms WHERE project_id=? AND has_media=?) AND type=? AND is_data_synced=? AND is_media_synced=? AND value<>? LIMIT 1";e.executeSql(n,[t,1,EC.Const.PHOTO,1,0,""],a,EC.Select.errorCB)},a=function(e,t){t.rows.length>0&&(o=t.rows.item(0))},i=function(){o?(console.log(o),n.resolve(o)):n.reject()};return e.getOneBranchPhotoFile=function(e){return t=e,o=null,n=new $.Deferred,EC.db.transaction(r,EC.Select.errorCB,i),n.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r=function(e){var n="SELECT _id, value, type FROM ec_branch_data WHERE form_id IN (SELECT _id FROM ec_branch_forms WHERE project_id=? AND has_media=?) AND type=? AND is_data_synced=? AND is_media_synced=? AND value<>? LIMIT 1";e.executeSql(n,[t,1,EC.Const.VIDEO,1,0,""],a,EC.Select.errorCB)},a=function(e,t){t.rows.length>0&&(o=t.rows.item(0))},i=function(){o?n.resolve(o):n.reject()};return e.getOneBranchVideoFile=function(e,a){return t=e,n=new $.Deferred,o=null,EC.db.transaction(r,EC.Select.errorCB,i),n.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a,i,s=function(e){var t,n=e,o=JSON.parse(window.localStorage.forms),r=o.length;for(t=1;r>t;t++)if(o[t].name===n)return o[t-1].key;return!1},l=function(e){var t="SELECT DISTINCT entry_key FROM ec_data WHERE form_id=? AND is_data_synced=? LIMIT 1";e.executeSql(t,[n._id,0],c,EC.Select.errorCB)},c=function(e,n){var o=n.rows.length,s=parseInt(window.localStorage.project_id,10);o>0?(r=n.rows.item(0).entry_key,i=[],EC.db.transaction(d,EC.Select.errorCB,E)):EC.Upload.hierarchy_forms.length>0?(EC.Upload.current_form=EC.Upload.hierarchy_forms.shift(),t.getOneHierarchyEntry(EC.Upload.current_form)):(EC.Upload.has_branches||EC.Upload.action===EC.Const.HIERARCHY_RECURSION&&(EC.Upload.action=EC.Const.STOP_HIERARCHY_UPLOAD,EC.Upload.renderUploadViewFeedback(!0)),EC.Upload.action===EC.Const.START_HIERARCHY_UPLOAD&&a.reject(),EC.Upload.action===EC.Const.HIERARCHY_RECURSION&&(EC.Upload.action=EC.Const.BRANCH_RECURSION,$.when(EC.Select.getBranchForms(s)).then(function(e){EC.Upload.branch_forms=e,EC.Upload.current_branch_form=EC.Upload.branch_forms.shift(),EC.Select.getOneBranchEntry(s,EC.Upload.current_branch_form.name,!1)})))},d=function(e){var t="SELECT _id, entry_key, parent, value, type, ref, created_on FROM ec_data WHERE entry_key=? AND form_id=? AND is_data_synced=?";e.executeSql(t,[r,n._id,0],u,EC.Select.errorCB),EC.Select.query_error_message="EC.Select.getOneHierarchyEntry _getOneHierarchyEntryTX"},u=function(e,t){var r,a,i,l,c=t,d=c.rows.length,u={},E=0;for(o={created_on:c.rows.item(0).created_on,entry_key:c.rows.item(0).entry_key,values:[{}]},i=s(n.name),i&&(o.parent_ref=i,l=c.rows.item(0).parent.split(EC.Const.ENTRY_ROOT_PATH_SEPARATOR),o.parent_key_value=l[l.length-1]),r=0,E=0;d>r;){switch(o.values[E]={},c.rows.item(r).type){case EC.Const.LOCATION:a=c.rows.item(r).value.replace("\n","").replace("\r",""),""===a?(o.values[E].ref=c.rows.item(r).ref+"_lat",o.values[E].value="",o.values[E]._id=c.rows.item(r)._id,o.values[E].type=c.rows.item(r).type,o.values[E+1]={},o.values[E+1].ref=c.rows.item(r).ref+"_lon",o.values[E+1].value="",o.values[E+1]._id="",o.values[E+1].type=c.rows.item(r).type,o.values[E+2]={},o.values[E+2].ref=c.rows.item(r).ref+"_acc",o.values[E+2].value="",o.values[E+2]._id="",o.values[E+2].type=c.rows.item(r).type,o.values[E+3]={},o.values[E+3].ref=c.rows.item(r).ref+"_alt",o.values[E+3].value="",o.values[E+3]._id="",o.values[E+3].type=c.rows.item(r).type,o.values[E+4]={},o.values[E+4].ref=c.rows.item(r).ref+"_bearing",o.values[E+4].value="",o.values[E+4]._id="",o.values[E+4].type=c.rows.item(r).type):(u=EC.Utils.parseLocationString(a),o.values[E].ref=c.rows.item(r).ref+"_lat",o.values[E].value=u.latitude,o.values[E]._id=c.rows.item(r)._id,o.values[E].type=c.rows.item(r).type,o.values[E+1]={},o.values[E+1].ref=c.rows.item(r).ref+"_lon",o.values[E+1].value=u.longitude,o.values[E+1]._id="",o.values[E+1].type=c.rows.item(r).type,o.values[E+2]={},o.values[E+2].ref=c.rows.item(r).ref+"_acc",o.values[E+2].value=u.accuracy,o.values[E+2]._id="",o.values[E+2].type=c.rows.item(r).type,o.values[E+3]={},o.values[E+3].ref=c.rows.item(r).ref+"_alt",o.values[E+3].value=u.altitude,o.values[E+3]._id="",o.values[E+3].type=c.rows.item(r).type,o.values[E+4]={},o.values[E+4].ref=c.rows.item(r).ref+"_bearing",o.values[E+4].value=u.heading,o.values[E+4]._id="",o.values[E+4].type=c.rows.item(r).type),E+=4;break;default:o.values[E].ref=c.rows.item(r).ref,o.values[E].value=c.rows.item(r).value===EC.Const.SKIPPED?"":c.rows.item(r).value,o.values[E]._id=c.rows.item(r)._id,o.values[E].type=c.rows.item(r).type}E++,r++}},E=function(){switch(console.log("One entry"),console.log(o),EC.Upload.action){case EC.Const.START_HIERARCHY_UPLOAD:o?a.resolve(o):a.reject();break;case EC.Const.HIERARCHY_RECURSION:o?(EC.Upload.current_entry=o,EC.Upload.prepareOneHierarchyEntry(EC.Upload.current_form.name,EC.Upload.current_entry)):console.log("no entry to upload")}},p=function(){};return e.getOneHierarchyEntry=function(e,r){return t=this,n=e,o={},r&&(a=new $.Deferred),EC.db.transaction(l,EC.Select.errorCB,p),r?a.promise():void 0},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a=function(e){var n="SELECT _id, value, type FROM ec_data WHERE form_id IN (SELECT _id FROM ec_forms WHERE project_id=? AND has_media=?) AND type=? AND is_data_synced=? AND is_media_synced=? AND value<>? LIMIT 1";e.executeSql(n,[t,1,o,1,0,""],i,EC.Select.errorCB)},i=function(e,t){r=t.rows.item(0)},s=function(){r?n.resolve(r):(console.log("reject video upload"),n.reject())};return e.getOneHierarchyMediaFile=function(e,r){return t=e,o=r,n=new $.Deferred,EC.db.transaction(a,EC.Select.errorCB,s),n.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r,a,i=[],s=function(e){var n=(i.length,"SELECT _id, value, type FROM ec_data WHERE form_id IN (SELECT _id FROM ec_forms WHERE project_id=? AND has_media=?) AND type=? AND is_data_synced=? AND is_media_synced=? AND value<>? LIMIT 1");e.executeSql(n,[t,1,EC.Const.PHOTO,1,0,""],l,EC.Select.errorCB),e.executeSql(n,[t,1,EC.Const.AUDIO,1,0,""],c,EC.Select.errorCB),e.executeSql(n,[t,1,EC.Const.VIDEO,1,0,""],d,EC.Select.errorCB),EC.Select.query_error_message="EC.SelectgetOneHierarchyMediaPerType() _getOneHierarchyMediaPerTypeTX"},l=function(e,t){t.rows.length>0&&(n=t.rows.item(0))},c=function(e,t){t.rows.length>0&&(o=t.rows.item(0))},d=function(e,t){t.rows.length>0&&(r=t.rows.item(0))},u=function(){a.resolve(n,o,r)};return e.getOneHierarchyMediaPerType=function(e){return t=e,n=null,o=null,r=null,a=new $.Deferred,EC.db.transaction(s,EC.Select.errorCB,u),a.promise()},e}(EC.Select);var EC=EC||{};EC.Select=EC.Select||{},EC.Select=function(e){"use strict";var t,n,o,r=function(e){var n="SELECT uploadToServer FROM ec_projects WHERE _id=?";e.executeSql(n,[t],a,EC.Select.errorCB)},a=function(e,t){var n=t;o=n.rows.item(0).uploadToServer},i=function(){EC.Upload.setUploadURL(o),n.resolve(o)};return e.getUploadURL=function(e){return t=e,n=new $.Deferred,EC.db.transaction(r,EC.Select.errorCB,i),n.promise()},e}(EC.Select);var EC=EC||{};EC.Update=EC.Update||{},EC.Update=function(e){"use strict";var t,n,o=function(e){var n,o,a,s=t.length;for(n=0;s>n;n++)o="",a=t[n],"[object Array]"===Object.prototype.toString.call(a.value)&&(a.value=a.value.join(", ")),o="UPDATE ec_branch_data SET value=? WHERE _id=?",e.executeSql(o,[a.value,a._id],r,i)},r=function(e,t){},a=function(){n.resolve()},i=function(e,t){console.log(t),console.log("Error updating branch data"),n.reject()};return e.commitBranchForm=function(e){return t=e,n=new $.Deferred,EC.db.transaction(o,i,a),n.promise()},e}(EC.Update);var EC=EC||{};EC.Update=EC.Update||{},EC.Update=function(e){"use strict";var t,n,o,r=[],a=[],i=function(e,t,n){var o,r=e,a=t,i=n,s=i.length;for(o=0;s>o;o++)if(a[o].form_id===r)return a[o].total_deleted/i[o].total_inputs},s=function(){o.resolve()},l=function(e){var n,o,s=t.length,l="";for(n=0;s>n;n++)o=i(t[n]._id,r,t),a.push(o),l="UPDATE ec_forms SET entries = entries - "+o+" WHERE _id=?",e.executeSql(l,[t[n]._id],c,EC.Update.errorCB);window.localStorage.deleted_entries=JSON.stringify(a)},c=function(e,t){console.log(t)};return e.countSyncedDeleted=function(e,i){return n=this,r=e,t=i,a.length=0,o=new $.Deferred,EC.db.transaction(l,EC.Update.errorCB,s),o.promise()},e}(EC.Update);var EC=EC||{};EC.Update=EC.Update||{},EC.Update=function(e){"use strict";var t,n,o,r,a=function(e){var r,a=t.length,l="UPDATE ec_data SET value=? WHERE form_id=? AND (type=? OR type=? OR type=?)",d="";

for(r=0;a>r;r++)e.executeSql(l,["",t[r]._id,EC.Const.PHOTO,EC.Const.AUDIO,EC.Const.VIDEO],i,c);o&&(d="UPDATE ec_branch_data SET value=? WHERE form_id IN (SELECT form_id FROM ec_branch_data JOIN ec_branch_forms WHERE ec_branch_data.form_id = ec_branch_forms._id AND ec_branch_forms.project_id=?) AND (type=? OR type=? OR type=?)",e.executeSql(d,["",n,EC.Const.PHOTO,EC.Const.AUDIO,EC.Const.VIDEO],s,c))},i=function(e,t){console.log(t)},s=function(e,t){console.log(t)},l=function(){r.resolve()},c=function(e,t){console.log(EC.Const.TRANSACTION_ERROR),console.log(e,t),r.reject()};return e.emptyMediaValues=function(e,i){return t=e,n=i,o=EC.Utils.projectHasBranches(),r=new $.Deferred,EC.db.transaction(a,c,l),r.promise()},e}(EC.Update);var EC=EC||{};EC.Update=EC.Update||{},EC.Update=function(e){"use strict";var t,n,o,r=function(e){var o=n?"ec_branch_data":"ec_data",r="UPDATE "+o+" SET is_media_synced=? WHERE _id=?";e.executeSql(r,[1,t],null,EC.Update.errorCB)},a=function(){o.resolve()};return e.flagOneFileAsSynced=function(e,i){return t=e,n=i,o=new $.Deferred,EC.db.transaction(r,EC.Update.errorCB,a),o.promise()},e}(EC.Update);var EC=EC||{};EC.Update=EC.Update||{},EC.Update=function(e){"use strict";return e.errorCB=function(e){console.log(EC.Const.TRANSACTION_ERROR),console.log("%c"+e.message,"color: red")},e}(EC.Update);var EC=EC||{};EC.Update=EC.Update||{},EC.Update=function(e){"use strict";var t,n,o,r=function(e){var n,r,a=t.length;for(n=0;a>n;n++)r="UPDATE ec_branch_data SET is_data_synced=? WHERE _id=?",e.executeSql(r,[1,t[n]._id],null,o.errorCB)},a=function(){n.resolve()};return e.setBranchEntryAsSynced=function(e){return o=this,t=e,n=new $.Deferred,EC.db.transaction(r,o.errorCB,a),n.promise()},e}(EC.Update);var EC=EC||{};EC.Update=EC.Update||{},EC.Update=function(e){var t,n,o,r=[],a=function(e){var o,a,i,c,d,u;for(i=r.length,o=0;i>o;o++)for(u=r[o].branch_form_name,c=r[o].primary_keys.length,a=0;c>a;a++)d="UPDATE ec_branch_data SET is_stored=? WHERE form_id IN (SELECT _id from ec_branch_forms WHERE name=? AND project_id=?) AND hierarchy_entry_key_value=? AND entry_key=?",e.executeSql(d,[1,u,n,t,r[o].primary_keys[a]],s,l)},i=function(){console.log("UPDATE BRANCH STORED FLAG  SUCCESS"),o.resolve(t)},s=function(){console.log("UPDATE BRANCH STORED FLAG SQL SUCCESS")},l=function(e,t){console.log(t),o.reject()};return e.setCachedBranchesAsStored=function(e,s,c){return r=e,t=s,n=c,o=$.Deferred(),EC.db.transaction(a,l,i),o.promise()},e}(EC.Update);var EC=EC||{};EC.Update=EC.Update||{},EC.Update=function(e){"use strict";var t,n,o,r=function(e){var n,r,a=t.length;for(n=0;a>n;n++)r="UPDATE ec_data SET is_data_synced=? WHERE _id=?",e.executeSql(r,[1,t[n]._id],null,o.errorCB)},a=function(){n.resolve()};return e.setHierarchyEntryAsSynced=function(e){return o=this,t=e,n=new $.Deferred,EC.db.transaction(r,o.errorCB,a),n.promise()},e}(EC.Update);var EC=EC||{};EC.Update=EC.Update||{},EC.Update=function(e){"use strict";var t,n,o,r=[],a=function(e){var t,a,l=r.length,d="UPDATE ec_data SET is_data_synced=? WHERE form_id=?";for(t=0;l>t;t++)e.executeSql(d,[0,r[t]._id],i,c);if(n){var a="UPDATE ec_branch_data SET is_data_synced=? WHERE form_id IN (SELECT form_id FROM ec_branch_data JOIN ec_branch_forms WHERE ec_branch_data.form_id = ec_branch_forms._id AND ec_branch_forms.project_id=?)";e.executeSql(a,[0,o],s,c)}},i=function(e,t){console.log("Hierarchy entries "),console.log(t)},s=function(e,t){console.log("Branch entries "),console.log(t)},l=function(){t.resolve()},c=function(e,n){console.log(n),t.reject()};return e.unsyncAllEntries=function(e,i){return r=e,o=i,n=EC.Utils.projectHasBranches(),t=new $.Deferred,EC.db.transaction(a,c,l),t.promise()},e}(EC.Update);var EC=EC||{};EC.Update=EC.Update||{},EC.Update=function(e){"use strict";var t,n,o,r,a,i,s,l=function(e){var n,a="UPDATE ec_data SET is_data_synced=? WHERE _id=?",i=t.length;for(n=0;i>n;n++)o&&t[n].type===EC.Const.BRANCH&&r.push(t[n].value.branch_form_name),e.executeSql(a,[0,t[n]._id],c,C)},c=function(e,t){console.log(t,!1)},d=function(){t.length=0,o&&r.length>0?EC.db.transaction(u,C,p):s.resolve()},u=function(e){var t,n="UPDATE ec_branch_data SET is_data_synced=? WHERE form_id IN (SELECT _id FROM ec_branch_forms WHERE name=? AND project_id=?) AND hierarchy_entry_key_value=?",o=r.length;for(t=0;o>t;t++)e.executeSql(n,[0,r[t],a,i],E,C)},E=function(e,t){},p=function(){s.resolve()},C=function(){s.reject()};return e.unsyncOneHierarchyEntry=function(e,c,u){return n=this,o=EC.Utils.projectHasBranches(),t=e,i=c,a=u,r=[],s=new $.Deferred,EC.db.transaction(l,C,d),s.promise()},e}(EC.Update);var EC=EC||{};EC.Update=EC.Update||{},EC.Update=function(e){"use strict";var t,n,o;e.updateCountersOnEntriesDownload=function(e){return t=this,o=new $.Deferred,n=e,EC.db.transaction(r,t.errorCB,a),o.promise()};var r=function(e){var o="UPDATE ec_forms SET entries = entries + 1 WHERE _id=?";e.executeSql(o,[n],null,t.errorCB)},a=function(){o.resolve()};return e}(EC.Update);var EC=EC||{};EC.Update=EC.Update||{},EC.Update=function(e){"use strict";var t,n,o,r,a,i,s,l=[];e.updateCountersOnEntriesRestore=function(e,u,E){return t=this,a=new $.Deferred,n=e,o=u,r=E,i=JSON.parse(window.localStorage.forms),s=i.shift(),l.push({_id:n,entries:o,has_media:s.has_media,num:s.num,total_inputs:s.total_inputs,name:s.name,is_active:s.is_active,key:s.key}),window.localStorage.forms=JSON.stringify(i),EC.db.transaction(c,EC.Update.errorCB,d),a.promise()};var c=function(e){var t="UPDATE ec_forms SET entries = entries + "+o+" WHERE _id=?";e.executeSql(t,[n],null,EC.Update.errorCB)},d=function(){r.length>0?a.reject(r):(window.localStorage.forms=JSON.stringify(l),l.length=0,o=0,a.resolve())};return e}(EC.Update);var EC=EC||{};EC.Update=EC.Update||{},EC.Update=function(e){"use strict";var t,n,o,r,a=function(e){var o="UPDATE ec_branch_forms SET entries = entries + 1 WHERE _id=?";e.executeSql(o,[n],null,t.errorCB)},i=function(){r.resolve(!0,o)};return e.updateCountersOnSingleBranchEntryInsertion=function(e,s){return t=this,o=e,n=s,r=new $.Deferred,EC.db.transaction(a,t.errorCB,i),r.promise()},e}(EC.Update);var EC=EC||{};EC.Update=EC.Update||{},EC.Update=function(e){"use strict";function t(){a=-o.amount,console.log("localstorage forms maybe need to be updated here"),EC.db.transaction(l,n.errorCB,s)}var n,o,r,a,i,s=function(){r.length>0?(o=r.shift(),t()):i.resolve()},l=function(e){var t="UPDATE ec_forms SET entries = entries + "+a+" WHERE _id=?";e.executeSql(t,[o.form_id],null,n.errorCB)};return e.updateCountersOnSingleEntryDeletion=function(e){return n=this,i=new $.Deferred,r=e,o=r.shift(),a=0,t(),i.promise()},e}(EC.Update);var EC=EC||{};EC.Update=EC.Update||{},EC.Update=function(e){"use strict";var t,n,o,r;e.updateCountersOnSingleEntryInsertion=function(e,s){return t=this,r=new $.Deferred,o=e,n=s,EC.Utils.updateFormsObj(n),EC.db.transaction(a,t.errorCB,i),r.promise()};var a=function(e){var o="UPDATE ec_forms SET entries = entries + 1 WHERE _id=?";e.executeSql(o,[n],null,t.errorCB)},i=function(){var e,t,n,a,i;try{for(t=JSON.parse(window.localStorage.cached_branch_entry_keys),i=t.length,n=!1,a=0;i>a;a++)if(t[a].primary_keys.length>0){n=!0;break}n?(e=window.localStorage.project_id,$.when(EC.Update.setCachedBranchesAsStored(t,o,e)).then(function(e){r.resolve(e)})):r.resolve(o)}catch(s){r.resolve(o)}};return e}(EC.Update);var EC=EC||{};EC.Update=EC.Update||{},EC.Update=function(e){"use strict";var t,n,o,r,a=function(){n.resolve()},i=function(e){var n,a,i=o.length;for(n=0;i>n;n++)a="UPDATE ec_forms SET entries = entries - "+o[n].amount+" WHERE _id=?",r.push(o[n].amount),e.executeSql(a,[o[n].form_id],null,t.errorCB);window.localStorage.deleted_entries=JSON.stringify(r)};return e.updateCountersOnSyncedEntriesDeletion=function(e){return t=this,o=e,r=[],n=new $.Deferred,EC.db.transaction(i,t.errorCB,a),n.promise()},e}(EC.Update);var EC=EC||{};EC.Update=EC.Update||{},EC.Update=function(e){"use strict";var t,n,o,r,a=function(){console.log("FORM VALUE EDITED SQL QUERY SUCCESS")},i=function(e){var t,o,r=n.length,i="UPDATE ec_data SET value=? WHERE _id=?";for(t=0;r>t;t++)o=n[t],"[object Array]"===Object.prototype.toString.call(o.value)&&(o.value=o.value.join(", ")),e.executeSql(i,[o.value,o._id],a,l)},s=function(){console.log("FORM VALUES UPDATED SUCCESSFULLY"),r.resolve()},l=function(e,t){console.log(t),r.reject()};return e.updateHierarchyEntryValues=function(e){return t=this,r=new $.Deferred,n=e,o=n[0].form_id,EC.db.transaction(i,l,s),r.promise()},e}(EC.Update);var EC=EC||{};EC.Create=EC.Create||{},EC.Create=function(e){"use strict";function t(e){var t=e,n="N/A"===t.latitude?"":t.latitude,o="N/A"===t.longitude?"":t.longitude,r="N/A"===t.altitude?"":t.altitude,a="N/A"===t.accuracy?"":t.accuracy,i="N/A"===t.bearing?"":t.bearing;return"Latitude: "+n+",\nLongitude: "+o+",\nAltitude: "+r+",\nAccuracy: "+a+",\nAltitude Accuracy:  ,\nHeading: "+i+"\n"}function n(e,n,o,r,a,s){var l,c,d,u,C,_,h,f=e.length,v=n,m=o,g=r,w=a,y=s;for(l=0;f>l;l++)d=E[l].ref,g.hasOwnProperty(d)?"string"==typeof g[d]?_=g[d]:(C=g[d],h=t(C)):_="",c="",u=E[l],c+="INSERT INTO ec_data (",c+="input_id, ",c+="form_id, ",c+="position, ",c+="parent, ",c+="label, ",c+="ref, ",c+="value, ",c+="is_title, ",c+="entry_key, ",c+="type, ",c+="created_on, ",c+="is_remote, ",c+="is_data_synced, ",c+="is_media_synced) ",c+='VALUES ("',c+=u._id+'", "',c+=i+'", "',c+=u.position+'", "',c+=m+'", "',c+=u.label+'", "',c+=d+'", "',c+=_+'", "',c+=u.is_title+'", "',c+=w+'", "',c+=u.type+'", "',c+=y+'", "',c+='1", "',c+='1", "',c+='1");',v.executeSql(c,[],S,p)}var o,r,a,i,s,l,c,d,u=[],E=[],p=function(e,t){console.log(e),console.log(t)},C=function(e){var t="SELECT DISTINCT entry_key FROM ec_data WHERE form_id=?",n="SELECT * FROM ec_inputs WHERE form_id=? ORDER BY position";e.executeSql(t,[i],h,l.errorCB),e.executeSql(n,[i],_,l.errorCB)},_=function(e,t){var n,o=t.rows.length;for(n=0;o>n;n++)E.push(t.rows.item(n));window.localStorage.dre_inputs=JSON.stringify(E)},h=function(e,t){var n,o=t.rows.length;for(n=0;o>n;n++)u.push(t.rows.item(n).entry_key);window.localStorage.dre_local_entries_keys=JSON.stringify(u)},f=function(e){var t=o,r=t[s],a=t.created;n(E,e,d,t,r,a)},v=function(e){var t=o,r=t[s],a=t.created;n(E,e,d,t,r,a)},m=function(e){var n,r,a,c,d,u,p,C=o,_=C[s],h=(C.created,E.length);for(a=0;h>a;a++)n=E[a].ref,r=E[a]._id,C.hasOwnProperty(n)?"string"==typeof C[n]?d=C[n]:(c=C[n],u=t(c)):d="",p="UPDATE ec_data SET value=?, is_remote=? WHERE form_id=? AND input_id=? AND entry_key=?",e.executeSql(p,[d,1,i,r,_],g,l.errorCB)},g=function(e,t){},w=function(e){c.resolve()},y=function(){var e,t,n=o,r=n[s],a=(n.created,JSON.parse(window.localStorage.form_tree)),l=a.pname;EC.Utils.inArray(u,r)?(console.log("***********************************************************  update "+r),EC.db.transaction(m,p,w)):(console.log("***********************************************************  insert "+r),""===l?(d="",EC.db.transaction(f,p,I)):(t=EC.Utils.getFormParentPrimaryKeyRef(i),d=n[t],e=EC.Utils.getParentFormByChildID(i),$.when(EC.Select.getFullParentPath(e._id,d)).then(function(e){""!==e&&(d=e+"|"+d),EC.db.transaction(v,p,b)},function(){c.reject()})))},S=function(e,t){console.log("INSERT REMOTE ENTRY SUCCESS"),console.log(JSON.stringify(t))},I=function(e,t){$.when(EC.Update.updateCountersOnEntriesDownload(i)).then(function(){c.resolve()})},b=function(e,t){$.when(EC.Update.updateCountersOnEntriesDownload(i)).then(function(){c.resolve()})};return e.commitRemoteEntry=function(e,t,n){return a=e,i=t,o=n,l=this,c=new $.Deferred,s=EC.Utils.getFormPrimaryKeyRef(i),u.length=0,r=0,E.length=0,window.localStorage.dre_local_entries_keys||window.localStorage.dre_inputs?(u=JSON.parse(window.localStorage.dre_local_entries_keys),E=JSON.parse(window.localStorage.dre_inputs),y()):EC.db.transaction(C,p,y),c.promise()},e}(EC.Create);var EC=EC||{};EC.Create=EC.Create||{},EC.Create=function(e){"use strict";var t,n,o,r,a=function(e){var t,n;for(t=0;t<o.length;t++)if(o[t].name===e){n=o[t]._id;break}return n},i=function(e){var t,n;for(t=0;t<r.length;t++)if(r[t].ref===e){n=r[t]._id;break}return n},s=function(e){var n,o,r,s=t.length,c="",u={};for(n=0;s>n;n++)c="",u=t[n],o=a(u.name),r=i(u.ref),c+="INSERT INTO ec_branch_data (",c+="input_id, ",c+="form_id, ",c+="hierarchy_entry_key_ref, ",c+="hierarchy_entry_key_value, ",c+="position, ",c+="label, ",c+="ref, ",c+="value, ",c+="is_title, ",c+="entry_key, ",c+="type, ",c+="is_data_synced, ",c+="is_media_synced, ",c+="is_cached, ",c+="is_stored, ",c+="created_on, ",c+="is_remote) ",c+='VALUES ("',c+=r+'", "',c+=o+'", "',c+=u.hierarchy_entry_key_ref+'", "',c+=u.hierarchy_entry_key_value+'", "',c+=u.position+'", "',c+=u.label+'", "',c+=u.ref+'", "',c+=u.value+'", "',c+=u.is_title+'", "',c+=u.entry_key+'", "',c+=u.type+'", "',c+=u.is_data_synced+'", "',c+=u.is_media_synced+'", "',c+=u.is_cached+'", "',c+=u.is_stored+'", "',c+=u.created_on+'", "',c+=u.remote_flag+'");',e.executeSql(c,[],l,d)},l=function(e,t){console.log(t)},c=function(){n.resolve()},d=function(e,t){console.log(t)};return e.insertBranchDataRows=function(e,a,i){return t=e.branch_data_rows,o=a,r=i,n=new $.Deferred,EC.db.transaction(s,d,c),n.promise()},e}(EC.Create);var EC=EC||{};EC.Create=EC.Create||{},EC.Create=function(e){"use strict";var t,n,o=[],r=function(e,t){console.log(EC.Utils.TRANSACTION_ERROR),console.log(t)},a=function(e){var t,n=o.length,a=0,i=1,l=0;for(t=0;n>t;t++){var c="",d=o[t];c+="INSERT INTO ec_branch_data (",c+="input_id, ",c+="form_id, ",c+="hierarchy_entry_key_ref, ",c+="hierarchy_entry_key_value, ",c+="position, ",c+="label, ",c+="ref, ",c+="value, ",c+="is_title, ",c+="entry_key, ",c+="type, ",c+="is_data_synced, ",c+="is_media_synced, ",c+="is_cached, ",c+="is_stored, ",c+="created_on, ",c+="is_remote) ",c+='VALUES ("',c+=d.input_id+'", "',c+=d.form_id+'", "',c+=d.hierarchy_entry_key_ref+'", "',c+=d.hierarchy_entry_key_value+'", "',c+=d.position+'", "',c+=d.label+'", "',c+=d.ref+'", "',c+=d.value+'", "',c+=d.is_title+'", "',c+=d.entry_key+'", "',c+=d.type+'", "',c+=d.is_data_synced+'", "',c+=d.is_media_synced+'", "',c+=i+'", "',c+=l+'", "',c+=d.created_on+'", "',c+=a+'");',e.executeSql(c,[],s,r)}},i=function(){var e=o[0].form_id;$.when(EC.Update.updateCountersOnSingleBranchEntryInsertion(t,e)).then(function(){n.resolve(t)},function(){n.reject()})},s=function(){};return e.insertBranchFormValues=function(e,s){return o=e,t=s,n=new $.Deferred,EC.db.transaction(a,r,i),n.promise()},e}(EC.Create);var EC=EC||{};EC.Create=EC.Create||{},EC.Create=function(e){"use strict";var t,n,o,r=function(e){var n,o,r,a=t.length,l=0;for(n=0;a>n;n++)o="",r=t[n],o+="INSERT INTO ec_data (",o+="input_id, ",o+="form_id, ",o+="position, ",o+="parent, ",o+="label, ",o+="ref, ",o+="value, ",o+="is_title, ",o+="entry_key, ",o+="type, ",o+="created_on, ",o+="is_data_synced, ",o+="is_remote, ",o+="is_media_synced) ",o+='VALUES ("',o+=r.input_id+'", "',o+=r.form_id+'", "',o+=r.position+'", "',o+=r.parent+'", "',o+=r.label+'", "',o+=r.ref+'", "',o+=r.value+'", "',o+=r.is_title+'", "',o+=r.entry_key+'", "',o+=r.type+'", "',o+=r.created_on+'", "',o+=r.is_data_synced+'", "',o+=l+'", "',o+=r.is_media_synced+'");',e.executeSql(o,[],i,s)},a=function(){var e=t[0].form_id;console.log("FORM VALUES SAVED SUCCESSFULLY"),$.when(EC.Update.updateCountersOnSingleEntryInsertion(n,e)).then(function(e){o.resolve(e)},function(){o.reject()})},i=function(){console.log("FORM VALUE SQL QUERY SUCCESS")},s=function(e,t){console.log(t),o.reject()};return e.insertFormValues=function(e,i){return t=e,n=i,o=new $.Deferred,EC.db.transaction(r,s,a),o.promise()},e}(EC.Create);var EC=EC||{};EC.Create=EC.Create||{},EC.Create=function(e){"use strict";var t,n,o,r,a,i,s=[],l=[];e.errorCB=function(e,t){console.log(EC.Utils.TRANSACTION_ERROR),console.log(t),console.log(e)};var c=function(e,o){t=e,n=o,EC.db.transaction(d,EC.Create.errorCB,E)};e.insertAllFormsData=function(e){return a=this,s=e,i=new $.Deferred,a.insertEntries(s.shift()),i.promise()},e.insertEntries=function(e){var t,n,a,i=[];for(e.hasOwnProperty("form_name")?(o=EC.Utils.getLocalFormID(e.form_name),r=e.total_entries,l=e.data_rows):l=e,a=l[0].entry_key,n=l.length,t=0;n>t&&l[t].entry_key===a;t++)i.push(l[t]);l.splice(0,i.length),c(i,a)};var d=function(e){var n,r,a,i,s=t.length;for(n=0;s>n;n++)r="",a=t[n],i=EC.Utils.getLocalInputID(a.ref),r+="INSERT INTO ec_data (",r+="input_id, ",r+="form_id, ",r+="position, ",r+="parent, ",r+="label, ",r+="ref, ",r+="value, ",r+="is_title, ",r+="entry_key, ",r+="type, ",r+="created_on, ",r+="is_data_synced, ",r+="is_media_synced) ",r+='VALUES ("',r+=i+'", "',r+=o+'", "',r+=a.position+'", "',r+=a.parent+'", "',r+=a.label+'", "',r+=a.ref+'", "',r+=a.value+'", "',r+=a.is_title+'", "',r+=a.entry_key+'", "',r+=a.type+'", "',r+=a.created_on+'", "',r+=a.is_data_synced+'", "',r+=a.is_media_synced+'");',e.executeSql(r,[],u,EC.Create.errorCB)},u=function(){console.log("SINGLE ENTRY VALUE SQL INSERT SUCCESS")},E=function(){console.log("SINGLE ENTRY VALUES SAVED SUCCESSFULLY"),l.length>0?a.insertEntries(l):$.when(EC.Update.updateCountersOnEntriesRestore(o,r,s)).then(function(){i.resolve()},function(e){a.insertEntries(e.shift())})};return e}(EC.Create);var EC=EC||{};EC.Delete=EC.Delete||{},EC.Delete=function(e){"use strict";var t,n,o,r,a=[],i="",s=function(e){var t,o,i=a.length,s="DELETE FROM ec_data WHERE form_id=?",l="UPDATE ec_forms SET entries=? WHERE _id=?";for(t=0;i>t;t++)e.executeSql(s,[a[t]._id],d,c),e.executeSql(l,[0,a[t]._id]);n&&(o="DELETE FROM ec_branch_data WHERE form_id IN (SELECT _id FROM ec_branch_forms WHERE project_id=?)",e.executeSql(o,[r],d,c))},l=function(){var e,n,r=JSON.parse(window.localStorage.forms);switch(i){case EC.Const.RESTORE:$.when(EC.File.deleteAllMedia(t,!1,[EC.Const.PHOTO_DIR,EC.Const.AUDIO_DIR,EC.Const.VIDEO_DIR])).then(function(){o.resolve(r)});break;case EC.Const.DELETE:for(n=r.length,e=0;n>e;e++)r[e].entries=0;window.localStorage.forms=JSON.stringify(r),$.when(EC.File.deleteAllMedia(t,!1,[EC.Const.PHOTO_DIR,EC.Const.AUDIO_DIR,EC.Const.VIDEO_DIR])).then(function(){o.resolve()})}},c=function(e,t){console.log(t),o.reject()},d=function(e,t){console.log(t)};return e.deleteAllEntries=function(e,d){return a=JSON.parse(window.localStorage.forms),r=parseInt(window.localStorage.project_id,10),i=e,t=d,n=EC.Utils.projectHasBranches(),o=new $.Deferred,EC.db.transaction(s,c,l),o.promise()},e}(EC.Delete);var EC=EC||{};EC.Delete=EC.Delete||{},EC.Delete=function(e){"use strict";function t(){$.when(EC.Delete.removeSyncedHierarchyEntries(l._id)).then(function(){s.length>0?o(s.shift()):$.when(EC.Update.updateCountersOnSyncedEntriesDeletion(r.deletion_counters)).then(function(){r.deletion_files.length>0?$.when(EC.File.remove(a,r.deletion_files)).then(function(){c.resolve()}):c.resolve()})})}function n(e){var t=new $.Deferred,n=e;return $.when(EC.Select.getBranchSyncedFiles(n)).then(function(e){r.deletion_files=r.deletion_files.concat(e),$.when(EC.Delete.removeSyncedBranchEntries(n)).then(function(){t.resolve()})}),t.promise()}function o(e){l=e,$.when(EC.Select.getSyncedEntryKeys(l._id)).then(function(e){r.deletion_synced_entry_keys=e,r.deletion_counters.push({form_id:l._id,amount:e.length}),1===l.has_media?$.when(EC.Select.getHierarchySyncedFiles(l._id)).then(function(e){r.deletion_files=r.deletion_files.concat(e),1===l.has_branches?$.when(n(r.deletion_synced_entry_keys)).then(function(){t()}):t()}):1===l.has_branches?$.when(n(r.deletion_synced_entry_keys)).then(function(){t()}):t()})}var r,a,i,s,l,c;return e.deleteAllSynced=function(e,t,n){return r=this,c=new $.Deferred,a=t,i=e,s=n,r.deletion_synced_entry_keys=[],r.deletion_files=[],r.deletion_counters=[],o(s.shift()),c.promise()},e}(EC.Delete);var EC=EC||{};EC.Delete=EC.Delete||{},EC.Delete=function(e){"use strict";var t,n,o,r,a=function(e){var o,a="DELETE FROM ec_branch_data WHERE _id=?",i=n.length;for(o=0;i>o;o++)-1!==r.indexOf(n[o].type)&&""!==n[o].value.stored&&t.deletion_files.push({value:n[o].value.stored,type:n[o].type}),e.executeSql(a,[n[o]._id],null,s)},i=function(){t.deletion_files.length>0?$.when(EC.File.remove(window.localStorage.project_name,t.deletion_files)).then(function(){o.resolve(!0)}):o.resolve()},s=function(){o.reject()};return e.deleteBranchEntry=function(e){return t=this,n=e,o=new $.Deferred,r=[EC.Const.AUDIO,EC.Const.PHOTO,EC.Const.VIDEO],t.deletion_files=[],EC.db.transaction(a,s,i),o.promise()},e}(EC.Delete);var EC=EC||{};EC.Delete=EC.Delete||{},EC.Delete=function(e){"use strict";var t=function(e){var t="DELETE FROM ec_branch_data WHERE is_cached=? AND is_stored=?";e.executeSql(t,[1,0],o,EC.Delete.errorCB)},n=function(){console.log("Cached branch entries deleted"),EC.Routing.changePage(EC.Const.INDEX_VIEW)},o=function(e,t){console.log(t)};return e.deleteCachedBranchEntries=function(){EC.db.transaction(t,EC.Delete.errorCB,n)},e}(EC.Delete);var EC=EC||{};EC.Delete=EC.Delete||{},EC.Delete=function(e){"use strict";function t(){$.when(EC.Delete.removeHierarchyChildrenEntries()).then(function(){EC.Delete.children_forms.length>0?(l=EC.Delete.children_forms.shift(),n()):a.resolve()})}function n(){$.when(EC.Select.getChildEntriesForDeletion()).then(function(e,n){r.deletion_entries=e,r.deletion_counters.push(n),1===l.has_media?$.when(EC.Select.getHierarchyChildrenFiles(l)).then(function(e){r.deletion_files=r.deletion_files.concat(e),1===l.has_branches?$.when(o()).then(function(){t()}):t()}):1===l.has_branches?$.when(o()).then(function(){t()}):t()})}function o(){var e=new $.Deferred;return $.when(EC.Select.getBranchChildrenFiles()).then(function(t){r.deletion_files=r.deletion_files.concat(t),$.when(EC.Delete.removeLinkedBranchChildEntries()).then(function(){e.resolve()})}),e.promise()}var r,a,i,s,l;return e.deleteChildEntries=function(){return r=this,a=new $.Deferred,l=EC.Delete.children_forms.shift(),i=[],s=[],n(),a.promise()},e}(EC.Delete);var EC=EC||{};EC.Delete=EC.Delete||{},EC.Delete=function(e){"use strict";function t(e){var t=new $.Deferred,n=e;return $.when(EC.Select.getBranchFiles(n)).then(function(e){o.deletion_files=o.deletion_files.concat(e),$.when(EC.Delete.removeLinkedBranchEntries(n)).then(function(){t.resolve()})}),t.promise()}function n(){$.when(EC.Delete.removeHierarchyEntry(r)).then(function(){o.children_forms.length>0?(console.log("delete children and branches and media attached"),$.when(EC.Delete.deleteChildEntries()).then(function(){console.log("all children deleted"),console.log(o.deletion_counters),$.when(EC.Update.updateCountersOnSingleEntryDeletion(o.deletion_counters)).then(function(){o.deletion_files.length>0?$.when(EC.File.remove(l,o.deletion_files)).then(function(){console.log(l+" media deleted"),s.resolve(!0)}):s.resolve(!0)})})):$.when(EC.Update.updateCountersOnSingleEntryDeletion(o.deletion_counters)).then(function(){s.resolve(!0)})})}var o,r,a,i,s,l;return e.deleteEntry=function(e,c,d,u){return o=this,s=new $.Deferred,r=d,i=EC.Utils.projectHasBranches(),a=EC.Utils.getFormByID(u),l=e,o.deletion_files=[],o.deletion_counters=[],o.deletion_entries=[],o.children_forms=EC.Utils.getChildrenForms(a._id),$.when(EC.Select.getHierarchyEntriesForDeletion(r)).then(function(e,i){o.deletion_entries=e,o.deletion_counters=i,1===a.has_media?$.when(EC.Select.getHierarchyFiles(a,r)).then(function(e){o.deletion_files=o.deletion_files.concat(e),1===a.has_branches?$.when(t(r)).then(function(){n()}):n()}):1===a.has_branches?$.when(t(r)).then(function(){n()}):n()}),s.promise()},e}(EC.Delete);var EC=EC||{};EC.Delete=EC.Delete||{},EC.Delete=function(e){"use strict";var t,n,o,r=function(e){EC.db.executeSql("PRAGMA foreign_keys=ON;",[],function(e){console.log("PRAGMA res: "+JSON.stringify(e)),window.device.platform===EC.Const.ANDROID&&EC.db.executeSql("PRAGMA foreign_keys;",[],function(e){console.log("PRAGMA res: "+JSON.stringify(e))})});var n="DELETE FROM ec_projects WHERE _id=?";e.executeSql(n,[t],a,s)},a=function(e,t){console.log(t)},i=function(){$.when(EC.File.deleteAllMedia(n,!0,[EC.Const.PHOTO_DIR,EC.Const.AUDIO_DIR,EC.Const.VIDEO_DIR])).then(function(){o.resolve()})},s=function(e,t){console.log(t),o.reject()};return e.deleteProject=function(e,a){return t=e,n=a,o=new $.Deferred,EC.db.transaction(r,s,i),o.promise()},e}(EC.Delete);var EC=EC||{};EC.Delete=EC.Delete||{},EC.Delete=function(e){"use strict";return e.deletion_counters=[],e.deletion_entries=[],e.deletion_files=[],e.children_forms=[],e.errorCB=function(e){console.log(EC.Const.TRANSACTION_ERROR),console.log("%c"+e.message,"color: red")},e}(EC.Delete);var EC=EC||{};EC.Delete=EC.Delete||{},EC.Delete=function(e){"use strict";var t,n,o,r=function(e){var n,r=o.length,a="DELETE FROM ec_data WHERE parent=?";for(n=0;r>n;n++)e.executeSql(a,[o[n].parent],null,t.errorCB)},a=function(){n.resolve()};return e.removeHierarchyChildrenEntries=function(){return t=this,n=new $.Deferred,o=t.deletion_entries,EC.db.transaction(r,t.errorCB,a),n.promise()},e}(EC.Delete);var EC=EC||{};EC.Delete=EC.Delete||{},EC.Delete=function(e){"use strict";var t,n,o,r=function(e){var o="DELETE FROM ec_data WHERE entry_key=?";e.executeSql(o,[n],null,t.errorCB)},a=function(){o.resolve()};return e.removeHierarchyEntry=function(e){return t=this,o=new $.Deferred,n=e,EC.db.transaction(r,t.errorCB,a),o.promise()},e}(EC.Delete);var EC=EC||{};EC.Delete=EC.Delete||{},EC.Delete=function(e){"use strict";var t,n,o,r=function(e){var n,r=o.length,a="DELETE FROM ec_branch_data WHERE hierarchy_entry_key_value=?";for(n=0;r>n;n++)e.executeSql(a,[o[n].entry_key],null,t.errorCB)},a=function(){n.resolve()};return e.removeLinkedBranchChildEntries=function(){return t=this,n=new $.Deferred,o=t.deletion_entries,EC.db.transaction(r,t.errorCB,a),n.promise()},e}(EC.Delete);var EC=EC||{};EC.Delete=EC.Delete||{},EC.Delete=function(e){"use strict";var t,n,o,r=function(e,t){},a=function(e){var o="DELETE FROM ec_branch_data WHERE hierarchy_entry_key_value=?";e.executeSql(o,[n],r,t.errorCB)},i=function(){o.resolve()};return e.removeLinkedBranchEntries=function(e){return t=this,o=new $.Deferred,n=e,EC.db.transaction(a,t.errorCB,i),o.promise()},e}(EC.Delete);var EC=EC||{};EC.Delete=EC.Delete||{},EC.Delete=function(e){"use strict";var t,n,o,r=function(e){var o,r=n.length,a="DELETE FROM ec_branch_data WHERE hierarchy_entry_key_value=? AND is_data_synced=?";for(o=0;r>o;o++)e.executeSql(a,[n[o],1],null,t.errorCB)},a=function(){o.resolve()};return e.removeSyncedBranchEntries=function(e){return t=this,o=new $.Deferred,n=e,EC.db.transaction(r,t.errorCB,a),o.promise()},e}(EC.Delete);var EC=EC||{};EC.Delete=EC.Delete||{},EC.Delete=function(e){"use strict";var t,n,o,r=function(e){var o="DELETE FROM ec_data WHERE form_id=? AND is_data_synced=?";e.executeSql(o,[n,1],null,t.errorCB)},a=function(){o.resolve()};return e.removeSyncedHierarchyEntries=function(e){return t=this,n=e,o=new $.Deferred,EC.db.transaction(r,t.errorCB,a),o.promise()},e}(EC.Delete);var EC=EC||{};EC.File=EC.File||{},EC.File=function(e){"use strict";function t(e){function t(e){console.log(e)}function n(e){console.log(JSON.stringify(e)),a=e.root.fullPath,e.root.getFile(l,{create:!0,exclusive:!1},r,t)}function r(e){e.createWriter(i,t)}function i(e){e.onwritestart=function(){},e.onwriteend=function(e){c.resolve(),console.log("Content of file:"+s)},e.write(s)}console.log(JSON.stringify(e));var s=JSON.stringify(e),l=o+".txt",c=new $.Deferred;return window.requestFileSystem(LocalFileSystem.PERSISTENT,0,n,t),c.promise()}var n,o,r,a;return e.backup=function(e,a,i){var s=new $.Deferred;return n=e,o=a,r=i,$.when(EC.Select.getAllProjectEntries(n,r)).then(function(e){$.when(t(e)).then(function(){s.resolve()})}),s.promise()},e}(EC.File);var EC=EC||{};EC.File=EC.File||{},EC.File=function(e){"use strict";var t,n,o,r;return e.copyVideo=function(e,a){function i(e){console.log(e)}function s(e){function t(t){var a=t;console.log(a),e.copyTo(a,n,function(e){r.resolve(n)},o)}function o(e){console.log(e)}window.resolveLocalFileSystemURL(cordova.file.externalCacheDirectory,t,o)}return r=new $.Deferred,t=e,o=a,n=EC.Utils.getTimestamp()+".mp4",window.resolveLocalFileSystemURI(t,s,i),r.promise()},e}(EC.File);var EC=EC||{};EC.File=EC.File||{},EC.File=function(e){"use strict";function t(){o()}function n(e){console.log(e),l.reject()}function o(){var e;i.length>0?(e=i.shift(),c===EC.Const.ANDROID&&(e=e.replace("/files/","")),s.getDirectory(e,{create:!0,exclusive:!1},t,n)):(console.log("Media folders created"),window.localStorage.are_media_folders_created=1,l.resolve())}function r(e){s=c===EC.Const.ANDROID?e:e.root,o()}function a(e){console.log(e),l.reject()}var i,s,l,c;return e.createMediaDirs=function(){return l=new $.Deferred,c=window.device.platform,window.localStorage.are_media_folders_created?l.resolve():(i=[EC.Const.PHOTO_DIR,EC.Const.AUDIO_DIR,EC.Const.VIDEO_DIR],c===EC.Const.ANDROID?window.resolveLocalFileSystemURL(cordova.file.dataDirectory,r,a):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,r,a)),l.promise()},e}(EC.File);var EC=EC||{};EC.File=EC.File||{},EC.File=function(e){"use strict";var t;return e.deleteAllMedia=function(e,n,o){var r,a=this,i=e,s=n,l=o,c=l.shift(),d=window.parseInt(window.localStorage.project_id,10),u=JSON.parse(window.localStorage.forms);t||(t=new $.Deferred),console.log("dir: "+EC.Const.ANDROID_APP_PRIVATE_URI+c+i);var E=function(e){var n=e;console.log("dir_entry: "+JSON.stringify(n));var o=function(){console.log("dir deleted, skip to next one if any"),l.length>0?a.deleteAllMedia(i,s,l):(console.log("All media deleted"),s?(t.resolve(),t=null):$.when(EC.Update.emptyMediaValues(u,d)).then(function(){t.resolve()},function(e){t.resolve(),console.log(e)}))},r=function(e){console.log(JSON.stringify(e))};n.removeRecursively(o,r)},p=function(e){1===e.code&&(console.log("no dir "+c+", skip to next"),l.length>0?a.deleteAllMedia(i,s,l):(console.log("All media deleted"),s?(t.resolve(),t=null):$.when(EC.Update.emptyMediaValues(u,d)).then(function(){t.resolve(),t=null},function(){t.resolve(),t=null}))),console.log(JSON.stringify(e))};switch(window.device.platform){case EC.Const.ANDROID:r=EC.Const.ANDROID_APP_PRIVATE_URI;break;case EC.Const.IOS:r="file://"+EC.Const.IOS_APP_PRIVATE_URI}return console.log(r+c+i),window.resolveLocalFileSystemURL(r+c+i,E,p),t.promise()},e}(EC.File);var EC=EC||{};EC.File=EC.File||{},EC.File=function(e){"use strict";return e.hasBackup=function(e){function t(e){console.log(JSON.stringify(e)),a=e.root.fullPath,e.root.getFile(i,{create:!1,exclusive:!1},n,o)}function n(){s.resolve()}function o(){s.reject()}function r(e){console.log(e)}var a,i=e+".txt",s=new $.Deferred;return window.requestFileSystem(LocalFileSystem.PERSISTENT,0,t,r),s.promise()},e}(EC.File);var EC=EC||{};EC.File=EC.File||{},EC.File=function(e){"use strict";return e.move=function(e,t){function n(e){var t,n=e;switch(n){case EC.Const.PHOTO:t=EC.Const.PHOTO_DIR;break;case EC.Const.AUDIO:t=EC.Const.AUDIO_DIR;break;case EC.Const.VIDEO:t=EC.Const.VIDEO_DIR}return t}function o(e){function t(e){function t(e){function t(e){function t(){function e(e){console.log("files length:"+a.length),console.log(JSON.stringify(a)),0===a.length?(console.log("no more files to save, build rows"),i?EC.BranchInputs.buildRows():EC.Inputs.buildRows()):(console.log("move another file"),EC.File.move(a,i)),console.log("file move OK : "+JSON.stringify(e))}function t(e){console.log("onMovedFail:"+JSON.stringify(e))}console.log("parent_dir: "+JSON.stringify(l)),console.log("destination dir: "+p+s+"/"+o),r.moveTo(l,"/"+s+"/"+o,e,t)}function n(e){console.log("onGetDirectoryFail: "+JSON.stringify(e))}var s=window.localStorage.project_name,l=e;l.getDirectory(s,{create:!0,exclusive:!1},t,n)}function n(e){console.log("onLFSError: "+JSON.stringify(e))}var o,r=e,s=(window.localStorage.project_name,window.localStorage.form_name),d=EC.Utils.getPhoneUUID();""===u?o=s+"_"+E+"_"+d+"_"+c:(l=u.split("/"),o=l[l.length-1]),window.resolveLocalFileSystemURL(EC.Const.ANDROID_APP_PRIVATE_URI+p,t,n)}var n,s=e,d=s.length;for(n=0;d>n;n++)console.log("dir_entries[i].name  "+s[n].name),console.log("filename  "+c),s[n].name===c&&r.getFile(s[n].name,{
create:!1},t,o)}function n(e){console.log("onDirReadError: "+JSON.stringify(e))}function o(e){console.log("onFileError "+JSON.stringify(e))}var r=e,s=r.createReader();s.readEntries(t,n)}function r(e){console.log("fail"+JSON.stringify(e))}var a=e,i=t,s=a.shift();console.log("files: "+JSON.stringify(s));var l,c,d=s.cached,u=s.stored,E=s.ref,p=n(s.type);""===d||void 0===d?0===a.length?i?EC.BranchInputs.buildRows():EC.Inputs.buildRows():EC.File.move(a,i):(console.log("cached filepath: "+JSON.stringify(d)),l=d.split("/"),c=l[l.length-1],window.resolveLocalFileSystemURL(cordova.file.externalCacheDirectory,o,r),console.log("stored filepath:"+u))},e}(EC.File);var EC=EC||{};EC.File=EC.File||{},EC.File=function(e){"use strict";var t,n,o,r;return e.moveVideo=function(e,a,i){function s(e){function t(t){var o=t;e.moveTo(o,n,function(e){console.log(e),r.resolve(n)},function(e){console.log(e)})}function o(e){console.log(e)}window.resolveLocalFileSystemURL(cordova.file.externalCacheDirectory,t,o)}function l(e){console.log(e)}return r=new $.Deferred,t=e,o=i,n=""===a?EC.Utils.getTimestamp()+".mp4":a,window.resolveLocalFileSystemURI(t,s,l),r.promise()},e}(EC.File);var EC=EC||{};EC.File=EC.File||{},EC.File=function(e){"use strict";var t,n,o,r=[];e.remove=function(e,i){return n=this,o=new $.Deferred,t=e,r=i,a(),o.promise()};var a=function(){var e,n,o=r.shift(),a=o.value,l=o.type;switch(l){case EC.Const.PHOTO:e=EC.Const.PHOTO_DIR;break;case EC.Const.AUDIO:e=EC.Const.AUDIO_DIR;break;case EC.Const.VIDEO:e=EC.Const.VIDEO_DIR}switch(window.device.platform){case EC.Const.ANDROID:n=EC.Const.ANDROID_APP_PRIVATE_URI+e+t+"/"+a;break;case EC.Const.IOS:n="file://"+EC.Const.IOS_APP_PRIVATE_URI+e+t+"/"+a}console.log("file full path: "+n),window.resolveLocalFileSystemURL(n,i,s)},i=function(e){var t=e;t.remove(l,c)},s=function(e){console.log("Error getting file: "+JSON.stringify(e))},l=function(e){console.log("File removed: "+JSON.stringify(e)),r.length>0?a():(EC.Notification.showToast(EC.Localise.getTranslation("all_media_deleted"),"short"),o.resolve())},c=function(e){console.log("Error: "+JSON.stringify(e)),EC.Notification.showToast(EC.Localise.getTranslation("generic_error"),"short")};return e}(EC.File);var EC=EC||{};EC.File=EC.File||{},EC.File=function(e){"use strict";return e.restoreFromBackup=function(e,t){function n(e){console.log(e),1===e.code&&EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("no_backup_saved"))}function o(e){function t(e){var t=new FileReader;t.onloadend=function(e){console.log("Read as text"),console.log(e.target.result),i=JSON.parse(e.target.result),console.log(i),i[i.length-1].has_branches===!0&&(s=i.pop()),$.when(EC.Create.insertAllFormsData(i,s)).then(function(){console.log("Hierarchy entries restored"),s.branch_data_rows.length>0?(l=s.branch_form_names,$.when(EC.Select.getBranchFormLocalIDs(c,l)).then(function(e){$.when(EC.Select.getBranchInputsLocalIDs(c)).then(function(t){console.log(e),console.log(t),$.when(EC.Create.insertBranchDataRows(s,e,t)).then(function(){d.resolve()})})})):d.resolve()})},t.readAsText(e)}r=e.root.fullPath,e.root.getFile(a,{create:!1,exclusive:!1},function(e){e.file(function(e){t(e)},n)},n)}var r,a=e+".txt",i=[],s={},l=[],c=t,d=new $.Deferred;return window.requestFileSystem(LocalFileSystem.PERSISTENT,0,o,n),d.promise()},e}(EC.File);var EC=EC||{};EC.File=EC.File||{},EC.File=function(e){"use strict";var t,n,o="",r="",a="",i="",s="",l="";e.uploadFile=function(e,u){console.log("the_filename: "+e.value);var E,p,C=new FileTransfer,_={},h=EC.Utils.getPhoneUUID(),f=parseInt(window.localStorage.project_id,10),v=function(){switch(a=window.localStorage.project_name,o=e.value,l=e._id,i=u){case EC.Const.PHOTO_DIR:r+="?type=thumbnail&phoneID="+h,console.log("Upload URL for thumbnail: "+r),s=EC.Const.PHOTO,EC.Upload.is_branch_image&&(n=!0);break;case EC.Const.AUDIO_DIR:r+="?type=audio&phoneID="+h,s=EC.Const.AUDIO,console.log("Upload URL for audio: "+r),EC.Upload.is_branch_audio&&(n=!0);break;case EC.Const.VIDEO_DIR:r+="?type=video&phoneID="+h,s=EC.Const.VIDEO,console.log("Upload URL for video: "+r),EC.Upload.is_branch_video&&(n=!0)}switch(console.log("filename:"+JSON.stringify(o)),window.device.platform){case EC.Const.ANDROID:p=EC.Const.ANDROID_APP_PRIVATE_URI;break;case EC.Const.IOS:p=EC.Const.IOS_APP_PRIVATE_URI}_.mimeType="",_.fileKey="name",_.fileName=o,window.device.platform===EC.Const.IOS,E=p+i+a+"/"+o,console.log("file_URI: "+JSON.stringify(E)),C.onprogress=function(e){},C.upload(E,r,c,d,_)};t=this,r=EC.Upload.getUploadURL(),n=!1,EC.Utils.isChrome()||r?v():$.when(EC.Select.getUploadURL(f)).then(function(e){console.log("Project URL is: "+e),r=e,EC.Upload.setUploadURL(e),v()})};var c=function(e){console.log(JSON.stringify(e)),$.when(EC.Update.flagOneFileAsSynced(l,n)).then(function(){EC.Upload.uploadNextFile(s)})},d=function(e){console.log(JSON.stringify(e)),EC.Notification.hideProgressDialog(),EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("upload_error")),EC.Upload.handleMedia()};return e}(EC.File);var EC=EC||{};EC.File=EC.File||{},EC.File=function(e){"use strict";return e.writeProjectDataAsCSV=function(e,t){function n(e){console.log(e)}function o(e){function t(e){function t(e){function t(e){e.onwritestart=function(){},e.onwriteend=function(e){console.log("Content of file:"+l),c.resolve({filename:a,folder:r})},e.write(l)}e.createWriter(t,n)}e.getFile(a,{create:!0,exclusive:!1},t,n)}e.getDirectory(r,{create:!0,exclusive:!1},t,n)}var r,a,i,s,l,c=new $.Deferred,d=t,u=e;return $.when(EC.Utils.getExportDirName()).then(function(e){var t,c;for(console.log(e),r=e,s=new JSZip,a=u+".zip",c=d.length,t=0;c>t;t++)i=Papa.unparse(d[t].entries,{quotes:!0,delimiter:",",newline:"\r\n"}),console.log(i),s.file(d[t].name+".csv",i);l=s.generate({type:"blob",compression:"STORE"}),window.resolveLocalFileSystemURL(cordova.file.externalRootDirectory,o,n)}),c.promise()},e}(EC.File);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";var t,n,o;return e.getInputAt=function(e){var t=e-1;return o=this,o.branch_inputs[t]},e.getPrimaryKeyRefPosition=function(){var e,t=o.branch_inputs.length;for(o=this,e=0;t>e;e++)if(1===parseInt(o.branch_inputs[e].is_primary_key,10))return o.branch_inputs[e].position},e.getList=function(e,o){var r=window.localStorage.branch_edit_position;n=e,t=o,$.when(EC.Select.getBranchInputs(n,t)).then(function(e,t){EC.BranchInputs.setInputs(e,t),EC.BranchInputs.prepareFirstInput(void 0===r?e[0]:e[r-1])})},e.setInputs=function(e,t){o=this,o.branch_inputs=e,window.localStorage.branch_inputs_total=o.branch_inputs.length,window.localStorage.branch_form_has_jumps=t?1:0},e.getInputs=function(){return this.branch_inputs},e.getFormDetails=function(e,t,n){EC.Select.getBranchFormDetails(e,t,n)},e.setCachedBranchEntryKeys=function(e,t){var n,o,r,a,i=t,s=e,l=!1;try{n=JSON.parse(window.localStorage.cached_branch_entry_keys)}catch(c){n=[]}if(a=n.length,a>0){for(r=0;a>r;r++)n[r].branch_form_name===s&&(l=!0,o=n[r].primary_keys,o=o.concat(i).unique(),n[r].primary_keys=o,window.localStorage.cached_branch_entry_keys=JSON.stringify(n));l||(n.push({branch_form_name:s,primary_keys:i}),window.localStorage.cached_branch_entry_keys=JSON.stringify(n))}else n.push({branch_form_name:s,primary_keys:i}),window.localStorage.cached_branch_entry_keys=JSON.stringify(n)},e.getCachedBranchEntryKeys=function(e){var t,n,o,r,a=e;try{t=JSON.parse(window.localStorage.cached_branch_entry_keys)}catch(i){t=[]}if(o=t.length,!(o>0))return[];for(n=0;o>n;n++)if(t[n].branch_form_name===a)return r=t[n].primary_keys,console.log(r,!0),t[n].primary_keys},e.getJumpDestinationPosition=function(e){var t,n=this.branch_inputs.length,o=e;for(t=0;n>t;t++)if(o===this.branch_inputs[t].ref)return this.branch_inputs[t].position},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.backToHierarchyForm=function(){var e,t,n,o;e=JSON.parse(window.localStorage.inputs),n=parseInt(window.localStorage.current_position,10),t=e[n-1],window.localStorage.removeItem("branch_current_position"),window.localStorage.removeItem("branch_form_has_jumps"),window.localStorage.removeItem("branch_form_name"),window.localStorage.removeItem("branch_inputs_total"),window.localStorage.removeItem("branch_inputs_trail"),window.localStorage.removeItem("branch_inputs_values"),window.localStorage.removeItem("branch_form_id"),window.localStorage.removeItem("branch_edit_hash"),window.localStorage.removeItem("branch_edit_key_value"),window.localStorage.removeItem("branch_edit_type"),window.localStorage.back_from_branch=1,o=EC.Const.INPUT_VIEWS_DIR+t.type+EC.Const.HTML_FILE_EXT,EC.Routing.changePage(o)},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.bindBackBtn=function(e){var t=this,n=$("div[data-role='header'] div[data-href='back-btn']"),o=n.find("span.main-form-name"),r=window.localStorage.form_name;o.text("Back to "+r.trunc(EC.Const.FORM_NAME_MAX_LENGTH)),n.off().one("vclick",function(n){e?t.backToHierarchyForm():EC.Notification.askConfirm(EC.Localise.getTranslation("exit"),EC.Localise.getTranslation("exit_confirm"),"EC.BranchInputs.backToHierarchyForm")})},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";var t,n,o,r=function(e,r){var a,i,s,l=e,c=l.length,d=r,u=window.localStorage.branch_inputs_total;for(i=n+1,a=0;c>a;a++){if(l[a].jump_when===EC.Const.JUMP_ALWAYS){o=!0,s=l[a].jump_to,i=s===EC.Const.END_OF_FORM?u:t.getJumpDestinationPosition(s);break}if(l[a].jump_when===EC.Const.JUMP_FIELD_IS_BLANK&&(null===d||d===EC.Const.NO_OPTION_SELECTED)){o=!0,s=l[a].jump_to,i=s===EC.Const.END_OF_FORM?u:t.getJumpDestinationPosition(s);break}if(l[a].jump_when===EC.Const.JUMP_VALUE_IS&&d.toString()===l[a].jump_value.toString()){o=!0,s=l[a].jump_to,i=s===EC.Const.END_OF_FORM?u:t.getJumpDestinationPosition(s);break}if(l[a].jump_when===EC.Const.JUMP_VALUE_IS_NOT&&d.toString()!==l[a].jump_value.toString()){o=!0,s=l[a].jump_to,i=s===EC.Const.END_OF_FORM?u:t.getJumpDestinationPosition(s);break}}return n=i-1,s};return e.gotoNextPage=function(e,a){var i,s,l,c,d,u,E,p,C=a,_=EC.Utils.isBranchFormGenKeyHidden(),h=!1;if(t=this,n=parseInt(window.localStorage.branch_current_position,10),C.hasOwnProperty("value")&&(C=C.value),Array.isArray(C)&&(h=!0),n===t.branch_inputs.length)l=EC.Const.BRANCH_VIEWS_DIR+EC.Const.BRANCH_SAVE_CONFIRM_VIEW;else{if(i=t.getInputAt(n),1===parseInt(i.has_jump,10))if(E=EC.Utils.parseJumpString(i.jumps),h)for(o=!1,d=C.length,c=0;d>c&&(u=r(E,C[c].value),!o);c++);else u=r(E,C);u===EC.Const.END_OF_FORM?l=EC.Const.BRANCH_VIEWS_DIR+EC.Const.BRANCH_SAVE_CONFIRM_VIEW:(s=t.getInputAt(n+1),_&&1===s.is_primary_key?(t.pushInputsTrail(s),p=EC.Utils.getGenKey(),t.setCachedInputValue(p,n+1,s.type,s.is_primary_key),s=t.getInputAt(n+2),s||(l=EC.Const.BRANCH_VIEWS_DIR+EC.Const.BRANCH_SAVE_CONFIRM_VIEW),window.localStorage.branch_current_position=n+2):window.localStorage.branch_current_position=n+1,s&&(l=EC.Const.BRANCH_VIEWS_DIR+EC.Const.BRANCH_PREFIX+s.type+EC.Const.HTML_FILE_EXT))}EC.Routing.changePage(l),e.preventDefault()},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.gotoPrevPage=function(e){var t,n=this,o=parseInt(window.localStorage.branch_current_position,10),r=JSON.parse(window.localStorage.branch_inputs_trail),a=r[r.length-1].position,i=n.getInputAt(a),s=EC.Utils.isBranchFormGenKeyHidden();s&&1===i.is_primary_key?(a=r[r.length-2].position,i=n.getInputAt(a),window.localStorage.branch_current_position=o-2,n.popInputsTrail()):window.localStorage.branch_current_position=a,n.popInputsTrail(),t=EC.Const.BRANCH_VIEWS_DIR+EC.Const.BRANCH_PREFIX+i.type+EC.Const.HTML_FILE_EXT,EC.Routing.changePage(t),e.preventDefault()},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.onNextBtnTapped=function(e,t){var n=this,o=window.localStorage,r=t,a=(o.branch_edit_id||"",o.branch_edit_type||"",JSON.parse(o.branch_form),EC.BranchInputs.getCurrentValue(r.type)),i=o.branch_current_position,s=EC.Inputs.getCachedInputValue(i),l=n.validateValue(r,a,i);return l.is_valid?(o.branch_edit_mode&&1===parseInt(r.has_jump,10)&&(EC.Inputs.valuesMatch(s,a,r.type)||(o.branch_has_new_jump_sequence=1)),n.setCachedInputValue(a,i,r.type,r.is_primary_key),n.pushInputsTrail(r),window.localStorage.removeItem("is_dismissing_barcode"),void n.gotoNextPage(e,a)):void EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation(l.message))},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.onPrevBtnTapped=function(e,t){var n=this,o=t,r=(n.branch_inputs.length,n.getCurrentValue(o.type)),a=window.localStorage.branch_current_position,i=EC.Inputs.getCachedInputValue(a);window.localStorage.branch_edit_mode&&1===parseInt(o.has_jump,10)&&(EC.Inputs.valuesMatch(i,r,o.type)||(window.localStorage.branch_has_new_jump_sequence=1)),a<=n.branch_inputs.length&&n.setCachedInputValue(r,a,o.type,o.primary_key),window.localStorage.removeItem("is_dismissing_barcode"),n.gotoPrevPage(e)},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.popInputsTrail=function(){var e;try{e=JSON.parse(window.localStorage.branch_inputs_trail),e.pop(),window.localStorage.branch_inputs_trail=JSON.stringify(e)}catch(t){}},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.pushInputsTrail=function(e){var t,n=e;try{t=JSON.parse(window.localStorage.branch_inputs_trail)}catch(o){t=[]}t.push({position:n.position,label:n.label}),window.localStorage.branch_inputs_trail=JSON.stringify(t)},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.spliceInputsTrail=function(e){var t,n,o,r=parseInt(e,10),a=JSON.parse(window.localStorage.branch_inputs_trail),i=a.length;for(t=0;i>t;t++)if(a[t].position===r){n=t;break}o=i-n,a.splice(n,o),window.localStorage.branch_inputs_trail=JSON.stringify(a)},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.prepareFeedback=function(e,t){var n=this,o=e,r=EC.Const.BRANCH_VIEWS_DIR+EC.Const.BRANCH_FEEDBACK_VIEW,a=JSON.parse(window.localStorage.branch_form),i=t;o?(n.message="Branch entry saved successfully!",n.setCachedBranchEntryKeys(a.name,[i])):n.message="Error saving data...please retry",EC.Routing.changePage(r)},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.prepareFirstInput=function(e){var t=this,n=1,o=e,r=EC.Const.BRANCH_VIEWS_DIR+EC.Const.BRANCH_PREFIX+o.type+EC.Const.HTML_FILE_EXT,a=EC.Utils.isBranchFormGenKeyHidden();window.localStorage.branch_edit_mode?t.spliceInputsTrail(window.localStorage.branch_edit_position):window.localStorage.branch_inputs_trail=[],window.localStorage.branch_current_position=window.localStorage.branch_edit_mode?window.localStorage.branch_edit_position:n,1===a&&1===o.is_primary_key&&(window.localStorage.branch_current_position=n+1,window.localStorage.branch_edit_mode||(window.localStorage.branch_inputs_values=JSON.stringify([{_id:"",type:"",value:EC.Utils.getGenKey(),position:1,is_primary_key:1}])),o=t.branch_inputs[n],r=EC.Const.BRANCH_VIEWS_DIR+EC.Const.BRANCH_PREFIX+o.type+EC.Const.HTML_FILE_EXT),EC.Routing.changePage(r)},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.renderFeedbackView=function(){var e=this,t=(window.localStorage.form_id,window.localStorage.form_name),n=JSON.parse(window.localStorage.branch_form),o=$("div#branch-feedback div#branch-input-feedback div#add-entry-branch-form"),r=$("div#branch-feedback div#branch-input-feedback div#back-to-main-form"),a=window.localStorage.project_id;e.bindBackBtn(!0),window.localStorage.removeItem("branch_current_position"),window.localStorage.removeItem("branch_edit_id"),window.localStorage.removeItem("branch_edit_mode"),window.localStorage.removeItem("branch_edit_position"),window.localStorage.removeItem("branch_inputs_trail"),window.localStorage.removeItem("branch_inputs_values"),$("div.branch-form-name div.ui-block-a span.ui-btn-active span.ui-btn-inner").text(n.name),o.find("span.entry").text("("+n.name+")"),r.find("span.form-name-inline").text(t),o.off().one("vclick",function(t){EC.Notification.showProgressDialog(),e.getList(n.name,a)}),r.off().one("vclick",function(t){e.backToHierarchyForm()}),EC.Notification.hideProgressDialog()},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.renderInput=function(e){var t,n,o,r=this,a=window.localStorage,i=e,s=parseInt(a.branch_current_position,10),l=r.getCachedInputValue(s),c=$("div#branch-"+i.type+" div[data-role='header'] div[data-href='back-btn']"),d=$("div[data-role='header'] div[data-href='back-btn'] span.form-name"),u=$("div.branch-input-nav-tabs div.ui-block-a.input-prev-btn"),E=$("div.branch-input-nav-tabs div.ui-block-c.input-next-btn"),p=a.form_name,C=r.branch_inputs.length,_=JSON.parse(a.branch_form),h=EC.Utils.isBranchFormGenKeyHidden(),f=!1;c.off().on("vclick",function(e){a.branch_edit_mode?a.branch_has_new_jump_sequence?EC.Notification.askConfirm(EC.Localise.getTranslation("leaving_current_form"),EC.Localise.getTranslation("exit_confirm"),"EC.Inputs.backToHierarchyForm",!1,i,!0):1===parseInt(i.has_jump,10)?(t=EC.Inputs.getCurrentValue(i.type),EC.Inputs.valuesMatch(l,t,i.type)?EC.Notification.askConfirm(EC.Localise.getTranslation("leaving_current_form"),EC.Localise.getTranslation("save_before_leave"),"EC.Inputs.backToBranchEntryValuesList",!0,i,!0):EC.Notification.askConfirm(EC.Localise.getTranslation("leaving_current_form"),EC.Localise.getTranslation("exit_confirm"),"EC.Inputs.backToHierarchyForm",!1,i,!0)):EC.Notification.askConfirm(EC.Localise.getTranslation("leaving_current_form"),EC.Localise.getTranslation("save_before_leave"),"EC.Inputs.backToBranchEntryValuesList",!0,i,!0):EC.Notification.askConfirm(EC.Localise.getTranslation("leaving_current_form"),EC.Localise.getTranslation("save_before_leave"),"EC.Inputs.backToBranchEntryValuesList",!0,i,!0)}),d.text("Back to "+p.trunc(EC.Const.FORM_NAME_MAX_LENGTH)),$("div.branch-form-name div.ui-block-a span.ui-btn-active span.ui-btn-inner").text(_.name),$(u,E).removeClass("invisible"),0!==s&&(t=r.getCachedInputValue(s).value,t=t===EC.Const.SKIPPED?"":t,i.type===EC.Const.PHOTO||i.type===EC.Const.AUDIO||i.type===EC.Const.VIDEO?t?r.renderInputView(i,t):r.renderInputView(i,{cached:"",stored:""}):t?r.renderInputView(i,t):r.renderInputView(i,i.default_value)),C>=s&&(E.off().on("vclick",function(e){r.onNextBtnTapped(e,i)}),s-1>0?(2===s&&(n=JSON.parse(a.branch_inputs_values),o=n[0],1===o.is_primary_key&&1===h&&(u.addClass("invisible"),f=!0)),f||u.off().on("vclick",function(e){r.onPrevBtnTapped(e,i)})):(u.addClass("invisible"),a.removeItem("branch_inputs_trail")),a.branch_edit_mode&&($("div.store-edit").removeClass("hidden"),1===i.has_jump?$("div.store-edit").addClass("ui-disabled"):$("div.store-edit").removeClass("ui-disabled"),$("div.store-edit").off().on("vclick",function(){r.prepareStoreEdit(t,s,i)}))),r.updateFormCompletion(s,C)},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.renderInputView=function(e,t){var n=e,o=t;switch(n.type){case EC.Const.TEXT:EC.BranchInputTypes.text(o,n);break;case EC.Const.TEXTAREA:EC.BranchInputTypes.textarea(o,n);break;case EC.Const.INTEGER:EC.BranchInputTypes.integer(o,n);break;case EC.Const.DECIMAL:EC.BranchInputTypes.decimal(o,n);break;case EC.Const.DATE:EC.BranchInputTypes.date(o,n);break;case EC.Const.TIME:EC.BranchInputTypes.time(o,n);break;case EC.Const.RADIO:EC.BranchInputTypes.radio(o,n);break;case EC.Const.CHECKBOX:EC.BranchInputTypes.checkbox(o,n);break;case EC.Const.DROPDOWN:EC.BranchInputTypes.dropdown(o,n);break;case EC.Const.BARCODE:EC.BranchInputTypes.barcode(o,n);break;case EC.Const.LOCATION:EC.BranchInputTypes.location(o,n);break;case EC.Const.PHOTO:EC.BranchInputTypes.photo(o,n);break;case EC.Const.AUDIO:EC.BranchInputTypes.audio(o,n);break;case EC.Const.VIDEO:EC.BranchInputTypes.video(o,n)}EC.Notification.hideProgressDialog()},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.renderSaveConfirmView=function(){var e=this,t=$("div#branch-save-confirm div.ui-grid-b div.ui-block-a.input-prev-btn"),n=$("div#branch-save-confirm div#branch-input-save-confirm div#store"),o=$("div#branch-save-confirm div.store-edit"),r=$("div.ui-grid-b.branch-input-nav-tabs div.input-progress-bar div.progress.progress_tiny"),a=$("div.ui-grid-b.branch-input-nav-tabs div.input-progress-bar span.form-completion-percent"),i=e.branch_inputs.length,s=(parseInt(window.localStorage.branch_current_position,10),JSON.parse(window.localStorage.branch_form));e.bindBackBtn(!1),e.updateFormCompletion(i+1,i,a,r),$("div.branch-form-name div.ui-block-a span.ui-btn-active span.ui-btn-inner").text(s.name),t.removeClass("invisible"),t.off().on("vclick",function(t){e.gotoPrevPage(t)}),window.localStorage.branch_edit_mode?(n.hide(),o.removeClass("ui-disabled hidden"),o.off().one("vclick",function(t){e.onStoreValues()})):(n.show(),$("div.store-edit").addClass("hidden"),n.off().one("vclick",function(t){e.onStoreValues()})),e.updateFormCompletion(i+1,i)},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.renderStoreEditFeedback=function(e){e&&(EC.Notification.showToast(EC.Localise.getTranslation("edit_saved"),"short"),window.localStorage.removeItem("branch_has_new_jump_sequence"),EC.Routing.changePage(EC.Const.BRANCH_ENTRIES_LIST_VIEW))},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.updateFormCompletion=function(e,t){var n=Math.ceil(100*(e-1)/t),o=$("div.ui-grid-b.branch-input-nav-tabs div.input-progress-bar div.progress.progress_tiny"),r=$("div.ui-grid-b.branch-input-nav-tabs div.input-progress-bar span.form-completion-percent");r.text(n+"%"),o.css("width",n+"%")},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.amendSkippedValues=function(){var e,t,n,o,r,a,i=window.localStorage,s=[],l=[],c=EC.Utils.isBranchFormGenKeyHidden();for(s=JSON.parse(i.branch_inputs_trail),l=JSON.parse(i.branch_inputs_values),n=l.length,o=s.length,r=s[s.length-1].position,e=0;n>e;e++){if(a=!1,null===l[e])a=!0;else for(t=0;o>t;t++)if(parseInt(l[e].position,10)===s[t].position||1===c&&1===parseInt(l[e].is_primary_key,10)){a=!0;break}a||(l[e].value=EC.Const.SKIPPED)}i.branch_inputs_values=JSON.stringify(l)},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.buildRows=function(e){var t,n,o,r,a,i,s,l,c,d,u=[],E=EC.BranchInputs.branch_inputs.length,p=EC.BranchInputs.getPrimaryKeyRefPosition(),C=EC.Inputs.getPrimaryKeyRefPosition(),_=window.localStorage.form_name,h=EC.Utils.getPhoneUUID(),f=window.localStorage.form_id,v=EC.Utils.getTimestamp(),m=(window.localStorage.branch_form_name,e),g=(parseInt(window.localStorage.branch_current_position,10),EC.BranchInputs.getCachedInputValue(p).value),w=EC.Inputs.getCachedInputValue(C).value,y=EC.Utils.getFormPrimaryKeyRef(f);for(t=0;E>t;t++){if(n=EC.BranchInputs.branch_inputs[t],o=EC.BranchInputs.getCachedInputValue(n.position),r=o.value||"",a=o._id,n.type===EC.Const.PHOTO||n.type===EC.Const.VIDEO||n.type===EC.Const.AUDIO)if(r.hasOwnProperty("stored"))if(""===r.stored)if(""!==r.cached){switch(i=r.cached.split("/"),s=i[i.length-1],window.device.platform){case EC.Const.ANDROID:break;case EC.Const.IOS:(n.type===EC.Const.PHOTO||n.type===EC.Const.AUDIO||n.type===EC.Const.VIDEO)&&(l=s.split("."),c=l[l.length-1],d=EC.Utils.getIOSFilename(m,s),s=d+"."+c)}r=_+"_"+n.ref+"_"+h+"_"+s}else r="";else r=r.stored;else r="";u.push({_id:a,input_id:n._id,form_id:n.form_id,position:n.position,hierarchy_entry_key_value:w,hierarchy_entry_key_ref:y,label:n.label,value:r,ref:n.ref,is_title:n.is_title,entry_key:g,type:n.type,is_data_synced:0,is_media_synced:0,is_remote:0,created_on:v})}console.log("rows"),console.log(JSON.stringify(u)),window.localStorage.branch_edit_mode?$.when(EC.Update.commitBranchForm(u)).then(function(){window.localStorage.branch_edit_hash="#entries?form="+f+"&name="+_+"&entry_key=&direction="+EC.Const.EDITING,window.localStorage.branch_edit_key_value=g,EC.BranchInputs.renderStoreEditFeedback(!0)},function(){EC.BranchInputs.renderStoreEditFeedback(!1)}):$.when(EC.Create.insertBranchFormValues(u,g,w)).then(function(e){EC.BranchInputs.prepareFeedback(!0,e)},function(){EC.BranchInputs.prepareFeedback(!1,null)})},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.buildRows=function(){var e,t,n,o,r,a,i=[],s=EC.BranchInputs.branch_inputs.length,l=EC.BranchInputs.getPrimaryKeyRefPosition(),c=EC.Inputs.getPrimaryKeyRefPosition(),d=window.localStorage.form_name,u=EC.Utils.getPhoneUUID(),E=window.localStorage.form_id,p=EC.Utils.getTimestamp(),C=(window.localStorage.branch_form_name,parseInt(window.localStorage.branch_current_position,10),EC.BranchInputs.getCachedInputValue(l).value),_=EC.Inputs.getCachedInputValue(c).value;for(e=0;s>e;e++)t=EC.BranchInputs.branch_inputs[e],n=EC.BranchInputs.getCachedInputValue(t.position).value,o=EC.BranchInputs.getCachedInputValue(t.position)._id,(t.type===EC.Const.PHOTO||t.type===EC.Const.VIDEO||t.type===EC.Const.AUDIO)&&(console.log("value: "+JSON.stringify(n)),""===n.stored?""!==n.cached?(r=n.cached.split("/"),a=r[r.length-1],n=d+"_"+t.ref+"_"+u+"_"+a):n="":n=n.stored),console.log("branch_input.type: "+t.type),i.push({_id:o,input_id:t._id,form_id:t.form_id,position:t.position,hierarchy_entry_key_value:_,label:t.label,value:n,ref:t.ref,is_title:t.is_title,entry_key:C,type:t.type,is_data_synced:0,is_media_synced:0,is_remote:0,created_on:p});EC.Notification.showProgressDialog(),console.log("rows"),console.log(JSON.stringify(i)),window.localStorage.branch_edit_mode?(EC.Update.commitBranchForm(i),window.localStorage.branch_edit_hash="#entries?form="+E+"&name="+d+"&entry_key=&direction="+EC.Const.EDITING,window.localStorage.branch_edit_key_value=C):EC.Create.insertBranchFormValues(i,C,_)},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.prepareStoreEdit=function(e,t,n){var o,r=this,a="",i={},s=e,l=t,c=n;return $(this).addClass("ui-disabled"),o=window.localStorage.form_has_jumps,s=EC.BranchInputs.getCurrentValue(c.type),l=window.localStorage.branch_current_position,1===parseInt(c.has_double_check,10)&&(a=r.getCloneValue(c.type)),i=EC.Utils.isValidValue(c,s,a),i.is_valid?(r.setCachedInputValue(s,l,c.type,c.is_primary_key),"1"===o&&(r.pushInputsTrail(c),r.amendSkippedValues()),void r.storeData(r)):(EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation(i.message)),void $(this).removeClass("ui-disabled"))},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.saveValuesOnExit=function(e){var t=this,n=e,o=t.getCurrentValue(n.type),r=parseInt(window.localStorage.branch_current_position,10),a=t.validateValue(n,o,r);return a.is_valid?(t.setCachedInputValue(o,r,n.type,n.is_primary_key),t.pushInputsTrail(n),void t.onStoreValues()):(EC.Notification.hideProgressDialog(),void EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation(a.message)))},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.storeData=function(e){var t=e,n=[],o=function(){var e,t,n,o=JSON.parse(window.localStorage.branch_inputs_values),r=o.length,a=[];for(e=0;r>e;e++)t=EC.BranchInputs.branch_inputs[e],n=EC.BranchInputs.getCachedInputValue(t.position).value,(t.type===EC.Const.PHOTO||t.type===EC.Const.VIDEO||t.type===EC.Const.AUDIO)&&""!==n.cached&&a.push({type:t.type,cached:n.cached,stored:n.stored,ref:t.ref});return a.length>0&&($("div#branch-audio div#branch-input-audio input#cached-audio-uri").val(""),$("div#branch-audio div#branch-input-audio input#stored-audio-uri").val("")),a};n=o(),console.log("media_files.length= "+n.length),0===n.length||EC.Utils.isChrome()?t.buildRows():(console.log(JSON.stringify(n)),EC.File.move(n,!0))},e.onStoreValues=function(){var e=this;return e.isEmptyPrimaryKey()?(EC.Notification.hideProgressDialog(),void EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("missing_pk"))):("1"===window.localStorage.branch_form_has_jumps&&e.amendSkippedValues(),void e.storeData(e))},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputTypes=EC.BranchInputTypes||{},EC.BranchInputTypes=function(e){"use strict";return e.audio=function(e,t){function n(e){var t;switch(w.addClass("ui-disabled"),_.removeClass("ui-disabled"),_.one("vclick",o),C.addClass("ui-disabled"),h.addClass("hidden"),f.removeClass("hidden"),window.device.platform){case EC.Const.ANDROID:t=EC.Utils.getTimestamp()+".mp4";break;case EC.Const.IOS:t=EC.Utils.getTimestamp()+".wav"}i||(i=l+t),console.log("Recording... - Full path: "+i),c=new Media(i,function(){h.removeClass("ui-disabled"),v.text("Audio available"),console.log("recordAudio():Audio Success"),m.val(i)},function(e){console.log("recordAudio():Audio Error: "+e.code)}),c.startRecord(),e.preventDefault(),e.stopPropagation()}function o(e){w.removeClass("ui-disabled"),_.addClass("ui-disabled"),C.removeClass("ui-disabled"),h.removeClass("hidden ui-disabled"),f.addClass("hidden"),C.one("vclick",n),c.stopRecord(),c.release(),e.preventDefault(),e.stopPropagation()}function r(e){console.log("Audio stopped"),d.stop(),d.release(),w.removeClass("ui-disabled"),_.off().one("vclick",o),_.addClass("ui-disabled"),C.removeClass("ui-disabled"),h.removeClass("ui-disabled")}function a(){function e(e){var t=e;4===t&&(w.removeClass("ui-disabled"),_.addClass("ui-disabled"),C.removeClass("ui-disabled"),h.removeClass("ui-disabled"))}w.addClass("ui-disabled"),console.log("Playing... "+i),_.off().one("vclick",r),_.removeClass("ui-disabled"),h.addClass("ui-disabled"),C.addClass("ui-disabled"),d=new Media(i,null,null,e),d.play()}var i,s,l,c,d,u=$("div#branch-audio div#branch-input-audio span.label"),E=e,p=t,C=$("div#branch-audio div#branch-input-audio div#start-btn"),_=$("div#branch-audio div#branch-input-audio div#stop-btn"),h=$("div#branch-audio div#branch-input-audio div#play-btn"),f=$("div#branch-audio div#branch-input-audio div#ongoing-recording-spinner"),v=$("div#branch-audio div#branch-input-audio p#audio-feedback"),m=$("div#branch-audio div#branch-input-audio input#cached-audio-uri"),g=$("div#branch-audio div#branch-input-audio input#stored-audio-uri"),w=$("div#branch-audio div.ui-header");if(u.text(p.label),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),C.off("vclick").one("vclick",n),_.off("vclick"),h.off("vclick").on("vclick",a),window.localStorage.edit_mode&&void 0===E.stored&&(g.val(E),E={cached:"",stored:E}),E.cached)h.removeClass("ui-disabled"),i=m.val();else if(E.stored){switch(h.removeClass("ui-disabled"),window.device.platform){case EC.Const.ANDROID:s=EC.Const.ANDROID_APP_PRIVATE_URI+EC.Const.AUDIO_DIR+window.localStorage.project_name+"/"+E.stored;break;case EC.Const.IOS:s=EC.Const.IOS_APP_PRIVATE_URI+EC.Const.AUDIO_DIR+window.localStorage.project_name+"/"+E.stored}console.log("image_full_path_uri: "+s),
i=s,v.text("Audio available"),console.log("current_path: "+JSON.stringify(s))}else h.addClass("ui-disabled");console.log("value.stored "+E.stored),console.log("cache_audio_uri: "+m.val()),g.val(E.stored||""),C.removeClass("enable"),_.addClass("ui-disabled"),window.device.platform===EC.Const.IOS?window.requestFileSystem(LocalFileSystem.TEMPORARY,0,function(e){console.log(JSON.stringify(e)),l=e.root.nativeURL,console.log("nativeURL: "+l),l=l.slice(7)},function(e){console.log(JSON.stringify(e))}):window.resolveLocalFileSystemURL(cordova.file.externalCacheDirectory,function(e){console.log(JSON.stringify(e)),l=e.nativeURL,console.log("nativeURL: "+l)},function(e){console.log(JSON.stringify(e))})},e}(EC.BranchInputTypes);var EC=EC||{};EC.BranchInputTypes=EC.BranchInputTypes||{},EC.BranchInputTypes=function(e){"use strict";return e.barcode=function(e,t){var n,o=$("span.label"),r=$("div.clone"),a=e,i=t,s=$("div#branch-barcode div#branch-input-barcode div#scanner"),l=$("div#branch-barcode div#branch-input-barcode div#scanner-confirm"),c=$("div#branch-barcode div#branch-input-barcode input.scan-result"),d=$("div#branch-barcode div#branch-input-barcode input.scan-result-confirm");o.text(i.label),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),1===parseInt(i.is_primary_key,10)?o.attr("data-primary-key","true"):o.attr("data-primary-key",""),n=1===parseInt(i.has_double_check,10)?!0:!1,s.removeClass("ui-disabled"),l.removeClass("ui-disabled"),c.val(a),window.localStorage.branch_edit_mode&&"1"===i.is_primary_key?(s.addClass("ui-disabled"),$("div#branch-input-barcode p.primary-key-not-editable").removeClass("hidden")):$("div#branch-input-barcode p.primary-key-not-editable").addClass("hidden"),n?(r.removeClass("hidden"),d.val(a),window.localStorage.branch_edit_mode&&1===i.is_primary_key&&l.addClass("ui-disabled"),l.off().on("vclick",function(){window.localStorage.is_dismissing_barcode=1,cordova.plugins.barcodeScanner.scan(function(e){e.cancelled||d.val(e.text)},function(e){console.log(e)})})):r.addClass("hidden"),s.off().on("vclick",function(){window.localStorage.is_dismissing_barcode=1,cordova.plugins.barcodeScanner.scan(function(e){e.cancelled||c.val(e.text)},function(e){console.log(e)})})},e}(EC.BranchInputTypes);var EC=EC||{};EC.BranchInputTypes=EC.BranchInputTypes||{},EC.BranchInputTypes=function(e){"use strict";return e.checkbox=function(e,t){var n,o=$("div#branch-checkbox span.label"),r=($("div#branch-checkbox div.clone"),e),a=t,i="",s="",l="";o.text(a.label),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),1===parseInt(a.is_primary_key,10)?o.attr("data-primary-key","true"):o.attr("data-primary-key",""),n=1===parseInt(a.has_double_check,10)?!0:!1,!window.localStorage.branch_edit_mode||"1"!==a.is_primary_key&&"1"!==a.has_jump||(s='disabled="disabled"'),$(a.options).each(function(e){var t,n,o=this.value.trim(),a=this.label.trim(),c="checkbox-choice-"+(e+1);for(t=0,n=r.length;n>t;t++)if(i="",r[t]===o){i='checked="checked"';break}l+="<label>",l+='<input type="checkbox" '+i+" "+s+' name="'+a,l+='" id="'+c,l+='" value="'+o,l+='" />'+a,l+="</label>"}),o.append(l),$("div#branch-input-checkbox").trigger("create")},e}(EC.BranchInputTypes);var EC=EC||{};EC.BranchInputTypes=EC.BranchInputTypes||{},EC.BranchInputTypes=function(e){"use strict";return e.date=function(e,t){var n,o,r,a=$("div#branch-date span.label"),i=($("div#branch-date div.clone"),e),s=t;a.text(s.label+" - "+s.datetime_format),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),1===parseInt(s.is_primary_key,10)?a.attr("data-primary-key","true"):a.attr("data-primary-key",""),r=1===parseInt(s.has_double_check,10)?!0:!1,n=$("div#branch-input-date input.nativedatepicker"),o=$("div#branch-input-date input.ios-date"),o.parent().addClass("no-border"),n.attr("data-raw-date",new Date),n.val(i===s.datetime_format?EC.Utils.parseDate(new Date,s.datetime_format):i),window.device.platform===EC.Const.ANDROID&&n.off().on("focus",function(e){var t=$(this),n=new Date(t.attr("data-raw-date"));window.plugins.datePicker.show({date:n,mode:"date",allowOldDates:!0},function(e){var n;void 0!==e&&(n=new Date(e),t.val(EC.Utils.parseDate(n,s.datetime_format)),t.attr("data-raw-date",n)),t.blur()})}),window.device.platform===EC.Const.IOS&&(n.off().on("vclick",function(e){o.focus()}),o.off().on("blur",function(e){var t=o.val();n.val(EC.Utils.parseIOSDate(t,s.datetime_format)),n.attr("data-raw-date",t)}))},e}(EC.BranchInputTypes);var EC=EC||{};EC.BranchInputTypes=EC.BranchInputTypes||{},EC.BranchInputTypes=function(e){"use strict";return e.decimal=function(e,t){var n,o=$("span.label"),r=$("div.clone"),a=e,i=t,s=$("span.min-range"),l=$("span.max-range");o.text(i.label),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),1===parseInt(i.is_primary_key,10)?o.attr("data-primary-key","true"):o.attr("data-primary-key",""),n=1===parseInt(i.has_double_check,10)?!0:!1,$("div#branch-input-decimal input").removeAttr("disabled"),r.addClass("hidden"),s.addClass("hidden"),l.addClass("hidden"),n&&(r.removeClass("hidden"),$("div.clone input").val(a),window.localStorage.branch_edit_mode&&1===i.is_primary_key&&$("div.clone input").attr("disabled","disabled")),""!==i.min_range&&(s.removeClass("hidden"),s.text("Min: "+i.min_range)),""!==i.max_range&&(l.removeClass("hidden"),l.text("Max: "+i.max_range)),$("div#input-decimal input").val(a),window.localStorage.branch_edit_mode&&1===i.is_primary_key?($("div#branch-input-decimal input").attr("disabled","disabled"),$("div#branch-input-decimal p.primary-key-not-editable").removeClass("hidden")):$("div#branch-input-decimal p.primary-key-not-editable").addClass("hidden")},e}(EC.BranchInputTypes);var EC=EC||{};EC.BranchInputTypes=EC.BranchInputTypes||{},EC.BranchInputTypes=function(e){"use strict";return e.dropdown=function(e,t){var n,o=$("div#branch-select span.label"),r=($("div.clone"),e),a=t,i="",s="",l="";o.text(a.label),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),1===parseInt(a.is_primary_key,10)?o.attr("data-primary-key","true"):o.attr("data-primary-key",""),n=1===parseInt(a.has_double_check,10)?!0:!1,!window.localStorage.branch_edit_mode||"1"!==a.is_primary_key&&"1"!==a.has_jump||(i='disabled="disabled"'),s=""===r?"selected":"",l+='<select id="selection" name="selection" data-native-menu="true" >',l+='<option value ="0"'+s+">"+EC.Const.NO_OPTION_SELECTED+"</option>",$(a.options).each(function(e){var t=this.value,n=e+1,o=this.label;s=r===t?"selected":"",l+="<option "+s+" "+i+' value ="'+t+'" data-index="'+n+'">'+o+"</option>"}),l+="</select>",o.append(l),$("div#branch-input-dropdown").trigger("create"),$("select").on("vmousedown",function(e){$(this).focus().click()})},e}(EC.BranchInputTypes);var EC=EC||{};EC.BranchInputTypes=EC.BranchInputTypes||{},EC.BranchInputTypes=function(e){"use strict";return e.integer=function(e,t){var n,o=$("div#branch-integer span.label"),r=$("div.clone"),a=parseInt(e,10),i=t,s=$("div#branch-input-integer span.min-range"),l=$("div#branch-input-integer span.max-range"),c=$("div#branch-input-integer input");o.text(i.label),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),1===parseInt(i.is_primary_key,10)?o.attr("data-primary-key","true"):o.attr("data-primary-key",""),n=1===parseInt(i.has_double_check,10)?!0:!1,c.removeAttr("disabled"),window.device.platform===EC.Const.IOS&&$("div#branch-input-integer input").attr("pattern","[0-9]*"),r.addClass("hidden"),s.addClass("hidden"),l.addClass("hidden"),n&&(r.removeClass("hidden"),$("div.clone input").val(a),window.localStorage.branch_edit_mode&&1===i.is_primary_key&&$("div.clone input").attr("disabled","disabled")),""!==i.min_range&&(s.removeClass("hidden"),s.text("Min: "+i.min_range)),""!==i.max_range&&(l.removeClass("hidden"),l.text("Max: "+i.max_range)),c.val(a),window.localStorage.branch_edit_mode&&1===i.is_primary_key?(c.attr("disabled","disabled"),$("div#branch-input-integer p.primary-key-not-editable").removeClass("hidden")):$("div#branch-input-integer p.primary-key-not-editable").addClass("hidden")},e}(EC.BranchInputTypes);var EC=EC||{};EC.BranchInputTypes=EC.BranchInputTypes||{},EC.BranchInputTypes=function(e){"use strict";return e.location=function(e,t){function n(){$(p).find("span").text(Math.floor(location.accuracy)),$(p).removeClass("hidden"),$(C).removeClass("hidden"),EC.Notification.hideProgressDialog(),E.val("Latitude: "+location.latitude+",\nLongitude: "+location.longitude+",\nAltitude: "+location.altitude+",\nAccuracy: "+location.accuracy+",\nAltitude Accuracy: "+location.altitude_accuracy+",\nHeading: "+location.heading+"\n"),EC.Utils.isChrome()||EC.Notification.showToast(EC.Localise.getTranslation("location_acquired"),"short"),u.one("vclick",_)}function o(){console.log("requestPosition called"),c?r=navigator.geolocation.watchPosition(h,f,{maximumAge:0,timeout:d,enableHighAccuracy:!0}):(r=navigator.geolocation.watchPosition(h,f,{maximumAge:0,timeout:d,enableHighAccuracy:!0}),window.setTimeout(function(){window.navigator.geolocation.clearWatch(r),n(),console.log("setTimeout called")},3e3))}var r,a=$("span.label"),i=e,s=t,l=[],c=!0,d=window.device.platform===EC.Const.IOS?1/0:3e4;a.text(s.label),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE);var u=$("div#branch-location div#branch-input-location div#branch-set-location"),E=$("textarea#branch-set-location-result"),p=$("div#branch-location  div#branch-input-location div.current-accuracy-result"),C=$("div#branch-location  div#branch-input-location div.location-accuracy-tip");$(p).addClass("hidden"),$(C).addClass("hidden"),E.val(i);var _=function(){u.off("vclick"),l=[],$.when(EC.Utils.isGPSEnabled()).then(function(){EC.Notification.showProgressDialog(EC.Localise.getTranslation("locating"),EC.Localise.getTranslation("wait")),window.device.platform===EC.Const.ANDROID&&(EC.Const.KITKAT_REGEX.test(window.device.version)||EC.Const.LOLLIPOP_REGEX||EC.Utils.sleep(2e3)),o()},function(){console.log("gps NOT enabled"),EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("gps_disabled"))})},h=function(e){console.log("onGCPSuccess called, accuracy: "+e.coords.accuracy),location.latitude=null===e.coords.latitude?"":e.coords.latitude,location.longitude=null===e.coords.longitude?"":e.coords.longitude,location.altitude=null===e.coords.altitude?"":e.coords.altitude,location.accuracy=null===e.coords.accuracy?"":e.coords.accuracy,location.altitude_accuracy=null===e.coords.altitudeAccuracy?"":e.coords.altitudeAccuracy,location.heading=null===e.coords.heading?"":e.coords.heading},f=function(e){var t="";window.navigator.geolocation.clearWatch(r),EC.Notification.hideProgressDialog(),console.log(JSON.stringify(e)),3===e.code?EC.Notification.showAlert(EC.Localise.getTranslation("error"),e.message+EC.Localise.getTranslation("location_fail")):1===e.code?window.device.platform===EC.Const.IOS&&EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("location_service_fail")):EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("unknow_error")),E.val("Latitude: "+t+",\nLongitude: "+t+",\nAltitude: "+t+",\nAccuracy: "+t+",\nAltitude Accuracy: "+t+",\nHeading: "+t+"\n"),u.one("vclick",_)};u.off().one("vclick",_)},e}(EC.BranchInputTypes);var EC=EC||{};EC.BranchInputTypes=EC.BranchInputTypes||{},EC.BranchInputTypes=function(e){"use strict";var t;return e.photo=function(e,n){var o,r=$("div#branch-photo span.label"),a=e,i=n,s=$("div#branch-input-photo div#camera-btn"),l=$("div#branch-input-photo input#stored-image-uri"),c=$("div#branch-input-photo input#cached-image-uri"),d=$("div#branch-input-photo #canvas-portrait"),u=$("div#branch-input-photo #canvas-landscape"),E=$("div#branch-input-photo #canvas-portrait")[0],p=$("div#branch-input-photo #canvas-landscape")[0],C=E.getContext("2d");C.clearRect(0,0,E.width,E.height);var _=p.getContext("2d");_.clearRect(0,0,p.width,p.height),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),EC.Const.IOS,$("div#canvas-wrapper").off().on("vclick",function(e){var n=$("div#branch-input-photo input#cached-image-uri").val(),o=$("#branch-photo-popup");if(console.log(n),""===n&&(n=t+$("div#branch-input-photo input#stored-image-uri").val()),window.device)switch(window.device.platform){case EC.Const.ANDROID:e.preventDefault(),$.swipebox([{href:n}]);break;case EC.Const.IOS:o.find("img").attr("src",n),window.setTimeout(function(){o.popup("open")},100),$(window).on("orientationchange",function(e){console.log("called orientationchange"),o.popup("close")})}});var h=function(e){var t,n=new Image,o=e;n.src=o,n.onerror=function(){console.log("Image failed!")},n.onload=function(){console.log("on load called");var e,n,o,r=this.width,a=this.height;a>r?(o=E,n=188,e=250,u.addClass("hidden"),d.removeClass("hidden")):(o=p,n=250,e=188,d.addClass("hidden"),u.removeClass("hidden")),t=o.getContext("2d"),t.clearRect(0,0,o.width,o.height),t.save(),t.imageSmoothingEnabled=!1,t.drawImage(this,0,0,n,e),t.restore()},console.log(JSON.stringify(o))};if(u.addClass("hidden"),d.addClass("hidden"),s.off("vclick"),r.text(i.label),window.localStorage.branch_edit_mode?void 0===a.stored?(l.val(a),a={cached:"",stored:a}):l.val(a.stored):l.val(""),console.log("value.stored "+JSON.stringify(a.stored)),c.val(a.cached||""),console.log("cache_image_uri: "+c.val()),""===a.cached){if(console.log("cached value empty"),""!==a.stored){switch(window.device.platform){case EC.Const.ANDROID:o=EC.Const.ANDROID_APP_PRIVATE_URI+EC.Const.PHOTO_DIR+window.localStorage.project_name+"/"+a.stored,t=EC.Const.ANDROID_APP_PRIVATE_URI+EC.Const.PHOTO_DIR+window.localStorage.project_name+"/";break;case EC.Const.IOS:o=EC.Const.IOS_APP_PRIVATE_URI+EC.Const.PHOTO_DIR+window.localStorage.project_name+"/"+a.stored,t="file://"+EC.Const.IOS_APP_PRIVATE_URI+EC.Const.PHOTO_DIR+window.localStorage.project_name+"/"}console.log("image_full_path_uri: "+o),h(o)}}else h(a.cached);var f=Camera.PictureSourceType.CAMERA,v={quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:f,encodingType:Camera.EncodingType.JPEG,mediaType:Camera.MediaType.PICTURE,correctOrientation:!0,saveToPhotoAlbum:!1,targetWidth:1024,targetHeight:768};s.on("vclick",function(){navigator.camera.getPicture(m,g,v)});var m=function(e){console.log("image_uri: "+e);var t=e;h(t),console.log("image uri is"+t),$("div#branch-input-photo input#cached-image-uri").val(t)},g=function(e){console.log("Error","Failed because: "+e)}},e}(EC.BranchInputTypes);var EC=EC||{};EC.BranchInputTypes=EC.BranchInputTypes||{},EC.BranchInputTypes=function(e){"use strict";return e.radio=function(e,t){var n=$("div#branch-radio div#branch-input-radio span.label"),o=e,r=t,a="",i="",s="";n.text(r.label),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),1===parseInt(r.is_primary_key,10)?n.attr("data-primary-key","true"):n.attr("data-primary-key",""),!window.localStorage.branch_edit_mode||"1"!==r.is_primary_key&&"1"!==r.has_jump||(s='disabled="disabled"'),a+='<fieldset data-role="controlgroup">',$(r.options).each(function(e){var t=this.value,n=e+1,r=this.label,l="radio-choice-"+(e+1);i=o===t?'checked="checked"':"",a+='<input type="radio" name="radio-options" id="'+l+'" value="'+t+'"'+i+" "+s+' data-index="'+n+'">',a+='<label for="'+l+'">'+r+"</label>"}),a+="</fieldset>",n.append(a),$("div#branch-input-radio").trigger("create")},e}(EC.BranchInputTypes);var EC=EC||{};EC.BranchInputTypes=EC.BranchInputTypes||{},EC.BranchInputTypes=function(e){"use strict";return e.text=function(e,t){var n,o=$("div#branch-text div#branch-input-text span.label"),r=$("div#branch-text div#branch-input-text div.clone"),a=e,i=t;return o.text(i.label),1===parseInt(i.is_primary_key,10)?o.attr("data-primary-key","true"):o.attr("data-primary-key",""),n=1===parseInt(i.has_double_check,10)?!0:!1,$("div#branch-input-text input").removeAttr("disabled"),n?(r.removeClass("hidden"),$("div.clone input").val(a),console.log(typeof i.is_primary_key),console.log(typeof i.has_jump),window.localStorage.branch_edit_mode&&1===i.is_primary_key&&$("div.clone input").attr("disabled","disabled")):r.addClass("hidden"),$("div#branch-input-text input").val(a),1===i.is_genkey&&""===a?void $("div#branch-input-text input").attr("disabled","disabled").val(EC.Utils.getGenKey()):void(window.localStorage.branch_edit_mode&&1===i.is_primary_key?($("div#branch-input-text input").attr("disabled","disabled"),$("div#branch-input-text p.primary-key-not-editable").removeClass("hidden")):$("div#branch-input-text p.primary-key-not-editable").addClass("hidden"))},e}(EC.BranchInputTypes);var EC=EC||{};EC.BranchInputTypes=EC.BranchInputTypes||{},EC.BranchInputTypes=function(e){"use strict";return e.textarea=function(e,t){var n,o=$("span.label"),r=$("div.clone"),a=e,i=t;o.text(i.label),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),1===parseInt(i.is_primary_key,10)?o.attr("data-primary-key","true"):o.attr("data-primary-key",""),n=1===parseInt(i.has_double_check,10)?!0:!1,$("div#branch-input-textarea textarea").removeAttr("disabled"),n?(r.removeClass("hidden"),$("div.clone textarea").val(a),window.localStorage.branch_edit_mode&&1===i.is_primary_key&&$("div.clone textarea").attr("disabled","disabled")):r.addClass("hidden"),$("div#branch-input-textarea textarea").val(a),window.localStorage.branch_edit_mode&&1===i.is_primary_key?($("div#branch-input-textarea textarea").attr("disabled","disabled"),$("div#branch-input-textarea p.primary-key-not-editable").removeClass("hidden")):$("div#branch-input-textarea p.primary-key-not-editable").addClass("hidden")},e}(EC.BranchInputTypes);var EC=EC||{};EC.BranchInputTypes=EC.BranchInputTypes||{},EC.BranchInputTypes=function(e){"use strict";return e.time=function(e,t){var n,o,r,a=$("div#branch-input-time span.label"),i=($("div.clone"),e),s=t;a.text(s.label+" - "+s.datetime_format),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),1===parseInt(s.is_primary_key,10)?a.attr("data-primary-key","true"):a.attr("data-primary-key",""),r=1===parseInt(s.has_double_check,10)?!0:!1,n=$("div#branch-input-time input.nativedatepicker"),o=$("div#branch-input-time input.ios-time"),o.parent().addClass("no-border"),n.val(s.datetime_format===s.default_value?EC.Utils.parseTime(new Date,s.datetime_format):i),window.device.platform===EC.Const.ANDROID&&n.off().on("focus",function(e){var t=$(this),n=Date.parse(t.val())||new Date;window.plugins.datePicker.show({date:n,mode:"time",allowOldDates:!0},function(e){var n;void 0!==e&&(n=new Date(e),t.val(EC.Utils.parseTime(n,s.datetime_format))),t.blur()})}),window.device.platform===EC.Const.IOS&&(n.off().on("vclick",function(e){o.focus()}),o.off().on("blur",function(e){var t=o.val(),r=new Date(e.timeStamp),a=r.getSeconds();t=t+":"+a,n.val(EC.Utils.parseIOSTime(t,s.datetime_format)),n.attr("data-raw-date",t)}))},e}(EC.BranchInputTypes);var EC=EC||{};EC.BranchInputTypes=EC.BranchInputTypes||{},EC.BranchInputTypes=function(e){"use strict";return e.video=function(e,t){var n,o,r,a=$("div#branch-video div#branch-input-video span.label"),i=e,s=t,l=$("div#branch-video div#branch-input-video div#video-btn"),c=$("div#branch-video div#branch-input-video div#play-video-btn"),d=$("div#branch-video div#branch-input-video input#stored-video-uri"),u=$("div#branch-video div#branch-input-video input#cached-video-uri"),E=$("div#branch-input-video div#ios-video-player-wrapper"),p=$("div#branch-input-video video#ios-video-player"),C=function(e){c.attr("data-video-path",e),c.removeClass("ui-disabled")};if(window.device.platform===EC.Const.IOS&&$(c,E).addClass("hidden"),a.text(s.label),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),window.localStorage.edit_mode&&(void 0===i.stored?(d.val(i),i={cached:"",stored:i}):d.val(i.stored)),console.log("value.stored "+JSON.stringify(i.stored)),u.val(i.cached||""),console.log("cache_video_uri: "+u.val()),""===i.cached)if(console.log("cached value empty"),""!==i.stored)switch(window.device.platform){case EC.Const.ANDROID:n=EC.Const.ANDROID_APP_PRIVATE_URI+EC.Const.VIDEO_DIR+window.localStorage.project_name+"/"+i.stored,EC.Notification.showProgressDialog(),$.when(EC.File.copyVideo(n)).then(function(e){u.val(e),c.attr("data-video-path",e),c.removeClass("ui-disabled"),EC.Notification.hideProgressDialog()});break;case EC.Const.IOS:n=EC.Const.IOS_APP_PRIVATE_URI+EC.Const.VIDEO_DIR+window.localStorage.project_name+"/"+i.stored,p.attr("src",n),parseFloat(window.device.version)>=8&&p.load(),E.removeClass("hidden")}else c.addClass("ui-disabled"),E.addClass("hidden");else switch(window.device.platform){case EC.Const.ANDROID:C(i.cached);break;case EC.Const.IOS:E.removeClass("hidden")}window.device.platform===EC.Const.IOS?window.requestFileSystem(LocalFileSystem.TEMPORARY,0,function(e){console.log(JSON.stringify(e)),o=e.root.nativeURL,console.log("nativeURL: "+o)},function(e){console.log(JSON.stringify(e))}):window.resolveLocalFileSystemURL(cordova.file.externalCacheDirectory,function(e){console.log(JSON.stringify(e)),o=e.nativeURL,console.log("nativeURL: "+o)},function(e){console.log(JSON.stringify(e))});var _=function(e){var t=$("div#branch-video div#branch-input-video input#cached-video-uri");console.log(JSON.stringify(e[0])),r=e[0].fullPath,EC.Notification.showProgressDialog(),$.when(EC.File.moveVideo(r,t.val())).then(function(e){window.device.platform===EC.Const.IOS&&(E.removeClass("hidden"),window.requestFileSystem(LocalFileSystem.TEMPORARY,0,function(n){var o=n.root.nativeURL,r=o+"/"+e;p.attr("src",r),t.val(e),EC.Notification.hideProgressDialog()},function(e){console.log(JSON.stringify(e)),EC.Notification.hideProgressDialog()})),window.device.platform===EC.Const.ANDROID&&(t.val(e),c.attr("data-video-path",e),c.removeClass("ui-disabled"),EC.Notification.hideProgressDialog())})},h=function(e){console.log(e.message)};c.off().on("vclick",function(){var e=$(this).attr("data-video-path");window.device.platform===EC.Const.IOS?window.requestFileSystem(LocalFileSystem.TEMPORARY,0,function(t){var n=t.root.nativeURL,o=n+"/"+e;window.plugins.videoPlayer.play(o)},function(e){console.log(JSON.stringify(e))}):window.resolveLocalFileSystemURL(cordova.file.externalCacheDirectory,function(t){var n=t.nativeURL,o=n+"/"+e;window.plugins.videoPlayer.play(o)},function(e){console.log(JSON.stringify(e))})}),l.off().on("vclick",function(){var e={limit:1};navigator.device.capture.captureVideo(_,h,e)})},e}(EC.BranchInputTypes);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.getCachedInputValue=function(e){var t,n,o,r=parseInt(e,10),a=r-1,i={_id:"",type:"",value:EC.Const.SKIPPED,position:"",is_primary_key:""};try{if(t=JSON.parse(window.localStorage.branch_inputs_values),void 0===t[a])return i;for(o=t.length,n=0;o>n;n++)if(null===t[n]&&(t[n]=i),parseInt(t[n].position,10)===r)return window.localStorage.branch_edit_mode&&(window.localStorage.branch_edit_id=t[n]._id,window.localStorage.branch_edit_type=t[n].type),t[n];return i}catch(s){return console.log(s),!1}},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.getCloneValue=function(e){var t,n=e;switch(n){case EC.Const.TEXT:t=$("div.clone input#branch-text-clone").val();break;case EC.Const.TEXTAREA:t=$("div.clone textarea#branch-textarea-clone").val();break;case EC.Const.INTEGER:t=$("div.clone input#branch-integer-clone").val();break;case EC.Const.DECIMAL:t=$("div.clone input#branch-decimal-clone").val();break;case EC.Const.BARCODE:t=$("div#branch-input-barcode div.clone input#scan-result-confirm").val()}return t.trim()},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.getCurrentValue=function(e){var t,n,o,r=e,a=[],i=[];switch(r){case EC.Const.TEXT:a.push($("div#branch-input-text input").val()),n=a[0].trim();break;case EC.Const.TEXTAREA:a.push($("div#branch-input-textarea textarea").val()),n=a[0].trim();break;case EC.Const.INTEGER:a.push($("div#branch-input-integer input").val()),n=a[0].trim();break;case EC.Const.DECIMAL:a.push($("div#branch-input-decimal input#decimal-main").val()),n=a[0].trim();break;case EC.Const.DATE:a.push($("div#branch-input-date input").val()),n=a[0];break;case EC.Const.TIME:a.push($("div#branch-input-time input").val()),n=a[0];break;case EC.Const.RADIO:o=$("div#branch-input-radio input[type=radio]:checked"),t={value:"",index:""},t.value=o.val(),t.index=o.attr("data-index"),void 0===t.value?(t.value=EC.Const.NO_OPTION_SELECTED,t.index=EC.Const.NO_OPTION_SELECTED):(t.value.trim(),t.index.trim()),a.push(t),n=a[0];break;case EC.Const.CHECKBOX:$("div#branch-input-checkbox input[type=checkbox]:checked").each(function(){i.push({value:$(this).val().trim(),label:$(this).parent().text().trim()})}),a.push(0===i.length?EC.Const.NO_OPTION_SELECTED:i),n=a[0];break;case EC.Const.DROPDOWN:o=$("div#branch-input-dropdown select option:selected"),t={value:"",index:""},t.value=o.val(),t.index=o.attr("data-index"),"0"===t.index&&(t.index=EC.Const.NO_OPTION_SELECTED),a.push(t),n=a[0];break;case EC.Const.BARCODE:t=$("div#branch-input-barcode input.scan-result").val(),a.push(t),n=a[0];break;case EC.Const.LOCATION:t=$("div#branch-input-location textarea#branch-set-location-result").val(),a.push(t),n=a[0];break;case EC.Const.AUDIO:t=EC.Utils.isChrome()?{cached:"...audio cached  uri...",stored:"...audio stored uri..."}:{cached:$("div#branch-input-audio input#cached-audio-uri").val(),stored:$("div#branch-input-audio input#stored-audio-uri").val()},a.push(t),n=a[0];break;case EC.Const.VIDEO:EC.Utils.isChrome()?t={cached:"...video cached  uri...",stored:"...video stored uri..."}:(console.log("getting video file values"),t={cached:$("div#branch-input-video input#cached-video-uri").val(),stored:$("div#branch-input-video input#stored-video-uri").val()},console.log("current_value "+JSON.stringify(t))),a.push(t),n=a[0];break;case EC.Const.PHOTO:EC.Utils.isChrome()?t={cached:"placeholder.jpg",stored:"placeholder.jpg"}:(t={cached:$("div#branch-input-photo input#cached-image-uri").val(),stored:$("div#branch-input-photo input#stored-image-uri").val()},console.log("current_value "+JSON.stringify(t))),a.push(t),n=a[0]}return n},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.isEmptyPrimaryKey=function(){var e,t,n=!0,o=JSON.parse(window.localStorage.branch_inputs_values);if(o)for(t=o.length,e=0;t>e;e++)1===o[e].is_primary_key&&(n=""===o[e].value?!0:!1);return n},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";return e.setCachedInputValue=function(e,t,n,o){var r,a,i,s,l,c=window.localStorage,d=e,u=[],E=t,p=E-1,C=o,_=EC.Utils.isBranchFormGenKeyHidden();if(c.branch_edit_mode?(i=c.branch_edit_id,a=c.branch_edit_type):(i="",a=n),(a===EC.Const.DROPDOWN||a===EC.Const.RADIO)&&(d=d.value),a===EC.Const.CHECKBOX&&d!==EC.Const.NO_OPTION_SELECTED){for(l=d.length,s=0;l>s;s++)u.push(d[s].value);d=u}try{r=JSON.parse(c.branch_inputs_values)}catch(h){r=[]}null!==r[p]&&p<r.length&&1===r[p].is_primary_key&&1===_?d=r[p].value:r[p]={_id:i,type:a,value:d,position:E,is_primary_key:C},c.branch_inputs_values=JSON.stringify(r),console.log("branch_input_values: "+c.branch_inputs_values,!0)},e}(EC.BranchInputs);var EC=EC||{};EC.BranchInputs=EC.BranchInputs||{},EC.BranchInputs=function(e){"use strict";var t=function(e,t){var n,o,r,a,i=e,s=t,l=!0;try{n=JSON.parse(window.localStorage.cached_branch_entry_keys)}catch(c){n=[]}if(a=n.length,a>0)for(r=0;a>r;r++)n[r].branch_form_name===s&&(o=n[r].primary_keys,-1!==o.indexOf(i)&&(l=!1));return l};return e.validateValue=function(e,n,o){var r=this,a=e,i=n,s="",l=$("span.label").attr("data-primary-key"),c={};return 1===parseInt(a.has_double_check,10)&&(s=r.getCloneValue(a.type)),c=EC.Utils.isValidValue(a,i,s),c.is_valid?"true"!==l||window.localStorage.branch_edit_mode||t(i)?c:(c={is_valid:!1,message:"Value already exists!"},console.log("Error: value already exists"),c):c},e}(EC.BranchInputs);var EC=EC||{};EC.Download=EC.Download||{},EC.Download=function(){"use strict";function e(t){$.when(EC.Create.commitRemoteEntry(o,r,t)).then(function(){0===s.length?0===l.length?(EC.Notification.showToast("All data downloaded","short"),window.device.platform===EC.Const.IOS&&window.ActivityIndicator.hide(),window.localStorage.removeItem("dre_local_entries_keys"),window.localStorage.removeItem("dre_inputs"),EC.Routing.changePage(window.localStorage.back_nav_url)):(s=l.splice(0,500),e(s.shift())):e(s.shift())},function(){var e=EC.Utils.getParentFormByChildID(a);EC.Notification.hideProgressDialog(),EC.Notification.showAlert("Error","Parent keys for "+i+" are missing on device database, please download "+e.name+" entries first")})}var t,n,o,r,a,i,s,l,c=function(t){var n=t;$.ajax({url:n,type:"get",crossDomain:!0,timeout:6e4,dataType:"json",success:function(t){l=t,0===l.length?EC.Notification.showAlert("Sorry","No remote entries for the selected form yet!"):(s=l.splice(0,500),e(s.shift()))},error:function(e,t,n){EC.Notification.hideProgressDialog(),e.responseText&&"<"===e.responseText.trim().charAt(0)&&EC.Notification.showAlert("Sorry, private project","This project is set as private therefore you cannot download data"),"timeout"===t&&"timeout"===n&&EC.Notification.showAlert("Error","Server Timeout"),console.log(t+", "+n),console.log(e)}})},d=function(){EC.Notification.showProgressDialog(),c(t+n+"/"+i+".json")},u=function(){var e,s,l,c,d=JSON.parse(window.localStorage.forms),u=d.length,E=u,p="",C=$("div#download div#download-forms"),_=($("#download"),$("div#download div[data-role='header'] div[data-href='back-btn']"));o=window.localStorage.project_id,n=window.localStorage.project_name,t=window.localStorage.project_server_url,window.localStorage.back_nav_url="forms.html?project="+o+"&name="+n;var h=function(){i=$(this).find("span").text(),a=$(this).attr("id"),c=EC.Utils.getParentAndChildForms(a),window.localStorage.form_tree=JSON.stringify(c),r=a,EC.Notification.askConfirm("Download remote data","Are you sure to proceed? It might take some time","EC.Download.fetchRemoteData")};for(_.off().one("vclick",function(e){EC.Routing.changePage(window.localStorage.back_nav_url)}),e=0;u>e;e++)p+='<div id="'+d[e]._id+'" class="embedded-btn">',p+='<i class="fa fa-download  fa-fw fa-ep-embedded-btn"></i>',p+='<span class="v-nav-item-label">'+d[e].name+"</span>",p+="</div>";for(C.append(p),s=0;E>s;s++)l=$("div#download div#download-forms div#"+d[s]._id),l.off().on("vclick",h)};return{fetchRemoteData:d,renderDownloadView:u}}();var EC=EC||{};EC.Entries=EC.Entries||{},EC.Entries=function(e){"use strict";return e.getBranchEntriesList=function(){var e=EC.Inputs.getPrimaryKeyRefPosition(),t=EC.Inputs.getMainFormCurrentKeyValue(e),n=parseInt(window.localStorage.project_id,10),o=JSON.parse(window.localStorage.branch_form);$.when(EC.Select.getBranchEntries(n,o.name,t,0)).then(function(e){e.length>0?EC.Entries.renderBranchEntriesList(e):EC.BranchInputs.backToHierarchyForm()})},e}(EC.Entries);var EC=EC||{};EC.Entries=EC.Entries||{},EC.Entries=function(e){"use strict";return e.getBranchEntryValues=function(e){var t=e.split("?"),n=(window.localStorage.is_child_form_nav,t[1].split("&")),o=n[0].replace("branch_form_name=",""),r=n[1].replace("entry_key=",""),a=window.localStorage.project_id,i=EC.Inputs.getPrimaryKeyRefPosition(),s=EC.Inputs.getMainFormCurrentKeyValue(i);

window.localStorage.branch_entry_values_url="branch-entry-values.html?branch_form_name="+o+"&entry_key="+r,$.when(EC.Select.getBranchEntryValues(a,o,r,s)).then(function(e){$.when(EC.Select.getBranchInputs(o,a)).then(function(t,n){EC.BranchInputs.setInputs(t,n),EC.Entries.renderBranchEntryValues(e),window.localStorage.removeItem("branch_has_new_jump_sequence")})})},e}(EC.Entries);var EC=EC||{};EC.Entries=EC.Entries||{},EC.Entries=function(e){"use strict";return e.getEntryValues=function(e){var t,n,o,r,a=e.split("?"),i=window.localStorage,s=[],l=(i.is_child_form_nav,a[1].split("&")),c=l[0].replace("form=",""),d=l[1].replace("entry_key=",""),u=l[2].replace("direction=",""),E=(i.form_name,JSON.parse(i.form_tree));r=e.split("/"),i.current_view_url=r[r.length-1],i.entry_key=d,i.back_edit_nav_url="entry-values.html?form="+c+"&entry_key="+d+"&direction="+EC.Const.EDITING;try{t=l[3].replace("parent=",""),i.removeItem("breadcrumbs")}catch(p){t="",console.log(p)}try{s=JSON.parse(i.breadcrumbs)}catch(C){s=[]}switch(o=i.parent_path,n=void 0===o?""===s[0]?s.join(EC.Const.ENTRY_ROOT_PATH_SEPARATOR).substring(1):s.join(EC.Const.ENTRY_ROOT_PATH_SEPARATOR):o,u){case EC.Const.FORWARD:s.push(d);break;case EC.Const.BACKWARD:s.pop();break;case EC.Const.EDITING:console.log("back from editing");break;case EC.Const.VIEW:s.push(d)}i.setItem("breadcrumbs",JSON.stringify(s)),E=EC.Utils.getParentAndChildForms(c),""!==t&&(n=""===n?t:t+EC.Const.ENTRY_ROOT_PATH_SEPARATOR+n),n===d&&(n="",s=JSON.parse(i.breadcrumbs),s.pop(),i.setItem("breadcrumbs",JSON.stringify(s))),i.removeItem("parent_path"),$.when(EC.Select.getEntryValues(c,d,n)).then(function(e){$.when(EC.Select.getInputs(c)).then(function(t,n){EC.Inputs.setInputs(t,n),EC.Entries.renderEntryValues(e)})})},e}(EC.Entries);var EC=EC||{};EC.Entries=EC.Entries||{},EC.Entries=function(e){"use strict";return e.getList=function(e){var t,n,o,r,a,i,s,l,c,d,u=[],E=[],p=0,C=0,_=0,h=window.localStorage;d=e.split("/"),h.current_view_url=d[d.length-1];var f=e.split("?");switch(c=h.parent_path,n=f[1].split("&"),t=n[0].replace("form=",""),o=n[1].replace("name=",""),a=n[2].replace("entry_key=",""),i=n[3].replace("direction=",""),s=parseInt(n[4].replace("children=",""),10),u=JSON.parse(h.getItem("breadcrumbs"))||u,E=JSON.parse(h.getItem("entries_totals"))||E,i){case EC.Const.FORWARD:u.push(a),E.length===u.length-1&&E.push({form:o,entry_key:a,entries_total:s}),window.localStorage.removeItem("cached_entries_list");break;case EC.Const.BACKWARD:u.pop(),E.pop();break;case EC.Const.EDITING:break;case EC.Const.ADDING:break;case EC.Const.VIEW:u.pop()}h.setItem("breadcrumbs",JSON.stringify(u)),h.setItem("entries_totals",JSON.stringify(E)),r=EC.Utils.getParentAndChildForms(t),h.form_id=t,h.form_name=o,h.form_tree=JSON.stringify(r),r.parent>0&&""===a&&void 0===c||h.is_child_form_nav?(EC.Select.getChildEntries(t,C,_),h.is_child_form_nav=1):(h.removeItem("is_child_form_nav"),c?(console.log(c),l=c):l=""===u[0]?u.join(EC.Const.ENTRY_ROOT_PATH_SEPARATOR).substring(1):u.join(EC.Const.ENTRY_ROOT_PATH_SEPARATOR),h.load_more_parameters=JSON.stringify({form_id:t,parent_path:l}),i===EC.Const.VIEW&&window.localStorage.cached_entries_list?EC.Entries.renderList(JSON.parse(window.localStorage.cached_entries_list)):$.when(EC.Select.getEntries(t,l,p)).then(function(e){EC.Entries.renderList(e)}))},e}(EC.Entries);var EC=EC||{};EC.Entries=EC.Entries||{},EC.Entries=function(e){"use strict";e.unsyncEntry=function(){var e=JSON.parse(window.localStorage.inputs_values),t=parseInt(window.localStorage.project_id,10),n=window.localStorage.entry_key;$.when(EC.Update.unsyncOneHierarchyEntry(e,n,t)).then(function(){$(".entry-values-options").panel("close"),$("div#entry-values div.entry-values-options ul li#unsync-entry").addClass("ui-disabled"),EC.Notification.showToast(EC.Localise.getTranslation("entry_unsynced"),"short")},function(){EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("generic_error"))})},e.unsyncAllEntries=function(){var e=JSON.parse(window.localStorage.forms),t=parseInt(window.localStorage.project_id,10);$.when(EC.Update.unsyncAllEntries(e,t)).then(function(){$("div#forms div#project-options").panel("close"),$("div#forms div#project-options ul li#unsync-all-data").addClass("ui-disabled"),$("div#forms div#project-options ul li#delete-synced-entries").addClass("ui-disabled"),EC.Notification.showToast(EC.Localise.getTranslation("all_data_synced"),"short")},function(){$("div#forms div#project-options").panel("close"),EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("generic_error"))})},e.deleteAllEntries=function(){var e=window.localStorage.project_name;$.when(EC.Delete.deleteAllEntries(EC.Const.DELETE,e)).then(function(){$("div#forms div#project-options ul li#delete-all-entries").addClass("ui-disabled"),$("div#forms div#project-options ul li#delete-synced-entries").addClass("ui-disabled"),$("div#forms div#project-options ul li#delete-media-files").addClass("ui-disabled"),$("div#forms div#project-options ul li#unsync-all-data").addClass("ui-disabled");var e=$("div#forms-list ul li");e.each(function(e){0===e?$(this).find("a").find("span.ui-li-count.ui-btn-up-c.ui-btn-corner-all").text("0"):($(this).addClass("ui-disabled"),$(this).find("a").find("span.ui-li-count.ui-btn-up-c.ui-btn-corner-all").remove())}),$("#project-options").panel("close"),EC.Notification.hideProgressDialog(),EC.Notification.showToast(EC.Localise.getTranslation("all_entries_deleted"),"short")},function(){$("#project-options").panel("close"),EC.Notification.hideProgressDialog(),EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("generic_error"))})},e.deleteAllMedia=function(){var e=window.localStorage.project_name,t=JSON.parse(window.localStorage.forms);EC.Utils.isChrome()?EC.Update.emptyMediaValues(t):$.when(EC.File.deleteAllMedia(e,!1,[EC.Const.PHOTO_DIR,EC.Const.AUDIO_DIR,EC.Const.VIDEO_DIR])).then(function(){EC.Entries.allMediaDeletedFeedback(!0)})},e.allEntriesDeletedFeedback=function(e){},e.allMediaDeletedFeedback=function(e){$("#project-options").panel("close"),EC.Notification.hideProgressDialog(),e?($("div#forms div#project-options ul li#delete-media-files").addClass("ui-disabled"),EC.Notification.showToast(EC.Localise.getTranslation("all_media_deleted"),"short")):EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("generic_error"))},e.deleteAllSynced=function(){var e=JSON.parse(window.localStorage.forms),n=window.localStorage.project_name,o=parseInt(window.localStorage.project_id,10);$.when(EC.Delete.deleteAllSynced(o,n,e)).then(function(){t(!0)},function(){t(!1)})};var t=function(e){var t,n,o=$("div#forms-list ul li"),r=JSON.parse(window.localStorage.deleted_entries);$("#project-options").panel("close"),e?(o.each(function(e){var o;n=$(this).find("a"),t=n.find("span.ui-li-count"),o=parseInt(t.text(),10)-r[e],console.log("new_count"+o),t.text(o),0===o&&e>0&&n.addClass("ui-disabled")}),EC.Notification.showToast(EC.Localise.getTranslation("all_synced_deleted"),"short")):EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("generic_error"))};return e.deleteEntry=function(){var e=JSON.parse(window.localStorage.inputs_values),t=window.localStorage.entry_key,n=window.localStorage.form_id,o=window.localStorage.project_name;window.localStorage.back_nav_url=$('div#entry-values div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab i').attr("data-href"),window.localStorage.removeItem("cached_entries_list"),$.when(EC.Delete.deleteEntry(o,e,t,n)).then(function(e){e?(EC.Notification.showToast(EC.Localise.getTranslation("entry_deleted"),"short"),EC.Routing.changePage(window.localStorage.back_nav_url)):EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("generic"))})},e.deleteBranchEntry=function(){var e=JSON.parse(window.localStorage.branch_inputs_values);$.when(EC.Delete.deleteBranchEntry(e)).then(function(){EC.Notification.showToast(EC.Localise.getTranslation("branch_entry_deleted"),"short"),window.localStorage.removeItem("branch_edit_mode"),EC.Routing.changePage("branch-entries-list.html")},function(){EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("generic"))})},e.addEntry=function(){var e=parseInt(window.localStorage.form_id,10);EC.Notification.showProgressDialog(),$.when(EC.Select.getInputs(e)).then(function(e,t,n){EC.Inputs.setInputs(e,t,n),EC.Inputs.prepareFirstInput(void 0===window.localStorage.edit_position?e[0]:e[window.localStorage.edit_position-1])})},e.exportAllEntriesToCSV=function(){var e=window.localStorage.project_id,t=JSON.parse(window.localStorage.forms);EC.Notification.showProgressDialog(),$.when(EC.Export.saveProjectDataToCSV(e,t)).then(function(e){var t=e.filename,n=e.folder;$("#project-options").panel("close"),EC.Notification.hideProgressDialog(),EC.Notification.showAlert(EC.Localise.getTranslation("success"),t+" saved in folder: "+n)})},e}(EC.Entries);var EC=EC||{};EC.Entries=EC.Entries||{},EC.Entries=function(e){"use strict";var t=function(){var e=$('div[data-role="header"] div[data-href="back-btn"]'),t=$('div[data-role="header"] div[data-href="back-btn"] span.form-name'),n=window.localStorage.form_name;t.text("Back to "+n.trunc(EC.Const.FORM_NAME_MAX_LENGTH)),e.off().one("vclick",function(e){window.localStorage.back_from_branch=1,EC.BranchInputs.backToHierarchyForm()})},n=function(e,t){var n,o=e,r=t,a=r.length,i="";for(n=0;a>n;n++)r[n].full_title=""===r[n].full_title?r[n].entry_key:r[n].full_title,i+='<li data-icon="false">',i+='<a href="branch-entry-values.html?branch_form_name='+o+"&entry_key="+r[n].entry_key+'">',i+=r[n].full_title,i+="</a>",i+="</li>";return i};return e.renderBranchEntriesList=function(e){var o,r,a=this,i=e,s=$("div#branch-entries-list ul"),l=JSON.parse(window.localStorage.branch_form),c=$("div#branch-entries div#branch-entries-list div.more-items-btn"),d=$("div#branch-entries div#branch-entries-list div.more-items-btn-spinner"),u=parseInt(window.localStorage.QUERY_ENTRIES_OFFSET,10),E=parseInt(window.localStorage.QUERY_LIMIT,10);window.localStorage.QUERY_ENTRIES_OFFSET=0,t(),$("div.branch-form-name div.ui-block-a span.ui-btn-active span.ui-btn-inner").text(l.name),o>u+E?c.removeClass("hidden"):c.addClass("hidden"),c.off().on("vclick",function(e){$(this).addClass("hidden"),d.removeClass("hidden"),u=parseInt(window.localStorage.QUERY_ENTRIES_OFFSET,10),u+=parseInt(window.localStorage.QUERY_LIMIT,10),window.localStorage.QUERY_ENTRIES_OFFSET=u,a.getMoreEntries(u)}),s.empty(),r=n(l.name,i),s.append(r),s.listview("refresh"),EC.Notification.hideProgressDialog()},e.getMoreBranchEntries=function(e){var t=JSON.parse(window.localStorage.load_more_parameters),n=t.form_id,o=t.parent_path,r=e;EC.Select.getEntries(n,o,r)},e.appendMoreBranchEntries=function(e){var t,o,r,a=$("div#entries-list ul"),i=e,s=parseInt(window.localStorage.form_id,10),l=parseInt(window.localStorage.QUERY_ENTRIES_OFFSET,10),c=parseInt(window.localStorage.QUERY_LIMIT,10);o=JSON.parse(window.localStorage.entries_totals),r=o[o.length-1].entries_total,t=n(s,i),a.append(t),a.listview("refresh"),a.trigger("updatelayout"),$("div#entries div#entries-list div.more-items-btn-spinner").addClass("hidden"),r>l+c&&$("div#entries div#entries-list div.more-items-btn").removeClass("hidden")},e}(EC.Entries);var EC=EC||{};EC.Entries=function(e){"use strict";var t=function(){{var e=$('div#branch-entry-values div[data-role="header"] div[data-href="back-btn"]'),t=$('div#branch-entry-values div[data-role="header"] div[data-href="back-btn"] span.form-name'),n=$('div#branch-entry-values div[data-role="controlgroup"] i[data-href="branch-entry-values-options"]'),o=$("div#branch-entry-values div#branch-entry-values-options ul li#delete-branch-entry"),r=$("div#branch-entry-values div#branch-entry-values-list ul"),a=(window.localStorage.form_name,JSON.parse(window.localStorage.branch_form)),i=window.localStorage.project_id;$("div#entry-values div#entry-values-options ul li#unsync-entry")}t.text("Back to "+a.name.trunc(EC.Const.FORM_NAME_MAX_LENGTH)+" entries"),e.off().one("vclick",function(e){window.localStorage.removeItem("branch_edit_mode"),EC.Routing.changePage(EC.Const.BRANCH_ENTRIES_LIST_VIEW)}),r.off().on("vclick","i",function(e){var t=$(e.target).parent().attr("data-href");EC.Notification.showProgressDialog(),t&&(window.localStorage.branch_edit_position=parseInt(t.replace("?position=",""),10),EC.BranchInputs.getList(a.name,i)),e.preventDefault()}),o.off().on("vclick",function(e){EC.Notification.askConfirm(EC.Localise.getTranslation("delete_branch_entry"),EC.Localise.getTranslation("delete_entry_confirm"),"EC.Entries.deleteBranchEntry")}),n.off().on("vclick",function(e){var t=$("div#branch-entry-values-options");t.panel("open"),$(".ui-panel-dismiss-open").off().on("vclick",function(){t.panel("close")})})};return e.renderBranchEntryValues=function(e){var n,o,r,a,i,s,l="",c=e,d=[],u=[],E=$("div#branch-entry-values-list ul"),p=(parseInt(window.localStorage.form_id,10),JSON.parse(window.localStorage.branch_form)),C=window.localStorage.allow_download_edits,_=(window.localStorage.project_name,0),h=(EC.Utils.isBranchFormGenKeyHidden(),EC.BranchInputs.getInputs());for(t(),E.empty(),$("div.branch-form-name div.ui-block-a span.ui-btn-active span.ui-btn-inner").text(p.name),n=0,o=c.length;o>n;n++){switch(_+=c[n].is_data_synced,r=c[n].value===c[n].entry_key?1:0,c[n].type){case EC.Const.CHECKBOX:d.push({_id:c[n]._id,type:c[n].type,value:c[n].value.split(","),position:c[n].position,is_primary_key:r});break;case EC.Const.PHOTO:d.push({_id:c[n]._id,type:c[n].type,value:{cached:"",stored:c[n].value},position:c[n].position,is_primary_key:r});break;case EC.Const.AUDIO:d.push({_id:c[n]._id,type:c[n].type,value:{cached:"",stored:c[n].value},position:c[n].position,is_primary_key:r});break;case EC.Const.VIDEO:d.push({_id:c[n]._id,type:c[n].type,value:{cached:"",stored:c[n].value},position:c[n].position,is_primary_key:r});break;default:d.push({_id:c[n]._id,type:c[n].type,value:c[n].value,position:c[n].position,is_primary_key:r})}if(c[n].value!==EC.Const.SKIPPED){switch(u.push({position:c[n].position,label:c[n].label}),l+='<li data-role="list-divider">',l+=c[n].label,l+="</li>",l+='<li class="entry-value-btn-wrapper">',c[n].type){case EC.Const.CHECKBOX:a=EC.Utils.mapLabelToValue(c[n],h),l+='<span class="h-entry-value-label">'+a.join(", ")+"</span>";break;case EC.Const.DROPDOWN:i=EC.Utils.mapLabelToValue(c[n],h),l+='<span class="h-entry-value-label">'+i+"</span>";break;case EC.Const.RADIO:s=EC.Utils.mapLabelToValue(c[n],h),l+='<span class="h-entry-value-label">'+s+"</span>";break;case EC.Const.LOCATION:var f=c[n].value;f=f.split(",");var v,m=f.length;for(v=0;m>v;v++)l+='<span class="h-entry-value-label">'+f[v]+"<span>";break;case EC.Const.PHOTO:l+=""!==c[n].value?'<span class="h-entry-value-label">'+EC.Localise.getTranslation(EC.Const.PHOTO_AVAILABLE_LABEL)+"</span>":'<span class="h-entry-value-label">'+EC.Localise.getTranslation(EC.Const.PHOTO_NOT_AVAILABLE_LABEL)+"</span>";break;case EC.Const.AUDIO:l+=""!==c[n].value?'<span class="h-entry-value-label">'+EC.Localise.getTranslation(EC.Const.AUDIO_AVAILABLE_LABEL)+"</span>":'<span class="h-entry-value-label">'+EC.Localise.getTranslation(EC.Const.AUDIO_NOT_AVAILABLE_LABEL)+"</span>";break;case EC.Const.VIDEO:l+=""!==c[n].value?'<span class="h-entry-value-label">'+EC.Localise.getTranslation(EC.Const.VIDEO_AVAILABLE_LABEL)+"</span>":'<span class="h-entry-value-label">'+EC.Localise.getTranslation(EC.Const.VIDEO_NOT_AVAILABLE_LABEL)+"</span>";break;default:l+='<span class="h-entry-value-label">'+c[n].value+"</span>"}l+='<div class="entry-value-embedded-btn" data-href="?position='+c[n].position+'">',l+=1===c[n].is_remote?"1"===C?'<i class="fa fa-edit  fa-fw fa-ep-entry-value-embedded-btn"></i>':'<i class="fa fa-edit  fa-fw fa-ep-entry-value-embedded-btn ui-disabled"></i>':'<i class="fa fa-edit  fa-fw fa-ep-entry-value-embedded-btn"></i>',l+="</div>",l+="</li>"}}window.localStorage.branch_inputs_values=JSON.stringify(d),window.localStorage.branch_inputs_trail=JSON.stringify(u),E.append(l),E.listview("refresh"),window.localStorage.branch_edit_mode=1,EC.Notification.hideProgressDialog()},e}(EC.Entries);var EC=EC||{};EC.Entries=function(e){"use strict";var t,n=function(){var e=$("div#entries div[data-role='header'] div[data-href='entries-nav-btn']"),n=$("div#entries div[data-role='header'] div[data-href='home']"),o=$('div#entries div[data-role="header"] div#entries-nav-drawer ul li div[data-href="settings"]'),r=$("div#entries div[data-role='header'] i[data-href='add-entry']"),a=$('div#entries div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab');e.off().on("vclick",function(e){var r=$("#entries-nav-drawer");r.panel("open"),n.off().one("vclick",function(e){t.QUERY_ENTRIES_OFFSET=0,t.back_nav_url="#refresh",EC.Routing.changePage(EC.Const.INDEX_VIEW)}),o.off().one("vclick",function(e){window.localStorage.reached_settings_view_from=$.mobile.activePage.attr("id"),EC.Routing.changePage(EC.Const.SETTINGS_VIEW)}),$(".ui-panel-dismiss-open").off().on("vclick",function(){r.panel("close")})}),r.off().on("vclick",function(e){EC.Entries.addEntry()}),a.off().on("vclick",function(e){var n=(t.project_id,t.project_name,$('div#entries div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab i').attr("data-href"));EC.Routing.changePage(n)})};return e.renderCachedList=function(){var e,o,r,a,i,s,l,c,d,u,E="",p=$("div#entries-list ul"),C=($("div#entries div#entries-list div#empty-entries-list"),$("div#entries div#entries-list div#empty-entries-list p span.form-name"),$("#entries"),$('div#entries div[data-role="header"] div[data-href="entries-nav-btn"] span.project-name')),_="",h=($("div#entries a.back-home"),$("div#entries div#entries-actionbar")),f=$('div#entries div[data-role="header"] div[data-role="navbar"] ul li.active-tab span'),v=($('div#entries div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab'),$('div#entries div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab i')),m=$('div#entries div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab span'),g=$("div#entries div#entries-list div.more-items-btn"),w=$("div#entries div#entries-list div.more-items-btn-spinner"),y=this;t=window.localStorage,r=parseInt(t.form_id,10),a=t.form_name,i=JSON.parse(t.form_tree),s=t.project_name,l=parseInt(t.QUERY_ENTRIES_OFFSET,10),c=parseInt(t.QUERY_LIMIT,10),u=JSON.parse(t.entries_totals),d=u[u.length-1].entries_total,e=u.length>1?u[u.length-2].entries_total:0,n(),h.show(),d>l+c?g.removeClass("hidden"):g.addClass("hidden"),g.off().on("vclick",function(e){window.device.platform===EC.Const.IOS&&($(this).addClass("hidden"),w.removeClass("hidden")),window.device.platform===EC.Const.ANDROID&&EC.Notification.showProgressDialog(),l=parseInt(t.QUERY_ENTRIES_OFFSET,10),l+=parseInt(t.QUERY_LIMIT,10),t.QUERY_ENTRIES_OFFSET=l,y.getMoreEntries(l)}),p.empty(),C.text(s.trunc(EC.Const.PROJECT_NAME_MAX_LENGTH)),0===i.parent?(_="Forms",E="forms.html?project="+t.project_id+"&name="+t.project_name):(o=JSON.parse(t.breadcrumbs),_=i.pname+": "+o[o.length-1],E+="entries-list.html?form="+i.parent,E+="&name="+i.pname,E+="&entry_key="+o[o.length-2],E+="&direction="+EC.Const.BACKWARD,E+="&children="+e),f.text(a),m.text(_),v.attr("data-href",E),p.append(window.localStorage.cached_entries_list),t.form_name=a,t.form_id=r,t.removeItem("inputs_values"),t.removeItem("inputs_trail"),t.removeItem("current_position"),t.removeItem("back_edit_nav_url"),t.removeItem("edit_mode"),t.removeItem("edit_position"),t.removeItem("edit_type"),t.removeItem("edit_id"),EC.Notification.hideProgressDialog()},e}(EC.Entries);var EC=EC||{};EC.Entries=EC.Entries||{},EC.Entries=function(e){"use strict";var t,n=function(){var e=$("div#entries div[data-role='header'] div[data-href='entries-nav-btn']"),n=$("div#entries div[data-role='header'] div[data-href='home']"),o=$('div#entries div[data-role="header"] div#entries-nav-drawer ul li div[data-href="settings"]'),r=($("div#entries div[data-role='header'] i[data-href='add-entry']"),$('div#entries div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab'));e.off().on("vclick",function(e){var r=$("#entries-nav-drawer");r.panel("open"),n.off().one("vclick",function(e){t.QUERY_ENTRIES_OFFSET=0,t.back_nav_url="#refresh",EC.Routing.changePage(EC.Const.INDEX_VIEW)}),o.off().one("vclick",function(e){t.reached_settings_view_from=$.mobile.activePage.attr("id"),EC.Routing.changePage(EC.Const.SETTINGS_VIEW)}),$(".ui-panel-dismiss-open").off().on("vclick",function(){r.panel("close")})}),r.off().on("vclick",function(e){var t=$('div#entries div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab i').attr("data-href");EC.Routing.changePage(t)})},o=function(e,t,n){var o,r,a,i,s=e,l=t,c=n,d=[],u="";for(o=0,a=c.length;a>o;o++)for(u+='<div class="parent-entry-divider">',u+="<span>",d=c[o].parent.split(EC.Const.ENTRY_ROOT_PATH_SEPARATOR),u+=d[d.length-1],u+="</span>",u+='<a id="'+c[o].parent+'" class="context-add-child-entry" href="#"  data-ajax="false">',u+='<i class="fa fa-plus-square-o fa-ep fa-ep-in-list" data-href="add-project"></i>',u+="</a>",u+="</div>",i=c[o].children.length,r=0;i>r;r++)u+='<li data-entry-key="'+c[o].children[r].entry_key+'" class="'+c[o].parent+'" data-icon="false">',u+='<a href="entry-values.html?form='+s+"&entry_key="+c[o].children[r].entry_key+"&direction="+EC.Const.FORWARD+"&parent="+c[o].parent+'">',u+=c[o].children[r].full_title,u+="</a>",0!==l.child&&(u+='<span class="ui-li-count">',u+=c[o].children[r].nested_children_count,u+="</span>"),u+="</li>";return window.localStorage.last_parent=c[c.length-1].parent,u};return e.renderChildEntriesList=function(e){var r,a,i="",s=e,l=$("div#entries-list ul"),c=($("div#entries a.back-home"),$("div#entries div#entries-actionbar")),d=$('div#entries div[data-role="header"] div[data-role="navbar"] ul li.active-tab span'),u=($('div#entries div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab'),$('div#entries div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab i')),E=$('div#entries div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab span'),p=($("#entries"),$('div#entries div[data-role="header"] div[data-href="back-btn"] span.project-name')),C="",_="",h=parseInt(window.localStorage.form_id,10),f=window.localStorage.form_name,v=JSON.parse(window.localStorage.form_tree),m=window.localStorage.project_id,g=window.localStorage.project_name,w=$("div#entries div#entries-list div.more-items-btn"),y=$("div#entries div#entries-list div.more-items-btn-spinner"),S=parseInt(window.localStorage.QUERY_CHILD_ENTRIES_OFFSET,10),I=(parseInt(window.localStorage.QUERY_PARENT_ENTRIES_OFFSET,10),this);t=window.localStorage,t.breadcrumbs=JSON.stringify([""]),n(h,v,s),l.empty(),c.hide(),s.length>0?i=o(h,v,s.slice(0)):EC.Forms.getList("forms.html?project="+m+"&name="+g),p.text(g.trunc(EC.Const.PROJECT_NAME_MAX_LENGTH)),_="Forms",r="forms.html?project="+t.project_id+"&name="+t.project_name,t.back_nav_url=r,C=f,d.text(f),E.text(_),u.attr("data-href",r),l.append(i),l.listview("refresh"),l.off().on("vclick","a.context-add-child-entry",function(){var e=JSON.parse(t.getItem("breadcrumbs"))||[];e.push($(this).attr("id")),t.breadcrumbs=JSON.stringify(e),EC.Entries.addEntry()}),a=EC.Utils.getFormByID(h).entries,a>S+t.QUERY_LIMIT?w.removeClass("hidden"):w.addClass("hidden"),w.off().on("vclick",function(e){$(this).addClass("hidden"),y.removeClass("hidden"),S=parseInt(t.QUERY_CHILD_ENTRIES_OFFSET,10),S+=parseInt(t.QUERY_LIMIT,10),t.QUERY_CHILD_ENTRIES_OFFSET=S,I.getMoreChildEntries(h,S)}),$("div#entries a.context-add-btn").off().on("vclick",function(e){var n=$(this).attr("id"),o=[],r=[],a=$(this).parent().parent().find("li:not('.custom-divider')");r=n.split(EC.Const.ENTRY_ROOT_PATH_SEPARATOR),t.breadcrumbs=JSON.stringify(r),a.each(function(e){$(this).hasClass(n)&&(console.log($(this).attr("data-entry-key")),o.push($(this).attr("data-entry-key")))}),t.primary_keys=JSON.stringify(o),navigator.notification.activityStart("","Loading...")}),t.form_name=f,t.form_id=h,t.removeItem("edit_mode"),t.removeItem("edit_position"),t.removeItem("edit_type"),t.removeItem("edit_id"),t.removeItem("inputs_values"),t.removeItem("inputs_trail"),t.removeItem("child_full_parent_path"),EC.Notification.hideProgressDialog()},e.getMoreChildEntries=function(e,t){var n=e,o=t;EC.Select.getMoreChildEntries(n,o)},e.appendMoreChildEntries=function(e){var t,n,o,r=e,a=r.length,i=$("div#entries-list ul"),s=window.localStorage.form_id,l=JSON.parse(window.localStorage.form_tree),c=($("div#entries-list .more-items-btn"),""),d=parseInt(window.localStorage.QUERY_CHILD_ENTRIES_OFFSET,10),u=EC.Utils.getFormByID(s).entries,E=parseInt(window.localStorage.QUERY_LIMIT,10);for(t=0,a=r.length;a>t;t++)if(r[t].parent===window.localStorage.last_parent)for(o=r[t].children.length,n=0;o>n;n++)c+='<li data-entry-key="'+r[t].children[n].entry_key+'" class="'+r[t].parent+'" data-icon="false">',c+='<a href="#values?form='+s+"&entry_key="+r[t].children[n].entry_key+"&direction="+EC.Const.FORWARD+"&parent="+r[t].parent+'">',c+=r[t].children[n].full_title,c+="</a>",0!==l.child&&(c+='<span class="ui-li-count">',c+=r[t].children[n].nested_children_count,c+="</span>"),c+="</li>";else for(c+='<li data-role="list-divider">',c+=r[t].parent,c+='<a id="'+r[t].parent+'" class="context-add-btn" href="views/inputs.html"  data-ajax="false">',c+='<i class="fa fa-plus-square-o fa-ep fa-fw fa-ep-in-list" data-href="add-project"></i>',c+="</a>",c+="</li>",o=r[t].children.length,n=0;o>n;n++)c+='<li data-entry-key="'+r[t].children[n].entry_key+'" class="'+r[t].parent+'" data-icon="false">',c+='<a href="#values?form='+s+"&entry_key="+r[t].children[n].entry_key+"&direction="+EC.Const.FORWARD+"&parent="+r[t].parent+'">',c+=r[t].children[n].full_title,c+="</a>",0!==l.child&&(c+='<span class="ui-li-count">',c+=r[t].children[n].nested_children_count,c+="</span>"),c+="</li>";window.localStorage.last_parent=r[r.length-1].parent,i.append(c),i.listview("refresh"),i.trigger("updatelayout"),$("div#entries div#entries-list div.more-items-btn-spinner").addClass("hidden"),u>d+E&&$("div#entries div#entries-list div.more-items-btn").removeClass("hidden")},e}(EC.Entries);var EC=EC||{};EC.Entries=EC.Entries||{},EC.Entries=function(e){"use strict";var t,n,o=function(){{var e=$('div#entry-values div[data-role="header"] div[data-href="entry-values-nav-btn"]'),o=$('div#entry-values div[data-role="header"] div[data-href="home"]'),r=$('div#entry-values div[data-role="header"] div#entry-values-nav-drawer ul li div[data-href="settings"]'),a=$('div#entry-values div[data-role="header"] div.ui-btn-right[data-href="entry-values-options"]'),i=$("div#entry-values div.entry-values-options ul li#delete-entry"),s=$('div#entry-values div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab'),l=$("div#entry-values div#entry-values-list ul");window.localStorage.input_page_href}t=$("div#entry-values div.entry-values-options ul li#unsync-entry"),e.off().on("vclick",function(e){var t=$("#entry-values-nav-drawer");t.panel("open"),o.off().one("vclick",function(e){n.back_nav_url="#refresh",EC.Routing.changePage(EC.Const.INDEX_VIEW)}),r.off().one("vclick",function(e){window.localStorage.reached_settings_view_from=$.mobile.activePage.attr("id"),EC.Routing.changePage(EC.Const.SETTINGS_VIEW)}),$(".ui-panel-dismiss-open").off().on("vclick",function(){t.panel("close")})}),s.off().on("vclick",function(e){var t=$('div#entry-values div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab i').attr("data-href");EC.Routing.changePage(t)}),l.off().on("vclick","i",function(e){var t=$(e.target).parent().attr("data-href"),n=parseInt(t.replace("?position=",""),10);window.localStorage.edit_position=n,window.localStorage.edit_mode=1,window.localStorage.back_nav_url=$('div#entry-values div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab i').attr("data-href"),EC.Entries.addEntry(),e.preventDefault()}),t.off().on("vclick",function(e){EC.Notification.askConfirm(EC.Localise.getTranslation("unsync_entry"),EC.Localise.getTranslation("unsync_entry_confirm"),"EC.Entries.unsyncEntry")}),i.off().on("vclick",function(e){EC.Notification.askConfirm(EC.Localise.getTranslation("delete_entry"),EC.Localise.getTranslation("delete_entry_with_children_confirm"),"EC.Entries.deleteEntry")}),a.off().on("vclick",function(e){var t=$(".entry-values-options");t.panel("open"),$(".ui-panel-dismiss-open").off().on("vclick",function(){t.panel("close")})})};return e.renderEntryValues=function(e){var r,a,i,s,l,c,d,u,E,p,C,_="",h=e,f=[],v=[],m=$("div#entry-values-list ul"),g=$("#entry-values"),w=$('div#entry-values div[data-role="header"] div[data-href="entry-values-nav-btn"] span.project-name'),y="",S=window.localStorage.entry_key,I=$('div#entry-values div[data-role="header"] div[data-role="navbar"] ul li.active-tab span'),b=($('div#entry-value div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab'),$('div#entry-values div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab i')),T=$('div#entry-values div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab span'),O=parseInt(window.localStorage.form_id,10),N=window.localStorage.form_name,A=JSON.parse(window.localStorage.form_tree),D=window.localStorage.allow_download_edits,R=window.localStorage.project_name,k=0,L=EC.Utils.isFormGenKeyHidden(O),U=EC.Inputs.getInputs();for(n=window.localStorage,window.navigator.geolocation.clearWatch(n.watch_position),window.localStorage.form_has_location=0,o(),y=S,m.empty(),i=0,s=h.length;s>i;i++){switch(k+=h[i].is_data_synced,u=h[i].value===h[i].entry_key?1:0,1===parseInt(h[i].is_title,10)&&y===S&&(y=h[i].value),h[i].type){case EC.Const.CHECKBOX:f.push({_id:h[i]._id,type:h[i].type,value:h[i].value.split(","),position:h[i].position,is_primary_key:u});break;case EC.Const.PHOTO:f.push({_id:h[i]._id,type:h[i].type,value:{cached:"",stored:h[i].value},position:h[i].position,is_primary_key:u});break;case EC.Const.AUDIO:f.push({_id:h[i]._id,type:h[i].type,value:{cached:"",stored:h[i].value},position:h[i].position,is_primary_key:u});break;case EC.Const.VIDEO:f.push({_id:h[i]._id,type:h[i].type,value:{cached:"",stored:h[i].value},position:h[i].position,is_primary_key:u});break;case EC.Const.BRANCH:d=h[i].value.split(","),f.push({_id:h[i]._id,type:h[i].type,value:{branch_form_name:d[0],branch_total_entries:parseInt(d[1],10)},position:h[i].position,is_primary_key:u});break;default:f.push({_id:h[i]._id,type:h[i].type,value:h[i].value,position:h[i].position,is_primary_key:u})}if(h[i].value!==EC.Const.SKIPPED&&(1!==L||h[i].value!==h[i].entry_key)){switch(v.push({position:h[i].position,label:h[i].label}),_+='<li data-role="list-divider">',_+=h[i].label,_+="</li>",_+='<li class="entry-value-btn-wrapper">',h[i].type){case EC.Const.CHECKBOX:console.log("CHECKBOX"),console.log(h[i]),E=EC.Utils.mapLabelToValue(h[i],U),_+='<span class="h-entry-value-label">'+E.join(", ")+"</span>";break;case EC.Const.DROPDOWN:console.log("DROPDOWN"),console.log(h[i]),p="0"!==h[i].value?EC.Utils.mapLabelToValue(h[i],U):"",_+='<span class="h-entry-value-label">'+p+"</span>";break;case EC.Const.RADIO:console.log("RADIO"),console.log(h[i]),C=""!==h[i].value?EC.Utils.mapLabelToValue(h[i],U):"",_+='<span class="h-entry-value-label">'+C+"</span>";break;case EC.Const.LOCATION:var P=h[i].value;P=P.split(",");var B,F=P.length;for(B=0;F>B;B++)_+='<span class="h-entry-value-label">'+P[B]+"<span>";break;case EC.Const.BRANCH:_+='<span class="h-entry-value-label">'+d[0]+"<br/>("+d[1]+")</span>";break;case EC.Const.PHOTO:_+=""!==h[i].value?'<span class="h-entry-value-label">'+EC.Localise.getTranslation(EC.Const.PHOTO_AVAILABLE_LABEL)+"</span>":'<span class="h-entry-value-label">'+EC.Localise.getTranslation(EC.Const.PHOTO_NOT_AVAILABLE_LABEL)+"</span>";break;case EC.Const.AUDIO:
_+=""!==h[i].value?'<span class="h-entry-value-label">'+EC.Localise.getTranslation(EC.Const.AUDIO_AVAILABLE_LABEL)+"</span>":'<span class="h-entry-value-label">'+EC.Localise.getTranslation(EC.Const.AUDIO_NOT_AVAILABLE_LABEL)+"</span>";break;case EC.Const.VIDEO:_+=""!==h[i].value?'<span class="h-entry-value-label">'+EC.Localise.getTranslation(EC.Const.VIDEO_AVAILABLE_LABEL)+"</span>":'<span class="h-entry-value-label">'+EC.Localise.getTranslation(EC.Const.VIDEO_NOT_AVAILABLE_LABEL)+"</span>";break;default:_+='<span class="h-entry-value-label">'+h[i].value+"</span>"}_+='<div class="entry-value-embedded-btn" data-href="?position='+h[i].position+'">',_+=1===h[i].is_remote?"1"===D?'<i class="fa fa-edit  fa-fw fa-ep-entry-value-embedded-btn"></i>':'<i class="fa fa-edit  fa-fw fa-ep-entry-value-embedded-btn ui-disabled"></i>':'<i class="fa fa-edit  fa-fw fa-ep-entry-value-embedded-btn"></i>',_+="</div>",_+="</li>"}}window.localStorage.inputs_values=JSON.stringify(f),window.localStorage.inputs_trail=JSON.stringify(v),w.text(R.trunc(EC.Const.PROJECT_NAME_MAX_LENGTH)),0===A.parent?S="":(l=JSON.parse(window.localStorage.breadcrumbs),S=l[l.length-2]),c=JSON.parse(window.localStorage.entries_totals),a=c[c.length-1].entries_total,r="",r+="entries-list.html?form="+O,r+="&name="+N,r+="&entry_key="+S,r+="&direction="+EC.Const.VIEW,r+="&children="+a,k>0?t.removeClass("ui-disabled"):t.addClass("ui-disabled"),I.text(y),T.text(N),b.attr("data-href",r),m.append(_),g.page(),m.listview("refresh"),void 0!==S&&(window.localStorage.back_nav_url=r),window.localStorage.edit_mode=1,EC.Notification.hideProgressDialog()},e}(EC.Entries);var EC=EC||{};EC.Entries=function(e){"use strict";var t,n=function(){var e=$('div#entries div[data-role="header"] div[data-href="entries-nav-btn"]'),n=$('div#entries div[data-role="header"] div[data-href="home"]'),o=$('div#entries div[data-role="header"] div#entries-nav-drawer ul li div[data-href="settings"]'),r=$('div#entries div[data-role="header"] i[data-href="add-entry"]'),a=$('div#entries div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab');e.off().on("vclick",function(e){var r=$("#entries-nav-drawer");r.panel("open"),n.off().one("vclick",function(e){t.QUERY_ENTRIES_OFFSET=0,t.back_nav_url="#refresh",EC.Routing.changePage(EC.Const.INDEX_VIEW)}),o.off().one("vclick",function(e){t.reached_settings_view_from=$.mobile.activePage.attr("id"),EC.Routing.changePage(EC.Const.SETTINGS_VIEW)}),$(".ui-panel-dismiss-open").off().on("vclick",function(){r.panel("close")})}),r.off().on("vclick",function(e){EC.Entries.addEntry()}),a.off().on("vclick",function(e){var n=(t.project_id,t.project_name,$('div#entries div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab i').attr("data-href"));EC.Routing.changePage(n)})},o=function(e,t,n){var o,r=e,a=t,i=n,s=i.length,l="";if(0===a.child)for(o=0;s>o;o++)i[o].full_title=""===i[o].full_title?i[o].entry_key:i[o].full_title,l+='<li data-icon="false">',l+='<a href="entry-values.html?form='+r+"&entry_key="+i[o].entry_key+"&direction="+EC.Const.FORWARD+'">',l+=i[o].full_title.replace(/,\s*$/,""),l+="</a>",l+="</li>";else for(o=0,s=i.length;s>o;o++)i[o].full_title=""===i[o].full_title?i[o].entry_key:i[o].full_title,l+='<li data-icon="ep-next-page">',l+='<a href="entry-values.html?form='+r,l+="&entry_key="+i[o].entry_key,l+="&direction="+EC.Const.VIEW,l+='">',l+=i[o].full_title.replace(/,\s*$/,""),l+="</a>",l+='<a href="entries-list.html?form='+a.child,l+="&name="+a.cname,l+="&entry_key="+i[o].entry_key,l+="&direction="+EC.Const.FORWARD,l+="&children="+i[o].children,l+='">',l+="</a>",l+='<span class="ui-li-count">'+i[o].children,l+="</span>",l+="</li>";return l};return e.renderList=function(e){var r,a,i,s,l,c,d,u,E,p,C="",_="",h=e,f=$("div#entries-list ul"),v=$("div#entries div#entries-list div#empty-entries-list"),m=$("div#entries div#entries-list div#empty-entries-list p span.form-name"),g=($("#entries"),$('div#entries div[data-role="header"] div[data-href="entries-nav-btn"] span.project-name')),w="",y=($("div#entries a.back-home"),$("div#entries div#entries-actionbar")),S=$('div#entries div[data-role="header"] div[data-role="navbar"] ul li.active-tab span'),I=($('div#entries div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab'),$('div#entries div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab i')),b=$('div#entries div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab span'),T=$("div#entries div#entries-list div.more-items-btn"),O=$("div#entries div#entries-list div.more-items-btn-spinner"),N=this;t=window.localStorage,i=parseInt(t.form_id,10),s=t.form_name,l=JSON.parse(t.form_tree),c=t.project_name,d=parseInt(t.QUERY_ENTRIES_OFFSET,10),u=parseInt(t.QUERY_LIMIT,10),window.localStorage.cached_entries_list||(t.QUERY_ENTRIES_OFFSET=0),window.navigator.geolocation.clearWatch(window.localStorage.watch_position),window.localStorage.form_has_location=0,p=JSON.parse(t.entries_totals),E=p[p.length-1].entries_total,r=p.length>1?p[p.length-2].entries_total:0,n(),y.show(),E>d+u?T.removeClass("hidden"):T.addClass("hidden"),T.off().on("vclick",function(e){window.device.platform===EC.Const.IOS&&($(this).addClass("hidden"),O.removeClass("hidden")),window.device.platform===EC.Const.ANDROID&&EC.Notification.showProgressDialog(),d=parseInt(t.QUERY_ENTRIES_OFFSET,10),d+=parseInt(t.QUERY_LIMIT,10),t.QUERY_ENTRIES_OFFSET=d,N.getMoreEntries(d)}),f.empty(),h.length>0?(v.addClass("hidden"),f.removeClass("hidden"),C=o(i,l,h)):(v.removeClass("hidden"),f.addClass("hidden"),m.text(s)),g.text(c.trunc(EC.Const.PROJECT_NAME_MAX_LENGTH)),0===l.parent?(w="Forms",_="forms.html?project="+t.project_id+"&name="+t.project_name):(a=JSON.parse(t.breadcrumbs),w=l.pname,_+="entries-list.html?form="+l.parent,_+="&name="+l.pname,_+="&entry_key="+a[a.length-2],_+="&direction="+EC.Const.BACKWARD,_+="&children="+r),S.text(s),b.text(w),I.attr("data-href",_),h.length>0&&(f.append(C),f.listview("refresh")),t.form_name=s,t.form_id=i,t.removeItem("inputs_values"),t.removeItem("inputs_trail"),t.removeItem("current_position"),t.removeItem("back_edit_nav_url"),t.removeItem("edit_mode"),t.removeItem("edit_position"),t.removeItem("edit_type"),t.removeItem("edit_id"),$("div#entries-list ul li").off().on("vclick",function(){console.log($(this).position().top),window.localStorage.previous_tapped_entry_Y=$(this).position().top}),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),window.localStorage.cached_entries_list=JSON.stringify(h),EC.Notification.hideProgressDialog()},e.getMoreEntries=function(e){var n=JSON.parse(t.load_more_parameters),o=n.form_id,r=n.parent_path,a=e;EC.Select.getEntries(o,r,a)},e.appendMoreEntries=function(e){var n,r,a,i=$("div#entries-list ul"),s=e,l=parseInt(t.form_id,10),c=(t.form_name,JSON.parse(t.form_tree)),d=(t.project_name,$("div#entries-list .more-items-btn"),""),u=parseInt(t.QUERY_ENTRIES_OFFSET,10),E=parseInt(t.QUERY_LIMIT,10);n=JSON.parse(t.entries_totals),r=n[n.length-1].entries_total,d=o(l,c,s),i.append(d),i.listview("refresh"),i.trigger("updatelayout"),$("div#entries-list ul li").off().on("vclick",function(){console.log($(this).position().top),window.localStorage.previous_tapped_entry_Y=$(this).position().top}),window.device.platform===EC.Const.IOS&&$("div#entries div#entries-list div.more-items-btn-spinner").addClass("hidden"),window.device.platform===EC.Const.ANDROID&&EC.Notification.hideProgressDialog(),r>u+E&&$("div#entries div#entries-list div.more-items-btn").removeClass("hidden"),a=JSON.parse(window.localStorage.cached_entries_list),window.localStorage.cached_entries_list=JSON.stringify(a.concat(s))},e}(EC.Entries);var EC=EC||{};EC.EmailBackup=EC.EmailBackup||{},EC.EmailBackup=function(){"use strict";var e,t,n,o,r,a=function(e){function t(e){o=e.root.nativeURL+r,console.log("Backup path: "+o),window.device.platform===EC.Const.IOS&&(o=o.slice(7))}function n(e){console.log(e)}r=e+".txt",window.requestFileSystem(LocalFileSystem.PERSISTENT,0,t,n)},i=function(){var r,i,s,l=$("div#email-backup div#email-address-wrapper input#email-address"),c=$('div#email-backup div[data-role="header"] div#send-email'),d=$('div#email-backup div[data-role="header"] div[data-href="back-btn"]');e=window.localStorage.project_name,t=window.localStorage.project_id,s="forms.html?project="+t+"&name="+e,d.off().one("vclick",function(){EC.Routing.changePage(window.localStorage.current_view_url?window.localStorage.current_view_url:EC.Const.INDEX_VIEW)}),$('div#email-backup div[data-role="navbar"] ul li.title-tab span#email-backup-label span.project-name-inline').text(e.trunc(EC.Const.PROJECT_NAME_MAX_LENGTH)),r="Backup for "+e,i="The backup for project "+e+" is attached",a(e),c.off().on("vclick",function(e){return EC.Utils.hasConnection()?(n=l.val(),""!==n&&EC.Utils.isValidEmail(n)?void window.plugin.email.isServiceAvailable(function(e){return e?void window.plugin.email.open({to:[n],cc:[],bcc:[],attachments:[o],subject:r,body:i,isHtml:!0},function(){console.log("email view dismissed")},this):void EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("invalid_email_client"))}):void EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("invalid_email"))):void EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("no_internet"))})};return{renderSendEmailView:i}}();var EC=EC||{};EC.Export=EC.Export||{},EC.Export.saveProjectDataToCSV=function(e,t){"use strict";function n(e,t){var n,r,a=e,i=a.total_entries,s=[],l=t;for(n=0;i>n;n++)r=a.data_rows.splice(0,a.total_inputs),s.push(o(r,l));return s}function o(e,t){var n,o,r,a,i,s=e,l=s.length,c={},d=t,u={};for(d&&(o=EC.Utils.getFormParentPrimaryKeyRef(s[0].form_id),a=s[0].parent.split("|"),r=a[a.length-1],c[o]=r),n=0;l>n;n++)s[n].value===EC.Const.SKIPPED&&(s[n].value=""),s[n].type===EC.Const.LOCATION?(i=s[n].value.replace("\n","").replace("\r",""),""===i?(c[s[n].ref+"_lat"]="",c[s[n].ref+"_lon"]="",c[s[n].ref+"_acc"]="",c[s[n].ref+"_alt"]="",c[s[n].ref+"_bearing"]=""):(u=EC.Utils.parseLocationString(s[n].value),c[s[n].ref+"_lat"]=u.latitude,c[s[n].ref+"_lon"]=u.longitude,c[s[n].ref+"_acc"]=u.accuracy,c[s[n].ref+"_alt"]=u.altitude,c[s[n].ref+"_bearing"]=u.heading)):c[s[n].ref]=s[n].value;return c}var r,a=new $.Deferred,i=i,s=t;return $.when(EC.Select.getAllProjectEntries(s,i)).then(function(e){console.log(e);var t,o=e.length;for(r=[],t=0;o>t;t++)r[t]={name:e[t].form_name,entries:[]},r[t].entries=n(e[t],0!==t);console.log("parsed_forms_json **********************************************"),console.log(r),$.when(EC.File.writeProjectDataAsCSV(window.localStorage.project_name,r)).then(function(e){a.resolve(e)})}),a.promise()};var EC=EC||{};EC.Forms=EC.Forms||{},EC.Forms=function(e){"use strict";return e.getList=function(e){var t,n=e.split("?"),o=n[1].split("&"),r=o[0].replace("project=",""),a=o[1].replace("name=",""),i=window.localStorage;t=e.split("/"),i.current_view_url=t[t.length-1],i.project_id=r,i.project_name=a,EC.Utils.isChrome()||$.when(EC.File.hasBackup(a)).then(function(){i.has_backup=1},function(){i.removeItem("has_backup")}),$.when(EC.Select.getAllowDownloadEdits(r)).then(function(){i.allow_download_edits=1},function(){i.allow_download_edits=0}),$.when(EC.Select.getForms(r)).then(function(e,t){i.QUERY_ENTRIES_OFFSET=0,i.QUERY_CHILD_ENTRIES_OFFSET=0,i.QUERY_PARENT_ENTRIES_OFFSET=0,i.removeItem("last_parent"),i.removeItem("entry_key"),i.removeItem("form_has_jumps"),i.removeItem("load_more_parameters"),i.removeItem("current_position"),i.removeItem("is_child_form_nav"),i.removeItem("has_new_jump_sequence"),i.removeItem("back_nav_url"),i.removeItem("cached_entries_list"),i.removeItem("previous_tapped_entry_Y"),EC.Forms.renderList(e,t)})},e}(EC.Forms);var EC=EC||{};EC.Forms=EC.Forms||{},EC.Forms=function(e){"use strict";var t=function(){var e=$('div#forms div[data-role="header"] div[data-href="home"]'),t=$('div#forms div[data-role="header"] div[data-href="form-nav-btn"]'),n=$('div#forms  div[data-role="header"] div.ui-btn-right[data-href="upload"]'),o=$('div#forms div[data-role="header"] div.ui-btn-right[data-href="project-options"]'),r=$('div#forms div[data-role="header"] div[data-role="navbar"] ul li.inactive-tab'),a=$('div#forms div[data-role="header"] div#form-nav-drawer ul li div[data-href="settings"]');t.off().on("vclick",function(t){var n=$("#form-nav-drawer");n.panel("open"),e.off().one("vclick",function(e){window.localStorage.back_nav_url="#refresh",EC.Routing.changePage(EC.Const.INDEX_VIEW,"../")}),a.off().one("vclick",function(e){EC.Routing.changePage(EC.Const.SETTINGS_VIEW)}),$(".ui-panel-dismiss-open").off().on("vclick",function(){n.panel("close")})}),n.off().one("vclick",function(e){EC.Routing.changePage(EC.Const.UPLOAD_VIEW)}),o.off().on("vclick",function(){$(".project-options-panel").panel("open"),$(".ui-panel-dismiss-open").off().on("vclick",function(){$(".project-options-panel").panel("close")})}),r.off().one("vclick",function(e){window.localStorage.back_nav_url="#refresh",EC.Routing.changePage(EC.Const.INDEX_VIEW,"../")})};return e.renderList=function(e,n){var o,r,a="",i=e,s=$("div#forms-list ul"),l=($("#forms"),$('div#forms div[data-role="header"] div[data-href="form-nav-btn"] span.project-name')),c=$("a.ui-btn-active span.ui-btn-inner"),d=$("div#forms div#project-options ul li#email-backup"),u=$("div#forms div#project-options ul li#download-remote-data"),E=$("div#forms div#project-options ul li#unsync-all-data"),p=$("div#forms div#project-options ul li#delete-project"),C=$("div#forms div#project-options ul li#delete-all-entries"),_=$("div#forms div#project-options ul li#delete-synced-entries"),h=$("div#forms div#project-options ul li#delete-media-files"),f=$("div#forms div#project-options ul li#backup-project-data"),v=$("div#forms div#project-options ul li#restore-data-from-backup"),m=$("div#forms div#project-options ul li#export-project-data-to-csv"),g=n,w=window.localStorage.has_backup,y=window.localStorage.project_name;for(t(),s.empty(),o=0,r=i.length;r>o;o++)o>0&&0===parseInt(i[o].entries,10)?(a+='<li data-icon="false">',a+='<a href="entries-list.html?form='+i[o]._id+"&name="+i[o].name+'&entry_key=&direction=forward" class="ui-disabled">'+i[o].name,a+="<p>"+i[o].total_inputs+EC.Localise.getTranslation("questions")+"</p>",a+="</a>",a+="</li>"):(a+='<li data-icon="ep-next-page">',a+='<a href="entries-list.html?form='+i[o]._id+"&name="+i[o].name+"&entry_key=&direction=forward&children="+i[o].entries+'">'+i[o].name,a+='<span class="ui-li-count">'+i[o].entries,a+="</span>",a+="<p>"+i[o].total_inputs+EC.Localise.getTranslation("questions")+"</p>",a+="</a>",a+="</li>");c.text(EC.Const.FORMS),l.text(y.trunc(EC.Const.PROJECT_NAME_MAX_LENGTH)),s.append(a),s.listview("refresh"),EC.Utils.setForms(i),window.localStorage.form_name="",window.localStorage.form_id="",window.localStorage.removeItem("primary_keys"),window.localStorage.removeItem("parent_path"),d.off().on("vclick",function(e){EC.Routing.changePage(EC.Const.EMAIL_BACKUP_VIEW)}),u.off().on("vclick",function(e){EC.Routing.changePage(EC.Const.DOWNLOAD_VIEW)}),0===g.unsync_all_data?E.addClass("ui-disabled"):E.removeClass("ui-disabled"),E.off().on("vclick",function(e){EC.Notification.askConfirm(EC.Localise.getTranslation("unsync_all_data"),EC.Localise.getTranslation("unsync_all_data"),"EC.Entries.unsyncAllEntries")}),p.off().on("vclick",function(e){EC.Notification.askConfirm(EC.Localise.getTranslation("delete_project"),EC.Localise.getTranslation("delete_project_confirm"),"EC.Project.deleteProject")}),0===g.delete_all_entries?(C.addClass("ui-disabled"),m.addClass("ui-disabled")):(C.removeClass("ui-disabled"),m.removeClass("ui-disabled")),C.off().on("vclick",function(e){EC.Notification.askConfirm(EC.Localise.getTranslation("delete_all_entries"),EC.Localise.getTranslation("delete_all_entries_confirm"),"EC.Entries.deleteAllEntries")}),m.off().on("vclick",function(e){EC.Notification.askConfirm(EC.Localise.getTranslation("export_all_entries_to_csv"),EC.Localise.getTranslation("export_all_entries_to_csv_confirm"),"EC.Entries.exportAllEntriesToCSV")}),0===g.delete_media_files?h.addClass("ui-disabled"):h.removeClass("ui-disabled"),h.off().on("vclick",function(e){EC.Notification.askConfirm(EC.Localise.getTranslation("delete_all_media"),EC.Localise.getTranslation("delete_all_media_confirm"),"EC.Entries.deleteAllMedia")}),0===g.delete_synced_entries?_.addClass("ui-disabled"):_.removeClass("ui-disabled"),_.off().on("vclick",function(e){EC.Notification.askConfirm(EC.Localise.getTranslation("delete_all_synced"),EC.Localise.getTranslation("delete_all_synced_confirm"),"EC.Entries.deleteAllSynced")}),0===g.delete_all_entries?f.addClass("ui-disabled"):f.removeClass("ui-disabled"),f.off().on("vclick",function(e){EC.Notification.askConfirm(EC.Localise.getTranslation("backup_data"),EC.Localise.getTranslation("backup_data_confirm"),"EC.Project.backupCurrentProject")}),w?(v.removeClass("ui-disabled"),d.removeClass("ui-disabled")):(v.addClass("ui-disabled"),d.addClass("ui-disabled")),v.off().on("vclick",function(e){EC.Notification.askConfirm(EC.Localise.getTranslation("restore_data"),EC.Localise.getTranslation("restore_data_confirm"),"EC.Project.restoreFromBackup")}),window.device&&window.device.platform===EC.Const.IOS&&v.addClass("hidden"),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),EC.Notification.hideProgressDialog()},e}(EC.Forms);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.getInputs=function(){return this.inputs},e.setInputs=function(e,t,n){this.inputs=e,window.localStorage.form_has_jumps=t?1:0,window.localStorage.form_has_location=n?1:0},e.getPrimaryKeyRefPosition=function(){var e,t=this.inputs.length;for(e=0;t>e;e++)if(1===parseInt(this.inputs[e].is_primary_key,10))return this.inputs[e].position},e.getJumpDestinationPosition=function(e){var t,n=this.inputs.length,o=e;for(t=0;n>t;t++)if(o===this.inputs[t].ref)return this.inputs[t].position},e.getInputAt=function(e){return this.inputs[e-1]},e.updateFormCompletion=function(e,t){var n=Math.ceil(100*(e-1)/t),o=$("div.ui-grid-b.input-nav-tabs div.input-progress-bar div.progress.progress_tiny"),r=$("div.ui-grid-b.input-nav-tabs div.input-progress-bar span.form-completion-percent");r.text(n+"%"),o.css("width",n+"%")},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.backToBranchEntryValuesList=function(){var e=window.localStorage.branch_entry_values_url;window.localStorage.removeItem("branch_current_position"),window.localStorage.removeItem("branch_form_has_jumps"),window.localStorage.removeItem("branch_form_name"),window.localStorage.removeItem("branch_inputs_total"),window.localStorage.removeItem("branch_inputs_trail"),window.localStorage.removeItem("branch_inputs_values"),window.localStorage.removeItem("branch_form_id"),window.localStorage.removeItem("branch_edit_hash"),window.localStorage.removeItem("branch_edit_key_value"),window.localStorage.removeItem("branch_edit_type"),window.localStorage.removeItem("branch_entry_values_url"),EC.Routing.changePage(e)},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.backToEntriesList=function(){var e,t,n,o=!1,r=window.localStorage.back_nav_url;try{for(e=JSON.parse(window.localStorage.cached_branch_entry_keys),n=e.length,t=0;n>t;t++)if(e[t].primary_keys.length>0){o=!0;break}o?(window.localStorage.removeItem("cached_branch_entry_keys"),EC.Delete.deleteCachedBranchEntries()):EC.Routing.changePage(r)}catch(a){EC.Routing.changePage(r)}},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.backToEntryValuesList=function(){var e,t,n,o=!1,r=window.localStorage.back_edit_nav_url,a=EC.Inputs.getPrimaryKeyRefPosition(),i=JSON.parse(window.localStorage.getItem("breadcrumbs")),s=(i[i.length-1],EC.Inputs.getCachedInputValue(a).value),l=""===i[0]?i.join(EC.Const.ENTRY_ROOT_PATH_SEPARATOR).substring(1):i.join(EC.Const.ENTRY_ROOT_PATH_SEPARATOR);if(s!==l){var c=l.split(EC.Const.ENTRY_ROOT_PATH_SEPARATOR);c.pop(),window.localStorage.parent_path=c.join(EC.Const.ENTRY_ROOT_PATH_SEPARATOR)}try{for(e=JSON.parse(window.localStorage.cached_branch_entry_keys),n=e.length,t=0;n>t;t++)if(e[t].primary_keys.length>0){o=!0;break}o?(window.localStorage.removeItem("cached_branch_entry_keys"),EC.Delete.deleteCachedBranchEntries()):EC.Routing.changePage(r)}catch(d){EC.Routing.changePage(r)}},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.bindBackBtn=function(e){var t=$("div[data-role='header'] div[data-href='back-btn']");t.off().one("vclick",function(t){e?(window.localStorage.is_child_form_nav,EC.Inputs.backToEntriesList()):window.localStorage.is_child_form_nav?EC.Inputs.backToEntriesList():EC.Notification.askConfirm(EC.Localise.getTranslation("exit"),EC.Localise.getTranslation("exit_confirm"),"EC.Inputs.backToEntriesList")})},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";function t(e,t){var a,i,s,l=e,c=l.length,d=t,u=n.inputs.length;for(i=o+1,a=0;c>a;a++){if(l[a].jump_when===EC.Const.JUMP_ALWAYS){r=!0,s=l[a].jump_to,i=s===EC.Const.END_OF_FORM?u:n.getJumpDestinationPosition(s);break}if(l[a].jump_when===EC.Const.JUMP_FIELD_IS_BLANK&&(null===d||d===EC.Const.NO_OPTION_SELECTED)){r=!0,s=l[a].jump_to,i=s===EC.Const.END_OF_FORM?u:n.getJumpDestinationPosition(s);break}if(l[a].jump_when===EC.Const.JUMP_VALUE_IS&&d.toString()===l[a].jump_value.toString()){r=!0,s=l[a].jump_to,i=s===EC.Const.END_OF_FORM?u:n.getJumpDestinationPosition(s);break}if(l[a].jump_when===EC.Const.JUMP_VALUE_IS_NOT&&d.toString()!==l[a].jump_value.toString()){r=!0,s=l[a].jump_to,i=s===EC.Const.END_OF_FORM?u:n.getJumpDestinationPosition(s);break}}return o=i-1,s}var n,o,r;return e.gotoNextPage=function(e,a){var i,s,l,c,d,u,E,p,C=a,_=EC.Utils.isFormGenKeyHidden(parseInt(window.localStorage.form_id,10)),h=!1;if(n=this,o=parseInt(window.localStorage.current_position,10),C.hasOwnProperty("index")&&(C=C.index),Array.isArray(C)&&(h=!0),o===n.inputs.length)l=EC.Const.INPUT_VIEWS_DIR+EC.Const.SAVE_CONFIRM_VIEW;else{if(i=n.getInputAt(o),1===parseInt(i.has_jump,10))if(d=EC.Utils.parseJumpString(i.jumps),h)for(r=!1,p=C.length,E=0;p>E&&(c=t(d,C[E].value),!r);E++);else c=t(d,C);c===EC.Const.END_OF_FORM?l=EC.Const.INPUT_VIEWS_DIR+EC.Const.SAVE_CONFIRM_VIEW:(s=n.getInputAt(o+1),_&&1===s.is_primary_key?(n.pushInputsTrail(s),u=EC.Utils.getGenKey(),n.setCachedInputValue(u,o+1,s.type,s.is_primary_key),s=n.getInputAt(o+2),s||(l=EC.Const.INPUT_VIEWS_DIR+EC.Const.SAVE_CONFIRM_VIEW),window.localStorage.current_position=o+2):window.localStorage.current_position=o+1,s&&(l=EC.Const.INPUT_VIEWS_DIR+s.type+EC.Const.HTML_FILE_EXT))}EC.Routing.changePage(l),e.preventDefault()},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.gotoPrevPage=function(e){var t,n=this,o=parseInt(window.localStorage.current_position,10),r=JSON.parse(window.localStorage.inputs_trail),a=parseInt(r[r.length-1].position,10),i=n.getInputAt(a),s=EC.Utils.isFormGenKeyHidden(window.localStorage.form_id);s&&1===i.is_primary_key?(a=r[r.length-2].position,i=EC.Inputs.getInputAt(a),window.localStorage.current_position=o-2,n.popInputsTrail()):window.localStorage.current_position=a,n.popInputsTrail(),t=EC.Const.INPUT_VIEWS_DIR+i.type+EC.Const.HTML_FILE_EXT,EC.Routing.changePage(t),e.preventDefault()},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.onNextBtnTapped=function(e,t){var n=this,o=window.localStorage,r=(o.edit_id||"",o.edit_type||"",t),a=n.getCurrentValue(r.type),i=parseInt(o.current_position,10),s=EC.Inputs.getCachedInputValue(i),l=n.validateValue(r,a,i);return l.is_valid?(o.edit_mode&&1===parseInt(r.has_jump,10)&&(n.valuesMatch(s,a,r.type)||(o.has_new_jump_sequence=1)),n.setCachedInputValue(a,i,r.type,r.is_primary_key),n.pushInputsTrail(r),window.localStorage.removeItem("is_dismissing_barcode"),void n.gotoNextPage(e,a)):void EC.Notification.showAlert(EC.Localise.getTranslation("error"),l.message)},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.onPrevBtnTapped=function(e,t){var n=this,o=t,r=n.inputs.length,a=n.getCurrentValue(o.type),i=parseInt(window.localStorage.current_position,10),s=EC.Inputs.getCachedInputValue(i);window.localStorage.edit_mode&&1===parseInt(o.has_jump,10)&&(n.valuesMatch(s,a,o.type)||(window.localStorage.has_new_jump_sequence=1)),r>=i&&n.setCachedInputValue(a,i,o.type,o.is_primary_key),window.localStorage.removeItem("is_dismissing_barcode"),n.gotoPrevPage(e)},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.popInputsTrail=function(){var e;try{e=JSON.parse(window.localStorage.inputs_trail),e.pop(),window.localStorage.inputs_trail=JSON.stringify(e)}catch(t){}},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.pushInputsTrail=function(e){var t,n=e;try{t=JSON.parse(window.localStorage.inputs_trail)}catch(o){t=[]}t.push({position:n.position,label:n.label}),window.localStorage.inputs_trail=JSON.stringify(t)},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.spliceInputsTrail=function(e){var t,n,o,r=parseInt(e,10),a=JSON.parse(window.localStorage.inputs_trail),i=a.length;for(t=0;i>t;t++)if(parseInt(a[t].position,10)===r){n=t;break}o=i-n,a.splice(n,o),window.localStorage.inputs_trail=JSON.stringify(a)},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.prepareFeedback=function(e,t){var n,o,r=this,a=e,i=EC.Const.INPUT_VIEWS_DIR+"save-feedback.html",s=JSON.parse(window.localStorage.primary_keys),l=window.localStorage.back_nav_url,c=JSON.parse(window.localStorage.entries_totals);r.entry_key=t,a?(this.message="Data save successfully!",n=l.split("="),o=parseInt(n[n.length-1],10),n[n.length-1]=o+1,l=n.join("="),c[c.length-1].entries_total=o+1,window.localStorage.back_nav_url=l,window.localStorage.entries_totals=JSON.stringify(c),s.push(r.entry_key),window.localStorage.primary_keys=JSON.stringify(s)):this.message="Error saving data...please retry",EC.Routing.changePage(i)},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.prepareFirstInput=function(e){var t,n=this,o=1,r=window.localStorage.form_name,a=window.localStorage.form_id,i=JSON.parse(window.localStorage.breadcrumbs),s=i[i.length-1],l=e,c=EC.Const.INPUT_VIEWS_DIR+l.type+EC.Const.HTML_FILE_EXT,d=($('div[data-role="header"] div[data-href="back-btn"]'),$('div[data-role="header"] div[data-href="back-btn"] span.form-name')),u=JSON.parse(window.localStorage.entries_totals),E=u[u.length-1].entries_total,p=EC.Utils.isFormGenKeyHidden(a);1===parseInt(window.localStorage.form_has_location,10)&&(window.localStorage.watch_position=navigator.geolocation.watchPosition(function(e){console.log(e)},function(e){console.log(e)},{maximumAge:0,timeout:3e5,enableHighAccuracy:!0})),n.entry_key=null,d.text(r.trunc(EC.Const.FORM_NAME_MAX_LENGTH)+" entries"),window.localStorage.edit_mode?EC.Inputs.spliceInputsTrail(window.localStorage.edit_position):window.localStorage.inputs_trail=[],window.localStorage.edit_mode||(t="entries-list.html",t+="?form="+a,t+="&name="+r,t+="&entry_key="+s,t+="&direction="+EC.Const.ADDING,t+="&children="+E,window.localStorage.back_nav_url=t),window.localStorage.current_position=window.localStorage.edit_mode?window.localStorage.edit_position:o,1===p&&1===l.is_primary_key&&(window.localStorage.current_position=o+1,window.localStorage.edit_mode||(window.localStorage.inputs_values=JSON.stringify([{_id:"",type:"",value:EC.Utils.getGenKey(),position:1,is_primary_key:1}])),l=n.inputs[o],c=EC.Const.INPUT_VIEWS_DIR+l.type+EC.Const.HTML_FILE_EXT),window.localStorage.removeItem("cached_branch_entry_keys"),window.localStorage.removeItem("stored_branch_entry_keys"),window.localStorage.removeItem("branch_current_position"),window.localStorage.removeItem("branch_form"),window.localStorage.removeItem("branch_form_has_jumps"),window.localStorage.removeItem("branch_form_id"),window.localStorage.removeItem("branch_form_name"),window.localStorage.removeItem("branch_inputs_total"),window.localStorage.removeItem("branch_primary_keys"),window.localStorage.removeItem("branch_edit_id"),window.localStorage.removeItem("branch_edit_mode"),window.localStorage.removeItem("branch_edit_position"),window.localStorage.removeItem("branch_inputs_trail"),window.localStorage.removeItem("branch_inputs_values"),EC.Routing.changePage(c)},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.renderFeedbackView=function(){var e=this,t=window.localStorage.form_id,n=window.localStorage.form_name,o=EC.Utils.getParentAndChildForms(t),r=$("div#feedback div#input-feedback div#upload"),a=$("div#feedback div#input-feedback div#add-entry-current-form"),i=$("div#feedback div#input-feedback div#list-entries-current-form"),s=$("div#feedback div#input-feedback div#add-child-entry"),l=$('div[data-role="header"] div[data-href="back-btn"] span.form-name');window.navigator.geolocation.clearWatch(window.localStorage.watch_position),window.localStorage.form_has_location=0,l.text(n.trunc(EC.Const.FORM_NAME_MAX_LENGTH)+" entries"),e.bindBackBtn(!0),window.localStorage.removeItem("edit_id"),window.localStorage.removeItem("edit_mode"),window.localStorage.removeItem("edit_position"),window.localStorage.removeItem("inputs_trail"),window.localStorage.removeItem("inputs_values"),window.localStorage.removeItem("current_position"),window.localStorage.removeItem("cached_branch_entry_keys"),$("p#message").text(this.message),a.find("span.entry").text(n),r.off().one("vclick",function(){EC.Routing.changePage(EC.Const.UPLOAD_VIEW)}),a.off().one("vclick",function(e){EC.Entries.addEntry()}),i.off().one("vclick",function(e){window.localStorage.is_child_form_nav,EC.Inputs.backToEntriesList()}),i.find("span.form-name-inline").text(n),""!==o.cname&&(s.find("span").text(EC.Localise.getTranslation("add")+o.cname+EC.Localise.getTranslation("to")+n),s.removeClass("hidden"),s.one("vclick",function(t){var n,r;window.localStorage.form_name=o.cname,window.localStorage.form_id=o.child,n=JSON.parse(window.localStorage.breadcrumbs),n.push(e.entry_key),window.localStorage.breadcrumbs=JSON.stringify(n),r=JSON.parse(window.localStorage.entries_totals),r.push({form:o.cname,entry_key:e.entry_key,entries_total:1}),window.localStorage.entries_totals=JSON.stringify(r),EC.Entries.addEntry()})),EC.Notification.hideProgressDialog()},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.renderInput=function(e){var t,n,o,r,a=this,i=window.localStorage,s=e,l=(EC.Const.INPUT_VIEWS_DIR+s.type,parseInt(i.current_position,10)),c=a.getCachedInputValue(l),d=JSON.parse(i.getItem("breadcrumbs")),u=$("div[data-role='header'] div[data-href='back-btn']"),E=$("div[data-role='header'] div[data-href='back-btn'] span.form-name"),p=$("div.input-nav-tabs div.ui-block-a.input-prev-btn"),C=$("div.input-nav-tabs div.ui-block-c.input-next-btn"),_=i.form_name,h=i.form_id,f=a.inputs.length,v=EC.Utils.isFormGenKeyHidden(h),m=!1;u.off().on("vclick",function(e){i.edit_mode?i.has_new_jump_sequence?EC.Notification.askConfirm(EC.Localise.getTranslation("leaving_current_form"),"Are you sure? \nData will NOT be saved","EC.Inputs.backToEntryValuesList",!1,s,!1):1===parseInt(s.has_jump,10)?(t=EC.Inputs.getCurrentValue(s.type),a.valuesMatch(c,t,s.type)?EC.Notification.askConfirm(EC.Localise.getTranslation("leaving_current_form"),EC.Localise.getTranslation("save_before_leave"),"EC.Inputs.backToEntryValuesList",!0,s,!1):EC.Notification.askConfirm(EC.Localise.getTranslation("leaving_current_form"),EC.Localise.getTranslation("exit_confirm"),"EC.Inputs.backToEntryValuesList",!1,s,!1)):EC.Notification.askConfirm(EC.Localise.getTranslation("leaving_current_form"),EC.Localise.getTranslation("save_before_leave"),"EC.Inputs.backToEntryValuesList",!0,s,!1):EC.Notification.askConfirm(EC.Localise.getTranslation("leaving_current_form"),EC.Localise.getTranslation("save_before_leave"),"EC.Inputs.backToEntriesList",!0,s,!1);

}),E.text(_.trunc(EC.Const.FORM_NAME_MAX_LENGTH)+EC.Localise.getTranslation("entries")),n=i.edit_mode?d[d.length-2]:d[d.length-1],$(p,C).removeClass("invisible"),$("div.parent-key div.ui-block-a span.ui-btn-active span.ui-btn-inner").text(""!==n&&void 0!==n?i.form_name+" for "+n:i.form_name),0!==l&&(t=a.getCachedInputValue(l).value,t=t===EC.Const.SKIPPED?"":t,s.type===EC.Const.PHOTO||s.type===EC.Const.AUDIO||s.type===EC.Const.VIDEO?a.renderInputView(s,t||{cached:"",stored:""}):a.renderInputView(s,t||s.default_value)),f>=l&&C.off().on("vclick",function(e){a.onNextBtnTapped(e,s,a)}),l-1>0?(2===l&&(o=JSON.parse(i.inputs_values),r=o[0],1===r.is_primary_key&&1===v&&(p.addClass("invisible"),m=!0)),m||p.off().on("vclick",function(e){a.onPrevBtnTapped(e,s)})):(p.addClass("invisible"),i.removeItem("inputs_trail")),i.edit_mode?($("div.store-edit").removeClass("hidden"),i.has_new_jump_sequence?$("div.store-edit").addClass("ui-disabled"):$("div.store-edit").removeClass("ui-disabled"),$("div.store-edit").off().on("vclick",function(){var e;1===parseInt(s.has_jump,10)?(l=i.current_position,e=EC.Inputs.getCachedInputValue(l),a.valuesMatch(e,t,s.type)?(i.removeItem("has_new_jump_sequence"),a.prepareStoreEdit(l,s,a)):(EC.Notification.showAlert(EC.Localise.getTranslation("warning"),EC.Localise.getTranslation("edited_jump")),i.has_new_jump_sequence=1)):a.prepareStoreEdit(l,s,a)})):$("div.store-edit").addClass("hidden"),a.updateFormCompletion(l,f)},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";var t,n,o,r,a;return e.renderInputView=function(e,i){var s,l,c=e,d=i,u=this,E=0,p=window.localStorage.project_id;switch(c.type){case EC.Const.TEXT:EC.InputTypes.text(d,c);break;case EC.Const.TEXTAREA:EC.InputTypes.textarea(d,c);break;case EC.Const.INTEGER:EC.InputTypes.integer(d,c);break;case EC.Const.DECIMAL:EC.InputTypes.decimal(d,c);break;case EC.Const.DATE:EC.InputTypes.date(d,c);break;case EC.Const.TIME:EC.InputTypes.time(d,c);break;case EC.Const.RADIO:EC.InputTypes.radio(d,c);break;case EC.Const.CHECKBOX:EC.InputTypes.checkbox(d,c);break;case EC.Const.DROPDOWN:EC.InputTypes.dropdown(d,c);break;case EC.Const.BARCODE:EC.InputTypes.barcode(d,c);break;case EC.Const.LOCATION:EC.InputTypes.location(d,c);break;case EC.Const.PHOTO:EC.InputTypes.photo(d,c);break;case EC.Const.AUDIO:EC.InputTypes.audio(d,c);break;case EC.Const.VIDEO:EC.InputTypes.video(d,c);break;case EC.Const.BRANCH:window.localStorage.back_from_branch?window.localStorage.removeItem("back_from_branch"):window.localStorage.inputs=JSON.stringify(u.inputs),t=$.Deferred(),n=$.Deferred(),$.when(t,n).then(function(){console.log("Branch cache ready"),EC.InputTypes.addBranch(r,o)}),s=EC.Inputs.getPrimaryKeyRefPosition(),l=EC.Inputs.getMainFormCurrentKeyValue(s),$.when(EC.Select.getCountBranchEntries(c,l,p,E)).then(function(e,t){o=t,r=e,n.resolve(),console.log("branchEntriesCacheReady called")}),$.when(EC.Select.getBranchFormDetails(c,d,p)).then(function(e){a=e,window.localStorage.branch_form=JSON.stringify(a),t.resolve(),console.log("branchFormCacheReady called")})}c.type!==EC.Const.LOCATION&&(window.google&&google.maps.event.clearListeners(EC.DevicePosition.map),EC.Notification.hideProgressDialog())},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.renderSaveConfirmView=function(){var e,t=this,n=$("div#save-confirm div.ui-block-a.input-prev-btn"),o=$("div#save-confirm div#input-save-confirm div#store"),r=$("div.store-edit"),a=$('div[data-role="header"] div[data-href="back-btn"] span.form-name'),i=t.inputs.length,s=JSON.parse(window.localStorage.getItem("breadcrumbs")),l=window.localStorage.form_name;e=window.localStorage.edit_mode?s[s.length-2]:s[s.length-1],$("div.parent-key div.ui-block-a span.ui-btn-active span.ui-btn-inner").text(""!==e&&void 0!==e?window.localStorage.form_name+" for "+e:window.localStorage.form_name),a.text(l.trunc(EC.Const.FORM_NAME_MAX_LENGTH)+" entries"),t.bindBackBtn(!1),n.removeClass("invisible"),n.off().on("vclick",function(e){t.gotoPrevPage(e)}),window.localStorage.edit_mode?(o.hide(),$("div.store-edit").removeClass("ui-disabled hidden"),r.off().one("vclick",function(e){EC.Notification.showProgressDialog(),t.onStoreValues()})):(o.show(),$("div.store-edit").addClass("hidden"),o.off().one("vclick",function(e){EC.Notification.showProgressDialog(),t.onStoreValues()})),t.updateFormCompletion(i+1,i)},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.renderStoreEditFeedback=function(e){EC.Notification.hideProgressDialog(),e&&(EC.Notification.showToast(EC.Localise.getTranslation("edit_saved"),"short"),window.localStorage.removeItem("edit_hash"),window.localStorage.removeItem("edit_id"),window.localStorage.removeItem("edit_mode"),window.localStorage.removeItem("edit_position"),window.localStorage.removeItem("edit_type"),window.localStorage.removeItem("edit_key_value"),window.localStorage.removeItem("has_new_jump_sequence"),EC.Routing.changePage(window.localStorage.back_nav_url))},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.amendSkippedValues=function(){var e,t,n,o,r,a,i=window.localStorage,s=[],l=[],c=EC.Utils.isFormGenKeyHidden();for(s=JSON.parse(i.inputs_trail),l=JSON.parse(i.inputs_values),n=l.length,o=s.length,r=s[s.length-1].position,e=0;n>e;e++){if(a=!1,null===l[e])a=!0;else for(t=0;o>t;t++)if(parseInt(l[e].position,10)===s[t].position||1===c&&1===parseInt(l[e].is_primary_key,10)){a=!0;break}a||(l[e].value=EC.Const.SKIPPED)}i.inputs_values=JSON.stringify(l)},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.buildRows=function(e){var t,n,o,r,a,i,s,l,c,d,u=this,E=[],p=EC.Inputs.inputs.length,C=EC.Inputs.getPrimaryKeyRefPosition(),_=window.localStorage.form_name,h=EC.Utils.getPhoneUUID(),f=(window.localStorage.form_id,EC.Utils.getTimestamp()),v=e,m=(parseInt(window.localStorage.current_position,10),JSON.parse(window.localStorage.getItem("breadcrumbs"))),g=(m[m.length-1],""===m[0]?m.join(EC.Const.ENTRY_ROOT_PATH_SEPARATOR).substring(1):m.join(EC.Const.ENTRY_ROOT_PATH_SEPARATOR)),w=EC.Inputs.getCachedInputValue(C).value;for(t=0;p>t;t++){if(n=EC.Inputs.inputs[t],o=u.getCachedInputValue(n.position),r=o.value||"",a=o._id,n.type===EC.Const.PHOTO||n.type===EC.Const.VIDEO||n.type===EC.Const.AUDIO)if(r.hasOwnProperty("stored"))if(""===r.stored)if(""!==r.cached){switch(i=r.cached.split("/"),s=i[i.length-1],window.device.platform){case EC.Const.ANDROID:break;case EC.Const.IOS:(n.type===EC.Const.PHOTO||n.type===EC.Const.AUDIO||n.type===EC.Const.VIDEO)&&(l=s.split("."),c=l[l.length-1],d=EC.Utils.getIOSFilename(v,s),s=d+"."+c)}r=_+"_"+n.ref+"_"+h+"_"+s}else r="";else r=r.stored;else r="";n.type===EC.Const.BRANCH&&(r=r===EC.Const.SKIPPED?n.branch_form_name+",0":r.branch_form_name+","+r.branch_total_entries),(n.type===EC.Const.DROPDOWN||n.type===EC.Const.RADIO)&&r!==EC.Const.SKIPPED&&r===EC.Const.NO_OPTION_SELECTED&&(r=""),n.type===EC.Const.CHECKBOX&&r!==EC.Const.SKIPPED&&(r=r===EC.Const.NO_OPTION_SELECTED?"":r.join(", ")),E.push({_id:a,input_id:n._id,form_id:n.form_id,position:n.position,parent:g,label:n.label,value:r,ref:n.ref,is_title:n.is_title,entry_key:w,type:n.type,is_data_synced:0,is_media_synced:0,is_remote:0,created_on:f})}console.log("rows: "+JSON.stringify(E)),window.localStorage.edit_mode?$.when(EC.Update.updateHierarchyEntryValues(E)).then(function(){if(window.localStorage.is_child_form_nav||(window.localStorage.back_nav_url=window.localStorage.back_edit_nav_url),w!==g){var e=g.split(EC.Const.ENTRY_ROOT_PATH_SEPARATOR);e.pop(),window.localStorage.parent_path=e.join(EC.Const.ENTRY_ROOT_PATH_SEPARATOR)}EC.Inputs.renderStoreEditFeedback(!0)},function(){EC.Inputs.renderStoreEditFeedback(!1)}):$.when(EC.Create.insertFormValues(E,w)).then(function(e){EC.Inputs.prepareFeedback(!0,e)},function(){EC.Inputs.prepareFeedback(!1,null)})},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.prepareStoreEdit=function(e,t,n){var o,r,a="",i={},s=e,l=t,c=n;return $(this).addClass("ui-disabled"),o=window.localStorage.form_has_jumps,r=EC.Inputs.getCurrentValue(l.type),s=window.localStorage.current_position,1===parseInt(l.has_double_check,10)&&(a=EC.Inputs.getCloneValue(l.type)),i=EC.Utils.isValidValue(l,r,a),i.is_valid?(EC.Inputs.setCachedInputValue(r,s,l.type,l.is_primary_key),EC.Inputs.pushInputsTrail(l),void c.storeData(c)):(EC.Notification.showAlert("Error",i.message),void $(this).removeClass("ui-disabled"))},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.saveValuesOnExit=function(e){var t=this,n=e,o=t.getCurrentValue(n.type),r=parseInt(window.localStorage.current_position,10),a=t.validateValue(n,o,r);return a.is_valid?(t.setCachedInputValue(o,r,n.type,n.is_primary_key),t.pushInputsTrail(n),void t.onStoreValues()):(EC.Notification.hideProgressDialog(),void EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation(a.message)))},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.storeData=function(e){var t=e,n=[],o=function(){var e,t,n,o=JSON.parse(window.localStorage.inputs_values),r=o.length,a=[];for(e=0;r>e;e++)t=EC.Inputs.inputs[e],n=EC.Inputs.getCachedInputValue(t.position).value,(t.type===EC.Const.PHOTO||t.type===EC.Const.VIDEO||t.type===EC.Const.AUDIO)&&""!==n.cached&&a.push({type:t.type,cached:n.cached,stored:n.stored,ref:t.ref});return a.length>0&&($("div#audio div#input-audio input#cached-audio-uri").val(""),$("div#audio div#input-audio input#stored-audio-uri").val("")),a};n=o(),console.log("media_files.length= "+n.length),0===n.length||EC.Utils.isChrome()?t.buildRows():(console.log(JSON.stringify(n)),EC.File.move(n))},e.onStoreValues=function(){var e=this;return e.isEmptyPrimaryKey()?(EC.Notification.hideProgressDialog(),void EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("missing_pk"))):("1"===window.localStorage.form_has_jumps&&e.amendSkippedValues(),void e.storeData(e))},e}(EC.Inputs);var EC=EC||{};EC.InputTypes=EC.InputTypes||{},EC.InputTypes=function(e){"use strict";return e.addBranch=function(e,t){var n=$("div#branch span.label"),o=e,r=t,a=window.localStorage.project_id,i=$("div#input-branch div#add-branch-btn"),s=$("div#input-branch div#list-branch-entries-btn"),l=$("div#input-branch div#list-branch-entries-btn span.branch-entries-count"),c=JSON.parse(window.localStorage.branch_form);window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE);var d=function(){EC.BranchInputs.getList(c.name,a)},u=function(){EC.Routing.changePage(EC.Const.BRANCH_ENTRIES_LIST_VIEW)};n.text(r.label),i.off().one("vclick",d),i.attr("data-branch-form-name",r.branch_form_name),o>0?(s.off("vclick").one("vclick",u),s.removeClass("ui-disabled"),s.find("span.branch-entries-count").text(o)):(s.addClass("ui-disabled"),l.text("")),s.attr("data-entries-count",o)},e}(EC.InputTypes);var EC=EC||{};EC.InputTypes=EC.InputTypes||{},EC.InputTypes=function(e){"use strict";return e.audio=function(e,t){function n(e){w.addClass("ui-disabled"),_.removeClass("ui-disabled"),_.one("vclick",o),C.addClass("ui-disabled"),h.addClass("hidden"),f.removeClass("hidden"),i?EC.Utils.isAudioFileStored(l,i)&&(i=l+EC.Utils.generateAudioFileName()):i=l+EC.Utils.generateAudioFileName(),console.log("Recording... - Full path: "+i),c=new Media(i,function(){h.removeClass("ui-disabled"),v.text("Audio available"),console.log("recordAudio():Audio Success"),m.val(i),console.log("current_path: "+i)},function(e){console.log("recordAudio():Audio Error: "+e.code),console.log("recordAudio():Audio Error: "+JSON.stringify(e))}),c.startRecord(),e.preventDefault(),e.stopPropagation()}function o(e){w.removeClass("ui-disabled"),_.addClass("ui-disabled"),C.removeClass("ui-disabled"),h.removeClass("hidden ui-disabled"),f.addClass("hidden"),C.off().one("vclick",n),c.stopRecord(),c.release(),e.preventDefault(),e.stopPropagation()}function r(e){console.log("Audio stopped"),d.stop(),d.release(),w.removeClass("ui-disabled"),_.off().one("vclick",o),_.addClass("ui-disabled"),C.removeClass("ui-disabled"),h.removeClass("ui-disabled")}function a(){function e(e){var t=e;4===t&&(w.removeClass("ui-disabled"),_.addClass("ui-disabled"),C.removeClass("ui-disabled"),h.removeClass("ui-disabled"))}w.addClass("ui-disabled"),console.log("Playing... "+i),_.off().one("vclick",r),_.removeClass("ui-disabled"),h.addClass("ui-disabled"),C.addClass("ui-disabled"),d=new Media(i,null,null,e),d.play()}var i,s,l,c,d,u=$("span.label"),E=($("div.clone"),e),p=t,C=$("div#input-audio div#start-btn"),_=$("div#input-audio div#stop-btn"),h=$("div#input-audio div#play-btn"),f=$("div#input-audio div#ongoing-recording-spinner"),v=$("div#input-audio p#audio-feedback"),m=$("div#input-audio input#cached-audio-uri"),g=$("div#input-audio input#stored-audio-uri"),w=$("div#audio div.ui-header");if(u.text(p.label),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),C.off("vclick").one("vclick",n),_.off("vclick"),h.off("vclick").on("vclick",a),window.localStorage.edit_mode&&void 0===E.stored&&(g.val(E),E={cached:"",stored:E}),E.cached)console.log("we have a cached value"),h.removeClass("ui-disabled"),i=m.val();else if(E.stored){switch(h.removeClass("ui-disabled"),window.device.platform){case EC.Const.ANDROID:s=EC.Const.ANDROID_APP_PRIVATE_URI+EC.Const.AUDIO_DIR+window.localStorage.project_name+"/"+E.stored;break;case EC.Const.IOS:s=EC.Const.IOS_APP_PRIVATE_URI+EC.Const.AUDIO_DIR+window.localStorage.project_name+"/"+E.stored}console.log("audio_full_path_uri: "+s),i=s,v.text("Audio available"),console.log("current_path: "+JSON.stringify(s))}else h.addClass("ui-disabled");console.log("cache_audio_uri: "+m.val()),g.val(E.stored||""),C.removeClass("enable"),_.addClass("ui-disabled"),window.device.platform===EC.Const.IOS?window.requestFileSystem(LocalFileSystem.TEMPORARY,0,function(e){console.log(JSON.stringify(e)),l=e.root.nativeURL,console.log("nativeURL: "+l),l=l.slice(7)},function(e){console.log(JSON.stringify(e))}):window.resolveLocalFileSystemURL(cordova.file.externalCacheDirectory,function(e){console.log(JSON.stringify(e)),l=e.nativeURL,console.log("nativeURL: "+l)},function(e){console.log(JSON.stringify(e))})},e}(EC.InputTypes);var EC=EC||{};EC.InputTypes=EC.InputTypes||{},EC.InputTypes=function(e){"use strict";return e.barcode=function(e,t){var n,o=$("div#barcode span.label"),r=$("div.clone"),a=e,i=t,s=$("div#barcode div#scanner"),l=$("div#barcode div#scanner-confirm"),c=$("div#barcode input.scan-result"),d=$("div#barcode input.scan-result-confirm");o.text(i.label),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),1===parseInt(i.is_primary_key,10)?o.attr("data-primary-key","true"):o.attr("data-primary-key",""),n=1===parseInt(i.has_double_check,10)?!0:!1,s.removeClass("ui-disabled"),l.removeClass("ui-disabled"),c.val(a),window.localStorage.edit_mode&&"1"===i.is_primary_key?(s.addClass("ui-disabled"),$("div#input-barcode p.primary-key-not-editable").removeClass("hidden")):$("div#input-barcode p.primary-key-not-editable").addClass("hidden"),n?(r.removeClass("hidden"),d.val(a),window.localStorage.edit_mode&&1===i.is_primary_key&&l.addClass("ui-disabled"),l.off().on("vclick",function(){window.localStorage.is_dismissing_barcode=1,cordova.plugins.barcodeScanner.scan(function(e){e.cancelled||d.val(e.text)},function(e){console.log(e)})})):r.addClass("hidden"),s.off().on("vclick",function(){window.localStorage.is_dismissing_barcode=1,cordova.plugins.barcodeScanner.scan(function(e){console.log(e),e.cancelled||c.val(e.text)},function(e){console.log(e)})})},e}(EC.InputTypes);var EC=EC||{};EC.InputTypes=EC.InputTypes||{},EC.InputTypes=function(e){"use strict";return e.checkbox=function(e,t){var n,o=$("div#checkbox span.label"),r=($("div.clone"),e),a=t,i="",s="",l="";o.text(a.label),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),1===parseInt(a.is_primary_key,10)?o.attr("data-primary-key","true"):o.attr("data-primary-key",""),n=1===parseInt(a.has_double_check,10)?!0:!1,!window.localStorage.edit_mode||"1"!==a.is_primary_key&&"1"!==a.has_jump||(s='disabled="disabled"'),$(a.options).each(function(e){var t,n="choice",o=this.value.trim(),a=this.label.trim(),c="checkbox-choice-"+(e+1),d=r.length;for(t=0;d>t;t++)if(i="",r[t].trim()===o){i='checked="checked"';break}l+="<label>",l+='<input type="checkbox" '+i+" "+s+' name="'+n,l+='" id="'+c,l+='" value="'+o,l+='" data-label="'+a,l+='" />'+a,l+="</label>"}),o.append(l),$("div#input-checkbox").trigger("create")},e}(EC.InputTypes);var EC=EC||{};EC.InputTypes=EC.InputTypes||{},EC.InputTypes=function(e){"use strict";return e.date=function(e,t){var n,o,r,a=$("span.label"),i=($("div.clone"),e),s=t;a.text(s.label+" - "+s.datetime_format),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),1===parseInt(s.is_primary_key,10)?a.attr("data-primary-key","true"):a.attr("data-primary-key",""),r=1===parseInt(s.has_double_check,10)?!0:!1,n=$("div#input-date input.nativedatepicker"),o=$("div#input-date input.ios-date"),o.parent().addClass("no-border"),n.attr("data-raw-date",new Date),n.val(i===s.datetime_format?EC.Utils.parseDate(new Date,s.datetime_format):i),window.device.platform===EC.Const.ANDROID&&n.off().on("vclick",function(e){var t=$(this),n=new Date(t.attr("data-raw-date")),o=new Date,r=t.data("lastFocus");r&&500>o-r||(t.data("lastFocus",o),window.plugins.datePicker.show({date:n,mode:"date",allowOldDates:!0},function(e){var n;void 0!==e&&(n=new Date(e),t.val(EC.Utils.parseDate(n,s.datetime_format)),t.attr("data-raw-date",n)),t.blur()}),t.blur())}),window.device.platform===EC.Const.IOS&&(n.off().on("vclick",function(e){o.focus()}),o.off().on("blur",function(e){var t=o.val();n.val(EC.Utils.parseIOSDate(t,s.datetime_format)),n.attr("data-raw-date",t)}))},e}(EC.InputTypes);var EC=EC||{};EC.InputTypes=EC.InputTypes||{},EC.InputTypes=function(e){"use strict";return e.decimal=function(e,t){var n,o=$("span.label"),r=$("div.clone"),a=e,i=t,s=$("span.min-range"),l=$("span.max-range");o.text(i.label),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),1===parseInt(i.is_primary_key,10)?o.attr("data-primary-key","true"):o.attr("data-primary-key",""),n=1===parseInt(i.has_double_check,10)?!0:!1,$("div#input-decimal input").removeAttr("disabled"),window.device.platform===EC.Const.IOS,r.addClass("hidden"),s.addClass("hidden"),l.addClass("hidden"),n&&(r.removeClass("hidden"),$("div.clone input").val(a),window.localStorage.edit_mode&&1===i.is_primary_key&&$("div.clone input").attr("disabled","disabled")),""!==i.min_range&&(s.removeClass("hidden"),s.text("Min: "+i.min_range)),""!==i.max_range&&(l.removeClass("hidden"),l.text("Max: "+i.max_range)),$("div#input-decimal input").val(a),window.localStorage.edit_mode&&1===i.is_primary_key?($("div#input-decimal input").attr("disabled","disabled"),$("div#input-decimal p.primary-key-not-editable").removeClass("hidden")):$("div#input-decimal p.primary-key-not-editable").addClass("hidden")},e}(EC.InputTypes);var EC=EC||{};EC.InputTypes=EC.InputTypes||{},EC.InputTypes=function(e){"use strict";return e.dropdown=function(e,t){var n,o=$("div#select span.label"),r=($("div.clone"),e),a=t,i="",s="",l="";o.text(a.label),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),1===parseInt(a.is_primary_key,10)?o.attr("data-primary-key","true"):o.attr("data-primary-key",""),n=1===parseInt(a.has_double_check,10)?!0:!1,!window.localStorage.edit_mode||"1"!==a.is_primary_key&&"1"!==a.has_jump||(i='disabled="disabled"'),s=""===r?"selected":"",l+='<select id="selection" name="selection" data-native-menu="true" >',l+='<option value ="0"'+s+' data-index="0">',l+=EC.Localise.getTranslation(EC.Const.NO_OPTION_SELECTED),l+="</option>",$(a.options).each(function(e){var t=this.value,n=e+1,o=this.label;s=r===t?"selected":"",l+="<option "+s+" "+i+' value ="'+t+'" data-index="'+n+'">'+o+"</option>"}),l+="</select>",o.append(l),$("div#input-dropdown").trigger("create"),$("select").on("vmousedown",function(e){$(this).focus().click()})},e}(EC.InputTypes);var EC=EC||{};EC.InputTypes=EC.InputTypes||{},EC.InputTypes=function(e){"use strict";return e.integer=function(e,t){var n,o=$("span.label"),r=$("div.clone"),a=parseInt(e,10),i=t,s=$("span.min-range"),l=$("span.max-range");o.text(i.label),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),1===parseInt(i.is_primary_key,10)?o.attr("data-primary-key","true"):o.attr("data-primary-key",""),n=1==parseInt(i.has_double_check,10),window.device.platform===EC.Const.IOS&&$("div#input-integer input").attr("pattern","[0-9]*"),r.addClass("hidden"),s.addClass("hidden"),l.addClass("hidden"),n&&(r.removeClass("hidden"),$("div.clone input").val(a=isNaN(a)?"":a),window.localStorage.edit_mode&&1===i.is_primary_key&&$("div.clone input").attr("disabled","disabled")),""!==i.min_range&&(s.removeClass("hidden"),s.text("Min: "+i.min_range)),""!==i.max_range&&(l.removeClass("hidden"),l.text("Max: "+i.max_range)),$("div#input-integer input").val(a=isNaN(a)?"":a),window.localStorage.edit_mode&&1===i.is_primary_key?($("div#input-integer input").attr("disabled","disabled"),$("div#input-integer p.primary-key-not-editable").removeClass("hidden")):($("div#input-integer input").removeAttr("disabled"),$("div#input-integer p.primary-key-not-editable").addClass("hidden"))},e}(EC.InputTypes);var EC=EC||{};EC.InputTypes=EC.InputTypes||{},EC.InputTypes=function(e){"use strict";var t;return e.location=function(e,n){function o(e){c.removeClass("hidden"),d.removeClass("hidden"),e?($(c).find("span").text(Math.floor(EC.DevicePosition.coords.accuracy)),EC.DevicePosition.is_enhanced_map_on()?(u.removeClass("hidden"),l.addClass("hidden"),EC.DevicePosition.current_position=new google.maps.LatLng(EC.DevicePosition.coords.latitude,EC.DevicePosition.coords.longitude),EC.DevicePosition.marker.setPosition(EC.DevicePosition.current_position),EC.DevicePosition.circle.setOptions({center:EC.DevicePosition.current_position,radius:EC.DevicePosition.coords.accuracy})):l.val(EC.DevicePosition.getCoordsFormattedText())):EC.DevicePosition.is_enhanced_map_on()||l.val(EC.DevicePosition.getCoordsEmptyText()),EC.Utils.isChrome()||EC.Notification.showToast(EC.Localise.getTranslation("location_acquired"),"short"),s.one("vclick",p),EC.Notification.hideProgressDialog()}var r=$("span.label"),a=e,i=n,s=$("div#location div#input-location div#set-location"),l=$("textarea#coords"),c=$("div#location  div#input-location div.current-accuracy-result"),d=$("div#location  div#input-location div.location-accuracy-tip"),u=$("div#location div#input-location div#map-canvas"),E=[];t=this,r.text(i.label),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),c.addClass("hidden"),d.addClass("hidden"),u.addClass("hidden"),""===a?(EC.Notification.showProgressDialog("Wait","Locating..."),$.when(EC.DevicePosition.getCurrentPosition()).then(function(){$(c).find("span").text(Math.floor(EC.DevicePosition.coords.accuracy)),$(c).removeClass("hidden"),$(d).removeClass("hidden"),EC.DevicePosition.is_enhanced_map_on()?(u.removeClass("hidden"),l.addClass("hidden"),$.when(EC.DevicePosition.loadGoogleMapsApi()).then(function(){$.when(EC.DevicePosition.initGoogleMap()).then(function(){EC.Notification.hideProgressDialog()})},function(){window.localStorage.is_enhanced_map_on=0,EC.Notification.showAlert("Sorry...","Google Maps failed to load, reverting to standard mode"),l.val(EC.DevicePosition.getCoordsFormattedText()).removeClass("hidden"),u.addClass("hidden"),EC.Notification.hideProgressDialog()})):(l.val(EC.DevicePosition.getCoordsFormattedText()),$(l).removeClass("hidden"),EC.Notification.hideProgressDialog())},function(e){EC.Notification.hideProgressDialog(),EC.Notification.showToast("Could not locate","long")})):(c.find("span").text(Math.floor(EC.Utils.parseLocationString(a).accuracy)),c.removeClass("hidden"),d.removeClass("hidden"),EC.DevicePosition.is_enhanced_map_on()?(u.removeClass("hidden"),l.addClass("hidden"),E=EC.Utils.parseLocationString(a),E.latitude===EC.DevicePosition.coords.latitude&&E.longitude===EC.DevicePosition.coords.longitude||console.log("map needs to be updated"),EC.Notification.hideProgressDialog()):(l.val(a),$(l).removeClass("hidden"),EC.Notification.hideProgressDialog()));var p=function(){s.off("vclick"),$.when(EC.Utils.isGPSEnabled()).then(function(){EC.Notification.showProgressDialog(EC.Localise.getTranslation("locating"),EC.Localise.getTranslation("wait")),window.device.platform===EC.Const.ANDROID&&(EC.Const.KITKAT_REGEX.test(window.device.version)||EC.Const.LOLLIPOP_REGEX||EC.Utils.sleep(2e3)),EC.Utils.hasGoodConnection()||(window.localStorage.is_enhanced_map_on=0),$.when(EC.DevicePosition.watchPosition()).then(function(e){o(e)})},function(){console.log("gps NOT enabled"),EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("gps_disabled"))})};s.off().one("vclick",p)},e}(EC.InputTypes);var EC=EC||{};EC.InputTypes=EC.InputTypes||{},EC.InputTypes=function(e){"use strict";var t;return e.photo=function(e,n){var o,r=$("span.label"),a=e,i=n,s=$("div#input-photo div#camera-btn"),l=$("div#input-photo input#stored-image-uri"),c=$("div#input-photo input#cached-image-uri"),d=$("#canvas-portrait"),u=$("#canvas-landscape"),E=$("#canvas-portrait")[0],p=$("#canvas-landscape")[0],C=E.getContext("2d");C.clearRect(0,0,E.width,E.height);var _=p.getContext("2d");_.clearRect(0,0,p.width,p.height),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),EC.Const.IOS,$("div#canvas-wrapper").off().on("vclick",function(e){var n=$("div#input-photo input#cached-image-uri").val(),o=$("#photo-popup");if(console.log(n),""===n&&(n=t+$("div#input-photo input#stored-image-uri").val()),window.device)switch(window.device.platform){case EC.Const.ANDROID:e.preventDefault(),$.swipebox([{href:n}]);break;case EC.Const.IOS:o.find("img").attr("src",n),window.setTimeout(function(){o.popup("open")},100),$(window).on("orientationchange",function(e){console.log("called orientationchange"),o.popup("close")})}});var h=function(e){var t,n=new Image,o=e;o+="?"+parseInt((new Date).getTime()/1e3,10),n.src=o,n.onerror=function(){console.log("Image failed!")},n.onload=function(){console.log("on load called");var e,n,o,r=this.width,a=this.height;a>r?(o=E,n=188,e=250,u.addClass("hidden"),d.removeClass("hidden")):(o=p,n=250,e=188,d.addClass("hidden"),u.removeClass("hidden")),t=o.getContext("2d"),t.clearRect(0,0,o.width,o.height),t.save(),t.imageSmoothingEnabled=!1,t.drawImage(this,0,0,n,e),t.restore()},console.log(JSON.stringify(o))};if(u.addClass("hidden"),d.addClass("hidden"),r.text(i.label),window.localStorage.edit_mode?void 0===a.stored?(l.val(a),a={cached:"",stored:a}):l.val(a.stored):l.val(""),console.log("value.stored "+JSON.stringify(a.stored)),c.val(a.cached||""),console.log("cache_image_uri: "+c.val()),""===a.cached){if(console.log("cached value empty"),""!==a.stored){switch(window.device.platform){case EC.Const.ANDROID:o=EC.Const.ANDROID_APP_PRIVATE_URI+EC.Const.PHOTO_DIR+window.localStorage.project_name+"/"+a.stored,t=EC.Const.ANDROID_APP_PRIVATE_URI+EC.Const.PHOTO_DIR+window.localStorage.project_name+"/";break;case EC.Const.IOS:o="file://"+EC.Const.IOS_APP_PRIVATE_URI+EC.Const.PHOTO_DIR+window.localStorage.project_name+"/"+a.stored,t="file://"+EC.Const.IOS_APP_PRIVATE_URI+EC.Const.PHOTO_DIR+window.localStorage.project_name+"/"}console.log("image_full_path_uri: "+o),h(o)}}else h(a.cached);var f=Camera.PictureSourceType.CAMERA,v={quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:f,encodingType:Camera.EncodingType.JPEG,mediaType:Camera.MediaType.PICTURE,correctOrientation:!0,saveToPhotoAlbum:!1,targetWidth:1024,targetHeight:768};s.off().on("vclick",function(){navigator.camera.getPicture(m,g,v)});var m=function(e){console.log("image_uri: "+e);var t=e;h(t),console.log("image uri is"+t),$("div#input-photo input#cached-image-uri").val(t)},g=function(e){console.log("Error","Failed because: "+e)}},e}(EC.InputTypes);var EC=EC||{};EC.InputTypes=EC.InputTypes||{},EC.InputTypes=function(e){"use strict";return e.radio=function(e,t){var n,o=$("div#radio div#input-radio span.label"),r=($("div.clone"),e),a=t,i="",s="",l="";o.text(a.label),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),1===parseInt(a.is_primary_key,10)?o.attr("data-primary-key","true"):o.attr("data-primary-key",""),n=1===parseInt(a.has_double_check,10)?!0:!1,window.localStorage.edit_mode&&1===parseInt(a.is_primary_key,10)&&(l='disabled="disabled"'),i+='<fieldset data-role="controlgroup">',$(a.options).each(function(e){var t=this.value,n=e+1,o=this.label,a="radio-choice-"+(e+1);s=r===t?'checked="checked"':"",i+='<input type="radio" name="radio-options" id="'+a+'" value="'+t+'"'+s+" "+l+' data-index="'+n+'">',i+='<label for="'+a+'">'+o+"</label>"}),i+="</fieldset>",o.append(i),$("div#input-radio").trigger("create")},e}(EC.InputTypes);var EC=EC||{};EC.InputTypes=EC.InputTypes||{},EC.InputTypes=function(e){"use strict";return e.text=function(e,t){var n,o=$("span.label"),r=$("div.clone"),a=e,i=t;return o.text(i.label),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),1===parseInt(i.is_primary_key,10)?o.attr("data-primary-key","true"):o.attr("data-primary-key",""),n=1===parseInt(i.has_double_check,10)?!0:!1,$("div#input-text input").removeAttr("disabled"),n?(r.removeClass("hidden"),$("div.clone input").val(a),console.log(typeof i.is_primary_key),console.log(typeof i.has_jump),window.localStorage.edit_mode&&1===i.is_primary_key&&$("div.clone input").attr("disabled","disabled")):r.addClass("hidden"),$("div#input-text input").val(a),1===parseInt(i.is_genkey,10)&&""===a?void $("div#input-text input").attr("disabled","disabled").val(EC.Utils.getGenKey()):void(window.localStorage.edit_mode&&1===i.is_primary_key?($("div#input-text input").attr("disabled","disabled"),$("div#input-text p.primary-key-not-editable").removeClass("hidden")):$("div#input-text p.primary-key-not-editable").addClass("hidden"))},e}(EC.InputTypes);var EC=EC||{};EC.InputTypes=EC.InputTypes||{},EC.InputTypes=function(e){"use strict";return e.textarea=function(e,t){var n,o=$("span.label"),r=$("div.clone"),a=e,i=t;o.text(i.label),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),1===parseInt(i.is_primary_key,10)?o.attr("data-primary-key","true"):o.attr("data-primary-key",""),n=1===parseInt(i.has_double_check,10)?!0:!1,$("div#input-textarea textarea").removeAttr("disabled"),n?(r.removeClass("hidden"),$("div.clone textarea").val(a),window.localStorage.edit_mode&&1===i.is_primary_key&&$("div.clone textarea").attr("disabled","disabled")):r.addClass("hidden"),$("div#input-textarea textarea").val(a),window.localStorage.edit_mode&&1===i.is_primary_key?($("div#input-textarea textarea").attr("disabled","disabled"),$("div#input-textarea p.primary-key-not-editable").removeClass("hidden")):$("div#input-textarea p.primary-key-not-editable").addClass("hidden")},e}(EC.InputTypes);var EC=EC||{};EC.InputTypes=EC.InputTypes||{},EC.InputTypes=function(e){"use strict";return e.time=function(e,t){var n,o,r,a=$("span.label"),i=($("div.clone"),e),s=t;a.text(s.label+" - "+s.datetime_format),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),
1===parseInt(s.is_primary_key,10)?a.attr("data-primary-key","true"):a.attr("data-primary-key",""),r=1===parseInt(s.has_double_check,10)?!0:!1,n=$("div#input-time input.nativedatepicker"),o=$("div#input-time input.ios-time"),o.parent().addClass("no-border"),n.val(i===s.datetime_format?EC.Utils.parseTime(new Date,s.datetime_format):i),window.device.platform===EC.Const.ANDROID&&n.off().on("vclick",function(e){var t=$(this),n=Date.parse(t.val())||new Date,o=new Date,r=t.data("lastFocus");r&&500>o-r||(t.data("lastFocus",o),window.plugins.datePicker.show({date:n,mode:"time",allowOldDates:!0},function(e){var n;void 0!==e&&(n=new Date(e),t.val(EC.Utils.parseTime(n,s.datetime_format))),t.blur()}))}),window.device.platform===EC.Const.IOS&&(n.off().on("vclick",function(e){o.focus()}),o.off().on("blur",function(e){var t=o.val(),r=new Date(e.timeStamp),a=r.getSeconds();t=t+":"+a,n.val(EC.Utils.parseIOSTime(t,s.datetime_format)),n.attr("data-raw-date",t)}))},e}(EC.InputTypes);var EC=EC||{};EC.InputTypes=EC.InputTypes||{},EC.InputTypes=function(e){"use strict";return e.video=function(e,t){var n,o,r,a=$("span.label"),i=e,s=t,l=$("div#input-video div#video-btn"),c=$("div#input-video div#play-video-btn"),d=$("div#input-video input#stored-video-uri"),u=$("div#input-video input#cached-video-uri"),E=$("div#input-video div#ios-video-player-wrapper"),p=$("div#input-video video#ios-video-player"),C=function(e){c.attr("data-video-path",e),c.removeClass("ui-disabled")};if(window.device.platform===EC.Const.IOS&&$(c,E).addClass("hidden"),a.text(s.label),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),window.localStorage.edit_mode&&(void 0===i.stored?(d.val(i),i={cached:"",stored:i}):d.val(i.stored)),console.log("value.stored "+JSON.stringify(i.stored)),u.val(i.cached||""),console.log("cache_video_uri: "+u.val()),""===i.cached)if(console.log("cached value empty"),""!==i.stored)switch(window.device.platform){case EC.Const.ANDROID:n=EC.Const.ANDROID_APP_PRIVATE_URI+EC.Const.VIDEO_DIR+window.localStorage.project_name+"/"+i.stored,EC.Notification.showProgressDialog(),$.when(EC.File.copyVideo(n)).then(function(e){u.val(e),c.attr("data-video-path",e),c.removeClass("ui-disabled"),EC.Notification.hideProgressDialog()});break;case EC.Const.IOS:n=EC.Const.IOS_APP_PRIVATE_URI+EC.Const.VIDEO_DIR+window.localStorage.project_name+"/"+i.stored,p.attr("src","file://"+n),parseFloat(window.device.version)>=8&&p.load(),E.removeClass("hidden")}else c.addClass("ui-disabled"),E.addClass("hidden");else switch(window.device.platform){case EC.Const.ANDROID:C(i.cached);break;case EC.Const.IOS:E.removeClass("hidden")}window.device.platform===EC.Const.IOS?window.requestFileSystem(LocalFileSystem.TEMPORARY,0,function(e){console.log(JSON.stringify(e)),o=e.root.nativeURL,console.log("nativeURL: "+o)},function(e){console.log(JSON.stringify(e))}):window.resolveLocalFileSystemURL(cordova.file.externalCacheDirectory,function(e){console.log(JSON.stringify(e)),o=e.nativeURL,console.log("nativeURL: "+o)},function(e){console.log(JSON.stringify(e))});var _=function(e){var t=$("div#input-video input#cached-video-uri");console.log(t.val()),console.log(JSON.stringify(e[0])),r=e[0].fullPath,EC.Notification.showProgressDialog(),$.when(EC.File.moveVideo(r,t.val())).then(function(e){window.device.platform===EC.Const.IOS&&(E.removeClass("hidden"),window.requestFileSystem(LocalFileSystem.TEMPORARY,0,function(n){var o=n.root.nativeURL,r=o+"/"+e;p.attr("src",r),t.val(e),EC.Notification.hideProgressDialog()},function(e){console.log(JSON.stringify(e)),EC.Notification.hideProgressDialog()})),window.device.platform===EC.Const.ANDROID&&(t.val(e),c.attr("data-video-path",e),c.removeClass("ui-disabled"),EC.Notification.hideProgressDialog())})},h=function(e){console.log(e.message)};window.device.platform===EC.Const.ANDROID&&c.off().on("vclick",function(){var e=$(this).attr("data-video-path");window.resolveLocalFileSystemURL(cordova.file.externalCacheDirectory,function(t){var n=t.nativeURL,o=n+"/"+e;window.plugins.videoPlayer.play(o)},function(e){console.log(JSON.stringify(e))})}),l.off().on("vclick",function(){var e={limit:1};navigator.device.capture.captureVideo(_,h,e)})},e}(EC.InputTypes);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.getCachedInputValue=function(e){var t,n,o,r=parseInt(e,10),a=r-1,i={_id:"",type:"",value:EC.Const.SKIPPED,position:"",is_primary_key:""};try{if(t=JSON.parse(window.localStorage.inputs_values),void 0===t[a])return i;for(o=t.length,n=0;o>n;n++)if(null===t[n]&&(t[n]=i),parseInt(t[n].position,10)===r)return window.localStorage.edit_mode&&(window.localStorage.edit_id=t[n]._id,window.localStorage.edit_type=t[n].type),t[n];return i}catch(s){return!1}},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.getCloneValue=function(e){var t,n=e;switch(n){case EC.Const.TEXT:t=$("div.clone input#text-clone").val();break;case EC.Const.TEXTAREA:t=$("div.clone textarea#textarea-clone").val();break;case EC.Const.INTEGER:t=$("div.clone input#integer-clone").val();break;case EC.Const.DECIMAL:t=$("div.clone input#decimal-clone").val();break;case EC.Const.BARCODE:t=$("div.clone input#scan-result-confirm").val()}return t},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.getCurrentValue=function(e){var t,n,o,r,a,i=e,s=[],l=[];switch(i){case EC.Const.TEXT:s.push($("div#input-text input").val()),r=s[0].trim();break;case EC.Const.TEXTAREA:s.push($("div#input-textarea textarea").val()),r=s[0].trim();break;case EC.Const.INTEGER:s.push($("div#input-integer input").val()),r=s[0].trim();break;case EC.Const.DECIMAL:s.push($("div#input-decimal input").val()),r=s[0].trim();break;case EC.Const.DATE:s.push($("div#input-date input").val()),r=s[0];break;case EC.Const.TIME:s.push($("div#input-time input").val()),r=s[0];break;case EC.Const.RADIO:a=$("div#input-radio input[type=radio]:checked"),o={value:"",index:""},o.value=a.val(),o.index=a.attr("data-index"),void 0===o.value?(o.value=EC.Const.NO_OPTION_SELECTED,o.index=EC.Const.NO_OPTION_SELECTED):(o.value.trim(),o.index.trim()),s.push(o),r=s[0];break;case EC.Const.CHECKBOX:$("div#input-checkbox input[type=checkbox]:checked").each(function(){l.push({value:$(this).val().trim(),label:$(this).parent().text().trim()})}),s.push(0===l.length?EC.Const.NO_OPTION_SELECTED:l),r=s[0];break;case EC.Const.DROPDOWN:a=$("div#input-dropdown select option:selected"),o={value:"",index:""},o.value=a.val(),o.index=a.attr("data-index"),"0"===o.index&&(o.index=EC.Const.NO_OPTION_SELECTED),s.push(o),r=s[0];break;case EC.Const.BARCODE:o=$("div#input-barcode input.scan-result").val(),s.push(o),r=s[0];break;case EC.Const.LOCATION:o=EC.DevicePosition.getCoordsFormattedText(),s.push(o),r=s[0];break;case EC.Const.AUDIO:o=EC.Utils.isChrome()?{cached:"...audio cached  uri...",stored:"...audio stored uri..."}:{cached:$("div#input-audio input#cached-audio-uri").val(),stored:$("div#input-audio input#stored-audio-uri").val()},s.push(o),r=s[0];break;case EC.Const.VIDEO:EC.Utils.isChrome()?o={cached:"...video cached  uri...",stored:"...video stored uri..."}:(console.log("getting video file values"),o={cached:$("div#input-video input#cached-video-uri").val(),stored:$("div#input-video input#stored-video-uri").val()},console.log("current_value "+JSON.stringify(o))),s.push(o),r=s[0];break;case EC.Const.PHOTO:EC.Utils.isChrome()?o={cached:"placeholder.jpg",stored:"placeholder.jpg"}:(o={cached:$("div#input-photo input#cached-image-uri").val(),stored:$("div#input-photo input#stored-image-uri").val()},console.log("current_value "+JSON.stringify(o))),s.push(o),r=s[0];break;case EC.Const.BRANCH:t=JSON.parse(window.localStorage.branch_form),n=parseInt($("div#input-branch div#list-branch-entries-btn span span.branch-entries-count").text(),10),o={branch_form_name:t.name,branch_total_entries:isNaN(n)?0:n},console.log(n),s.push(o),r=s[0]}return r},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.getMainFormCurrentKeyValue=function(e){var t=e-1,n=JSON.parse(window.localStorage.inputs_values);return n[t].value},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.isEmptyPrimaryKey=function(){var e,t,n,o=!0;try{e=JSON.parse(window.localStorage.inputs_values)}catch(r){return o}for(n=e.length,t=0;n>t;t++)e[t]&&1===parseInt(e[t].is_primary_key,10)&&(o=""===e[t].value?!0:!1);return o},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.setCachedInputValue=function(e,t,n,o){var r,a,i,s,l,c=window.localStorage,d=e,u=[],E=parseInt(t,10),p=E-1,C=o,_=EC.Utils.isFormGenKeyHidden(window.localStorage.form_id);if(c.edit_mode?(i=c.edit_id,a=c.edit_type):(i="",a=n),(a===EC.Const.DROPDOWN||a===EC.Const.RADIO)&&(d=d.value),a===EC.Const.CHECKBOX&&d!==EC.Const.NO_OPTION_SELECTED){for(l=d.length,s=0;l>s;s++)u.push(d[s].value);d=u}try{r=JSON.parse(c.inputs_values)}catch(h){r=[]}null!==r[p]&&p<r.length&&1===r[p].is_primary_key&&1===_?d=r[p].value:r[p]={_id:i,type:a,value:d,position:E,is_primary_key:C},c.inputs_values=JSON.stringify(r),console.log("input_values: "+c.inputs_values)},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";var t=function(e){var t=[],n=e,o=!0;return t=JSON.parse(window.localStorage.primary_keys),-1!==t.indexOf(n)&&(o=!1),o};return e.validateValue=function(e,n){var o=this,r=e,a=n,i="",s=$("span.label").attr("data-primary-key"),l={};return(r.type===EC.Const.DROPDOWN||r.type===EC.Const.RADIO||r.type===EC.Const.CHECKBOX)&&(a=a.value),1===parseInt(r.has_double_check,10)&&(i=o.getCloneValue(r.type)),l=EC.Utils.isValidValue(r,a,i),l.is_valid?"true"!==s||window.localStorage.edit_mode||t(a)?l:(l={is_valid:!1,message:EC.Localise.getTranslation("value_exist")},console.log("Error: value already exists"),l):l},e}(EC.Inputs);var EC=EC||{};EC.Inputs=EC.Inputs||{},EC.Inputs=function(e){"use strict";return e.valuesMatch=function(e,t,n){var o,r,a,i,s=e,l=t,c=n,d=!1,u=0;switch(c){case EC.Const.DROPDOWN:l.label===s.value&&(d=!0);break;case EC.Const.RADIO:l.label===s.value&&(d=!0);break;case EC.Const.CHECKBOX:if(a=l.length,i=s.value.length,a===i){for(o=0;a>o;o++)for(r=0;i>r;r++)l[o].label.trim()===s.value[r].trim()&&u++;u===a&&(d=!0)}break;default:s===l&&(d=!0)}return d},e}(EC.Inputs);var EC=EC||{};EC.Project=EC.Project||{},EC.Project=function(e){"use strict";function t(e){var t=$("div#forms div#project-options ul li#restore-data-from-backup"),n=$("div#forms div#project-options ul li#email-backup");$("div#forms div#project-options").panel("close"),e?(EC.Notification.showAlert(EC.Localise.getTranslation("success"),EC.Localise.getTranslation("project_backup_success")),t.removeClass("ui-disabled"),n.removeClass("ui-disabled")):EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("generic_error"))}return e.backupCurrentProject=function(){EC.Notification.showProgressDialog();var e=JSON.parse(window.localStorage.forms),n=window.localStorage.project_name,o=parseInt(window.localStorage.project_id,10);$.when(EC.File.backup(e,n,o)).then(function(){EC.Notification.hideProgressDialog(),t(!0)},function(){EC.Notification.hideProgressDialog(),t(!1)})},e}(EC.Project);var EC=EC||{};EC.Project=EC.Project||{},EC.Project=function(e){"use strict";function t(e){var t,o=JSON.parse(window.localStorage.project_names),r=window.decodeURI(e),a=new $.Deferred,i=r.split("/");return t=i[i.length-1],t=t.split("."),t=t[0],console.log("Project names **************************************"),console.log(JSON.stringify(o)),EC.Utils.inArray(o,t,!1)?a.reject():EC.Utils.hasConnection()?(EC.Utils.isChrome()&&(console.log("Testing on Chrome *****************************"),n="xml/"+t+".xml"),n=r,$.when(EC.Project.request(n)).then(function(){$.when(EC.Structure.commitAll()).then(function(){a.resolve()})},function(){a.reject()})):(EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("connection_lost")),a.reject()),a.promise()}var n="",o=[],r=function(){var e=$('div#index div[data-role="header"] div[data-href="home-settings"]'),t=$('div#index div[data-role="header"] div.ui-btn-right[data-href="add-project"]'),n=$('div.home-settings ul li div[data-href="settings"]');e.off().on("vclick",function(e){var t=$(".home-settings");t.panel("open"),n.off().one("vclick",function(e){EC.Routing.changePage(EC.Const.SETTINGS_VIEW)}),$(".ui-panel-dismiss-open").off().on("vclick",function(){t.panel("close")})}),t.off().one("vclick",function(e){window.localStorage.back_nav_url="#refresh",EC.Routing.changePage(EC.Const.ADD_PROJECT_VIEW)})};return e.getList=function(){console.log("EC.Project.getList() called ***********************************");var e,n=this;window.localStorage.removeItem("current_view_url"),window.localStorage.removeItem("upload_URL"),e=EC.Utils.isChrome()?EC.Utils.getParameterByName("project"):window.localStorage.autoload_project_url,$.when(EC.Select.getProjects()).then(function(o){var r,a,i=o,s=[];if(i.length>0)for(a=i.length,r=0;a>r;r++)s.push(i[r].name);window.localStorage.project_names=JSON.stringify(s),console.log("Window Project names **************************************"),console.log(JSON.stringify(window.localStorage.project_names)),""===e?i.length>0?n.renderList(i):n.renderEmptyList():(EC.Notification.showProgressDialog(EC.Localise.getTranslation("wait"),EC.Localise.getTranslation("loading_project")+"/n"+e),$.when(t(e)).then(function(){i.push({_id:EC.Parse.project.insertId,name:EC.Parse.project.name,total_branch_forms:EC.Parse.project.total_branch_forms,total_hierarchy_forms:EC.Parse.project.total_hierarchy_forms}),window.localStorage.autoload_project_url="",EC.Notification.hideProgressDialog(),n.renderList(i)},function(){EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("project_already_loaded")),EC.Notification.hideProgressDialog(),n.renderList(i),window.localStorage.ios_project_form_url=""}))})},e.renderList=function(e){var t,n,a=[],i="",s=$("div#project-list ul"),l=$("a.ui-btn-active span.ui-btn-inner");for(o=e,r(),$("div#empty-list").hide(),s.empty(),t=0,n=o.length;n>t;t++)i+='<li data-icon="ep-next-page" >',i+='<a href="views/forms.html?project='+o[t]._id+"&name="+o[t].name+'">'+o[t].name,i+='<span class="ui-li-count">'+o[t].total_hierarchy_forms,i+="</span>",i+="<p>"+o[t].total_hierarchy_forms+EC.Localise.getTranslation("hierarchy_forms")+", "+o[t].total_branch_forms+EC.Localise.getTranslation("branch_forms")+"</p>",i+="</a>",i+="</li>",a.push(o[t].name);window.localStorage.project_names=JSON.stringify(a),l.text(EC.Const.PROJECT_LIST),s.append(i),s.listview("refresh"),window.localStorage.removeItem("current_position"),window.localStorage.removeItem("form_id"),window.localStorage.removeItem("form_name"),window.localStorage.removeItem("project_id"),window.localStorage.removeItem("project_name"),window.localStorage.removeItem("form_tree"),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),window.setTimeout(function(){$("body").removeClass("hidden")},500),console.log("Language set to "+window.localStorage.DEVICE_LANGUAGE)},e.renderEmptyList=function(){var e=$("div#project-list ul");window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),r(),e.empty(),$("div#index div#empty-list").show(),window.setTimeout(function(){$("body").removeClass("hidden")},500),console.log("project to be loaded = "+EC.Utils.getParameterByName("project")),EC.Notification.hideProgressDialog()},e.deleteProject=function(){var e=parseInt(window.localStorage.project_id,10),t=window.localStorage.project_name;$.when(EC.Delete.deleteProject(e,t)).then(function(){EC.Notification.showToast(EC.Localise.getTranslation("project_deleted"),"short"),window.localStorage.is_project_deleted=1,window.localStorage.back_nav_url="#refresh",EC.Routing.changePage(EC.Const.INDEX_VIEW)},function(){EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("generic_error"))})},e}(EC.Project);var EC=EC||{};EC.Project=EC.Project||{},EC.Project=function(e){"use strict";return e.loadRemoteXML=function(e){var t,n,o,r,a,i=e;try{for(t=JSON.parse(window.localStorage.project_names),o=t.length,n=0;o>n;n++)if(t[n]===i)return void EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("project_already_loaded"))}catch(s){console.log("no projects on device yet")}EC.Utils.isURL(i)?r=i:(a=window.localStorage.project_server_url,r=a+i+".xml"),EC.Notification.showProgressDialog(),$.when(EC.Project.request(r)).then(function(){$.when(EC.Structure.commitAll()).then(function(){EC.Routing.changePage(EC.Const.INDEX_VIEW)})},function(){console.log("request failed")})},e}(EC.Project);var EC=EC||{};EC.Project=EC.Project||{},EC.Project=function(e){"use strict";var t,n,o,r,a,i=function(){EC.Utils.hasConnection()?s():EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("no_internet"))},s=function(){var e=o.val();return""===e?(EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("project_empty_not_allowed")),void t.off().one("vclick",i)):/\s/.test(e)?(EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("project_no_spaces_allowed")),void t.off().one("vclick",i)):void EC.Project.loadRemoteXML(e)};return e.renderAddProjectView=function(){var e,s=$("div#add-project-content ul#projects-autocomplete");t=$("div#add-project div[data-role='header'] div.ui-btn-right[data-href='load-project-confirm']"),n=$("div#add-project div[data-role='header'] div[data-href='back-btn']"),o=$("div#add-project-content form div input[data-type='search']"),r=$(".autocomplete-spinner-loader"),a=window.localStorage.project_server_url,window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),o.val(""),s.on("listviewbeforefilter",function(t,n){console.log("typing");var o=$(this),a=$(n.input),i=a.val(),s="",l=200;o.html(""),i&&i.length>2&&(r.removeClass("hidden"),o.html('<li class="autocomplete-spinner"><i class="fa fa-spinner fa-spin"></i></li>'),o.listview("refresh"),clearTimeout(e),e=setTimeout(function(){console.log("requesting"),$.ajax({url:"http://plus.epicollect.net/projects?q="+i+"&limit=25",dataType:"json",crossDomain:!0,success:function(e){r.addClass("hidden"),$.each(e,function(t){s+="<li class='h-nav-item'>"+e[t].name+"</li>"}),o.html(s),o.listview("refresh"),o.trigger("updatelayout")},error:function(e,t,n){r.addClass("hidden")}})},l))}),s.on("vclick",function(e){"li"===e.target.tagName.toLowerCase()&&(o.val(e.target.innerText),o.attr("value",e.target.innerText))}),t.off().on("vclick",i),n.off().one("vclick",function(e){window.localStorage.back_nav_url="#refresh",EC.Routing.changePage(EC.Const.INDEX_VIEW,"../")})},e}(EC.Project);var EC=EC||{};EC.Project=EC.Project||{},EC.Project=function(e){"use strict";var t,n;return e.request=function(e){return t=e,console.log("doing request: "+t),n=new $.Deferred,$.ajax({url:t,type:"get",crossDomain:!0,dataType:"xml",timeout:3e4,success:function(e){var t=!0;return t=EC.Parse.parseXML(e),t===!1?(EC.Notification.hideProgressDialog(),EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("invalid_xml")),void n.reject()):void n.resolve()},error:function(e,t,o){switch(EC.Utils.sleep(1e3),EC.Notification.hideProgressDialog(),console.log(t+", "+o),t){case"parsererror":EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("invalid_xml"));break;case"timeout":EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("connection_timeout"));break;default:if("Page not found"===o)return void EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("project_not_found_on_server")+window.localStorage.project_server_url);if("Not Found"===o)return void EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("project_not_found"));EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("unknow_error"))}n.reject()}}),n.promise()},e}(EC.Project);var EC=EC||{};EC.Project=EC.Project||{},EC.Project=function(e){"use strict";return e.restoreFromBackup=function(){var e=window.localStorage.project_name,t=window.localStorage.project_id,n=function(e){{var t,n;$("div#forms-list ul li"),$("div#forms-list ul")}n=JSON.parse(window.localStorage.forms),t=parseInt(window.localStorage.project_id,10),e?(EC.Notification.showAlert(EC.Localise.getTranslation("success"),EC.Localise.getTranslation("project_restored")),$.when(EC.Select.getForms(t)).then(function(e,t){EC.Forms.renderList(e,t),$("div#forms div#project-options").panel("close")})):EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("generic_error"))};EC.Notification.showProgressDialog(),$.when(EC.Delete.deleteAllEntries(EC.Const.RESTORE,e,t)).then(function(o){$.when(EC.Select.getLocalInputIDs(o)).then(function(o){window.localStorage.local_input_ids=JSON.stringify(o),$.when(EC.File.restoreFromBackup(e,t)).then(function(){EC.Notification.hideProgressDialog(),n(!0)})})})},e}(EC.Project);var EC=EC||{};EC.Settings=EC.Settings||{},EC.Settings=function(){"use strict";var e,t,n,o,r,a,i,s,l,c=function(){e=window.localStorage.project_server_url,t=$("div#settings").find("div#settings-values").find("input#project-server-url"),o=$('div#settings div[data-role="header"] div.ui-btn-right[data-href="save-settings"]'),r=$('div#settings div[data-role="header"] div[data-href="back-btn"]'),a=$("div#settings div#settings-values p#version-name span.version"),n=$('form#pagination-options input[type="radio"]'),l=$("div#settings div#settings-values input#enhanced-location-google-maps"),i=window.localStorage.project_name,s=$('div#settings div[data-role="header"] div[data-href="back-btn"] span.project-name'),$.when(EC.Utils.getVersionName()).then(function(e){a.text(e)}),t.val(e),s.text(i?i.trunc(EC.Const.PROJECT_NAME_MAX_LENGTH):EC.Const.PROJECT_LIST),o.off().one("vclick",function(e){window.localStorage.project_server_url=t.val(),window.localStorage.is_enhanced_map_on=l.is(":checked")?1:0,n.each(function(e){var t=$(this).is(":checked");t&&(console.log($(this).val()),window.localStorage.QUERY_LIMIT=$(this).val())}),EC.Utils.isChrome()||EC.Notification.showToast(EC.Localise.getTranslation("settings_saved_success"),"short"),window.localStorage.current_view_url?EC.Routing.changePage(window.localStorage.current_view_url):window.history.back(-1)}),r.off().one("vclick",function(e){window.localStorage.current_view_url?EC.Routing.changePage(window.localStorage.current_view_url):window.history.back(-1)}),n.each(function(e){$(this).val()===window.localStorage.QUERY_LIMIT&&$(this).prop("checked",!0).checkboxradio("refresh")}),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE)};return{renderView:c}}();var EC=EC||{};EC.Upload=EC.Upload||{},EC.Upload=function(e){"use strict";return e.bindUploadButtons=function(e){var t,n,o=this,r=$("div#upload div[data-role='header'] div[data-href='back-btn'] span"),a=e,i=window.localStorage.project_name,s=parseInt(window.localStorage.project_id,10);o.upload_data_btn=$("div#upload div#upload-options div#upload-data-btn"),o.upload_images_btn=$("div#upload div#upload-options div#upload-images-btn"),o.upload_audios_btn=$("div#upload div#upload-options div#upload-audios-btn"),o.upload_videos_btn=$("div#upload div#upload-options div#upload-videos-btn"),o.back_btn=$("div#upload div[data-role='header'] div[data-href='back-btn']"),o.all_synced_message=$("div#upload div#upload-options .all-synced-message"),t="forms.html?project="+s+"&name="+i,a&&r.text("Forms"),r.text(window.localStorage.back_nav_url&&"#refresh"!==window.localStorage.back_nav_url?"Entries":"Forms"),o.back_btn.off().one("vclick",function(e){window.history.back(-1)}),o.upload_data_btn.off().on("vclick",function(e){return EC.Utils.hasConnection()?(o.hierarchy_rows_to_sync=[],o.branch_rows_to_sync=[],EC.Notification.showProgressDialog(EC.Localise.getTranslation("uploaded"),EC.Localise.getTranslation("wait")),void(o.is_branch_entry?o.prepareOneBranchEntry(o.current_branch_form.name,o.current_branch_entry):o.prepareOneHierarchyEntry(o.current_form.name,o.current_entry))):void EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("no_internet"))}),o.upload_images_btn.off().on("vclick",function(e){return EC.Utils.hasConnection()?(EC.Notification.showProgressDialog(EC.Localise.getTranslation("uploaded"),EC.Localise.getTranslation("wait")),n=EC.Const.PHOTO_DIR,void EC.File.uploadFile(o.current_image_file,n)):void EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("no_internet"))}),o.upload_audios_btn.off().on("vclick",function(e){return EC.Utils.hasConnection()?(EC.Notification.showProgressDialog(EC.Localise.getTranslation("uploaded"),EC.Localise.getTranslation("wait")),n=EC.Const.AUDIO_DIR,void EC.File.uploadFile(o.current_audio_file,n)):void EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("no_internet"))}),o.upload_videos_btn.off().on("vclick",function(e){return EC.Utils.hasConnection()?(EC.Notification.showProgressDialog(EC.Localise.getTranslation("uploaded"),EC.Localise.getTranslation("wait")),n=EC.Const.VIDEO_DIR,void EC.File.uploadFile(o.current_video_file,n)):void EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("no_internet"))})},e}(EC.Upload);var EC=EC||{};EC.Upload=EC.Upload||{},EC.Upload=function(e){"use strict";return e.handleMedia=function(){var e=this;e.audio_synced=!0,e.photo_synced=!0,e.video_synced=!0;var t=function(t){var n=new $.Deferred;return e.current_audio_file=t,e.current_audio_file?(e.is_branch_audio=!1,e.upload_audios_btn.removeClass("ui-disabled"),e.audio_synced=!1,n.resolve()):e.has_branches?$.when(EC.Select.getOneBranchAudioFile(e.project_id,EC.Const.AUDIO)).then(function(t){e.current_audio_file=t,e.is_branch_audio=!0,e.upload_audios_btn.removeClass("ui-disabled"),e.audio_synced=!1,n.resolve()},function(){n.resolve()}):n.resolve(),n.promise()},n=function(t){var n=new $.Deferred;return e.current_image_file=t,e.current_image_file?(e.is_branch_image=!1,e.upload_images_btn.removeClass("ui-disabled"),e.photo_synced=!1,n.resolve()):e.has_branches?$.when(EC.Select.getOneBranchPhotoFile(e.project_id,EC.Const.PHOTO)).then(function(t){e.current_image_file=t,e.is_branch_image=!0,e.upload_images_btn.removeClass("ui-disabled"),e.photo_synced=!1,n.resolve()},function(){n.resolve()}):n.resolve(),n.promise()},o=function(t){var n=new $.Deferred;return e.current_video_file=t,e.current_video_file?(e.video_synced=!1,EC.Upload.is_branch_video=!1,e.upload_videos_btn.removeClass("ui-disabled"),n.resolve()):e.has_branches?$.when(EC.Select.getOneBranchVideoFile(e.project_id,EC.Const.VIDEO)).then(function(t){e.current_video_file=t,e.video_synced=!1,e.is_branch_video=!0,e.upload_videos_btn.removeClass("ui-disabled"),n.resolve()},function(){n.resolve()}):n.resolve(),n.promise()};$.when(EC.Select.getOneHierarchyMediaPerType(e.project_id)).then(function(r,a,i){e.current_image_file=r,e.current_audio_file=a,e.current_video_file=i,$.when(n(e.current_image_file),t(e.current_audio_file),o(e.current_video_file)).then(function(){e.audio_synced&&e.photo_synced&&e.video_synced?e.all_synced_message.removeClass("hidden"):e.all_synced_message.addClass("hidden")})},function(){e.all_synced_message.removeClass("hidden")})},e}(EC.Upload);var EC=EC||{};EC.Upload=function(e){"use strict";return e.project_id="",e.project_name="",e.hierarchy_rows_to_sync=[],e.branch_rows_to_sync=[],e.main_rows_to_post=[],e.main_entries=[],e.hierarchy_forms=[],e.action=EC.Const.START_HIERARCHY_UPLOAD,e.current_entry={},e.current_branch_entry={},e.current_form={},e.current_branch_form={},e.has_branches=!1,e.audio_synced="",e.photo_synced="",e.video_synced="",e.current_image_file="",e.current_audio_file="",e.current_video_file="",e.upload_data_btn="",e.upload_images_btn="",e.upload_audios_btn="",e.upload_videos_btn="",e.upload_data_feedback="",e.back_btn="",e.all_synced_message="",e.setUploadURL=function(e){window.localStorage.upload_URL=e},e.getUploadURL=function(){return EC.Utils.isChrome()?"test.php":window.localStorage.upload_URL},e}(EC.Upload);var EC=EC||{};EC.Upload=EC.Upload||{},EC.Upload=function(e){"use strict";var t,n,o;return e.branch_rows_to_sync=[],e.postBranchEntries=function(e){var r=this;t=r.branch_form_name,n=parseInt(window.localStorage.project_id,10),o=e,EC.Select.getOneBranchEntry(t,n,o)},e}(EC.Upload);var EC=EC||{};EC.Upload=EC.Upload||{},EC.Upload=function(e){"use strict";return e.postOneBranchEntry=function(){var e,t=this,n=parseInt(window.localStorage.project_id,10);console.log(t.branch_entry_post_obj),e=t.getUploadURL(),EC.Utils.isChrome()||e||$.when(EC.Select.getUploadURL(n)).then(function(t){console.log("Project URL is: "+t),e=t}),$.ajax({type:"POST",url:e,crossDomain:!0,timeout:2e4,data:$.param(t.branch_entry_post_obj),success:function(e){"1"===e?(t.branch_entry_post_obj={},EC.Update.setBranchEntryAsSynced(t.branch_rows_to_sync).then(function(){t.action=EC.Const.BRANCH_RECURSION,EC.Select.getOneBranchEntry(n,t.current_branch_form.name,!1)})):$.when(EC.Select.getOneBranchEntry(t.current_branch_form).then(function(e){EC.Upload.current_entry=e,EC.Notification.hideProgressDialog(),EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("upload_error")),t.branch_rows_to_sync.length=0}))},error:function(e,n,o){console.log(n+", "+o),console.log("request: "+JSON.stringify(e)),$.when(EC.Select.getOneBranchEntry(t.current_branch_form).then(function(e){EC.Upload.current_entry=e,t.branch_rows_to_sync.length=0,EC.Notification.hideProgressDialog(),"error"===n&&""===o&&EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("connection_lost")),"timeout"===n&&"timeout"===o&&EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("connection_timeout"))}))}})},e}(EC.Upload);var EC=EC||{};EC.Upload=EC.Upload||{},EC.Upload=function(e){"use strict";return e.postOneHierarchyEntry=function(){function e(){$.ajax({type:"POST",url:t,crossDomain:!0,timeout:2e4,data:$.param(n.hierarchy_entry_post_obj),success:function(e){"1"===e?(n.hierarchy_entry_post_obj={},EC.Update.setHierarchyEntryAsSynced(n.hierarchy_rows_to_sync).then(function(){n.action=EC.Const.HIERARCHY_RECURSION,EC.Select.getOneHierarchyEntry(n.current_form,!1)})):$.when(EC.Select.getOneHierarchyEntry(n.current_form).then(function(e){EC.Upload.current_entry=e,EC.Notification.hideProgressDialog(),EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("upload_error")),n.hierarchy_rows_to_sync.length=0}))},error:function(e,t,o){EC.Notification.hideProgressDialog(),console.log(t+", "+o),console.log("request: "+JSON.stringify(e)),$.when(EC.Select.getOneHierarchyEntry(n.current_form,!0).then(function(r){EC.Upload.current_entry=r,n.hierarchy_rows_to_sync.length=0,EC.Notification.hideProgressDialog(),"error"===t&&""===o&&EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("connection_lost")),"timeout"===t&&"timeout"===o&&EC.Notification.showAlert(EC.Localise.getTranslation("error"),EC.Localise.getTranslation("connection_timeout")),405===e.status&&EC.Notification.showAlert(EC.Localise.getTranslation("error"),e.responseText),403===e.status&&EC.Notification.showAlert(EC.Localise.getTranslation("error"),o+EC.Localise.getTranslation("check_your_internet"))}))}})}var t,n=this,o=parseInt(window.localStorage.project_id,10);

console.log(n.hierarchy_entry_post_obj),t=n.getUploadURL(),EC.Utils.isChrome()||t?e():$.when(EC.Select.getUploadURL(o)).then(function(n){console.log("Project URL is: "+n),t=n,e()})},e}(EC.Upload);var EC=EC||{};EC.Upload=EC.Upload||{},EC.Upload=function(e){"use strict";var t;return e.branch_entry_post_obj={},e.prepareOneBranchEntry=function(e,n){var o=n;t=this,t.values=o.values,t.branch_entry_key=o.entry_key,t.branch_rows_to_sync=[],t.branch_entry_post_obj.table=e,t.branch_entry_post_obj[o.hierarchy_entry_key_ref]=o.hierarchy_entry_key_value,t.branch_entry_post_obj.ecTimeCreated=o.created_on,t.branch_entry_post_obj.ecPhoneID=EC.Utils.getPhoneUUID(),t.appendBranchEntryValue(t.values.shift(),t.branch_entry_key)},e.appendBranchEntryValue=function(e){var t,n,o=this;t=e.value,n=e.ref,""!==e._id&&o.branch_rows_to_sync.push({_id:e._id}),o.branch_entry_post_obj[n]=t,o.values.length>0?o.appendBranchEntryValue(o.values.shift(),o.branch_entry_key):o.postOneBranchEntry()},e}(EC.Upload);var EC=EC||{};EC.Upload=EC.Upload||{},EC.Upload=function(e){"use strict";return e.values=[],e.main_entry_key=[],e.branch_form_name="",e.hierarchy_entry_post_obj={},e.prepareOneHierarchyEntry=function(e,t){var n,o,r=this,a=t;r.values=a.values,r.hierarchy_rows_to_sync=[],r.hierarchy_entry_post_obj.table=e,r.hierarchy_entry_post_obj.ecTimeCreated=a.created_on,r.hierarchy_entry_post_obj.ecPhoneID=EC.Utils.getPhoneUUID(),void 0!==a.parent_ref&&(n=a.parent_ref,o=a.parent_key_value,r.hierarchy_entry_post_obj[n]=o),r.appendEntryValue(r.values.shift())},e.appendEntryValue=function(e){var t,n,o=this;t=e.value,n=e.ref,""!==e._id&&o.hierarchy_rows_to_sync.push({_id:e._id,type:e.type}),e.type!==EC.Const.BRANCH&&(o.hierarchy_entry_post_obj[n]=t),o.values.length>0?o.appendEntryValue(o.values.shift()):(console.log(o.hierarchy_entry_post_obj),o.postOneHierarchyEntry())},e}(EC.Upload);var EC=EC||{};EC.Upload=EC.Upload||{},EC.Upload=function(e){"use strict";return e.renderUploadView=function(e){function t(e){o.current_entry=e,o.is_branch_entry=!1,o.upload_data_btn.removeClass("ui-disabled"),o.all_synced_message.addClass("hidden")}function n(){if(console.log("No unsynced hierarchy data entry found"),o.branch_forms=[],o.has_branches){var e=function(e){o.current_branch_entry=e,o.is_branch_entry=!0,o.upload_data_btn.removeClass("ui-disabled"),o.all_synced_message.addClass("hidden")},t=function(){o.handleMedia()};o.action=EC.Const.START_BRANCH_UPLOAD,$.when(EC.Select.getBranchForms(o.project_id)).then(function(n){o.branch_forms=n,o.current_branch_form=o.branch_forms.shift(),$.when(EC.Select.getOneBranchEntry(o.project_id,o.current_branch_form.name,!0).then(e,t))})}else o.handleMedia()}var o=this,r=e;o.project_name=window.localStorage.project_name,o.project_id=parseInt(window.localStorage.project_id,10),o.has_branches=EC.Utils.projectHasBranches(),o.hierarchy_forms=JSON.parse(window.localStorage.forms),o.current_form=o.hierarchy_forms.shift(),o.current_entry={},o.action=EC.Const.START_HIERARCHY_UPLOAD,console.log(o.project_name.trunc(EC.Const.PROJECT_NAME_MAX_LENGTH)),$("div#upload div[data-role='navbar'] ul li.title-tab span#upload-label span.project-name").text(o.project_name.trunc(EC.Const.PROJECT_NAME_MAX_LENGTH)),o.bindUploadButtons(r,o),window.localStorage.DEVICE_LANGUAGE!==EC.Const.ENGLISH&&EC.Localise.applyToHTML(window.localStorage.DEVICE_LANGUAGE),o.is_branch_image=!1,o.is_branch_audio=!1,o.is_branch_video=!1,$.when(EC.Select.getOneHierarchyEntry(o.current_form,!0).then(t,n))},e}(EC.Upload);var EC=EC||{};EC.Upload=EC.Upload||{},EC.Upload=function(e){"use strict";return e.renderUploadViewFeedback=function(e){var t=this;EC.Notification.hideProgressDialog(),(t.action===EC.Const.STOP_HIERARCHY_UPLOAD||t.action===EC.Const.STOP_BRANCH_UPLOAD)&&e&&(t.upload_data_btn.addClass("ui-disabled"),t.all_synced_message.removeClass("hidden"),EC.Notification.showToast(EC.Localise.getTranslation("data_upload_success"),"short"),t.handleMedia())},e}(EC.Upload);var EC=EC||{};EC.Upload=EC.Upload||{},EC.Upload=function(e){"use strict";var t,n,o;return e.uploadNextFile=function(e){var r,a=this,i=parseInt(window.localStorage.project_id,10),s=$("div#upload div#upload-options .all-synced-message");switch(e){case EC.Const.PHOTO:$.when(EC.Select.getOneHierarchyMediaFile(i,EC.Const.PHOTO).then(function(e){r=EC.Const.PHOTO_DIR,EC.Upload.is_branch_image=!1,EC.File.uploadFile(e,r)},function(){$.when(EC.Select.getOneBranchPhotoFile(i)).then(function(e){r=EC.Const.PHOTO_DIR,EC.Upload.is_branch_image=!0,EC.File.uploadFile(e,r)},function(){t=$("div#upload div#upload-options div#upload-images-btn"),t.addClass("ui-disabled"),a.photo_synced=!0,a.audio_synced&&a.photo_synced&&a.video_synced?s.removeClass("hidden"):s.addClass("hidden"),EC.Notification.hideProgressDialog(),EC.Notification.showToast(EC.Localise.getTranslation("all_images_uploaded"),"short")})}));break;case EC.Const.AUDIO:$.when(EC.Select.getOneHierarchyMediaFile(i,EC.Const.AUDIO).then(function(e){r=EC.Const.AUDIO_DIR,EC.Upload.is_branch_audio=!1,EC.File.uploadFile(e,r)},function(){$.when(EC.Select.getOneBranchAudioFile(i)).then(function(e){r=EC.Const.AUDIO_DIR,EC.Upload.is_branch_audio=!0,EC.File.uploadFile(e,r)},function(){n=$("div#upload div#upload-options div#upload-audios-btn"),n.addClass("ui-disabled"),a.audio_synced=!0,a.audio_synced&&a.photo_synced&&a.video_synced?s.removeClass("hidden"):s.addClass("hidden"),EC.Notification.hideProgressDialog(),EC.Notification.showToast(EC.Localise.getTranslation("all_audios_uploaded"),"short")})}));break;case EC.Const.VIDEO:$.when(EC.Select.getOneHierarchyMediaFile(i,EC.Const.VIDEO).then(function(e){r=EC.Const.VIDEO_DIR,EC.File.uploadFile(e,r)},function(){$.when(EC.Select.getOneBranchVideoFile(i)).then(function(e){r=EC.Const.VIDEO_DIR,EC.Upload.is_branch_video=!0,EC.File.uploadFile(e,r)},function(){o=$("div#upload div#upload-options div#upload-videos-btn"),o.addClass("ui-disabled"),a.video_synced=!0,a.audio_synced&&a.photo_synced&&a.video_synced?s.removeClass("hidden"):s.addClass("hidden"),EC.Notification.hideProgressDialog(),EC.Notification.showToast(EC.Localise.getTranslation("all_videos_uploaded"),"short")})}))}},e}(EC.Upload);var EC=EC||{};EC.Test=EC.Test||{},EC.Test=function(e){"use strict";function t(e){var t,n="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(t=0;e>t;t++)n+=o.charAt(Math.floor(Math.random()*o.length));return n}var n,o,r=function(e){var o,r,a,i=n,s=0;for(o=0;i>o;o++)r="",a={},a.parent="",a.is_data_synced=0,a.is_media_synced=0,a.created_on=EC.Utils.getTimestamp(),o%2===0?(a.label="ID",a.ref="id",r+="INSERT INTO ec_data (",r+="input_id, ",r+="form_id, ",r+="position, ",r+="parent, ",r+="label, ",r+="ref, ",r+="value, ",r+="is_title, ",r+="entry_key, ",r+="type, ",r+="created_on, ",r+="is_data_synced, ",r+="is_remote, ",r+="is_media_synced) ",r+='VALUES ("',r+='1", "',r+='1", "',r+='1", "',r+=a.parent+'", "',r+=a.label+'", "',r+=a.ref+'", "',r+=o+1e4+'", "',r+='1", "',r+=o+1e4+'", "',r+=EC.Const.INTEGER+'", "',r+=a.created_on+'", "',r+=a.is_data_synced+'", "',r+=s+'", "',r+=a.is_media_synced+'");'):(a.label="Name",a.ref="ecplus_form_ctrl2",r+="INSERT INTO ec_data (",r+="input_id, ",r+="form_id, ",r+="position, ",r+="parent, ",r+="label, ",r+="ref, ",r+="value, ",r+="is_title, ",r+="entry_key, ",r+="type, ",r+="created_on, ",r+="is_data_synced, ",r+="is_remote, ",r+="is_media_synced) ",r+='VALUES ("',r+='2", "',r+='1", "',r+='2", "',r+=a.parent+'", "',r+=a.label+'", "',r+=a.ref+'", "',r+=t(25)+'", "',r+='1", "',r+=o-1+1e4+'", "',r+=EC.Const.TEXT+'", "',r+=a.created_on+'", "',r+=a.is_data_synced+'", "',r+=s+'", "',r+=a.is_media_synced+'");'),e.executeSql(r,[],l,c)},a=function(){},i=function(e){var t="UPDATE ec_forms SET entries = entries + "+n/2+" WHERE _id=?";e.executeSql(t,[1],a,c)},s=function(){o.resolve()},l=function(){console.log("FORM VALUE SQL QUERY SUCCESS")},c=function(e,t){console.log(t),o.reject()},d=function(){EC.db.transaction(i,c,s)};return e.insertEntries=function(e){return n=e,o=new $.Deferred,EC.db.transaction(r,c,d),o.promise()},e}(EC.Test);
//# sourceMappingURL=build-android.js.map